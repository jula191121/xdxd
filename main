function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
!function(e, t) {
    "use strict";
    "object" == ("undefined" == typeof module ? "undefined" : _typeof(module)) && "object" == _typeof(module.exports) ? module.exports = e.document ? t(e, !0) : function(e) {
        if (!e.document)
            throw new Error("jQuery requires a window with a document");
        return t(e)
    }
    : t(e)
}("undefined" != typeof window ? window : this, (function(e, t) {
    "use strict";
    var n = []
      , r = Object.getPrototypeOf
      , i = n.slice
      , o = n.flat ? function(e) {
        return n.flat.call(e)
    }
    : function(e) {
        return n.concat.apply([], e)
    }
      , a = n.push
      , s = n.indexOf
      , u = {}
      , l = u.toString
      , c = u.hasOwnProperty
      , f = c.toString
      , p = f.call(Object)
      , d = {}
      , h = function(e) {
        return "function" == typeof e && "number" != typeof e.nodeType && "function" != typeof e.item
    }
      , g = function(e) {
        return null != e && e === e.window
    }
      , v = e.document
      , y = {
        type: !0,
        src: !0,
        nonce: !0,
        noModule: !0
    };
    function m(e, t, n) {
        var r, i, o = (n = n || v).createElement("script");
        if (o.text = e,
        t)
            for (r in y)
                (i = t[r] || t.getAttribute && t.getAttribute(r)) && o.setAttribute(r, i);
        n.head.appendChild(o).parentNode.removeChild(o)
    }
    function x(e) {
        return null == e ? e + "" : "object" == _typeof(e) || "function" == typeof e ? u[l.call(e)] || "object" : _typeof(e)
    }
    var b = "3.6.0"
      , w = function e(t, n) {
        return new e.fn.init(t,n)
    };
    function T(e) {
        var t = !!e && "length"in e && e.length
          , n = x(e);
        return !h(e) && !g(e) && ("array" === n || 0 === t || "number" == typeof t && 0 < t && t - 1 in e)
    }
    w.fn = w.prototype = {
        jquery: b,
        constructor: w,
        length: 0,
        toArray: function() {
            return i.call(this)
        },
        get: function(e) {
            return null == e ? i.call(this) : e < 0 ? this[e + this.length] : this[e]
        },
        pushStack: function(e) {
            var t = w.merge(this.constructor(), e);
            return t.prevObject = this,
            t
        },
        each: function(e) {
            return w.each(this, e)
        },
        map: function(e) {
            return this.pushStack(w.map(this, (function(t, n) {
                return e.call(t, n, t)
            }
            )))
        },
        slice: function() {
            return this.pushStack(i.apply(this, arguments))
        },
        first: function() {
            return this.eq(0)
        },
        last: function() {
            return this.eq(-1)
        },
        even: function() {
            return this.pushStack(w.grep(this, (function(e, t) {
                return (t + 1) % 2
            }
            )))
        },
        odd: function() {
            return this.pushStack(w.grep(this, (function(e, t) {
                return t % 2
            }
            )))
        },
        eq: function(e) {
            var t = this.length
              , n = +e + (e < 0 ? t : 0);
            return this.pushStack(0 <= n && n < t ? [this[n]] : [])
        },
        end: function() {
            return this.prevObject || this.constructor()
        },
        push: a,
        sort: n.sort,
        splice: n.splice
    },
    w.extend = w.fn.extend = function() {
        var e, t, n, r, i, o, a = arguments[0] || {}, s = 1, u = arguments.length, l = !1;
        for ("boolean" == typeof a && (l = a,
        a = arguments[s] || {},
        s++),
        "object" == _typeof(a) || h(a) || (a = {}),
        s === u && (a = this,
        s--); s < u; s++)
            if (null != (e = arguments[s]))
                for (t in e)
                    r = e[t],
                    "__proto__" !== t && a !== r && (l && r && (w.isPlainObject(r) || (i = Array.isArray(r))) ? (n = a[t],
                    o = i && !Array.isArray(n) ? [] : i || w.isPlainObject(n) ? n : {},
                    i = !1,
                    a[t] = w.extend(l, o, r)) : void 0 !== r && (a[t] = r));
        return a
    }
    ,
    w.extend({
        expando: "jQuery" + (b + Math.random()).replace(/\D/g, ""),
        isReady: !0,
        error: function(e) {
            throw new Error(e)
        },
        noop: function() {},
        isPlainObject: function(e) {
            var t, n;
            return !(!e || "[object Object]" !== l.call(e) || (t = r(e)) && ("function" != typeof (n = c.call(t, "constructor") && t.constructor) || f.call(n) !== p))
        },
        isEmptyObject: function(e) {
            var t;
            for (t in e)
                return !1;
            return !0
        },
        globalEval: function(e, t, n) {
            m(e, {
                nonce: t && t.nonce
            }, n)
        },
        each: function(e, t) {
            var n, r = 0;
            if (T(e))
                for (n = e.length; r < n && !1 !== t.call(e[r], r, e[r]); r++)
                    ;
            else
                for (r in e)
                    if (!1 === t.call(e[r], r, e[r]))
                        break;
            return e
        },
        makeArray: function(e, t) {
            var n = t || [];
            return null != e && (T(Object(e)) ? w.merge(n, "string" == typeof e ? [e] : e) : a.call(n, e)),
            n
        },
        inArray: function(e, t, n) {
            return null == t ? -1 : s.call(t, e, n)
        },
        merge: function(e, t) {
            for (var n = +t.length, r = 0, i = e.length; r < n; r++)
                e[i++] = t[r];
            return e.length = i,
            e
        },
        grep: function(e, t, n) {
            for (var r = [], i = 0, o = e.length, a = !n; i < o; i++)
                !t(e[i], i) !== a && r.push(e[i]);
            return r
        },
        map: function(e, t, n) {
            var r, i, a = 0, s = [];
            if (T(e))
                for (r = e.length; a < r; a++)
                    null != (i = t(e[a], a, n)) && s.push(i);
            else
                for (a in e)
                    null != (i = t(e[a], a, n)) && s.push(i);
            return o(s)
        },
        guid: 1,
        support: d
    }),
    "function" == typeof Symbol && (w.fn[Symbol.iterator] = n[Symbol.iterator]),
    w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), (function(e, t) {
        u["[object " + t + "]"] = t.toLowerCase()
    }
    ));
    var C = function(e) {
        var t, n, r, i, o, a, s, u, l, c, f, p, d, h, g, v, y, m, x, b = "sizzle" + 1 * new Date, w = e.document, T = 0, C = 0, E = ue(), S = ue(), k = ue(), A = ue(), N = function(e, t) {
            return e === t && (f = !0),
            0
        }, j = {}.hasOwnProperty, D = [], q = D.pop, L = D.push, H = D.push, O = D.slice, P = function(e, t) {
            for (var n = 0, r = e.length; n < r; n++)
                if (e[n] === t)
                    return n;
            return -1
        }, R = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", M = "[\\x20\\t\\r\\n\\f]", I = "(?:\\\\[\\da-fA-F]{1,6}" + M + "?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+", _ = "\\[" + M + "*(" + I + ")(?:" + M + "*([*^$|!~]?=)" + M + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + I + "))|)" + M + "*\\]", W = ":(" + I + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + _ + ")*)|.*)\\)|)", F = new RegExp(M + "+","g"), B = new RegExp("^" + M + "+|((?:^|[^\\\\])(?:\\\\.)*)" + M + "+$","g"), $ = new RegExp("^" + M + "*," + M + "*"), z = new RegExp("^" + M + "*([>+~]|" + M + ")" + M + "*"), U = new RegExp(M + "|>"), X = new RegExp(W), V = new RegExp("^" + I + "$"), G = {
            ID: new RegExp("^#(" + I + ")"),
            CLASS: new RegExp("^\\.(" + I + ")"),
            TAG: new RegExp("^(" + I + "|[*])"),
            ATTR: new RegExp("^" + _),
            PSEUDO: new RegExp("^" + W),
            CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + M + "*(even|odd|(([+-]|)(\\d*)n|)" + M + "*(?:([+-]|)" + M + "*(\\d+)|))" + M + "*\\)|)","i"),
            bool: new RegExp("^(?:" + R + ")$","i"),
            needsContext: new RegExp("^" + M + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + M + "*((?:-\\d)?\\d*)" + M + "*\\)|)(?=[^-]|$)","i")
        }, Y = /HTML$/i, Q = /^(?:input|select|textarea|button)$/i, J = /^h\d$/i, K = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, ee = /[+~]/, te = new RegExp("\\\\[\\da-fA-F]{1,6}" + M + "?|\\\\([^\\r\\n\\f])","g"), ne = function(e, t) {
            var n = "0x" + e.slice(1) - 65536;
            return t || (n < 0 ? String.fromCharCode(n + 65536) : String.fromCharCode(n >> 10 | 55296, 1023 & n | 56320))
        }, re = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g, ie = function(e, t) {
            return t ? "\0" === e ? "ï¿½" : e.slice(0, -1) + "\\" + e.charCodeAt(e.length - 1).toString(16) + " " : "\\" + e
        }, oe = function() {
            p()
        }, ae = be((function(e) {
            return !0 === e.disabled && "fieldset" === e.nodeName.toLowerCase()
        }
        ), {
            dir: "parentNode",
            next: "legend"
        });
        try {
            H.apply(D = O.call(w.childNodes), w.childNodes),
            D[w.childNodes.length].nodeType
        } catch (t) {
            H = {
                apply: D.length ? function(e, t) {
                    L.apply(e, O.call(t))
                }
                : function(e, t) {
                    for (var n = e.length, r = 0; e[n++] = t[r++]; )
                        ;
                    e.length = n - 1
                }
            }
        }
        function se(e, t, r, i) {
            var o, s, l, c, f, h, y, m = t && t.ownerDocument, w = t ? t.nodeType : 9;
            if (r = r || [],
            "string" != typeof e || !e || 1 !== w && 9 !== w && 11 !== w)
                return r;
            if (!i && (p(t),
            t = t || d,
            g)) {
                if (11 !== w && (f = Z.exec(e)))
                    if (o = f[1]) {
                        if (9 === w) {
                            if (!(l = t.getElementById(o)))
                                return r;
                            if (l.id === o)
                                return r.push(l),
                                r
                        } else if (m && (l = m.getElementById(o)) && x(t, l) && l.id === o)
                            return r.push(l),
                            r
                    } else {
                        if (f[2])
                            return H.apply(r, t.getElementsByTagName(e)),
                            r;
                        if ((o = f[3]) && n.getElementsByClassName && t.getElementsByClassName)
                            return H.apply(r, t.getElementsByClassName(o)),
                            r
                    }
                if (n.qsa && !A[e + " "] && (!v || !v.test(e)) && (1 !== w || "object" !== t.nodeName.toLowerCase())) {
                    if (y = e,
                    m = t,
                    1 === w && (U.test(e) || z.test(e))) {
                        for ((m = ee.test(e) && ye(t.parentNode) || t) === t && n.scope || ((c = t.getAttribute("id")) ? c = c.replace(re, ie) : t.setAttribute("id", c = b)),
                        s = (h = a(e)).length; s--; )
                            h[s] = (c ? "#" + c : ":scope") + " " + xe(h[s]);
                        y = h.join(",")
                    }
                    try {
                        return H.apply(r, m.querySelectorAll(y)),
                        r
                    } catch (t) {
                        A(e, !0)
                    } finally {
                        c === b && t.removeAttribute("id")
                    }
                }
            }
            return u(e.replace(B, "$1"), t, r, i)
        }
        function ue() {
            var e = [];
            return function t(n, i) {
                return e.push(n + " ") > r.cacheLength && delete t[e.shift()],
                t[n + " "] = i
            }
        }
        function le(e) {
            return e[b] = !0,
            e
        }
        function ce(e) {
            var t = d.createElement("fieldset");
            try {
                return !!e(t)
            } catch (e) {
                return !1
            } finally {
                t.parentNode && t.parentNode.removeChild(t),
                t = null
            }
        }
        function fe(e, t) {
            for (var n = e.split("|"), i = n.length; i--; )
                r.attrHandle[n[i]] = t
        }
        function pe(e, t) {
            var n = t && e
              , r = n && 1 === e.nodeType && 1 === t.nodeType && e.sourceIndex - t.sourceIndex;
            if (r)
                return r;
            if (n)
                for (; n = n.nextSibling; )
                    if (n === t)
                        return -1;
            return e ? 1 : -1
        }
        function de(e) {
            return function(t) {
                return "input" === t.nodeName.toLowerCase() && t.type === e
            }
        }
        function he(e) {
            return function(t) {
                var n = t.nodeName.toLowerCase();
                return ("input" === n || "button" === n) && t.type === e
            }
        }
        function ge(e) {
            return function(t) {
                return "form"in t ? t.parentNode && !1 === t.disabled ? "label"in t ? "label"in t.parentNode ? t.parentNode.disabled === e : t.disabled === e : t.isDisabled === e || t.isDisabled !== !e && ae(t) === e : t.disabled === e : "label"in t && t.disabled === e
            }
        }
        function ve(e) {
            return le((function(t) {
                return t = +t,
                le((function(n, r) {
                    for (var i, o = e([], n.length, t), a = o.length; a--; )
                        n[i = o[a]] && (n[i] = !(r[i] = n[i]))
                }
                ))
            }
            ))
        }
        function ye(e) {
            return e && void 0 !== e.getElementsByTagName && e
        }
        for (t in n = se.support = {},
        o = se.isXML = function(e) {
            var t = e && e.namespaceURI
              , n = e && (e.ownerDocument || e).documentElement;
            return !Y.test(t || n && n.nodeName || "HTML")
        }
        ,
        p = se.setDocument = function(e) {
            var t, i, a = e ? e.ownerDocument || e : w;
            return a != d && 9 === a.nodeType && a.documentElement && (h = (d = a).documentElement,
            g = !o(d),
            w != d && (i = d.defaultView) && i.top !== i && (i.addEventListener ? i.addEventListener("unload", oe, !1) : i.attachEvent && i.attachEvent("onunload", oe)),
            n.scope = ce((function(e) {
                return h.appendChild(e).appendChild(d.createElement("div")),
                void 0 !== e.querySelectorAll && !e.querySelectorAll(":scope fieldset div").length
            }
            )),
            n.attributes = ce((function(e) {
                return e.className = "i",
                !e.getAttribute("className")
            }
            )),
            n.getElementsByTagName = ce((function(e) {
                return e.appendChild(d.createComment("")),
                !e.getElementsByTagName("*").length
            }
            )),
            n.getElementsByClassName = K.test(d.getElementsByClassName),
            n.getById = ce((function(e) {
                return h.appendChild(e).id = b,
                !d.getElementsByName || !d.getElementsByName(b).length
            }
            )),
            n.getById ? (r.filter.ID = function(e) {
                var t = e.replace(te, ne);
                return function(e) {
                    return e.getAttribute("id") === t
                }
            }
            ,
            r.find.ID = function(e, t) {
                if (void 0 !== t.getElementById && g) {
                    var n = t.getElementById(e);
                    return n ? [n] : []
                }
            }
            ) : (r.filter.ID = function(e) {
                var t = e.replace(te, ne);
                return function(e) {
                    var n = void 0 !== e.getAttributeNode && e.getAttributeNode("id");
                    return n && n.value === t
                }
            }
            ,
            r.find.ID = function(e, t) {
                if (void 0 !== t.getElementById && g) {
                    var n, r, i, o = t.getElementById(e);
                    if (o) {
                        if ((n = o.getAttributeNode("id")) && n.value === e)
                            return [o];
                        for (i = t.getElementsByName(e),
                        r = 0; o = i[r++]; )
                            if ((n = o.getAttributeNode("id")) && n.value === e)
                                return [o]
                    }
                    return []
                }
            }
            ),
            r.find.TAG = n.getElementsByTagName ? function(e, t) {
                return void 0 !== t.getElementsByTagName ? t.getElementsByTagName(e) : n.qsa ? t.querySelectorAll(e) : void 0
            }
            : function(e, t) {
                var n, r = [], i = 0, o = t.getElementsByTagName(e);
                if ("*" === e) {
                    for (; n = o[i++]; )
                        1 === n.nodeType && r.push(n);
                    return r
                }
                return o
            }
            ,
            r.find.CLASS = n.getElementsByClassName && function(e, t) {
                if (void 0 !== t.getElementsByClassName && g)
                    return t.getElementsByClassName(e)
            }
            ,
            y = [],
            v = [],
            (n.qsa = K.test(d.querySelectorAll)) && (ce((function(e) {
                var t;
                h.appendChild(e).innerHTML = "<a id='" + b + "'></a><select id='" + b + "-\r\\' msallowcapture=''><option selected=''></option></select>",
                e.querySelectorAll("[msallowcapture^='']").length && v.push("[*^$]=" + M + "*(?:''|\"\")"),
                e.querySelectorAll("[selected]").length || v.push("\\[" + M + "*(?:value|" + R + ")"),
                e.querySelectorAll("[id~=" + b + "-]").length || v.push("~="),
                (t = d.createElement("input")).setAttribute("name", ""),
                e.appendChild(t),
                e.querySelectorAll("[name='']").length || v.push("\\[" + M + "*name" + M + "*=" + M + "*(?:''|\"\")"),
                e.querySelectorAll(":checked").length || v.push(":checked"),
                e.querySelectorAll("a#" + b + "+*").length || v.push(".#.+[+~]"),
                e.querySelectorAll("\\\f"),
                v.push("[\\r\\n\\f]")
            }
            )),
            ce((function(e) {
                e.innerHTML = "<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";
                var t = d.createElement("input");
                t.setAttribute("type", "hidden"),
                e.appendChild(t).setAttribute("name", "D"),
                e.querySelectorAll("[name=d]").length && v.push("name" + M + "*[*^$|!~]?="),
                2 !== e.querySelectorAll(":enabled").length && v.push(":enabled", ":disabled"),
                h.appendChild(e).disabled = !0,
                2 !== e.querySelectorAll(":disabled").length && v.push(":enabled", ":disabled"),
                e.querySelectorAll("*,:x"),
                v.push(",.*:")
            }
            ))),
            (n.matchesSelector = K.test(m = h.matches || h.webkitMatchesSelector || h.mozMatchesSelector || h.oMatchesSelector || h.msMatchesSelector)) && ce((function(e) {
                n.disconnectedMatch = m.call(e, "*"),
                m.call(e, "[s!='']:x"),
                y.push("!=", W)
            }
            )),
            v = v.length && new RegExp(v.join("|")),
            y = y.length && new RegExp(y.join("|")),
            t = K.test(h.compareDocumentPosition),
            x = t || K.test(h.contains) ? function(e, t) {
                var n = 9 === e.nodeType ? e.documentElement : e
                  , r = t && t.parentNode;
                return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
            }
            : function(e, t) {
                if (t)
                    for (; t = t.parentNode; )
                        if (t === e)
                            return !0;
                return !1
            }
            ,
            N = t ? function(e, t) {
                if (e === t)
                    return f = !0,
                    0;
                var r = !e.compareDocumentPosition - !t.compareDocumentPosition;
                return r || (1 & (r = (e.ownerDocument || e) == (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1) || !n.sortDetached && t.compareDocumentPosition(e) === r ? e == d || e.ownerDocument == w && x(w, e) ? -1 : t == d || t.ownerDocument == w && x(w, t) ? 1 : c ? P(c, e) - P(c, t) : 0 : 4 & r ? -1 : 1)
            }
            : function(e, t) {
                if (e === t)
                    return f = !0,
                    0;
                var n, r = 0, i = e.parentNode, o = t.parentNode, a = [e], s = [t];
                if (!i || !o)
                    return e == d ? -1 : t == d ? 1 : i ? -1 : o ? 1 : c ? P(c, e) - P(c, t) : 0;
                if (i === o)
                    return pe(e, t);
                for (n = e; n = n.parentNode; )
                    a.unshift(n);
                for (n = t; n = n.parentNode; )
                    s.unshift(n);
                for (; a[r] === s[r]; )
                    r++;
                return r ? pe(a[r], s[r]) : a[r] == w ? -1 : s[r] == w ? 1 : 0
            }
            ),
            d
        }
        ,
        se.matches = function(e, t) {
            return se(e, null, null, t)
        }
        ,
        se.matchesSelector = function(e, t) {
            if (p(e),
            n.matchesSelector && g && !A[t + " "] && (!y || !y.test(t)) && (!v || !v.test(t)))
                try {
                    var r = m.call(e, t);
                    if (r || n.disconnectedMatch || e.document && 11 !== e.document.nodeType)
                        return r
                } catch (e) {
                    A(t, !0)
                }
            return 0 < se(t, d, null, [e]).length
        }
        ,
        se.contains = function(e, t) {
            return (e.ownerDocument || e) != d && p(e),
            x(e, t)
        }
        ,
        se.attr = function(e, t) {
            (e.ownerDocument || e) != d && p(e);
            var i = r.attrHandle[t.toLowerCase()]
              , o = i && j.call(r.attrHandle, t.toLowerCase()) ? i(e, t, !g) : void 0;
            return void 0 !== o ? o : n.attributes || !g ? e.getAttribute(t) : (o = e.getAttributeNode(t)) && o.specified ? o.value : null
        }
        ,
        se.escape = function(e) {
            return (e + "").replace(re, ie)
        }
        ,
        se.error = function(e) {
            throw new Error("Syntax error, unrecognized expression: " + e)
        }
        ,
        se.uniqueSort = function(e) {
            var t, r = [], i = 0, o = 0;
            if (f = !n.detectDuplicates,
            c = !n.sortStable && e.slice(0),
            e.sort(N),
            f) {
                for (; t = e[o++]; )
                    t === e[o] && (i = r.push(o));
                for (; i--; )
                    e.splice(r[i], 1)
            }
            return c = null,
            e
        }
        ,
        i = se.getText = function(e) {
            var t, n = "", r = 0, o = e.nodeType;
            if (o) {
                if (1 === o || 9 === o || 11 === o) {
                    if ("string" == typeof e.textContent)
                        return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling)
                        n += i(e)
                } else if (3 === o || 4 === o)
                    return e.nodeValue
            } else
                for (; t = e[r++]; )
                    n += i(t);
            return n
        }
        ,
        (r = se.selectors = {
            cacheLength: 50,
            createPseudo: le,
            match: G,
            attrHandle: {},
            find: {},
            relative: {
                ">": {
                    dir: "parentNode",
                    first: !0
                },
                " ": {
                    dir: "parentNode"
                },
                "+": {
                    dir: "previousSibling",
                    first: !0
                },
                "~": {
                    dir: "previousSibling"
                }
            },
            preFilter: {
                ATTR: function(e) {
                    return e[1] = e[1].replace(te, ne),
                    e[3] = (e[3] || e[4] || e[5] || "").replace(te, ne),
                    "~=" === e[2] && (e[3] = " " + e[3] + " "),
                    e.slice(0, 4)
                },
                CHILD: function(e) {
                    return e[1] = e[1].toLowerCase(),
                    "nth" === e[1].slice(0, 3) ? (e[3] || se.error(e[0]),
                    e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])),
                    e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && se.error(e[0]),
                    e
                },
                PSEUDO: function(e) {
                    var t, n = !e[6] && e[2];
                    return G.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && X.test(n) && (t = a(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t),
                    e[2] = n.slice(0, t)),
                    e.slice(0, 3))
                }
            },
            filter: {
                TAG: function(e) {
                    var t = e.replace(te, ne).toLowerCase();
                    return "*" === e ? function() {
                        return !0
                    }
                    : function(e) {
                        return e.nodeName && e.nodeName.toLowerCase() === t
                    }
                },
                CLASS: function(e) {
                    var t = E[e + " "];
                    return t || (t = new RegExp("(^|" + M + ")" + e + "(" + M + "|$)")) && E(e, (function(e) {
                        return t.test("string" == typeof e.className && e.className || void 0 !== e.getAttribute && e.getAttribute("class") || "")
                    }
                    ))
                },
                ATTR: function(e, t, n) {
                    return function(r) {
                        var i = se.attr(r, e);
                        return null == i ? "!=" === t : !t || (i += "",
                        "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && -1 < i.indexOf(n) : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? -1 < (" " + i.replace(F, " ") + " ").indexOf(n) : "|=" === t && (i === n || i.slice(0, n.length + 1) === n + "-"))
                    }
                },
                CHILD: function(e, t, n, r, i) {
                    var o = "nth" !== e.slice(0, 3)
                      , a = "last" !== e.slice(-4)
                      , s = "of-type" === t;
                    return 1 === r && 0 === i ? function(e) {
                        return !!e.parentNode
                    }
                    : function(t, n, u) {
                        var l, c, f, p, d, h, g = o !== a ? "nextSibling" : "previousSibling", v = t.parentNode, y = s && t.nodeName.toLowerCase(), m = !u && !s, x = !1;
                        if (v) {
                            if (o) {
                                for (; g; ) {
                                    for (p = t; p = p[g]; )
                                        if (s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType)
                                            return !1;
                                    h = g = "only" === e && !h && "nextSibling"
                                }
                                return !0
                            }
                            if (h = [a ? v.firstChild : v.lastChild],
                            a && m) {
                                for (x = (d = (l = (c = (f = (p = v)[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] || [])[0] === T && l[1]) && l[2],
                                p = d && v.childNodes[d]; p = ++d && p && p[g] || (x = d = 0) || h.pop(); )
                                    if (1 === p.nodeType && ++x && p === t) {
                                        c[e] = [T, d, x];
                                        break
                                    }
                            } else if (m && (x = d = (l = (c = (f = (p = t)[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] || [])[0] === T && l[1]),
                            !1 === x)
                                for (; (p = ++d && p && p[g] || (x = d = 0) || h.pop()) && ((s ? p.nodeName.toLowerCase() !== y : 1 !== p.nodeType) || !++x || (m && ((c = (f = p[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] = [T, x]),
                                p !== t)); )
                                    ;
                            return (x -= i) === r || x % r == 0 && 0 <= x / r
                        }
                    }
                },
                PSEUDO: function(e, t) {
                    var n, i = r.pseudos[e] || r.setFilters[e.toLowerCase()] || se.error("unsupported pseudo: " + e);
                    return i[b] ? i(t) : 1 < i.length ? (n = [e, e, "", t],
                    r.setFilters.hasOwnProperty(e.toLowerCase()) ? le((function(e, n) {
                        for (var r, o = i(e, t), a = o.length; a--; )
                            e[r = P(e, o[a])] = !(n[r] = o[a])
                    }
                    )) : function(e) {
                        return i(e, 0, n)
                    }
                    ) : i
                }
            },
            pseudos: {
                not: le((function(e) {
                    var t = []
                      , n = []
                      , r = s(e.replace(B, "$1"));
                    return r[b] ? le((function(e, t, n, i) {
                        for (var o, a = r(e, null, i, []), s = e.length; s--; )
                            (o = a[s]) && (e[s] = !(t[s] = o))
                    }
                    )) : function(e, i, o) {
                        return t[0] = e,
                        r(t, null, o, n),
                        t[0] = null,
                        !n.pop()
                    }
                }
                )),
                has: le((function(e) {
                    return function(t) {
                        return 0 < se(e, t).length
                    }
                }
                )),
                contains: le((function(e) {
                    return e = e.replace(te, ne),
                    function(t) {
                        return -1 < (t.textContent || i(t)).indexOf(e)
                    }
                }
                )),
                lang: le((function(e) {
                    return V.test(e || "") || se.error("unsupported lang: " + e),
                    e = e.replace(te, ne).toLowerCase(),
                    function(t) {
                        var n;
                        do {
                            if (n = g ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang"))
                                return (n = n.toLowerCase()) === e || 0 === n.indexOf(e + "-")
                        } while ((t = t.parentNode) && 1 === t.nodeType);
                        return !1
                    }
                }
                )),
                target: function(t) {
                    var n = e.location && e.location.hash;
                    return n && n.slice(1) === t.id
                },
                root: function(e) {
                    return e === h
                },
                focus: function(e) {
                    return e === d.activeElement && (!d.hasFocus || d.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
                },
                enabled: ge(!1),
                disabled: ge(!0),
                checked: function(e) {
                    var t = e.nodeName.toLowerCase();
                    return "input" === t && !!e.checked || "option" === t && !!e.selected
                },
                selected: function(e) {
                    return e.parentNode && e.parentNode.selectedIndex,
                    !0 === e.selected
                },
                empty: function(e) {
                    for (e = e.firstChild; e; e = e.nextSibling)
                        if (e.nodeType < 6)
                            return !1;
                    return !0
                },
                parent: function(e) {
                    return !r.pseudos.empty(e)
                },
                header: function(e) {
                    return J.test(e.nodeName)
                },
                input: function(e) {
                    return Q.test(e.nodeName)
                },
                button: function(e) {
                    var t = e.nodeName.toLowerCase();
                    return "input" === t && "button" === e.type || "button" === t
                },
                text: function(e) {
                    var t;
                    return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase())
                },
                first: ve((function() {
                    return [0]
                }
                )),
                last: ve((function(e, t) {
                    return [t - 1]
                }
                )),
                eq: ve((function(e, t, n) {
                    return [n < 0 ? n + t : n]
                }
                )),
                even: ve((function(e, t) {
                    for (var n = 0; n < t; n += 2)
                        e.push(n);
                    return e
                }
                )),
                odd: ve((function(e, t) {
                    for (var n = 1; n < t; n += 2)
                        e.push(n);
                    return e
                }
                )),
                lt: ve((function(e, t, n) {
                    for (var r = n < 0 ? n + t : t < n ? t : n; 0 <= --r; )
                        e.push(r);
                    return e
                }
                )),
                gt: ve((function(e, t, n) {
                    for (var r = n < 0 ? n + t : n; ++r < t; )
                        e.push(r);
                    return e
                }
                ))
            }
        }).pseudos.nth = r.pseudos.eq,
        {
            radio: !0,
            checkbox: !0,
            file: !0,
            password: !0,
            image: !0
        })
            r.pseudos[t] = de(t);
        for (t in {
            submit: !0,
            reset: !0
        })
            r.pseudos[t] = he(t);
        function me() {}
        function xe(e) {
            for (var t = 0, n = e.length, r = ""; t < n; t++)
                r += e[t].value;
            return r
        }
        function be(e, t, n) {
            var r = t.dir
              , i = t.next
              , o = i || r
              , a = n && "parentNode" === o
              , s = C++;
            return t.first ? function(t, n, i) {
                for (; t = t[r]; )
                    if (1 === t.nodeType || a)
                        return e(t, n, i);
                return !1
            }
            : function(t, n, u) {
                var l, c, f, p = [T, s];
                if (u) {
                    for (; t = t[r]; )
                        if ((1 === t.nodeType || a) && e(t, n, u))
                            return !0
                } else
                    for (; t = t[r]; )
                        if (1 === t.nodeType || a)
                            if (c = (f = t[b] || (t[b] = {}))[t.uniqueID] || (f[t.uniqueID] = {}),
                            i && i === t.nodeName.toLowerCase())
                                t = t[r] || t;
                            else {
                                if ((l = c[o]) && l[0] === T && l[1] === s)
                                    return p[2] = l[2];
                                if ((c[o] = p)[2] = e(t, n, u))
                                    return !0
                            }
                return !1
            }
        }
        function we(e) {
            return 1 < e.length ? function(t, n, r) {
                for (var i = e.length; i--; )
                    if (!e[i](t, n, r))
                        return !1;
                return !0
            }
            : e[0]
        }
        function Te(e, t, n, r, i) {
            for (var o, a = [], s = 0, u = e.length, l = null != t; s < u; s++)
                (o = e[s]) && (n && !n(o, r, i) || (a.push(o),
                l && t.push(s)));
            return a
        }
        function Ce(e, t, n, r, i, o) {
            return r && !r[b] && (r = Ce(r)),
            i && !i[b] && (i = Ce(i, o)),
            le((function(o, a, s, u) {
                var l, c, f, p = [], d = [], h = a.length, g = o || function(e, t, n) {
                    for (var r = 0, i = t.length; r < i; r++)
                        se(e, t[r], n);
                    return n
                }(t || "*", s.nodeType ? [s] : s, []), v = !e || !o && t ? g : Te(g, p, e, s, u), y = n ? i || (o ? e : h || r) ? [] : a : v;
                if (n && n(v, y, s, u),
                r)
                    for (l = Te(y, d),
                    r(l, [], s, u),
                    c = l.length; c--; )
                        (f = l[c]) && (y[d[c]] = !(v[d[c]] = f));
                if (o) {
                    if (i || e) {
                        if (i) {
                            for (l = [],
                            c = y.length; c--; )
                                (f = y[c]) && l.push(v[c] = f);
                            i(null, y = [], l, u)
                        }
                        for (c = y.length; c--; )
                            (f = y[c]) && -1 < (l = i ? P(o, f) : p[c]) && (o[l] = !(a[l] = f))
                    }
                } else
                    y = Te(y === a ? y.splice(h, y.length) : y),
                    i ? i(null, a, y, u) : H.apply(a, y)
            }
            ))
        }
        function Ee(e) {
            for (var t, n, i, o = e.length, a = r.relative[e[0].type], s = a || r.relative[" "], u = a ? 1 : 0, c = be((function(e) {
                return e === t
            }
            ), s, !0), f = be((function(e) {
                return -1 < P(t, e)
            }
            ), s, !0), p = [function(e, n, r) {
                var i = !a && (r || n !== l) || ((t = n).nodeType ? c(e, n, r) : f(e, n, r));
                return t = null,
                i
            }
            ]; u < o; u++)
                if (n = r.relative[e[u].type])
                    p = [be(we(p), n)];
                else {
                    if ((n = r.filter[e[u].type].apply(null, e[u].matches))[b]) {
                        for (i = ++u; i < o && !r.relative[e[i].type]; i++)
                            ;
                        return Ce(1 < u && we(p), 1 < u && xe(e.slice(0, u - 1).concat({
                            value: " " === e[u - 2].type ? "*" : ""
                        })).replace(B, "$1"), n, u < i && Ee(e.slice(u, i)), i < o && Ee(e = e.slice(i)), i < o && xe(e))
                    }
                    p.push(n)
                }
            return we(p)
        }
        return me.prototype = r.filters = r.pseudos,
        r.setFilters = new me,
        a = se.tokenize = function(e, t) {
            var n, i, o, a, s, u, l, c = S[e + " "];
            if (c)
                return t ? 0 : c.slice(0);
            for (s = e,
            u = [],
            l = r.preFilter; s; ) {
                for (a in n && !(i = $.exec(s)) || (i && (s = s.slice(i[0].length) || s),
                u.push(o = [])),
                n = !1,
                (i = z.exec(s)) && (n = i.shift(),
                o.push({
                    value: n,
                    type: i[0].replace(B, " ")
                }),
                s = s.slice(n.length)),
                r.filter)
                    !(i = G[a].exec(s)) || l[a] && !(i = l[a](i)) || (n = i.shift(),
                    o.push({
                        value: n,
                        type: a,
                        matches: i
                    }),
                    s = s.slice(n.length));
                if (!n)
                    break
            }
            return t ? s.length : s ? se.error(e) : S(e, u).slice(0)
        }
        ,
        s = se.compile = function(e, t) {
            var n, i, o, s, u, c, f = [], h = [], v = k[e + " "];
            if (!v) {
                for (t || (t = a(e)),
                n = t.length; n--; )
                    (v = Ee(t[n]))[b] ? f.push(v) : h.push(v);
                (v = k(e, (i = h,
                s = 0 < (o = f).length,
                u = 0 < i.length,
                c = function(e, t, n, a, c) {
                    var f, h, v, y = 0, m = "0", x = e && [], b = [], w = l, C = e || u && r.find.TAG("*", c), E = T += null == w ? 1 : Math.random() || .1, S = C.length;
                    for (c && (l = t == d || t || c); m !== S && null != (f = C[m]); m++) {
                        if (u && f) {
                            for (h = 0,
                            t || f.ownerDocument == d || (p(f),
                            n = !g); v = i[h++]; )
                                if (v(f, t || d, n)) {
                                    a.push(f);
                                    break
                                }
                            c && (T = E)
                        }
                        s && ((f = !v && f) && y--,
                        e && x.push(f))
                    }
                    if (y += m,
                    s && m !== y) {
                        for (h = 0; v = o[h++]; )
                            v(x, b, t, n);
                        if (e) {
                            if (0 < y)
                                for (; m--; )
                                    x[m] || b[m] || (b[m] = q.call(a));
                            b = Te(b)
                        }
                        H.apply(a, b),
                        c && !e && 0 < b.length && 1 < y + o.length && se.uniqueSort(a)
                    }
                    return c && (T = E,
                    l = w),
                    x
                }
                ,
                s ? le(c) : c))).selector = e
            }
            return v
        }
        ,
        u = se.select = function(e, t, n, i) {
            var o, u, l, c, f, p = "function" == typeof e && e, d = !i && a(e = p.selector || e);
            if (n = n || [],
            1 === d.length) {
                if (2 < (u = d[0] = d[0].slice(0)).length && "ID" === (l = u[0]).type && 9 === t.nodeType && g && r.relative[u[1].type]) {
                    if (!(t = (r.find.ID(l.matches[0].replace(te, ne), t) || [])[0]))
                        return n;
                    p && (t = t.parentNode),
                    e = e.slice(u.shift().value.length)
                }
                for (o = G.needsContext.test(e) ? 0 : u.length; o-- && (l = u[o],
                !r.relative[c = l.type]); )
                    if ((f = r.find[c]) && (i = f(l.matches[0].replace(te, ne), ee.test(u[0].type) && ye(t.parentNode) || t))) {
                        if (u.splice(o, 1),
                        !(e = i.length && xe(u)))
                            return H.apply(n, i),
                            n;
                        break
                    }
            }
            return (p || s(e, d))(i, t, !g, n, !t || ee.test(e) && ye(t.parentNode) || t),
            n
        }
        ,
        n.sortStable = b.split("").sort(N).join("") === b,
        n.detectDuplicates = !!f,
        p(),
        n.sortDetached = ce((function(e) {
            return 1 & e.compareDocumentPosition(d.createElement("fieldset"))
        }
        )),
        ce((function(e) {
            return e.innerHTML = "<a href='#'></a>",
            "#" === e.firstChild.getAttribute("href")
        }
        )) || fe("type|href|height|width", (function(e, t, n) {
            if (!n)
                return e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2)
        }
        )),
        n.attributes && ce((function(e) {
            return e.innerHTML = "<input/>",
            e.firstChild.setAttribute("value", ""),
            "" === e.firstChild.getAttribute("value")
        }
        )) || fe("value", (function(e, t, n) {
            if (!n && "input" === e.nodeName.toLowerCase())
                return e.defaultValue
        }
        )),
        ce((function(e) {
            return null == e.getAttribute("disabled")
        }
        )) || fe(R, (function(e, t, n) {
            var r;
            if (!n)
                return !0 === e[t] ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null
        }
        )),
        se
    }(e);
    w.find = C,
    (w.expr = C.selectors)[":"] = w.expr.pseudos,
    w.uniqueSort = w.unique = C.uniqueSort,
    w.text = C.getText,
    w.isXMLDoc = C.isXML,
    w.contains = C.contains,
    w.escapeSelector = C.escape;
    var E = function(e, t, n) {
        for (var r = [], i = void 0 !== n; (e = e[t]) && 9 !== e.nodeType; )
            if (1 === e.nodeType) {
                if (i && w(e).is(n))
                    break;
                r.push(e)
            }
        return r
    }
      , S = function(e, t) {
        for (var n = []; e; e = e.nextSibling)
            1 === e.nodeType && e !== t && n.push(e);
        return n
    }
      , k = w.expr.match.needsContext;
    function A(e, t) {
        return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
    }
    var N = /^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;
    function j(e, t, n) {
        return h(t) ? w.grep(e, (function(e, r) {
            return !!t.call(e, r, e) !== n
        }
        )) : t.nodeType ? w.grep(e, (function(e) {
            return e === t !== n
        }
        )) : "string" != typeof t ? w.grep(e, (function(e) {
            return -1 < s.call(t, e) !== n
        }
        )) : w.filter(t, e, n)
    }
    w.filter = function(e, t, n) {
        var r = t[0];
        return n && (e = ":not(" + e + ")"),
        1 === t.length && 1 === r.nodeType ? w.find.matchesSelector(r, e) ? [r] : [] : w.find.matches(e, w.grep(t, (function(e) {
            return 1 === e.nodeType
        }
        )))
    }
    ,
    w.fn.extend({
        find: function(e) {
            var t, n, r = this.length, i = this;
            if ("string" != typeof e)
                return this.pushStack(w(e).filter((function() {
                    for (t = 0; t < r; t++)
                        if (w.contains(i[t], this))
                            return !0
                }
                )));
            for (n = this.pushStack([]),
            t = 0; t < r; t++)
                w.find(e, i[t], n);
            return 1 < r ? w.uniqueSort(n) : n
        },
        filter: function(e) {
            return this.pushStack(j(this, e || [], !1))
        },
        not: function(e) {
            return this.pushStack(j(this, e || [], !0))
        },
        is: function(e) {
            return !!j(this, "string" == typeof e && k.test(e) ? w(e) : e || [], !1).length
        }
    });
    var D, q = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;
    (w.fn.init = function(e, t, n) {
        var r, i;
        if (!e)
            return this;
        if (n = n || D,
        "string" == typeof e) {
            if (!(r = "<" === e[0] && ">" === e[e.length - 1] && 3 <= e.length ? [null, e, null] : q.exec(e)) || !r[1] && t)
                return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e);
            if (r[1]) {
                if (t = t instanceof w ? t[0] : t,
                w.merge(this, w.parseHTML(r[1], t && t.nodeType ? t.ownerDocument || t : v, !0)),
                N.test(r[1]) && w.isPlainObject(t))
                    for (r in t)
                        h(this[r]) ? this[r](t[r]) : this.attr(r, t[r]);
                return this
            }
            return (i = v.getElementById(r[2])) && (this[0] = i,
            this.length = 1),
            this
        }
        return e.nodeType ? (this[0] = e,
        this.length = 1,
        this) : h(e) ? void 0 !== n.ready ? n.ready(e) : e(w) : w.makeArray(e, this)
    }
    ).prototype = w.fn,
    D = w(v);
    var L = /^(?:parents|prev(?:Until|All))/
      , H = {
        children: !0,
        contents: !0,
        next: !0,
        prev: !0
    };
    function O(e, t) {
        for (; (e = e[t]) && 1 !== e.nodeType; )
            ;
        return e
    }
    w.fn.extend({
        has: function(e) {
            var t = w(e, this)
              , n = t.length;
            return this.filter((function() {
                for (var e = 0; e < n; e++)
                    if (w.contains(this, t[e]))
                        return !0
            }
            ))
        },
        closest: function(e, t) {
            var n, r = 0, i = this.length, o = [], a = "string" != typeof e && w(e);
            if (!k.test(e))
                for (; r < i; r++)
                    for (n = this[r]; n && n !== t; n = n.parentNode)
                        if (n.nodeType < 11 && (a ? -1 < a.index(n) : 1 === n.nodeType && w.find.matchesSelector(n, e))) {
                            o.push(n);
                            break
                        }
            return this.pushStack(1 < o.length ? w.uniqueSort(o) : o)
        },
        index: function(e) {
            return e ? "string" == typeof e ? s.call(w(e), this[0]) : s.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
        },
        add: function(e, t) {
            return this.pushStack(w.uniqueSort(w.merge(this.get(), w(e, t))))
        },
        addBack: function(e) {
            return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
        }
    }),
    w.each({
        parent: function(e) {
            var t = e.parentNode;
            return t && 11 !== t.nodeType ? t : null
        },
        parents: function(e) {
            return E(e, "parentNode")
        },
        parentsUntil: function(e, t, n) {
            return E(e, "parentNode", n)
        },
        next: function(e) {
            return O(e, "nextSibling")
        },
        prev: function(e) {
            return O(e, "previousSibling")
        },
        nextAll: function(e) {
            return E(e, "nextSibling")
        },
        prevAll: function(e) {
            return E(e, "previousSibling")
        },
        nextUntil: function(e, t, n) {
            return E(e, "nextSibling", n)
        },
        prevUntil: function(e, t, n) {
            return E(e, "previousSibling", n)
        },
        siblings: function(e) {
            return S((e.parentNode || {}).firstChild, e)
        },
        children: function(e) {
            return S(e.firstChild)
        },
        contents: function(e) {
            return null != e.contentDocument && r(e.contentDocument) ? e.contentDocument : (A(e, "template") && (e = e.content || e),
            w.merge([], e.childNodes))
        }
    }, (function(e, t) {
        w.fn[e] = function(n, r) {
            var i = w.map(this, t, n);
            return "Until" !== e.slice(-5) && (r = n),
            r && "string" == typeof r && (i = w.filter(r, i)),
            1 < this.length && (H[e] || w.uniqueSort(i),
            L.test(e) && i.reverse()),
            this.pushStack(i)
        }
    }
    ));
    var P = /[^\x20\t\r\n\f]+/g;
    function R(e) {
        return e
    }
    function M(e) {
        throw e
    }
    function I(e, t, n, r) {
        var i;
        try {
            e && h(i = e.promise) ? i.call(e).done(t).fail(n) : e && h(i = e.then) ? i.call(e, t, n) : t.apply(void 0, [e].slice(r))
        } catch (e) {
            n.apply(void 0, [e])
        }
    }
    w.Callbacks = function(e) {
        var t;
        e = "string" == typeof e ? (t = {},
        w.each(e.match(P) || [], (function(e, n) {
            t[n] = !0
        }
        )),
        t) : w.extend({}, e);
        var n, r, i, o, a = [], s = [], u = -1, l = function() {
            for (o = o || e.once,
            i = n = !0; s.length; u = -1)
                for (r = s.shift(); ++u < a.length; )
                    !1 === a[u].apply(r[0], r[1]) && e.stopOnFalse && (u = a.length,
                    r = !1);
            e.memory || (r = !1),
            n = !1,
            o && (a = r ? [] : "")
        }, c = {
            add: function() {
                return a && (r && !n && (u = a.length - 1,
                s.push(r)),
                function t(n) {
                    w.each(n, (function(n, r) {
                        h(r) ? e.unique && c.has(r) || a.push(r) : r && r.length && "string" !== x(r) && t(r)
                    }
                    ))
                }(arguments),
                r && !n && l()),
                this
            },
            remove: function() {
                return w.each(arguments, (function(e, t) {
                    for (var n; -1 < (n = w.inArray(t, a, n)); )
                        a.splice(n, 1),
                        n <= u && u--
                }
                )),
                this
            },
            has: function(e) {
                return e ? -1 < w.inArray(e, a) : 0 < a.length
            },
            empty: function() {
                return a && (a = []),
                this
            },
            disable: function() {
                return o = s = [],
                a = r = "",
                this
            },
            disabled: function() {
                return !a
            },
            lock: function() {
                return o = s = [],
                r || n || (a = r = ""),
                this
            },
            locked: function() {
                return !!o
            },
            fireWith: function(e, t) {
                return o || (t = [e, (t = t || []).slice ? t.slice() : t],
                s.push(t),
                n || l()),
                this
            },
            fire: function() {
                return c.fireWith(this, arguments),
                this
            },
            fired: function() {
                return !!i
            }
        };
        return c
    }
    ,
    w.extend({
        Deferred: function(t) {
            var n = [["notify", "progress", w.Callbacks("memory"), w.Callbacks("memory"), 2], ["resolve", "done", w.Callbacks("once memory"), w.Callbacks("once memory"), 0, "resolved"], ["reject", "fail", w.Callbacks("once memory"), w.Callbacks("once memory"), 1, "rejected"]]
              , r = "pending"
              , i = {
                state: function() {
                    return r
                },
                always: function() {
                    return o.done(arguments).fail(arguments),
                    this
                },
                catch: function(e) {
                    return i.then(null, e)
                },
                pipe: function() {
                    var e = arguments;
                    return w.Deferred((function(t) {
                        w.each(n, (function(n, r) {
                            var i = h(e[r[4]]) && e[r[4]];
                            o[r[1]]((function() {
                                var e = i && i.apply(this, arguments);
                                e && h(e.promise) ? e.promise().progress(t.notify).done(t.resolve).fail(t.reject) : t[r[0] + "With"](this, i ? [e] : arguments)
                            }
                            ))
                        }
                        )),
                        e = null
                    }
                    )).promise()
                },
                then: function(t, r, i) {
                    var o = 0;
                    function a(t, n, r, i) {
                        return function() {
                            var s = this
                              , u = arguments
                              , l = function() {
                                var e, l;
                                if (!(t < o)) {
                                    if ((e = r.apply(s, u)) === n.promise())
                                        throw new TypeError("Thenable self-resolution");
                                    l = e && ("object" == _typeof(e) || "function" == typeof e) && e.then,
                                    h(l) ? i ? l.call(e, a(o, n, R, i), a(o, n, M, i)) : (o++,
                                    l.call(e, a(o, n, R, i), a(o, n, M, i), a(o, n, R, n.notifyWith))) : (r !== R && (s = void 0,
                                    u = [e]),
                                    (i || n.resolveWith)(s, u))
                                }
                            }
                              , c = i ? l : function() {
                                try {
                                    l()
                                } catch (e) {
                                    w.Deferred.exceptionHook && w.Deferred.exceptionHook(e, c.stackTrace),
                                    o <= t + 1 && (r !== M && (s = void 0,
                                    u = [e]),
                                    n.rejectWith(s, u))
                                }
                            }
                            ;
                            t ? c() : (w.Deferred.getStackHook && (c.stackTrace = w.Deferred.getStackHook()),
                            e.setTimeout(c))
                        }
                    }
                    return w.Deferred((function(e) {
                        n[0][3].add(a(0, e, h(i) ? i : R, e.notifyWith)),
                        n[1][3].add(a(0, e, h(t) ? t : R)),
                        n[2][3].add(a(0, e, h(r) ? r : M))
                    }
                    )).promise()
                },
                promise: function(e) {
                    return null != e ? w.extend(e, i) : i
                }
            }
              , o = {};
            return w.each(n, (function(e, t) {
                var a = t[2]
                  , s = t[5];
                i[t[1]] = a.add,
                s && a.add((function() {
                    r = s
                }
                ), n[3 - e][2].disable, n[3 - e][3].disable, n[0][2].lock, n[0][3].lock),
                a.add(t[3].fire),
                o[t[0]] = function() {
                    return o[t[0] + "With"](this === o ? void 0 : this, arguments),
                    this
                }
                ,
                o[t[0] + "With"] = a.fireWith
            }
            )),
            i.promise(o),
            t && t.call(o, o),
            o
        },
        when: function(e) {
            var t = arguments.length
              , n = t
              , r = Array(n)
              , o = i.call(arguments)
              , a = w.Deferred()
              , s = function(e) {
                return function(n) {
                    r[e] = this,
                    o[e] = 1 < arguments.length ? i.call(arguments) : n,
                    --t || a.resolveWith(r, o)
                }
            };
            if (t <= 1 && (I(e, a.done(s(n)).resolve, a.reject, !t),
            "pending" === a.state() || h(o[n] && o[n].then)))
                return a.then();
            for (; n--; )
                I(o[n], s(n), a.reject);
            return a.promise()
        }
    });
    var _ = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;
    w.Deferred.exceptionHook = function(t, n) {
        e.console && e.console.warn && t && _.test(t.name) && e.console.warn("jQuery.Deferred exception: " + t.message, t.stack, n)
    }
    ,
    w.readyException = function(t) {
        e.setTimeout((function() {
            throw t
        }
        ))
    }
    ;
    var W = w.Deferred();
    function F() {
        v.removeEventListener("DOMContentLoaded", F),
        e.removeEventListener("load", F),
        w.ready()
    }
    w.fn.ready = function(e) {
        return W.then(e).catch((function(e) {
            w.readyException(e)
        }
        )),
        this
    }
    ,
    w.extend({
        isReady: !1,
        readyWait: 1,
        ready: function(e) {
            (!0 === e ? --w.readyWait : w.isReady) || (w.isReady = !0) !== e && 0 < --w.readyWait || W.resolveWith(v, [w])
        }
    }),
    w.ready.then = W.then,
    "complete" === v.readyState || "loading" !== v.readyState && !v.documentElement.doScroll ? e.setTimeout(w.ready) : (v.addEventListener("DOMContentLoaded", F),
    e.addEventListener("load", F));
    var B = function e(t, n, r, i, o, a, s) {
        var u = 0
          , l = t.length
          , c = null == r;
        if ("object" === x(r))
            for (u in o = !0,
            r)
                e(t, n, u, r[u], !0, a, s);
        else if (void 0 !== i && (o = !0,
        h(i) || (s = !0),
        c && (s ? (n.call(t, i),
        n = null) : (c = n,
        n = function(e, t, n) {
            return c.call(w(e), n)
        }
        )),
        n))
            for (; u < l; u++)
                n(t[u], r, s ? i : i.call(t[u], u, n(t[u], r)));
        return o ? t : c ? n.call(t) : l ? n(t[0], r) : a
    }
      , $ = /^-ms-/
      , z = /-([a-z])/g;
    function U(e, t) {
        return t.toUpperCase()
    }
    function X(e) {
        return e.replace($, "ms-").replace(z, U)
    }
    var V = function(e) {
        return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType
    };
    function G() {
        this.expando = w.expando + G.uid++
    }
    G.uid = 1,
    G.prototype = {
        cache: function(e) {
            var t = e[this.expando];
            return t || (t = {},
            V(e) && (e.nodeType ? e[this.expando] = t : Object.defineProperty(e, this.expando, {
                value: t,
                configurable: !0
            }))),
            t
        },
        set: function(e, t, n) {
            var r, i = this.cache(e);
            if ("string" == typeof t)
                i[X(t)] = n;
            else
                for (r in t)
                    i[X(r)] = t[r];
            return i
        },
        get: function(e, t) {
            return void 0 === t ? this.cache(e) : e[this.expando] && e[this.expando][X(t)]
        },
        access: function(e, t, n) {
            return void 0 === t || t && "string" == typeof t && void 0 === n ? this.get(e, t) : (this.set(e, t, n),
            void 0 !== n ? n : t)
        },
        remove: function(e, t) {
            var n, r = e[this.expando];
            if (void 0 !== r) {
                if (void 0 !== t) {
                    n = (t = Array.isArray(t) ? t.map(X) : (t = X(t))in r ? [t] : t.match(P) || []).length;
                    for (; n--; )
                        delete r[t[n]]
                }
                (void 0 === t || w.isEmptyObject(r)) && (e.nodeType ? e[this.expando] = void 0 : delete e[this.expando])
            }
        },
        hasData: function(e) {
            var t = e[this.expando];
            return void 0 !== t && !w.isEmptyObject(t)
        }
    };
    var Y = new G
      , Q = new G
      , J = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/
      , K = /[A-Z]/g;
    function Z(e, t, n) {
        var r, i;
        if (void 0 === n && 1 === e.nodeType)
            if (r = "data-" + t.replace(K, "-$&").toLowerCase(),
            "string" == typeof (n = e.getAttribute(r))) {
                try {
                    n = "true" === (i = n) || "false" !== i && ("null" === i ? null : i === +i + "" ? +i : J.test(i) ? JSON.parse(i) : i)
                } catch (e) {}
                Q.set(e, t, n)
            } else
                n = void 0;
        return n
    }
    w.extend({
        hasData: function(e) {
            return Q.hasData(e) || Y.hasData(e)
        },
        data: function(e, t, n) {
            return Q.access(e, t, n)
        },
        removeData: function(e, t) {
            Q.remove(e, t)
        },
        _data: function(e, t, n) {
            return Y.access(e, t, n)
        },
        _removeData: function(e, t) {
            Y.remove(e, t)
        }
    }),
    w.fn.extend({
        data: function(e, t) {
            var n, r, i, o = this[0], a = o && o.attributes;
            if (void 0 === e) {
                if (this.length && (i = Q.get(o),
                1 === o.nodeType && !Y.get(o, "hasDataAttrs"))) {
                    for (n = a.length; n--; )
                        a[n] && 0 === (r = a[n].name).indexOf("data-") && (r = X(r.slice(5)),
                        Z(o, r, i[r]));
                    Y.set(o, "hasDataAttrs", !0)
                }
                return i
            }
            return "object" == _typeof(e) ? this.each((function() {
                Q.set(this, e)
            }
            )) : B(this, (function(t) {
                var n;
                if (o && void 0 === t)
                    return void 0 !== (n = Q.get(o, e)) || void 0 !== (n = Z(o, e)) ? n : void 0;
                this.each((function() {
                    Q.set(this, e, t)
                }
                ))
            }
            ), null, t, 1 < arguments.length, null, !0)
        },
        removeData: function(e) {
            return this.each((function() {
                Q.remove(this, e)
            }
            ))
        }
    }),
    w.extend({
        queue: function(e, t, n) {
            var r;
            if (e)
                return t = (t || "fx") + "queue",
                r = Y.get(e, t),
                n && (!r || Array.isArray(n) ? r = Y.access(e, t, w.makeArray(n)) : r.push(n)),
                r || []
        },
        dequeue: function(e, t) {
            var n = w.queue(e, t = t || "fx")
              , r = n.length
              , i = n.shift()
              , o = w._queueHooks(e, t);
            "inprogress" === i && (i = n.shift(),
            r--),
            i && ("fx" === t && n.unshift("inprogress"),
            delete o.stop,
            i.call(e, (function() {
                w.dequeue(e, t)
            }
            ), o)),
            !r && o && o.empty.fire()
        },
        _queueHooks: function(e, t) {
            var n = t + "queueHooks";
            return Y.get(e, n) || Y.access(e, n, {
                empty: w.Callbacks("once memory").add((function() {
                    Y.remove(e, [t + "queue", n])
                }
                ))
            })
        }
    }),
    w.fn.extend({
        queue: function(e, t) {
            var n = 2;
            return "string" != typeof e && (t = e,
            e = "fx",
            n--),
            arguments.length < n ? w.queue(this[0], e) : void 0 === t ? this : this.each((function() {
                var n = w.queue(this, e, t);
                w._queueHooks(this, e),
                "fx" === e && "inprogress" !== n[0] && w.dequeue(this, e)
            }
            ))
        },
        dequeue: function(e) {
            return this.each((function() {
                w.dequeue(this, e)
            }
            ))
        },
        clearQueue: function(e) {
            return this.queue(e || "fx", [])
        },
        promise: function(e, t) {
            var n, r = 1, i = w.Deferred(), o = this, a = this.length, s = function() {
                --r || i.resolveWith(o, [o])
            };
            for ("string" != typeof e && (t = e,
            e = void 0),
            e = e || "fx"; a--; )
                (n = Y.get(o[a], e + "queueHooks")) && n.empty && (r++,
                n.empty.add(s));
            return s(),
            i.promise(t)
        }
    });
    var ee = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source
      , te = new RegExp("^(?:([+-])=|)(" + ee + ")([a-z%]*)$","i")
      , ne = ["Top", "Right", "Bottom", "Left"]
      , re = v.documentElement
      , ie = function(e) {
        return w.contains(e.ownerDocument, e)
    }
      , oe = {
        composed: !0
    };
    re.getRootNode && (ie = function(e) {
        return w.contains(e.ownerDocument, e) || e.getRootNode(oe) === e.ownerDocument
    }
    );
    var ae = function(e, t) {
        return "none" === (e = t || e).style.display || "" === e.style.display && ie(e) && "none" === w.css(e, "display")
    };
    function se(e, t, n, r) {
        var i, o, a = 20, s = r ? function() {
            return r.cur()
        }
        : function() {
            return w.css(e, t, "")
        }
        , u = s(), l = n && n[3] || (w.cssNumber[t] ? "" : "px"), c = e.nodeType && (w.cssNumber[t] || "px" !== l && +u) && te.exec(w.css(e, t));
        if (c && c[3] !== l) {
            for (u /= 2,
            l = l || c[3],
            c = +u || 1; a--; )
                w.style(e, t, c + l),
                (1 - o) * (1 - (o = s() / u || .5)) <= 0 && (a = 0),
                c /= o;
            w.style(e, t, (c *= 2) + l),
            n = n || []
        }
        return n && (c = +c || +u || 0,
        i = n[1] ? c + (n[1] + 1) * n[2] : +n[2],
        r && (r.unit = l,
        r.start = c,
        r.end = i)),
        i
    }
    var ue = {};
    function le(e, t) {
        for (var n, r, i, o, a, s, u, l = [], c = 0, f = e.length; c < f; c++)
            (r = e[c]).style && (n = r.style.display,
            t ? ("none" === n && (l[c] = Y.get(r, "display") || null,
            l[c] || (r.style.display = "")),
            "" === r.style.display && ae(r) && (l[c] = (u = a = o = void 0,
            a = (i = r).ownerDocument,
            s = i.nodeName,
            (u = ue[s]) || (o = a.body.appendChild(a.createElement(s)),
            u = w.css(o, "display"),
            o.parentNode.removeChild(o),
            "none" === u && (u = "block"),
            ue[s] = u)))) : "none" !== n && (l[c] = "none",
            Y.set(r, "display", n)));
        for (c = 0; c < f; c++)
            null != l[c] && (e[c].style.display = l[c]);
        return e
    }
    w.fn.extend({
        show: function() {
            return le(this, !0)
        },
        hide: function() {
            return le(this)
        },
        toggle: function(e) {
            return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each((function() {
                ae(this) ? w(this).show() : w(this).hide()
            }
            ))
        }
    });
    var ce, fe, pe = /^(?:checkbox|radio)$/i, de = /<([a-z][^\/\0>\x20\t\r\n\f]*)/i, he = /^$|^module$|\/(?:java|ecma)script/i;
    ce = v.createDocumentFragment().appendChild(v.createElement("div")),
    (fe = v.createElement("input")).setAttribute("type", "radio"),
    fe.setAttribute("checked", "checked"),
    fe.setAttribute("name", "t"),
    ce.appendChild(fe),
    d.checkClone = ce.cloneNode(!0).cloneNode(!0).lastChild.checked,
    ce.innerHTML = "<textarea>x</textarea>",
    d.noCloneChecked = !!ce.cloneNode(!0).lastChild.defaultValue,
    ce.innerHTML = "<option></option>",
    d.option = !!ce.lastChild;
    var ge = {
        thead: [1, "<table>", "</table>"],
        col: [2, "<table><colgroup>", "</colgroup></table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        _default: [0, "", ""]
    };
    function ve(e, t) {
        var n;
        return n = void 0 !== e.getElementsByTagName ? e.getElementsByTagName(t || "*") : void 0 !== e.querySelectorAll ? e.querySelectorAll(t || "*") : [],
        void 0 === t || t && A(e, t) ? w.merge([e], n) : n
    }
    function ye(e, t) {
        for (var n = 0, r = e.length; n < r; n++)
            Y.set(e[n], "globalEval", !t || Y.get(t[n], "globalEval"))
    }
    ge.tbody = ge.tfoot = ge.colgroup = ge.caption = ge.thead,
    ge.th = ge.td,
    d.option || (ge.optgroup = ge.option = [1, "<select multiple='multiple'>", "</select>"]);
    var me = /<|&#?\w+;/;
    function xe(e, t, n, r, i) {
        for (var o, a, s, u, l, c, f = t.createDocumentFragment(), p = [], d = 0, h = e.length; d < h; d++)
            if ((o = e[d]) || 0 === o)
                if ("object" === x(o))
                    w.merge(p, o.nodeType ? [o] : o);
                else if (me.test(o)) {
                    for (a = a || f.appendChild(t.createElement("div")),
                    s = (de.exec(o) || ["", ""])[1].toLowerCase(),
                    u = ge[s] || ge._default,
                    a.innerHTML = u[1] + w.htmlPrefilter(o) + u[2],
                    c = u[0]; c--; )
                        a = a.lastChild;
                    w.merge(p, a.childNodes),
                    (a = f.firstChild).textContent = ""
                } else
                    p.push(t.createTextNode(o));
        for (f.textContent = "",
        d = 0; o = p[d++]; )
            if (r && -1 < w.inArray(o, r))
                i && i.push(o);
            else if (l = ie(o),
            a = ve(f.appendChild(o), "script"),
            l && ye(a),
            n)
                for (c = 0; o = a[c++]; )
                    he.test(o.type || "") && n.push(o);
        return f
    }
    var be = /^([^.]*)(?:\.(.+)|)/;
    function we() {
        return !0
    }
    function Te() {
        return !1
    }
    function Ce(e, t) {
        return e === function() {
            try {
                return v.activeElement
            } catch (e) {}
        }() == ("focus" === t)
    }
    function Ee(e, t, n, r, i, o) {
        var a, s;
        if ("object" == _typeof(t)) {
            for (s in "string" != typeof n && (r = r || n,
            n = void 0),
            t)
                Ee(e, s, n, r, t[s], o);
            return e
        }
        if (null == r && null == i ? (i = n,
        r = n = void 0) : null == i && ("string" == typeof n ? (i = r,
        r = void 0) : (i = r,
        r = n,
        n = void 0)),
        !1 === i)
            i = Te;
        else if (!i)
            return e;
        return 1 === o && (a = i,
        (i = function(e) {
            return w().off(e),
            a.apply(this, arguments)
        }
        ).guid = a.guid || (a.guid = w.guid++)),
        e.each((function() {
            w.event.add(this, t, i, r, n)
        }
        ))
    }
    function Se(e, t, n) {
        n ? (Y.set(e, t, !1),
        w.event.add(e, t, {
            namespace: !1,
            handler: function(e) {
                var r, o, a = Y.get(this, t);
                if (1 & e.isTrigger && this[t]) {
                    if (a.length)
                        (w.event.special[t] || {}).delegateType && e.stopPropagation();
                    else if (a = i.call(arguments),
                    Y.set(this, t, a),
                    r = n(this, t),
                    this[t](),
                    a !== (o = Y.get(this, t)) || r ? Y.set(this, t, !1) : o = {},
                    a !== o)
                        return e.stopImmediatePropagation(),
                        e.preventDefault(),
                        o && o.value
                } else
                    a.length && (Y.set(this, t, {
                        value: w.event.trigger(w.extend(a[0], w.Event.prototype), a.slice(1), this)
                    }),
                    e.stopImmediatePropagation())
            }
        })) : void 0 === Y.get(e, t) && w.event.add(e, t, we)
    }
    w.event = {
        global: {},
        add: function(e, t, n, r, i) {
            var o, a, s, u, l, c, f, p, d, h, g, v = Y.get(e);
            if (V(e))
                for (n.handler && (n = (o = n).handler,
                i = o.selector),
                i && w.find.matchesSelector(re, i),
                n.guid || (n.guid = w.guid++),
                (u = v.events) || (u = v.events = Object.create(null)),
                (a = v.handle) || (a = v.handle = function(t) {
                    return void 0 !== w && w.event.triggered !== t.type ? w.event.dispatch.apply(e, arguments) : void 0
                }
                ),
                l = (t = (t || "").match(P) || [""]).length; l--; )
                    d = g = (s = be.exec(t[l]) || [])[1],
                    h = (s[2] || "").split(".").sort(),
                    d && (f = w.event.special[d] || {},
                    d = (i ? f.delegateType : f.bindType) || d,
                    f = w.event.special[d] || {},
                    c = w.extend({
                        type: d,
                        origType: g,
                        data: r,
                        handler: n,
                        guid: n.guid,
                        selector: i,
                        needsContext: i && w.expr.match.needsContext.test(i),
                        namespace: h.join(".")
                    }, o),
                    (p = u[d]) || ((p = u[d] = []).delegateCount = 0,
                    f.setup && !1 !== f.setup.call(e, r, h, a) || e.addEventListener && e.addEventListener(d, a)),
                    f.add && (f.add.call(e, c),
                    c.handler.guid || (c.handler.guid = n.guid)),
                    i ? p.splice(p.delegateCount++, 0, c) : p.push(c),
                    w.event.global[d] = !0)
        },
        remove: function(e, t, n, r, i) {
            var o, a, s, u, l, c, f, p, d, h, g, v = Y.hasData(e) && Y.get(e);
            if (v && (u = v.events)) {
                for (l = (t = (t || "").match(P) || [""]).length; l--; )
                    if (d = g = (s = be.exec(t[l]) || [])[1],
                    h = (s[2] || "").split(".").sort(),
                    d) {
                        for (f = w.event.special[d] || {},
                        p = u[d = (r ? f.delegateType : f.bindType) || d] || [],
                        s = s[2] && new RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"),
                        a = o = p.length; o--; )
                            c = p[o],
                            !i && g !== c.origType || n && n.guid !== c.guid || s && !s.test(c.namespace) || r && r !== c.selector && ("**" !== r || !c.selector) || (p.splice(o, 1),
                            c.selector && p.delegateCount--,
                            f.remove && f.remove.call(e, c));
                        a && !p.length && (f.teardown && !1 !== f.teardown.call(e, h, v.handle) || w.removeEvent(e, d, v.handle),
                        delete u[d])
                    } else
                        for (d in u)
                            w.event.remove(e, d + t[l], n, r, !0);
                w.isEmptyObject(u) && Y.remove(e, "handle events")
            }
        },
        dispatch: function(e) {
            var t, n, r, i, o, a, s = new Array(arguments.length), u = w.event.fix(e), l = (Y.get(this, "events") || Object.create(null))[u.type] || [], c = w.event.special[u.type] || {};
            for (s[0] = u,
            t = 1; t < arguments.length; t++)
                s[t] = arguments[t];
            if (u.delegateTarget = this,
            !c.preDispatch || !1 !== c.preDispatch.call(this, u)) {
                for (a = w.event.handlers.call(this, u, l),
                t = 0; (i = a[t++]) && !u.isPropagationStopped(); )
                    for (u.currentTarget = i.elem,
                    n = 0; (o = i.handlers[n++]) && !u.isImmediatePropagationStopped(); )
                        u.rnamespace && !1 !== o.namespace && !u.rnamespace.test(o.namespace) || (u.handleObj = o,
                        u.data = o.data,
                        void 0 !== (r = ((w.event.special[o.origType] || {}).handle || o.handler).apply(i.elem, s)) && !1 === (u.result = r) && (u.preventDefault(),
                        u.stopPropagation()));
                return c.postDispatch && c.postDispatch.call(this, u),
                u.result
            }
        },
        handlers: function(e, t) {
            var n, r, i, o, a, s = [], u = t.delegateCount, l = e.target;
            if (u && l.nodeType && !("click" === e.type && 1 <= e.button))
                for (; l !== this; l = l.parentNode || this)
                    if (1 === l.nodeType && ("click" !== e.type || !0 !== l.disabled)) {
                        for (o = [],
                        a = {},
                        n = 0; n < u; n++)
                            void 0 === a[i = (r = t[n]).selector + " "] && (a[i] = r.needsContext ? -1 < w(i, this).index(l) : w.find(i, this, null, [l]).length),
                            a[i] && o.push(r);
                        o.length && s.push({
                            elem: l,
                            handlers: o
                        })
                    }
            return l = this,
            u < t.length && s.push({
                elem: l,
                handlers: t.slice(u)
            }),
            s
        },
        addProp: function(e, t) {
            Object.defineProperty(w.Event.prototype, e, {
                enumerable: !0,
                configurable: !0,
                get: h(t) ? function() {
                    if (this.originalEvent)
                        return t(this.originalEvent)
                }
                : function() {
                    if (this.originalEvent)
                        return this.originalEvent[e]
                }
                ,
                set: function(t) {
                    Object.defineProperty(this, e, {
                        enumerable: !0,
                        configurable: !0,
                        writable: !0,
                        value: t
                    })
                }
            })
        },
        fix: function(e) {
            return e[w.expando] ? e : new w.Event(e)
        },
        special: {
            load: {
                noBubble: !0
            },
            click: {
                setup: function(e) {
                    var t = this || e;
                    return pe.test(t.type) && t.click && A(t, "input") && Se(t, "click", we),
                    !1
                },
                trigger: function(e) {
                    var t = this || e;
                    return pe.test(t.type) && t.click && A(t, "input") && Se(t, "click"),
                    !0
                },
                _default: function(e) {
                    var t = e.target;
                    return pe.test(t.type) && t.click && A(t, "input") && Y.get(t, "click") || A(t, "a")
                }
            },
            beforeunload: {
                postDispatch: function(e) {
                    void 0 !== e.result && e.originalEvent && (e.originalEvent.returnValue = e.result)
                }
            }
        }
    },
    w.removeEvent = function(e, t, n) {
        e.removeEventListener && e.removeEventListener(t, n)
    }
    ,
    w.Event = function(e, t) {
        if (!(this instanceof w.Event))
            return new w.Event(e,t);
        e && e.type ? (this.originalEvent = e,
        this.type = e.type,
        this.isDefaultPrevented = e.defaultPrevented || void 0 === e.defaultPrevented && !1 === e.returnValue ? we : Te,
        this.target = e.target && 3 === e.target.nodeType ? e.target.parentNode : e.target,
        this.currentTarget = e.currentTarget,
        this.relatedTarget = e.relatedTarget) : this.type = e,
        t && w.extend(this, t),
        this.timeStamp = e && e.timeStamp || Date.now(),
        this[w.expando] = !0
    }
    ,
    w.Event.prototype = {
        constructor: w.Event,
        isDefaultPrevented: Te,
        isPropagationStopped: Te,
        isImmediatePropagationStopped: Te,
        isSimulated: !1,
        preventDefault: function() {
            var e = this.originalEvent;
            this.isDefaultPrevented = we,
            e && !this.isSimulated && e.preventDefault()
        },
        stopPropagation: function() {
            var e = this.originalEvent;
            this.isPropagationStopped = we,
            e && !this.isSimulated && e.stopPropagation()
        },
        stopImmediatePropagation: function() {
            var e = this.originalEvent;
            this.isImmediatePropagationStopped = we,
            e && !this.isSimulated && e.stopImmediatePropagation(),
            this.stopPropagation()
        }
    },
    w.each({
        altKey: !0,
        bubbles: !0,
        cancelable: !0,
        changedTouches: !0,
        ctrlKey: !0,
        detail: !0,
        eventPhase: !0,
        metaKey: !0,
        pageX: !0,
        pageY: !0,
        shiftKey: !0,
        view: !0,
        char: !0,
        code: !0,
        charCode: !0,
        key: !0,
        keyCode: !0,
        button: !0,
        buttons: !0,
        clientX: !0,
        clientY: !0,
        offsetX: !0,
        offsetY: !0,
        pointerId: !0,
        pointerType: !0,
        screenX: !0,
        screenY: !0,
        targetTouches: !0,
        toElement: !0,
        touches: !0,
        which: !0
    }, w.event.addProp),
    w.each({
        focus: "focusin",
        blur: "focusout"
    }, (function(e, t) {
        w.event.special[e] = {
            setup: function() {
                return Se(this, e, Ce),
                !1
            },
            trigger: function() {
                return Se(this, e),
                !0
            },
            _default: function() {
                return !0
            },
            delegateType: t
        }
    }
    )),
    w.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout",
        pointerenter: "pointerover",
        pointerleave: "pointerout"
    }, (function(e, t) {
        w.event.special[e] = {
            delegateType: t,
            bindType: t,
            handle: function(e) {
                var n, r = e.relatedTarget, i = e.handleObj;
                return r && (r === this || w.contains(this, r)) || (e.type = i.origType,
                n = i.handler.apply(this, arguments),
                e.type = t),
                n
            }
        }
    }
    )),
    w.fn.extend({
        on: function(e, t, n, r) {
            return Ee(this, e, t, n, r)
        },
        one: function(e, t, n, r) {
            return Ee(this, e, t, n, r, 1)
        },
        off: function(e, t, n) {
            var r, i;
            if (e && e.preventDefault && e.handleObj)
                return r = e.handleObj,
                w(e.delegateTarget).off(r.namespace ? r.origType + "." + r.namespace : r.origType, r.selector, r.handler),
                this;
            if ("object" == _typeof(e)) {
                for (i in e)
                    this.off(i, t, e[i]);
                return this
            }
            return !1 !== t && "function" != typeof t || (n = t,
            t = void 0),
            !1 === n && (n = Te),
            this.each((function() {
                w.event.remove(this, e, n, t)
            }
            ))
        }
    });
    var ke = /<script|<style|<link/i
      , Ae = /checked\s*(?:[^=]|=\s*.checked.)/i
      , Ne = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;
    function je(e, t) {
        return A(e, "table") && A(11 !== t.nodeType ? t : t.firstChild, "tr") && w(e).children("tbody")[0] || e
    }
    function De(e) {
        return e.type = (null !== e.getAttribute("type")) + "/" + e.type,
        e
    }
    function qe(e) {
        return "true/" === (e.type || "").slice(0, 5) ? e.type = e.type.slice(5) : e.removeAttribute("type"),
        e
    }
    function Le(e, t) {
        var n, r, i, o, a, s;
        if (1 === t.nodeType) {
            if (Y.hasData(e) && (s = Y.get(e).events))
                for (i in Y.remove(t, "handle events"),
                s)
                    for (n = 0,
                    r = s[i].length; n < r; n++)
                        w.event.add(t, i, s[i][n]);
            Q.hasData(e) && (o = Q.access(e),
            a = w.extend({}, o),
            Q.set(t, a))
        }
    }
    function He(e, t, n, r) {
        t = o(t);
        var i, a, s, u, l, c, f = 0, p = e.length, g = p - 1, v = t[0], y = h(v);
        if (y || 1 < p && "string" == typeof v && !d.checkClone && Ae.test(v))
            return e.each((function(i) {
                var o = e.eq(i);
                y && (t[0] = v.call(this, i, o.html())),
                He(o, t, n, r)
            }
            ));
        if (p && (a = (i = xe(t, e[0].ownerDocument, !1, e, r)).firstChild,
        1 === i.childNodes.length && (i = a),
        a || r)) {
            for (u = (s = w.map(ve(i, "script"), De)).length; f < p; f++)
                l = i,
                f !== g && (l = w.clone(l, !0, !0),
                u && w.merge(s, ve(l, "script"))),
                n.call(e[f], l, f);
            if (u)
                for (c = s[s.length - 1].ownerDocument,
                w.map(s, qe),
                f = 0; f < u; f++)
                    l = s[f],
                    he.test(l.type || "") && !Y.access(l, "globalEval") && w.contains(c, l) && (l.src && "module" !== (l.type || "").toLowerCase() ? w._evalUrl && !l.noModule && w._evalUrl(l.src, {
                        nonce: l.nonce || l.getAttribute("nonce")
                    }, c) : m(l.textContent.replace(Ne, ""), l, c))
        }
        return e
    }
    function Oe(e, t, n) {
        for (var r, i = t ? w.filter(t, e) : e, o = 0; null != (r = i[o]); o++)
            n || 1 !== r.nodeType || w.cleanData(ve(r)),
            r.parentNode && (n && ie(r) && ye(ve(r, "script")),
            r.parentNode.removeChild(r));
        return e
    }
    w.extend({
        htmlPrefilter: function(e) {
            return e
        },
        clone: function(e, t, n) {
            var r, i, o, a, s, u, l, c = e.cloneNode(!0), f = ie(e);
            if (!(d.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || w.isXMLDoc(e)))
                for (a = ve(c),
                r = 0,
                i = (o = ve(e)).length; r < i; r++)
                    s = o[r],
                    "input" === (l = (u = a[r]).nodeName.toLowerCase()) && pe.test(s.type) ? u.checked = s.checked : "input" !== l && "textarea" !== l || (u.defaultValue = s.defaultValue);
            if (t)
                if (n)
                    for (o = o || ve(e),
                    a = a || ve(c),
                    r = 0,
                    i = o.length; r < i; r++)
                        Le(o[r], a[r]);
                else
                    Le(e, c);
            return 0 < (a = ve(c, "script")).length && ye(a, !f && ve(e, "script")),
            c
        },
        cleanData: function(e) {
            for (var t, n, r, i = w.event.special, o = 0; void 0 !== (n = e[o]); o++)
                if (V(n)) {
                    if (t = n[Y.expando]) {
                        if (t.events)
                            for (r in t.events)
                                i[r] ? w.event.remove(n, r) : w.removeEvent(n, r, t.handle);
                        n[Y.expando] = void 0
                    }
                    n[Q.expando] && (n[Q.expando] = void 0)
                }
        }
    }),
    w.fn.extend({
        detach: function(e) {
            return Oe(this, e, !0)
        },
        remove: function(e) {
            return Oe(this, e)
        },
        text: function(e) {
            return B(this, (function(e) {
                return void 0 === e ? w.text(this) : this.empty().each((function() {
                    1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || (this.textContent = e)
                }
                ))
            }
            ), null, e, arguments.length)
        },
        append: function() {
            return He(this, arguments, (function(e) {
                1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || je(this, e).appendChild(e)
            }
            ))
        },
        prepend: function() {
            return He(this, arguments, (function(e) {
                if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                    var t = je(this, e);
                    t.insertBefore(e, t.firstChild)
                }
            }
            ))
        },
        before: function() {
            return He(this, arguments, (function(e) {
                this.parentNode && this.parentNode.insertBefore(e, this)
            }
            ))
        },
        after: function() {
            return He(this, arguments, (function(e) {
                this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
            }
            ))
        },
        empty: function() {
            for (var e, t = 0; null != (e = this[t]); t++)
                1 === e.nodeType && (w.cleanData(ve(e, !1)),
                e.textContent = "");
            return this
        },
        clone: function(e, t) {
            return e = null != e && e,
            t = null == t ? e : t,
            this.map((function() {
                return w.clone(this, e, t)
            }
            ))
        },
        html: function(e) {
            return B(this, (function(e) {
                var t = this[0] || {}
                  , n = 0
                  , r = this.length;
                if (void 0 === e && 1 === t.nodeType)
                    return t.innerHTML;
                if ("string" == typeof e && !ke.test(e) && !ge[(de.exec(e) || ["", ""])[1].toLowerCase()]) {
                    e = w.htmlPrefilter(e);
                    try {
                        for (; n < r; n++)
                            1 === (t = this[n] || {}).nodeType && (w.cleanData(ve(t, !1)),
                            t.innerHTML = e);
                        t = 0
                    } catch (e) {}
                }
                t && this.empty().append(e)
            }
            ), null, e, arguments.length)
        },
        replaceWith: function() {
            var e = [];
            return He(this, arguments, (function(t) {
                var n = this.parentNode;
                w.inArray(this, e) < 0 && (w.cleanData(ve(this)),
                n && n.replaceChild(t, this))
            }
            ), e)
        }
    }),
    w.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, (function(e, t) {
        w.fn[e] = function(e) {
            for (var n, r = [], i = w(e), o = i.length - 1, s = 0; s <= o; s++)
                n = s === o ? this : this.clone(!0),
                w(i[s])[t](n),
                a.apply(r, n.get());
            return this.pushStack(r)
        }
    }
    ));
    var Pe = new RegExp("^(" + ee + ")(?!px)[a-z%]+$","i")
      , Re = function(t) {
        var n = t.ownerDocument.defaultView;
        return n && n.opener || (n = e),
        n.getComputedStyle(t)
    }
      , Me = function(e, t, n) {
        var r, i, o = {};
        for (i in t)
            o[i] = e.style[i],
            e.style[i] = t[i];
        for (i in r = n.call(e),
        t)
            e.style[i] = o[i];
        return r
    }
      , Ie = new RegExp(ne.join("|"),"i");
    function _e(e, t, n) {
        var r, i, o, a, s = e.style;
        return (n = n || Re(e)) && ("" !== (a = n.getPropertyValue(t) || n[t]) || ie(e) || (a = w.style(e, t)),
        !d.pixelBoxStyles() && Pe.test(a) && Ie.test(t) && (r = s.width,
        i = s.minWidth,
        o = s.maxWidth,
        s.minWidth = s.maxWidth = s.width = a,
        a = n.width,
        s.width = r,
        s.minWidth = i,
        s.maxWidth = o)),
        void 0 !== a ? a + "" : a
    }
    function We(e, t) {
        return {
            get: function() {
                if (!e())
                    return (this.get = t).apply(this, arguments);
                delete this.get
            }
        }
    }
    !function() {
        function t() {
            if (c) {
                l.style.cssText = "position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",
                c.style.cssText = "position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",
                re.appendChild(l).appendChild(c);
                var t = e.getComputedStyle(c);
                r = "1%" !== t.top,
                u = 12 === n(t.marginLeft),
                c.style.right = "60%",
                a = 36 === n(t.right),
                i = 36 === n(t.width),
                c.style.position = "absolute",
                o = 12 === n(c.offsetWidth / 3),
                re.removeChild(l),
                c = null
            }
        }
        function n(e) {
            return Math.round(parseFloat(e))
        }
        var r, i, o, a, s, u, l = v.createElement("div"), c = v.createElement("div");
        c.style && (c.style.backgroundClip = "content-box",
        c.cloneNode(!0).style.backgroundClip = "",
        d.clearCloneStyle = "content-box" === c.style.backgroundClip,
        w.extend(d, {
            boxSizingReliable: function() {
                return t(),
                i
            },
            pixelBoxStyles: function() {
                return t(),
                a
            },
            pixelPosition: function() {
                return t(),
                r
            },
            reliableMarginLeft: function() {
                return t(),
                u
            },
            scrollboxSize: function() {
                return t(),
                o
            },
            reliableTrDimensions: function() {
                var t, n, r, i;
                return null == s && (t = v.createElement("table"),
                n = v.createElement("tr"),
                r = v.createElement("div"),
                t.style.cssText = "position:absolute;left:-11111px;border-collapse:separate",
                n.style.cssText = "border:1px solid",
                n.style.height = "1px",
                r.style.height = "9px",
                r.style.display = "block",
                re.appendChild(t).appendChild(n).appendChild(r),
                i = e.getComputedStyle(n),
                s = parseInt(i.height, 10) + parseInt(i.borderTopWidth, 10) + parseInt(i.borderBottomWidth, 10) === n.offsetHeight,
                re.removeChild(t)),
                s
            }
        }))
    }();
    var Fe = ["Webkit", "Moz", "ms"]
      , Be = v.createElement("div").style
      , $e = {};
    function ze(e) {
        return w.cssProps[e] || $e[e] || (e in Be ? e : $e[e] = function(e) {
            for (var t = e[0].toUpperCase() + e.slice(1), n = Fe.length; n--; )
                if ((e = Fe[n] + t)in Be)
                    return e
        }(e) || e)
    }
    var Ue = /^(none|table(?!-c[ea]).+)/
      , Xe = /^--/
      , Ve = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }
      , Ge = {
        letterSpacing: "0",
        fontWeight: "400"
    };
    function Ye(e, t, n) {
        var r = te.exec(t);
        return r ? Math.max(0, r[2] - (n || 0)) + (r[3] || "px") : t
    }
    function Qe(e, t, n, r, i, o) {
        var a = "width" === t ? 1 : 0
          , s = 0
          , u = 0;
        if (n === (r ? "border" : "content"))
            return 0;
        for (; a < 4; a += 2)
            "margin" === n && (u += w.css(e, n + ne[a], !0, i)),
            r ? ("content" === n && (u -= w.css(e, "padding" + ne[a], !0, i)),
            "margin" !== n && (u -= w.css(e, "border" + ne[a] + "Width", !0, i))) : (u += w.css(e, "padding" + ne[a], !0, i),
            "padding" !== n ? u += w.css(e, "border" + ne[a] + "Width", !0, i) : s += w.css(e, "border" + ne[a] + "Width", !0, i));
        return !r && 0 <= o && (u += Math.max(0, Math.ceil(e["offset" + t[0].toUpperCase() + t.slice(1)] - o - u - s - .5)) || 0),
        u
    }
    function Je(e, t, n) {
        var r = Re(e)
          , i = (!d.boxSizingReliable() || n) && "border-box" === w.css(e, "boxSizing", !1, r)
          , o = i
          , a = _e(e, t, r)
          , s = "offset" + t[0].toUpperCase() + t.slice(1);
        if (Pe.test(a)) {
            if (!n)
                return a;
            a = "auto"
        }
        return (!d.boxSizingReliable() && i || !d.reliableTrDimensions() && A(e, "tr") || "auto" === a || !parseFloat(a) && "inline" === w.css(e, "display", !1, r)) && e.getClientRects().length && (i = "border-box" === w.css(e, "boxSizing", !1, r),
        (o = s in e) && (a = e[s])),
        (a = parseFloat(a) || 0) + Qe(e, t, n || (i ? "border" : "content"), o, r, a) + "px"
    }
    function Ke(e, t, n, r, i) {
        return new Ke.prototype.init(e,t,n,r,i)
    }
    w.extend({
        cssHooks: {
            opacity: {
                get: function(e, t) {
                    if (t) {
                        var n = _e(e, "opacity");
                        return "" === n ? "1" : n
                    }
                }
            }
        },
        cssNumber: {
            animationIterationCount: !0,
            columnCount: !0,
            fillOpacity: !0,
            flexGrow: !0,
            flexShrink: !0,
            fontWeight: !0,
            gridArea: !0,
            gridColumn: !0,
            gridColumnEnd: !0,
            gridColumnStart: !0,
            gridRow: !0,
            gridRowEnd: !0,
            gridRowStart: !0,
            lineHeight: !0,
            opacity: !0,
            order: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: {},
        style: function(e, t, n, r) {
            if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                var i, o, a, s = X(t), u = Xe.test(t), l = e.style;
                if (u || (t = ze(s)),
                a = w.cssHooks[t] || w.cssHooks[s],
                void 0 === n)
                    return a && "get"in a && void 0 !== (i = a.get(e, !1, r)) ? i : l[t];
                "string" === (o = _typeof(n)) && (i = te.exec(n)) && i[1] && (n = se(e, t, i),
                o = "number"),
                null != n && n == n && ("number" !== o || u || (n += i && i[3] || (w.cssNumber[s] ? "" : "px")),
                d.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (l[t] = "inherit"),
                a && "set"in a && void 0 === (n = a.set(e, n, r)) || (u ? l.setProperty(t, n) : l[t] = n))
            }
        },
        css: function(e, t, n, r) {
            var i, o, a, s = X(t);
            return Xe.test(t) || (t = ze(s)),
            (a = w.cssHooks[t] || w.cssHooks[s]) && "get"in a && (i = a.get(e, !0, n)),
            void 0 === i && (i = _e(e, t, r)),
            "normal" === i && t in Ge && (i = Ge[t]),
            "" === n || n ? (o = parseFloat(i),
            !0 === n || isFinite(o) ? o || 0 : i) : i
        }
    }),
    w.each(["height", "width"], (function(e, t) {
        w.cssHooks[t] = {
            get: function(e, n, r) {
                if (n)
                    return !Ue.test(w.css(e, "display")) || e.getClientRects().length && e.getBoundingClientRect().width ? Je(e, t, r) : Me(e, Ve, (function() {
                        return Je(e, t, r)
                    }
                    ))
            },
            set: function(e, n, r) {
                var i, o = Re(e), a = !d.scrollboxSize() && "absolute" === o.position, s = (a || r) && "border-box" === w.css(e, "boxSizing", !1, o), u = r ? Qe(e, t, r, s, o) : 0;
                return s && a && (u -= Math.ceil(e["offset" + t[0].toUpperCase() + t.slice(1)] - parseFloat(o[t]) - Qe(e, t, "border", !1, o) - .5)),
                u && (i = te.exec(n)) && "px" !== (i[3] || "px") && (e.style[t] = n,
                n = w.css(e, t)),
                Ye(0, n, u)
            }
        }
    }
    )),
    w.cssHooks.marginLeft = We(d.reliableMarginLeft, (function(e, t) {
        if (t)
            return (parseFloat(_e(e, "marginLeft")) || e.getBoundingClientRect().left - Me(e, {
                marginLeft: 0
            }, (function() {
                return e.getBoundingClientRect().left
            }
            ))) + "px"
    }
    )),
    w.each({
        margin: "",
        padding: "",
        border: "Width"
    }, (function(e, t) {
        w.cssHooks[e + t] = {
            expand: function(n) {
                for (var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n]; r < 4; r++)
                    i[e + ne[r] + t] = o[r] || o[r - 2] || o[0];
                return i
            }
        },
        "margin" !== e && (w.cssHooks[e + t].set = Ye)
    }
    )),
    w.fn.extend({
        css: function(e, t) {
            return B(this, (function(e, t, n) {
                var r, i, o = {}, a = 0;
                if (Array.isArray(t)) {
                    for (r = Re(e),
                    i = t.length; a < i; a++)
                        o[t[a]] = w.css(e, t[a], !1, r);
                    return o
                }
                return void 0 !== n ? w.style(e, t, n) : w.css(e, t)
            }
            ), e, t, 1 < arguments.length)
        }
    }),
    ((w.Tween = Ke).prototype = {
        constructor: Ke,
        init: function(e, t, n, r, i, o) {
            this.elem = e,
            this.prop = n,
            this.easing = i || w.easing._default,
            this.options = t,
            this.start = this.now = this.cur(),
            this.end = r,
            this.unit = o || (w.cssNumber[n] ? "" : "px")
        },
        cur: function() {
            var e = Ke.propHooks[this.prop];
            return e && e.get ? e.get(this) : Ke.propHooks._default.get(this)
        },
        run: function(e) {
            var t, n = Ke.propHooks[this.prop];
            return this.options.duration ? this.pos = t = w.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : this.pos = t = e,
            this.now = (this.end - this.start) * t + this.start,
            this.options.step && this.options.step.call(this.elem, this.now, this),
            n && n.set ? n.set(this) : Ke.propHooks._default.set(this),
            this
        }
    }).init.prototype = Ke.prototype,
    (Ke.propHooks = {
        _default: {
            get: function(e) {
                var t;
                return 1 !== e.elem.nodeType || null != e.elem[e.prop] && null == e.elem.style[e.prop] ? e.elem[e.prop] : (t = w.css(e.elem, e.prop, "")) && "auto" !== t ? t : 0
            },
            set: function(e) {
                w.fx.step[e.prop] ? w.fx.step[e.prop](e) : 1 !== e.elem.nodeType || !w.cssHooks[e.prop] && null == e.elem.style[ze(e.prop)] ? e.elem[e.prop] = e.now : w.style(e.elem, e.prop, e.now + e.unit)
            }
        }
    }).scrollTop = Ke.propHooks.scrollLeft = {
        set: function(e) {
            e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
        }
    },
    w.easing = {
        linear: function(e) {
            return e
        },
        swing: function(e) {
            return .5 - Math.cos(e * Math.PI) / 2
        },
        _default: "swing"
    },
    (w.fx = Ke.prototype.init).step = {};
    var Ze, et, tt, nt, rt = /^(?:toggle|show|hide)$/, it = /queueHooks$/;
    function ot() {
        et && (!1 === v.hidden && e.requestAnimationFrame ? e.requestAnimationFrame(ot) : e.setTimeout(ot, w.fx.interval),
        w.fx.tick())
    }
    function at() {
        return e.setTimeout((function() {
            Ze = void 0
        }
        )),
        Ze = Date.now()
    }
    function st(e, t) {
        var n, r = 0, i = {
            height: e
        };
        for (t = t ? 1 : 0; r < 4; r += 2 - t)
            i["margin" + (n = ne[r])] = i["padding" + n] = e;
        return t && (i.opacity = i.width = e),
        i
    }
    function ut(e, t, n) {
        for (var r, i = (lt.tweeners[t] || []).concat(lt.tweeners["*"]), o = 0, a = i.length; o < a; o++)
            if (r = i[o].call(n, t, e))
                return r
    }
    function lt(e, t, n) {
        var r, i, o = 0, a = lt.prefilters.length, s = w.Deferred().always((function() {
            delete u.elem
        }
        )), u = function() {
            if (i)
                return !1;
            for (var t = Ze || at(), n = Math.max(0, l.startTime + l.duration - t), r = 1 - (n / l.duration || 0), o = 0, a = l.tweens.length; o < a; o++)
                l.tweens[o].run(r);
            return s.notifyWith(e, [l, r, n]),
            r < 1 && a ? n : (a || s.notifyWith(e, [l, 1, 0]),
            s.resolveWith(e, [l]),
            !1)
        }, l = s.promise({
            elem: e,
            props: w.extend({}, t),
            opts: w.extend(!0, {
                specialEasing: {},
                easing: w.easing._default
            }, n),
            originalProperties: t,
            originalOptions: n,
            startTime: Ze || at(),
            duration: n.duration,
            tweens: [],
            createTween: function(t, n) {
                var r = w.Tween(e, l.opts, t, n, l.opts.specialEasing[t] || l.opts.easing);
                return l.tweens.push(r),
                r
            },
            stop: function(t) {
                var n = 0
                  , r = t ? l.tweens.length : 0;
                if (i)
                    return this;
                for (i = !0; n < r; n++)
                    l.tweens[n].run(1);
                return t ? (s.notifyWith(e, [l, 1, 0]),
                s.resolveWith(e, [l, t])) : s.rejectWith(e, [l, t]),
                this
            }
        }), c = l.props;
        for (function(e, t) {
            var n, r, i, o, a;
            for (n in e)
                if (i = t[r = X(n)],
                o = e[n],
                Array.isArray(o) && (i = o[1],
                o = e[n] = o[0]),
                n !== r && (e[r] = o,
                delete e[n]),
                (a = w.cssHooks[r]) && "expand"in a)
                    for (n in o = a.expand(o),
                    delete e[r],
                    o)
                        n in e || (e[n] = o[n],
                        t[n] = i);
                else
                    t[r] = i
        }(c, l.opts.specialEasing); o < a; o++)
            if (r = lt.prefilters[o].call(l, e, c, l.opts))
                return h(r.stop) && (w._queueHooks(l.elem, l.opts.queue).stop = r.stop.bind(r)),
                r;
        return w.map(c, ut, l),
        h(l.opts.start) && l.opts.start.call(e, l),
        l.progress(l.opts.progress).done(l.opts.done, l.opts.complete).fail(l.opts.fail).always(l.opts.always),
        w.fx.timer(w.extend(u, {
            elem: e,
            anim: l,
            queue: l.opts.queue
        })),
        l
    }
    w.Animation = w.extend(lt, {
        tweeners: {
            "*": [function(e, t) {
                var n = this.createTween(e, t);
                return se(n.elem, e, te.exec(t), n),
                n
            }
            ]
        },
        tweener: function(e, t) {
            h(e) ? (t = e,
            e = ["*"]) : e = e.match(P);
            for (var n, r = 0, i = e.length; r < i; r++)
                n = e[r],
                lt.tweeners[n] = lt.tweeners[n] || [],
                lt.tweeners[n].unshift(t)
        },
        prefilters: [function(e, t, n) {
            var r, i, o, a, s, u, l, c, f = "width"in t || "height"in t, p = this, d = {}, h = e.style, g = e.nodeType && ae(e), v = Y.get(e, "fxshow");
            for (r in n.queue || (null == (a = w._queueHooks(e, "fx")).unqueued && (a.unqueued = 0,
            s = a.empty.fire,
            a.empty.fire = function() {
                a.unqueued || s()
            }
            ),
            a.unqueued++,
            p.always((function() {
                p.always((function() {
                    a.unqueued--,
                    w.queue(e, "fx").length || a.empty.fire()
                }
                ))
            }
            ))),
            t)
                if (i = t[r],
                rt.test(i)) {
                    if (delete t[r],
                    o = o || "toggle" === i,
                    i === (g ? "hide" : "show")) {
                        if ("show" !== i || !v || void 0 === v[r])
                            continue;
                        g = !0
                    }
                    d[r] = v && v[r] || w.style(e, r)
                }
            if ((u = !w.isEmptyObject(t)) || !w.isEmptyObject(d))
                for (r in f && 1 === e.nodeType && (n.overflow = [h.overflow, h.overflowX, h.overflowY],
                null == (l = v && v.display) && (l = Y.get(e, "display")),
                "none" === (c = w.css(e, "display")) && (l ? c = l : (le([e], !0),
                l = e.style.display || l,
                c = w.css(e, "display"),
                le([e]))),
                ("inline" === c || "inline-block" === c && null != l) && "none" === w.css(e, "float") && (u || (p.done((function() {
                    h.display = l
                }
                )),
                null == l && (c = h.display,
                l = "none" === c ? "" : c)),
                h.display = "inline-block")),
                n.overflow && (h.overflow = "hidden",
                p.always((function() {
                    h.overflow = n.overflow[0],
                    h.overflowX = n.overflow[1],
                    h.overflowY = n.overflow[2]
                }
                ))),
                u = !1,
                d)
                    u || (v ? "hidden"in v && (g = v.hidden) : v = Y.access(e, "fxshow", {
                        display: l
                    }),
                    o && (v.hidden = !g),
                    g && le([e], !0),
                    p.done((function() {
                        for (r in g || le([e]),
                        Y.remove(e, "fxshow"),
                        d)
                            w.style(e, r, d[r])
                    }
                    ))),
                    u = ut(g ? v[r] : 0, r, p),
                    r in v || (v[r] = u.start,
                    g && (u.end = u.start,
                    u.start = 0))
        }
        ],
        prefilter: function(e, t) {
            t ? lt.prefilters.unshift(e) : lt.prefilters.push(e)
        }
    }),
    w.speed = function(e, t, n) {
        var r = e && "object" == _typeof(e) ? w.extend({}, e) : {
            complete: n || !n && t || h(e) && e,
            duration: e,
            easing: n && t || t && !h(t) && t
        };
        return w.fx.off ? r.duration = 0 : "number" != typeof r.duration && (r.duration in w.fx.speeds ? r.duration = w.fx.speeds[r.duration] : r.duration = w.fx.speeds._default),
        null != r.queue && !0 !== r.queue || (r.queue = "fx"),
        r.old = r.complete,
        r.complete = function() {
            h(r.old) && r.old.call(this),
            r.queue && w.dequeue(this, r.queue)
        }
        ,
        r
    }
    ,
    w.fn.extend({
        fadeTo: function(e, t, n, r) {
            return this.filter(ae).css("opacity", 0).show().end().animate({
                opacity: t
            }, e, n, r)
        },
        animate: function(e, t, n, r) {
            var i = w.isEmptyObject(e)
              , o = w.speed(t, n, r)
              , a = function() {
                var t = lt(this, w.extend({}, e), o);
                (i || Y.get(this, "finish")) && t.stop(!0)
            };
            return a.finish = a,
            i || !1 === o.queue ? this.each(a) : this.queue(o.queue, a)
        },
        stop: function(e, t, n) {
            var r = function(e) {
                var t = e.stop;
                delete e.stop,
                t(n)
            };
            return "string" != typeof e && (n = t,
            t = e,
            e = void 0),
            t && this.queue(e || "fx", []),
            this.each((function() {
                var t = !0
                  , i = null != e && e + "queueHooks"
                  , o = w.timers
                  , a = Y.get(this);
                if (i)
                    a[i] && a[i].stop && r(a[i]);
                else
                    for (i in a)
                        a[i] && a[i].stop && it.test(i) && r(a[i]);
                for (i = o.length; i--; )
                    o[i].elem !== this || null != e && o[i].queue !== e || (o[i].anim.stop(n),
                    t = !1,
                    o.splice(i, 1));
                !t && n || w.dequeue(this, e)
            }
            ))
        },
        finish: function(e) {
            return !1 !== e && (e = e || "fx"),
            this.each((function() {
                var t, n = Y.get(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = w.timers, a = r ? r.length : 0;
                for (n.finish = !0,
                w.queue(this, e, []),
                i && i.stop && i.stop.call(this, !0),
                t = o.length; t--; )
                    o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0),
                    o.splice(t, 1));
                for (t = 0; t < a; t++)
                    r[t] && r[t].finish && r[t].finish.call(this);
                delete n.finish
            }
            ))
        }
    }),
    w.each(["toggle", "show", "hide"], (function(e, t) {
        var n = w.fn[t];
        w.fn[t] = function(e, r, i) {
            return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(st(t, !0), e, r, i)
        }
    }
    )),
    w.each({
        slideDown: st("show"),
        slideUp: st("hide"),
        slideToggle: st("toggle"),
        fadeIn: {
            opacity: "show"
        },
        fadeOut: {
            opacity: "hide"
        },
        fadeToggle: {
            opacity: "toggle"
        }
    }, (function(e, t) {
        w.fn[e] = function(e, n, r) {
            return this.animate(t, e, n, r)
        }
    }
    )),
    w.timers = [],
    w.fx.tick = function() {
        var e, t = 0, n = w.timers;
        for (Ze = Date.now(); t < n.length; t++)
            (e = n[t])() || n[t] !== e || n.splice(t--, 1);
        n.length || w.fx.stop(),
        Ze = void 0
    }
    ,
    w.fx.timer = function(e) {
        w.timers.push(e),
        w.fx.start()
    }
    ,
    w.fx.interval = 13,
    w.fx.start = function() {
        et || (et = !0,
        ot())
    }
    ,
    w.fx.stop = function() {
        et = null
    }
    ,
    w.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    },
    w.fn.delay = function(t, n) {
        return t = w.fx && w.fx.speeds[t] || t,
        n = n || "fx",
        this.queue(n, (function(n, r) {
            var i = e.setTimeout(n, t);
            r.stop = function() {
                e.clearTimeout(i)
            }
        }
        ))
    }
    ,
    tt = v.createElement("input"),
    nt = v.createElement("select").appendChild(v.createElement("option")),
    tt.type = "checkbox",
    d.checkOn = "" !== tt.value,
    d.optSelected = nt.selected,
    (tt = v.createElement("input")).value = "t",
    tt.type = "radio",
    d.radioValue = "t" === tt.value;
    var ct, ft = w.expr.attrHandle;
    w.fn.extend({
        attr: function(e, t) {
            return B(this, w.attr, e, t, 1 < arguments.length)
        },
        removeAttr: function(e) {
            return this.each((function() {
                w.removeAttr(this, e)
            }
            ))
        }
    }),
    w.extend({
        attr: function(e, t, n) {
            var r, i, o = e.nodeType;
            if (3 !== o && 8 !== o && 2 !== o)
                return void 0 === e.getAttribute ? w.prop(e, t, n) : (1 === o && w.isXMLDoc(e) || (i = w.attrHooks[t.toLowerCase()] || (w.expr.match.bool.test(t) ? ct : void 0)),
                void 0 !== n ? null === n ? void w.removeAttr(e, t) : i && "set"in i && void 0 !== (r = i.set(e, n, t)) ? r : (e.setAttribute(t, n + ""),
                n) : i && "get"in i && null !== (r = i.get(e, t)) ? r : null == (r = w.find.attr(e, t)) ? void 0 : r)
        },
        attrHooks: {
            type: {
                set: function(e, t) {
                    if (!d.radioValue && "radio" === t && A(e, "input")) {
                        var n = e.value;
                        return e.setAttribute("type", t),
                        n && (e.value = n),
                        t
                    }
                }
            }
        },
        removeAttr: function(e, t) {
            var n, r = 0, i = t && t.match(P);
            if (i && 1 === e.nodeType)
                for (; n = i[r++]; )
                    e.removeAttribute(n)
        }
    }),
    ct = {
        set: function(e, t, n) {
            return !1 === t ? w.removeAttr(e, n) : e.setAttribute(n, n),
            n
        }
    },
    w.each(w.expr.match.bool.source.match(/\w+/g), (function(e, t) {
        var n = ft[t] || w.find.attr;
        ft[t] = function(e, t, r) {
            var i, o, a = t.toLowerCase();
            return r || (o = ft[a],
            ft[a] = i,
            i = null != n(e, t, r) ? a : null,
            ft[a] = o),
            i
        }
    }
    ));
    var pt = /^(?:input|select|textarea|button)$/i
      , dt = /^(?:a|area)$/i;
    function ht(e) {
        return (e.match(P) || []).join(" ")
    }
    function gt(e) {
        return e.getAttribute && e.getAttribute("class") || ""
    }
    function vt(e) {
        return Array.isArray(e) ? e : "string" == typeof e && e.match(P) || []
    }
    w.fn.extend({
        prop: function(e, t) {
            return B(this, w.prop, e, t, 1 < arguments.length)
        },
        removeProp: function(e) {
            return this.each((function() {
                delete this[w.propFix[e] || e]
            }
            ))
        }
    }),
    w.extend({
        prop: function(e, t, n) {
            var r, i, o = e.nodeType;
            if (3 !== o && 8 !== o && 2 !== o)
                return 1 === o && w.isXMLDoc(e) || (t = w.propFix[t] || t,
                i = w.propHooks[t]),
                void 0 !== n ? i && "set"in i && void 0 !== (r = i.set(e, n, t)) ? r : e[t] = n : i && "get"in i && null !== (r = i.get(e, t)) ? r : e[t]
        },
        propHooks: {
            tabIndex: {
                get: function(e) {
                    var t = w.find.attr(e, "tabindex");
                    return t ? parseInt(t, 10) : pt.test(e.nodeName) || dt.test(e.nodeName) && e.href ? 0 : -1
                }
            }
        },
        propFix: {
            for: "htmlFor",
            class: "className"
        }
    }),
    d.optSelected || (w.propHooks.selected = {
        get: function(e) {
            var t = e.parentNode;
            return t && t.parentNode && t.parentNode.selectedIndex,
            null
        },
        set: function(e) {
            var t = e.parentNode;
            t && (t.selectedIndex,
            t.parentNode && t.parentNode.selectedIndex)
        }
    }),
    w.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], (function() {
        w.propFix[this.toLowerCase()] = this
    }
    )),
    w.fn.extend({
        addClass: function(e) {
            var t, n, r, i, o, a, s, u = 0;
            if (h(e))
                return this.each((function(t) {
                    w(this).addClass(e.call(this, t, gt(this)))
                }
                ));
            if ((t = vt(e)).length)
                for (; n = this[u++]; )
                    if (i = gt(n),
                    r = 1 === n.nodeType && " " + ht(i) + " ") {
                        for (a = 0; o = t[a++]; )
                            r.indexOf(" " + o + " ") < 0 && (r += o + " ");
                        i !== (s = ht(r)) && n.setAttribute("class", s)
                    }
            return this
        },
        removeClass: function(e) {
            var t, n, r, i, o, a, s, u = 0;
            if (h(e))
                return this.each((function(t) {
                    w(this).removeClass(e.call(this, t, gt(this)))
                }
                ));
            if (!arguments.length)
                return this.attr("class", "");
            if ((t = vt(e)).length)
                for (; n = this[u++]; )
                    if (i = gt(n),
                    r = 1 === n.nodeType && " " + ht(i) + " ") {
                        for (a = 0; o = t[a++]; )
                            for (; -1 < r.indexOf(" " + o + " "); )
                                r = r.replace(" " + o + " ", " ");
                        i !== (s = ht(r)) && n.setAttribute("class", s)
                    }
            return this
        },
        toggleClass: function(e, t) {
            var n = _typeof(e)
              , r = "string" === n || Array.isArray(e);
            return "boolean" == typeof t && r ? t ? this.addClass(e) : this.removeClass(e) : h(e) ? this.each((function(n) {
                w(this).toggleClass(e.call(this, n, gt(this), t), t)
            }
            )) : this.each((function() {
                var t, i, o, a;
                if (r)
                    for (i = 0,
                    o = w(this),
                    a = vt(e); t = a[i++]; )
                        o.hasClass(t) ? o.removeClass(t) : o.addClass(t);
                else
                    void 0 !== e && "boolean" !== n || ((t = gt(this)) && Y.set(this, "__className__", t),
                    this.setAttribute && this.setAttribute("class", t || !1 === e ? "" : Y.get(this, "__className__") || ""))
            }
            ))
        },
        hasClass: function(e) {
            var t, n, r = 0;
            for (t = " " + e + " "; n = this[r++]; )
                if (1 === n.nodeType && -1 < (" " + ht(gt(n)) + " ").indexOf(t))
                    return !0;
            return !1
        }
    });
    var yt = /\r/g;
    w.fn.extend({
        val: function(e) {
            var t, n, r, i = this[0];
            return arguments.length ? (r = h(e),
            this.each((function(n) {
                var i;
                1 === this.nodeType && (null == (i = r ? e.call(this, n, w(this).val()) : e) ? i = "" : "number" == typeof i ? i += "" : Array.isArray(i) && (i = w.map(i, (function(e) {
                    return null == e ? "" : e + ""
                }
                ))),
                (t = w.valHooks[this.type] || w.valHooks[this.nodeName.toLowerCase()]) && "set"in t && void 0 !== t.set(this, i, "value") || (this.value = i))
            }
            ))) : i ? (t = w.valHooks[i.type] || w.valHooks[i.nodeName.toLowerCase()]) && "get"in t && void 0 !== (n = t.get(i, "value")) ? n : "string" == typeof (n = i.value) ? n.replace(yt, "") : null == n ? "" : n : void 0
        }
    }),
    w.extend({
        valHooks: {
            option: {
                get: function(e) {
                    var t = w.find.attr(e, "value");
                    return null != t ? t : ht(w.text(e))
                }
            },
            select: {
                get: function(e) {
                    var t, n, r, i = e.options, o = e.selectedIndex, a = "select-one" === e.type, s = a ? null : [], u = a ? o + 1 : i.length;
                    for (r = o < 0 ? u : a ? o : 0; r < u; r++)
                        if (((n = i[r]).selected || r === o) && !n.disabled && (!n.parentNode.disabled || !A(n.parentNode, "optgroup"))) {
                            if (t = w(n).val(),
                            a)
                                return t;
                            s.push(t)
                        }
                    return s
                },
                set: function(e, t) {
                    for (var n, r, i = e.options, o = w.makeArray(t), a = i.length; a--; )
                        ((r = i[a]).selected = -1 < w.inArray(w.valHooks.option.get(r), o)) && (n = !0);
                    return n || (e.selectedIndex = -1),
                    o
                }
            }
        }
    }),
    w.each(["radio", "checkbox"], (function() {
        w.valHooks[this] = {
            set: function(e, t) {
                if (Array.isArray(t))
                    return e.checked = -1 < w.inArray(w(e).val(), t)
            }
        },
        d.checkOn || (w.valHooks[this].get = function(e) {
            return null === e.getAttribute("value") ? "on" : e.value
        }
        )
    }
    )),
    d.focusin = "onfocusin"in e;
    var mt = /^(?:focusinfocus|focusoutblur)$/
      , xt = function(e) {
        e.stopPropagation()
    };
    w.extend(w.event, {
        trigger: function(t, n, r, i) {
            var o, a, s, u, l, f, p, d, y = [r || v], m = c.call(t, "type") ? t.type : t, x = c.call(t, "namespace") ? t.namespace.split(".") : [];
            if (a = d = s = r = r || v,
            3 !== r.nodeType && 8 !== r.nodeType && !mt.test(m + w.event.triggered) && (-1 < m.indexOf(".") && (m = (x = m.split(".")).shift(),
            x.sort()),
            l = m.indexOf(":") < 0 && "on" + m,
            (t = t[w.expando] ? t : new w.Event(m,"object" == _typeof(t) && t)).isTrigger = i ? 2 : 3,
            t.namespace = x.join("."),
            t.rnamespace = t.namespace ? new RegExp("(^|\\.)" + x.join("\\.(?:.*\\.|)") + "(\\.|$)") : null,
            t.result = void 0,
            t.target || (t.target = r),
            n = null == n ? [t] : w.makeArray(n, [t]),
            p = w.event.special[m] || {},
            i || !p.trigger || !1 !== p.trigger.apply(r, n))) {
                if (!i && !p.noBubble && !g(r)) {
                    for (u = p.delegateType || m,
                    mt.test(u + m) || (a = a.parentNode); a; a = a.parentNode)
                        y.push(a),
                        s = a;
                    s === (r.ownerDocument || v) && y.push(s.defaultView || s.parentWindow || e)
                }
                for (o = 0; (a = y[o++]) && !t.isPropagationStopped(); )
                    d = a,
                    t.type = 1 < o ? u : p.bindType || m,
                    (f = (Y.get(a, "events") || Object.create(null))[t.type] && Y.get(a, "handle")) && f.apply(a, n),
                    (f = l && a[l]) && f.apply && V(a) && (t.result = f.apply(a, n),
                    !1 === t.result && t.preventDefault());
                return t.type = m,
                i || t.isDefaultPrevented() || p._default && !1 !== p._default.apply(y.pop(), n) || !V(r) || l && h(r[m]) && !g(r) && ((s = r[l]) && (r[l] = null),
                w.event.triggered = m,
                t.isPropagationStopped() && d.addEventListener(m, xt),
                r[m](),
                t.isPropagationStopped() && d.removeEventListener(m, xt),
                w.event.triggered = void 0,
                s && (r[l] = s)),
                t.result
            }
        },
        simulate: function(e, t, n) {
            var r = w.extend(new w.Event, n, {
                type: e,
                isSimulated: !0
            });
            w.event.trigger(r, null, t)
        }
    }),
    w.fn.extend({
        trigger: function(e, t) {
            return this.each((function() {
                w.event.trigger(e, t, this)
            }
            ))
        },
        triggerHandler: function(e, t) {
            var n = this[0];
            if (n)
                return w.event.trigger(e, t, n, !0)
        }
    }),
    d.focusin || w.each({
        focus: "focusin",
        blur: "focusout"
    }, (function(e, t) {
        var n = function(e) {
            w.event.simulate(t, e.target, w.event.fix(e))
        };
        w.event.special[t] = {
            setup: function() {
                var r = this.ownerDocument || this.document || this
                  , i = Y.access(r, t);
                i || r.addEventListener(e, n, !0),
                Y.access(r, t, (i || 0) + 1)
            },
            teardown: function() {
                var r = this.ownerDocument || this.document || this
                  , i = Y.access(r, t) - 1;
                i ? Y.access(r, t, i) : (r.removeEventListener(e, n, !0),
                Y.remove(r, t))
            }
        }
    }
    ));
    var bt = e.location
      , wt = {
        guid: Date.now()
    }
      , Tt = /\?/;
    w.parseXML = function(t) {
        var n, r;
        if (!t || "string" != typeof t)
            return null;
        try {
            n = (new e.DOMParser).parseFromString(t, "text/xml")
        } catch (t) {}
        return r = n && n.getElementsByTagName("parsererror")[0],
        n && !r || w.error("Invalid XML: " + (r ? w.map(r.childNodes, (function(e) {
            return e.textContent
        }
        )).join("\n") : t)),
        n
    }
    ;
    var Ct = /\[\]$/
      , Et = /\r?\n/g
      , St = /^(?:submit|button|image|reset|file)$/i
      , kt = /^(?:input|select|textarea|keygen)/i;
    function At(e, t, n, r) {
        var i;
        if (Array.isArray(t))
            w.each(t, (function(t, i) {
                n || Ct.test(e) ? r(e, i) : At(e + "[" + ("object" == _typeof(i) && null != i ? t : "") + "]", i, n, r)
            }
            ));
        else if (n || "object" !== x(t))
            r(e, t);
        else
            for (i in t)
                At(e + "[" + i + "]", t[i], n, r)
    }
    w.param = function(e, t) {
        var n, r = [], i = function(e, t) {
            var n = h(t) ? t() : t;
            r[r.length] = encodeURIComponent(e) + "=" + encodeURIComponent(null == n ? "" : n)
        };
        if (null == e)
            return "";
        if (Array.isArray(e) || e.jquery && !w.isPlainObject(e))
            w.each(e, (function() {
                i(this.name, this.value)
            }
            ));
        else
            for (n in e)
                At(n, e[n], t, i);
        return r.join("&")
    }
    ,
    w.fn.extend({
        serialize: function() {
            return w.param(this.serializeArray())
        },
        serializeArray: function() {
            return this.map((function() {
                var e = w.prop(this, "elements");
                return e ? w.makeArray(e) : this
            }
            )).filter((function() {
                var e = this.type;
                return this.name && !w(this).is(":disabled") && kt.test(this.nodeName) && !St.test(e) && (this.checked || !pe.test(e))
            }
            )).map((function(e, t) {
                var n = w(this).val();
                return null == n ? null : Array.isArray(n) ? w.map(n, (function(e) {
                    return {
                        name: t.name,
                        value: e.replace(Et, "\r\n")
                    }
                }
                )) : {
                    name: t.name,
                    value: n.replace(Et, "\r\n")
                }
            }
            )).get()
        }
    });
    var Nt = /%20/g
      , jt = /#.*$/
      , Dt = /([?&])_=[^&]*/
      , qt = /^(.*?):[ \t]*([^\r\n]*)$/gm
      , Lt = /^(?:GET|HEAD)$/
      , Ht = /^\/\//
      , Ot = {}
      , Pt = {}
      , Rt = "*/".concat("*")
      , Mt = v.createElement("a");
    function It(e) {
        return function(t, n) {
            "string" != typeof t && (n = t,
            t = "*");
            var r, i = 0, o = t.toLowerCase().match(P) || [];
            if (h(n))
                for (; r = o[i++]; )
                    "+" === r[0] ? (r = r.slice(1) || "*",
                    (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
        }
    }
    function _t(e, t, n, r) {
        var i = {}
          , o = e === Pt;
        function a(s) {
            var u;
            return i[s] = !0,
            w.each(e[s] || [], (function(e, s) {
                var l = s(t, n, r);
                return "string" != typeof l || o || i[l] ? o ? !(u = l) : void 0 : (t.dataTypes.unshift(l),
                a(l),
                !1)
            }
            )),
            u
        }
        return a(t.dataTypes[0]) || !i["*"] && a("*")
    }
    function Wt(e, t) {
        var n, r, i = w.ajaxSettings.flatOptions || {};
        for (n in t)
            void 0 !== t[n] && ((i[n] ? e : r || (r = {}))[n] = t[n]);
        return r && w.extend(!0, e, r),
        e
    }
    Mt.href = bt.href,
    w.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: bt.href,
            type: "GET",
            isLocal: /^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),
            global: !0,
            processData: !0,
            async: !0,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": Rt,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: {
                xml: /\bxml\b/,
                html: /\bhtml/,
                json: /\bjson\b/
            },
            responseFields: {
                xml: "responseXML",
                text: "responseText",
                json: "responseJSON"
            },
            converters: {
                "* text": String,
                "text html": !0,
                "text json": JSON.parse,
                "text xml": w.parseXML
            },
            flatOptions: {
                url: !0,
                context: !0
            }
        },
        ajaxSetup: function(e, t) {
            return t ? Wt(Wt(e, w.ajaxSettings), t) : Wt(w.ajaxSettings, e)
        },
        ajaxPrefilter: It(Ot),
        ajaxTransport: It(Pt),
        ajax: function(t, n) {
            "object" == _typeof(t) && (n = t,
            t = void 0);
            var r, i, o, a, s, u, l, c, f, p, d = w.ajaxSetup({}, n = n || {}), h = d.context || d, g = d.context && (h.nodeType || h.jquery) ? w(h) : w.event, y = w.Deferred(), m = w.Callbacks("once memory"), x = d.statusCode || {}, b = {}, T = {}, C = "canceled", E = {
                readyState: 0,
                getResponseHeader: function(e) {
                    var t;
                    if (l) {
                        if (!a)
                            for (a = {}; t = qt.exec(o); )
                                a[t[1].toLowerCase() + " "] = (a[t[1].toLowerCase() + " "] || []).concat(t[2]);
                        t = a[e.toLowerCase() + " "]
                    }
                    return null == t ? null : t.join(", ")
                },
                getAllResponseHeaders: function() {
                    return l ? o : null
                },
                setRequestHeader: function(e, t) {
                    return null == l && (e = T[e.toLowerCase()] = T[e.toLowerCase()] || e,
                    b[e] = t),
                    this
                },
                overrideMimeType: function(e) {
                    return null == l && (d.mimeType = e),
                    this
                },
                statusCode: function(e) {
                    var t;
                    if (e)
                        if (l)
                            E.always(e[E.status]);
                        else
                            for (t in e)
                                x[t] = [x[t], e[t]];
                    return this
                },
                abort: function(e) {
                    var t = e || C;
                    return r && r.abort(t),
                    S(0, t),
                    this
                }
            };
            if (y.promise(E),
            d.url = ((t || d.url || bt.href) + "").replace(Ht, bt.protocol + "//"),
            d.type = n.method || n.type || d.method || d.type,
            d.dataTypes = (d.dataType || "*").toLowerCase().match(P) || [""],
            null == d.crossDomain) {
                u = v.createElement("a");
                try {
                    u.href = d.url,
                    u.href = u.href,
                    d.crossDomain = Mt.protocol + "//" + Mt.host != u.protocol + "//" + u.host
                } catch (t) {
                    d.crossDomain = !0
                }
            }
            if (d.data && d.processData && "string" != typeof d.data && (d.data = w.param(d.data, d.traditional)),
            _t(Ot, d, n, E),
            l)
                return E;
            for (f in (c = w.event && d.global) && 0 == w.active++ && w.event.trigger("ajaxStart"),
            d.type = d.type.toUpperCase(),
            d.hasContent = !Lt.test(d.type),
            i = d.url.replace(jt, ""),
            d.hasContent ? d.data && d.processData && 0 === (d.contentType || "").indexOf("application/x-www-form-urlencoded") && (d.data = d.data.replace(Nt, "+")) : (p = d.url.slice(i.length),
            d.data && (d.processData || "string" == typeof d.data) && (i += (Tt.test(i) ? "&" : "?") + d.data,
            delete d.data),
            !1 === d.cache && (i = i.replace(Dt, "$1"),
            p = (Tt.test(i) ? "&" : "?") + "_=" + wt.guid++ + p),
            d.url = i + p),
            d.ifModified && (w.lastModified[i] && E.setRequestHeader("If-Modified-Since", w.lastModified[i]),
            w.etag[i] && E.setRequestHeader("If-None-Match", w.etag[i])),
            (d.data && d.hasContent && !1 !== d.contentType || n.contentType) && E.setRequestHeader("Content-Type", d.contentType),
            E.setRequestHeader("Accept", d.dataTypes[0] && d.accepts[d.dataTypes[0]] ? d.accepts[d.dataTypes[0]] + ("*" !== d.dataTypes[0] ? ", " + Rt + "; q=0.01" : "") : d.accepts["*"]),
            d.headers)
                E.setRequestHeader(f, d.headers[f]);
            if (d.beforeSend && (!1 === d.beforeSend.call(h, E, d) || l))
                return E.abort();
            if (C = "abort",
            m.add(d.complete),
            E.done(d.success),
            E.fail(d.error),
            r = _t(Pt, d, n, E)) {
                if (E.readyState = 1,
                c && g.trigger("ajaxSend", [E, d]),
                l)
                    return E;
                d.async && 0 < d.timeout && (s = e.setTimeout((function() {
                    E.abort("timeout")
                }
                ), d.timeout));
                try {
                    l = !1,
                    r.send(b, S)
                } catch (t) {
                    if (l)
                        throw t;
                    S(-1, t)
                }
            } else
                S(-1, "No Transport");
            function S(t, n, a, u) {
                var f, p, v, b, T, C = n;
                l || (l = !0,
                s && e.clearTimeout(s),
                r = void 0,
                o = u || "",
                E.readyState = 0 < t ? 4 : 0,
                f = 200 <= t && t < 300 || 304 === t,
                a && (b = function(e, t, n) {
                    for (var r, i, o, a, s = e.contents, u = e.dataTypes; "*" === u[0]; )
                        u.shift(),
                        void 0 === r && (r = e.mimeType || t.getResponseHeader("Content-Type"));
                    if (r)
                        for (i in s)
                            if (s[i] && s[i].test(r)) {
                                u.unshift(i);
                                break
                            }
                    if (u[0]in n)
                        o = u[0];
                    else {
                        for (i in n) {
                            if (!u[0] || e.converters[i + " " + u[0]]) {
                                o = i;
                                break
                            }
                            a || (a = i)
                        }
                        o = o || a
                    }
                    if (o)
                        return o !== u[0] && u.unshift(o),
                        n[o]
                }(d, E, a)),
                !f && -1 < w.inArray("script", d.dataTypes) && w.inArray("json", d.dataTypes) < 0 && (d.converters["text script"] = function() {}
                ),
                b = function(e, t, n, r) {
                    var i, o, a, s, u, l = {}, c = e.dataTypes.slice();
                    if (c[1])
                        for (a in e.converters)
                            l[a.toLowerCase()] = e.converters[a];
                    for (o = c.shift(); o; )
                        if (e.responseFields[o] && (n[e.responseFields[o]] = t),
                        !u && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)),
                        u = o,
                        o = c.shift())
                            if ("*" === o)
                                o = u;
                            else if ("*" !== u && u !== o) {
                                if (!(a = l[u + " " + o] || l["* " + o]))
                                    for (i in l)
                                        if ((s = i.split(" "))[1] === o && (a = l[u + " " + s[0]] || l["* " + s[0]])) {
                                            !0 === a ? a = l[i] : !0 !== l[i] && (o = s[0],
                                            c.unshift(s[1]));
                                            break
                                        }
                                if (!0 !== a)
                                    if (a && e.throws)
                                        t = a(t);
                                    else
                                        try {
                                            t = a(t)
                                        } catch (e) {
                                            return {
                                                state: "parsererror",
                                                error: a ? e : "No conversion from " + u + " to " + o
                                            }
                                        }
                            }
                    return {
                        state: "success",
                        data: t
                    }
                }(d, b, E, f),
                f ? (d.ifModified && ((T = E.getResponseHeader("Last-Modified")) && (w.lastModified[i] = T),
                (T = E.getResponseHeader("etag")) && (w.etag[i] = T)),
                204 === t || "HEAD" === d.type ? C = "nocontent" : 304 === t ? C = "notmodified" : (C = b.state,
                p = b.data,
                f = !(v = b.error))) : (v = C,
                !t && C || (C = "error",
                t < 0 && (t = 0))),
                E.status = t,
                E.statusText = (n || C) + "",
                f ? y.resolveWith(h, [p, C, E]) : y.rejectWith(h, [E, C, v]),
                E.statusCode(x),
                x = void 0,
                c && g.trigger(f ? "ajaxSuccess" : "ajaxError", [E, d, f ? p : v]),
                m.fireWith(h, [E, C]),
                c && (g.trigger("ajaxComplete", [E, d]),
                --w.active || w.event.trigger("ajaxStop")))
            }
            return E
        },
        getJSON: function(e, t, n) {
            return w.get(e, t, n, "json")
        },
        getScript: function(e, t) {
            return w.get(e, void 0, t, "script")
        }
    }),
    w.each(["get", "post"], (function(e, t) {
        w[t] = function(e, n, r, i) {
            return h(n) && (i = i || r,
            r = n,
            n = void 0),
            w.ajax(w.extend({
                url: e,
                type: t,
                dataType: i,
                data: n,
                success: r
            }, w.isPlainObject(e) && e))
        }
    }
    )),
    w.ajaxPrefilter((function(e) {
        var t;
        for (t in e.headers)
            "content-type" === t.toLowerCase() && (e.contentType = e.headers[t] || "")
    }
    )),
    w._evalUrl = function(e, t, n) {
        return w.ajax({
            url: e,
            type: "GET",
            dataType: "script",
            cache: !0,
            async: !1,
            global: !1,
            converters: {
                "text script": function() {}
            },
            dataFilter: function(e) {
                w.globalEval(e, t, n)
            }
        })
    }
    ,
    w.fn.extend({
        wrapAll: function(e) {
            var t;
            return this[0] && (h(e) && (e = e.call(this[0])),
            t = w(e, this[0].ownerDocument).eq(0).clone(!0),
            this[0].parentNode && t.insertBefore(this[0]),
            t.map((function() {
                for (var e = this; e.firstElementChild; )
                    e = e.firstElementChild;
                return e
            }
            )).append(this)),
            this
        },
        wrapInner: function(e) {
            return h(e) ? this.each((function(t) {
                w(this).wrapInner(e.call(this, t))
            }
            )) : this.each((function() {
                var t = w(this)
                  , n = t.contents();
                n.length ? n.wrapAll(e) : t.append(e)
            }
            ))
        },
        wrap: function(e) {
            var t = h(e);
            return this.each((function(n) {
                w(this).wrapAll(t ? e.call(this, n) : e)
            }
            ))
        },
        unwrap: function(e) {
            return this.parent(e).not("body").each((function() {
                w(this).replaceWith(this.childNodes)
            }
            )),
            this
        }
    }),
    w.expr.pseudos.hidden = function(e) {
        return !w.expr.pseudos.visible(e)
    }
    ,
    w.expr.pseudos.visible = function(e) {
        return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length)
    }
    ,
    w.ajaxSettings.xhr = function() {
        try {
            return new e.XMLHttpRequest
        } catch (e) {}
    }
    ;
    var Ft = {
        0: 200,
        1223: 204
    }
      , Bt = w.ajaxSettings.xhr();
    d.cors = !!Bt && "withCredentials"in Bt,
    d.ajax = Bt = !!Bt,
    w.ajaxTransport((function(t) {
        var n, r;
        if (d.cors || Bt && !t.crossDomain)
            return {
                send: function(i, o) {
                    var a, s = t.xhr();
                    if (s.open(t.type, t.url, t.async, t.username, t.password),
                    t.xhrFields)
                        for (a in t.xhrFields)
                            s[a] = t.xhrFields[a];
                    for (a in t.mimeType && s.overrideMimeType && s.overrideMimeType(t.mimeType),
                    t.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest"),
                    i)
                        s.setRequestHeader(a, i[a]);
                    n = function(e) {
                        return function() {
                            n && (n = r = s.onload = s.onerror = s.onabort = s.ontimeout = s.onreadystatechange = null,
                            "abort" === e ? s.abort() : "error" === e ? "number" != typeof s.status ? o(0, "error") : o(s.status, s.statusText) : o(Ft[s.status] || s.status, s.statusText, "text" !== (s.responseType || "text") || "string" != typeof s.responseText ? {
                                binary: s.response
                            } : {
                                text: s.responseText
                            }, s.getAllResponseHeaders()))
                        }
                    }
                    ,
                    s.onload = n(),
                    r = s.onerror = s.ontimeout = n("error"),
                    void 0 !== s.onabort ? s.onabort = r : s.onreadystatechange = function() {
                        4 === s.readyState && e.setTimeout((function() {
                            n && r()
                        }
                        ))
                    }
                    ,
                    n = n("abort");
                    try {
                        s.send(t.hasContent && t.data || null)
                    } catch (i) {
                        if (n)
                            throw i
                    }
                },
                abort: function() {
                    n && n()
                }
            }
    }
    )),
    w.ajaxPrefilter((function(e) {
        e.crossDomain && (e.contents.script = !1)
    }
    )),
    w.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /\b(?:java|ecma)script\b/
        },
        converters: {
            "text script": function(e) {
                return w.globalEval(e),
                e
            }
        }
    }),
    w.ajaxPrefilter("script", (function(e) {
        void 0 === e.cache && (e.cache = !1),
        e.crossDomain && (e.type = "GET")
    }
    )),
    w.ajaxTransport("script", (function(e) {
        var t, n;
        if (e.crossDomain || e.scriptAttrs)
            return {
                send: function(r, i) {
                    t = w("<script>").attr(e.scriptAttrs || {}).prop({
                        charset: e.scriptCharset,
                        src: e.url
                    }).on("load error", n = function(e) {
                        t.remove(),
                        n = null,
                        e && i("error" === e.type ? 404 : 200, e.type)
                    }
                    ),
                    v.head.appendChild(t[0])
                },
                abort: function() {
                    n && n()
                }
            }
    }
    ));
    var $t, zt = [], Ut = /(=)\?(?=&|$)|\?\?/;
    w.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            var e = zt.pop() || w.expando + "_" + wt.guid++;
            return this[e] = !0,
            e
        }
    }),
    w.ajaxPrefilter("json jsonp", (function(t, n, r) {
        var i, o, a, s = !1 !== t.jsonp && (Ut.test(t.url) ? "url" : "string" == typeof t.data && 0 === (t.contentType || "").indexOf("application/x-www-form-urlencoded") && Ut.test(t.data) && "data");
        if (s || "jsonp" === t.dataTypes[0])
            return i = t.jsonpCallback = h(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback,
            s ? t[s] = t[s].replace(Ut, "$1" + i) : !1 !== t.jsonp && (t.url += (Tt.test(t.url) ? "&" : "?") + t.jsonp + "=" + i),
            t.converters["script json"] = function() {
                return a || w.error(i + " was not called"),
                a[0]
            }
            ,
            t.dataTypes[0] = "json",
            o = e[i],
            e[i] = function() {
                a = arguments
            }
            ,
            r.always((function() {
                void 0 === o ? w(e).removeProp(i) : e[i] = o,
                t[i] && (t.jsonpCallback = n.jsonpCallback,
                zt.push(i)),
                a && h(o) && o(a[0]),
                a = o = void 0
            }
            )),
            "script"
    }
    )),
    d.createHTMLDocument = (($t = v.implementation.createHTMLDocument("").body).innerHTML = "<form></form><form></form>",
    2 === $t.childNodes.length),
    w.parseHTML = function(e, t, n) {
        return "string" != typeof e ? [] : ("boolean" == typeof t && (n = t,
        t = !1),
        t || (d.createHTMLDocument ? ((r = (t = v.implementation.createHTMLDocument("")).createElement("base")).href = v.location.href,
        t.head.appendChild(r)) : t = v),
        o = !n && [],
        (i = N.exec(e)) ? [t.createElement(i[1])] : (i = xe([e], t, o),
        o && o.length && w(o).remove(),
        w.merge([], i.childNodes)));
        var r, i, o
    }
    ,
    w.fn.load = function(e, t, n) {
        var r, i, o, a = this, s = e.indexOf(" ");
        return -1 < s && (r = ht(e.slice(s)),
        e = e.slice(0, s)),
        h(t) ? (n = t,
        t = void 0) : t && "object" == _typeof(t) && (i = "POST"),
        0 < a.length && w.ajax({
            url: e,
            type: i || "GET",
            dataType: "html",
            data: t
        }).done((function(e) {
            o = arguments,
            a.html(r ? w("<div>").append(w.parseHTML(e)).find(r) : e)
        }
        )).always(n && function(e, t) {
            a.each((function() {
                n.apply(this, o || [e.responseText, t, e])
            }
            ))
        }
        ),
        this
    }
    ,
    w.expr.pseudos.animated = function(e) {
        return w.grep(w.timers, (function(t) {
            return e === t.elem
        }
        )).length
    }
    ,
    w.offset = {
        setOffset: function(e, t, n) {
            var r, i, o, a, s, u, l = w.css(e, "position"), c = w(e), f = {};
            "static" === l && (e.style.position = "relative"),
            s = c.offset(),
            o = w.css(e, "top"),
            u = w.css(e, "left"),
            ("absolute" === l || "fixed" === l) && -1 < (o + u).indexOf("auto") ? (a = (r = c.position()).top,
            i = r.left) : (a = parseFloat(o) || 0,
            i = parseFloat(u) || 0),
            h(t) && (t = t.call(e, n, w.extend({}, s))),
            null != t.top && (f.top = t.top - s.top + a),
            null != t.left && (f.left = t.left - s.left + i),
            "using"in t ? t.using.call(e, f) : c.css(f)
        }
    },
    w.fn.extend({
        offset: function(e) {
            if (arguments.length)
                return void 0 === e ? this : this.each((function(t) {
                    w.offset.setOffset(this, e, t)
                }
                ));
            var t, n, r = this[0];
            return r ? r.getClientRects().length ? (t = r.getBoundingClientRect(),
            n = r.ownerDocument.defaultView,
            {
                top: t.top + n.pageYOffset,
                left: t.left + n.pageXOffset
            }) : {
                top: 0,
                left: 0
            } : void 0
        },
        position: function() {
            if (this[0]) {
                var e, t, n, r = this[0], i = {
                    top: 0,
                    left: 0
                };
                if ("fixed" === w.css(r, "position"))
                    t = r.getBoundingClientRect();
                else {
                    for (t = this.offset(),
                    n = r.ownerDocument,
                    e = r.offsetParent || n.documentElement; e && (e === n.body || e === n.documentElement) && "static" === w.css(e, "position"); )
                        e = e.parentNode;
                    e && e !== r && 1 === e.nodeType && ((i = w(e).offset()).top += w.css(e, "borderTopWidth", !0),
                    i.left += w.css(e, "borderLeftWidth", !0))
                }
                return {
                    top: t.top - i.top - w.css(r, "marginTop", !0),
                    left: t.left - i.left - w.css(r, "marginLeft", !0)
                }
            }
        },
        offsetParent: function() {
            return this.map((function() {
                for (var e = this.offsetParent; e && "static" === w.css(e, "position"); )
                    e = e.offsetParent;
                return e || re
            }
            ))
        }
    }),
    w.each({
        scrollLeft: "pageXOffset",
        scrollTop: "pageYOffset"
    }, (function(e, t) {
        var n = "pageYOffset" === t;
        w.fn[e] = function(r) {
            return B(this, (function(e, r, i) {
                var o;
                if (g(e) ? o = e : 9 === e.nodeType && (o = e.defaultView),
                void 0 === i)
                    return o ? o[t] : e[r];
                o ? o.scrollTo(n ? o.pageXOffset : i, n ? i : o.pageYOffset) : e[r] = i
            }
            ), e, r, arguments.length)
        }
    }
    )),
    w.each(["top", "left"], (function(e, t) {
        w.cssHooks[t] = We(d.pixelPosition, (function(e, n) {
            if (n)
                return n = _e(e, t),
                Pe.test(n) ? w(e).position()[t] + "px" : n
        }
        ))
    }
    )),
    w.each({
        Height: "height",
        Width: "width"
    }, (function(e, t) {
        w.each({
            padding: "inner" + e,
            content: t,
            "": "outer" + e
        }, (function(n, r) {
            w.fn[r] = function(i, o) {
                var a = arguments.length && (n || "boolean" != typeof i)
                  , s = n || (!0 === i || !0 === o ? "margin" : "border");
                return B(this, (function(t, n, i) {
                    var o;
                    return g(t) ? 0 === r.indexOf("outer") ? t["inner" + e] : t.document.documentElement["client" + e] : 9 === t.nodeType ? (o = t.documentElement,
                    Math.max(t.body["scroll" + e], o["scroll" + e], t.body["offset" + e], o["offset" + e], o["client" + e])) : void 0 === i ? w.css(t, n, s) : w.style(t, n, i, s)
                }
                ), t, a ? i : void 0, a)
            }
        }
        ))
    }
    )),
    w.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], (function(e, t) {
        w.fn[t] = function(e) {
            return this.on(t, e)
        }
    }
    )),
    w.fn.extend({
        bind: function(e, t, n) {
            return this.on(e, null, t, n)
        },
        unbind: function(e, t) {
            return this.off(e, null, t)
        },
        delegate: function(e, t, n, r) {
            return this.on(t, e, n, r)
        },
        undelegate: function(e, t, n) {
            return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
        },
        hover: function(e, t) {
            return this.mouseenter(e).mouseleave(t || e)
        }
    }),
    w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "), (function(e, t) {
        w.fn[t] = function(e, n) {
            return 0 < arguments.length ? this.on(t, null, e, n) : this.trigger(t)
        }
    }
    ));
    var Xt = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
    w.proxy = function(e, t) {
        var n, r, o;
        if ("string" == typeof t && (n = e[t],
        t = e,
        e = n),
        h(e))
            return r = i.call(arguments, 2),
            (o = function() {
                return e.apply(t || this, r.concat(i.call(arguments)))
            }
            ).guid = e.guid = e.guid || w.guid++,
            o
    }
    ,
    w.holdReady = function(e) {
        e ? w.readyWait++ : w.ready(!0)
    }
    ,
    w.isArray = Array.isArray,
    w.parseJSON = JSON.parse,
    w.nodeName = A,
    w.isFunction = h,
    w.isWindow = g,
    w.camelCase = X,
    w.type = x,
    w.now = Date.now,
    w.isNumeric = function(e) {
        var t = w.type(e);
        return ("number" === t || "string" === t) && !isNaN(e - parseFloat(e))
    }
    ,
    w.trim = function(e) {
        return null == e ? "" : (e + "").replace(Xt, "")
    }
    ,
    "function" == typeof define && define.amd && define("jquery", [], (function() {
        return w
    }
    ));
    var Vt = e.jQuery
      , Gt = e.$;
    return w.noConflict = function(t) {
        return e.$ === w && (e.$ = Gt),
        t && e.jQuery === w && (e.jQuery = Vt),
        w
    }
    ,
    void 0 === t && (e.jQuery = e.$ = w),
    w
}
));
!function(t) {
    "function" == typeof define && define.amd ? define(["jquery"], t) : t(jQuery)
}((function(t) {
    t.ui = t.ui || {},
    t.ui.version = "1.12.1";
    var e, i = 0, s = Array.prototype.slice;
    t.cleanData = (e = t.cleanData,
    function(i) {
        for (var s, o, n = 0; null != (o = i[n]); n++)
            try {
                (s = t._data(o, "events")) && s.remove && t(o).triggerHandler("remove")
            } catch (i) {}
        e(i)
    }
    ),
    t.widget = function(e, i, s) {
        var o, n, r, h = {}, a = e.split(".")[0], l = a + "-" + (e = e.split(".")[1]);
        return s || (s = i,
        i = t.Widget),
        t.isArray(s) && (s = t.extend.apply(null, [{}].concat(s))),
        t.expr[":"][l.toLowerCase()] = function(e) {
            return !!t.data(e, l)
        }
        ,
        t[a] = t[a] || {},
        o = t[a][e],
        n = t[a][e] = function(t, e) {
            if (!this._createWidget)
                return new n(t,e);
            arguments.length && this._createWidget(t, e)
        }
        ,
        t.extend(n, o, {
            version: s.version,
            _proto: t.extend({}, s),
            _childConstructors: []
        }),
        (r = new i).options = t.widget.extend({}, r.options),
        t.each(s, (function(e, s) {
            function o() {
                return i.prototype[e].apply(this, arguments)
            }
            function n(t) {
                return i.prototype[e].apply(this, t)
            }
            t.isFunction(s) ? h[e] = function() {
                var t, e = this._super, i = this._superApply;
                return this._super = o,
                this._superApply = n,
                t = s.apply(this, arguments),
                this._super = e,
                this._superApply = i,
                t
            }
            : h[e] = s
        }
        )),
        n.prototype = t.widget.extend(r, {
            widgetEventPrefix: o && r.widgetEventPrefix || e
        }, h, {
            constructor: n,
            namespace: a,
            widgetName: e,
            widgetFullName: l
        }),
        o ? (t.each(o._childConstructors, (function(e, i) {
            var s = i.prototype;
            t.widget(s.namespace + "." + s.widgetName, n, i._proto)
        }
        )),
        delete o._childConstructors) : i._childConstructors.push(n),
        t.widget.bridge(e, n),
        n
    }
    ,
    t.widget.extend = function(e) {
        for (var i, o, n = s.call(arguments, 1), r = 0, h = n.length; r < h; r++)
            for (i in n[r])
                o = n[r][i],
                n[r].hasOwnProperty(i) && void 0 !== o && (t.isPlainObject(o) ? e[i] = t.isPlainObject(e[i]) ? t.widget.extend({}, e[i], o) : t.widget.extend({}, o) : e[i] = o);
        return e
    }
    ,
    t.widget.bridge = function(e, i) {
        var o = i.prototype.widgetFullName || e;
        t.fn[e] = function(n) {
            var r = "string" == typeof n
              , h = s.call(arguments, 1)
              , a = this;
            return r ? this.length || "instance" !== n ? this.each((function() {
                var i, s = t.data(this, o);
                return "instance" === n ? (a = s,
                !1) : s ? t.isFunction(s[n]) && "_" !== n.charAt(0) ? (i = s[n].apply(s, h)) !== s && void 0 !== i ? (a = i && i.jquery ? a.pushStack(i.get()) : i,
                !1) : void 0 : t.error("no such method '" + n + "' for " + e + " widget instance") : t.error("cannot call methods on " + e + " prior to initialization; attempted to call method '" + n + "'")
            }
            )) : a = void 0 : (h.length && (n = t.widget.extend.apply(null, [n].concat(h))),
            this.each((function() {
                var e = t.data(this, o);
                e ? (e.option(n || {}),
                e._init && e._init()) : t.data(this, o, new i(n,this))
            }
            ))),
            a
        }
    }
    ,
    t.Widget = function() {}
    ,
    t.Widget._childConstructors = [],
    t.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {
            classes: {},
            disabled: !1,
            create: null
        },
        _createWidget: function(e, s) {
            s = t(s || this.defaultElement || this)[0],
            this.element = t(s),
            this.uuid = i++,
            this.eventNamespace = "." + this.widgetName + this.uuid,
            this.bindings = t(),
            this.hoverable = t(),
            this.focusable = t(),
            this.classesElementLookup = {},
            s !== this && (t.data(s, this.widgetFullName, this),
            this._on(!0, this.element, {
                remove: function(t) {
                    t.target === s && this.destroy()
                }
            }),
            this.document = t(s.style ? s.ownerDocument : s.document || s),
            this.window = t(this.document[0].defaultView || this.document[0].parentWindow)),
            this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e),
            this._create(),
            this.options.disabled && this._setOptionDisabled(this.options.disabled),
            this._trigger("create", null, this._getCreateEventData()),
            this._init()
        },
        _getCreateOptions: function() {
            return {}
        },
        _getCreateEventData: t.noop,
        _create: t.noop,
        _init: t.noop,
        destroy: function() {
            var e = this;
            this._destroy(),
            t.each(this.classesElementLookup, (function(t, i) {
                e._removeClass(i, t)
            }
            )),
            this.element.off(this.eventNamespace).removeData(this.widgetFullName),
            this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),
            this.bindings.off(this.eventNamespace)
        },
        _destroy: t.noop,
        widget: function() {
            return this.element
        },
        option: function(e, i) {
            var s, o, n, r = e;
            if (0 === arguments.length)
                return t.widget.extend({}, this.options);
            if ("string" == typeof e)
                if (r = {},
                e = (s = e.split(".")).shift(),
                s.length) {
                    for (o = r[e] = t.widget.extend({}, this.options[e]),
                    n = 0; n < s.length - 1; n++)
                        o[s[n]] = o[s[n]] || {},
                        o = o[s[n]];
                    if (e = s.pop(),
                    1 === arguments.length)
                        return void 0 === o[e] ? null : o[e];
                    o[e] = i
                } else {
                    if (1 === arguments.length)
                        return void 0 === this.options[e] ? null : this.options[e];
                    r[e] = i
                }
            return this._setOptions(r),
            this
        },
        _setOptions: function(t) {
            for (var e in t)
                this._setOption(e, t[e]);
            return this
        },
        _setOption: function(t, e) {
            return "classes" === t && this._setOptionClasses(e),
            this.options[t] = e,
            "disabled" === t && this._setOptionDisabled(e),
            this
        },
        _setOptionClasses: function(e) {
            var i, s, o;
            for (i in e)
                o = this.classesElementLookup[i],
                e[i] !== this.options.classes[i] && o && o.length && (s = t(o.get()),
                this._removeClass(o, i),
                s.addClass(this._classes({
                    element: s,
                    keys: i,
                    classes: e,
                    add: !0
                })))
        },
        _setOptionDisabled: function(t) {
            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!t),
            t && (this._removeClass(this.hoverable, null, "ui-state-hover"),
            this._removeClass(this.focusable, null, "ui-state-focus"))
        },
        enable: function() {
            return this._setOptions({
                disabled: !1
            })
        },
        disable: function() {
            return this._setOptions({
                disabled: !0
            })
        },
        _classes: function(e) {
            var i = []
              , s = this;
            function o(o, n) {
                for (var r, h = 0; h < o.length; h++)
                    r = s.classesElementLookup[o[h]] || t(),
                    r = e.add ? t(t.unique(r.get().concat(e.element.get()))) : t(r.not(e.element).get()),
                    s.classesElementLookup[o[h]] = r,
                    i.push(o[h]),
                    n && e.classes[o[h]] && i.push(e.classes[o[h]])
            }
            return e = t.extend({
                element: this.element,
                classes: this.options.classes || {}
            }, e),
            this._on(e.element, {
                remove: "_untrackClassesElement"
            }),
            e.keys && o(e.keys.match(/\S+/g) || [], !0),
            e.extra && o(e.extra.match(/\S+/g) || []),
            i.join(" ")
        },
        _untrackClassesElement: function(e) {
            var i = this;
            t.each(i.classesElementLookup, (function(s, o) {
                -1 !== t.inArray(e.target, o) && (i.classesElementLookup[s] = t(o.not(e.target).get()))
            }
            ))
        },
        _removeClass: function(t, e, i) {
            return this._toggleClass(t, e, i, !1)
        },
        _addClass: function(t, e, i) {
            return this._toggleClass(t, e, i, !0)
        },
        _toggleClass: function(t, e, i, s) {
            s = "boolean" == typeof s ? s : i;
            var o = "string" == typeof t || null === t;
            return (t = {
                extra: o ? e : i,
                keys: o ? t : e,
                element: o ? this.element : t,
                add: s
            }).element.toggleClass(this._classes(t), s),
            this
        },
        _on: function(e, i, s) {
            var o, n = this;
            "boolean" != typeof e && (s = i,
            i = e,
            e = !1),
            s ? (i = o = t(i),
            this.bindings = this.bindings.add(i)) : (s = i,
            i = this.element,
            o = this.widget()),
            t.each(s, (function(s, r) {
                function h() {
                    if (e || !0 !== n.options.disabled && !t(this).hasClass("ui-state-disabled"))
                        return ("string" == typeof r ? n[r] : r).apply(n, arguments)
                }
                "string" != typeof r && (h.guid = r.guid = r.guid || h.guid || t.guid++);
                var a;
                s = (a = s.match(/^([\w:-]*)\s*(.*)$/))[1] + n.eventNamespace;
                (a = a[2]) ? o.on(s, a, h) : i.on(s, h)
            }
            ))
        },
        _off: function(e, i) {
            i = (i || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace,
            e.off(i).off(i),
            this.bindings = t(this.bindings.not(e).get()),
            this.focusable = t(this.focusable.not(e).get()),
            this.hoverable = t(this.hoverable.not(e).get())
        },
        _delay: function(t, e) {
            var i = this;
            return setTimeout((function() {
                return ("string" == typeof t ? i[t] : t).apply(i, arguments)
            }
            ), e || 0)
        },
        _hoverable: function(e) {
            this.hoverable = this.hoverable.add(e),
            this._on(e, {
                mouseenter: function(e) {
                    this._addClass(t(e.currentTarget), null, "ui-state-hover")
                },
                mouseleave: function(e) {
                    this._removeClass(t(e.currentTarget), null, "ui-state-hover")
                }
            })
        },
        _focusable: function(e) {
            this.focusable = this.focusable.add(e),
            this._on(e, {
                focusin: function(e) {
                    this._addClass(t(e.currentTarget), null, "ui-state-focus")
                },
                focusout: function(e) {
                    this._removeClass(t(e.currentTarget), null, "ui-state-focus")
                }
            })
        },
        _trigger: function(e, i, s) {
            var o, n, r = this.options[e];
            if (s = s || {},
            (i = t.Event(i)).type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(),
            i.target = this.element[0],
            n = i.originalEvent)
                for (o in n)
                    o in i || (i[o] = n[o]);
            return this.element.trigger(i, s),
            !(t.isFunction(r) && !1 === r.apply(this.element[0], [i].concat(s)) || i.isDefaultPrevented())
        }
    },
    t.each({
        show: "fadeIn",
        hide: "fadeOut"
    }, (function(e, i) {
        t.Widget.prototype["_" + e] = function(s, o, n) {
            var r;
            "string" == typeof o && (o = {
                effect: o
            });
            var h = o ? !0 !== o && "number" != typeof o && o.effect || i : e;
            "number" == typeof (o = o || {}) && (o = {
                duration: o
            }),
            r = !t.isEmptyObject(o),
            o.complete = n,
            o.delay && s.delay(o.delay),
            r && t.effects && t.effects.effect[h] ? s[e](o) : h !== e && s[h] ? s[h](o.duration, o.easing, n) : s.queue((function(i) {
                t(this)[e](),
                n && n.call(s[0]),
                i()
            }
            ))
        }
    }
    )),
    t.widget,
    t.extend(t.expr[":"], {
        data: t.expr.createPseudo ? t.expr.createPseudo((function(e) {
            return function(i) {
                return !!t.data(i, e)
            }
        }
        )) : function(e, i, s) {
            return !!t.data(e, s[3])
        }
    }),
    t.fn.extend({
        disableSelection: (o = "onselectstart"in document.createElement("div") ? "selectstart" : "mousedown",
        function() {
            return this.on(o + ".ui-disableSelection", (function(t) {
                t.preventDefault()
            }
            ))
        }
        ),
        enableSelection: function() {
            return this.off(".ui-disableSelection")
        }
    }),
    t.fn.scrollParent = function(e) {
        var i = this.css("position")
          , s = "absolute" === i
          , o = e ? /(auto|scroll|hidden)/ : /(auto|scroll)/;
        e = this.parents().filter((function() {
            var e = t(this);
            return (!s || "static" !== e.css("position")) && o.test(e.css("overflow") + e.css("overflow-y") + e.css("overflow-x"))
        }
        )).eq(0);
        return "fixed" !== i && e.length ? e : t(this[0].ownerDocument || document)
    }
    ,
    t.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
    var o, n = !1;
    t(document).on("mouseup", (function() {
        n = !1
    }
    )),
    t.widget("ui.mouse", {
        version: "1.12.1",
        options: {
            cancel: "input, textarea, button, select, option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function() {
            var e = this;
            this.element.on("mousedown." + this.widgetName, (function(t) {
                return e._mouseDown(t)
            }
            )).on("click." + this.widgetName, (function(i) {
                if (!0 === t.data(i.target, e.widgetName + ".preventClickEvent"))
                    return t.removeData(i.target, e.widgetName + ".preventClickEvent"),
                    i.stopImmediatePropagation(),
                    !1
            }
            )),
            this.started = !1
        },
        _mouseDestroy: function() {
            this.element.off("." + this.widgetName),
            this._mouseMoveDelegate && this.document.off("mousemove." + this.widgetName, this._mouseMoveDelegate).off("mouseup." + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function(e) {
            if (!n) {
                this._mouseMoved = !1,
                this._mouseStarted && this._mouseUp(e),
                this._mouseDownEvent = e;
                var i = this
                  , s = 1 === e.which
                  , o = !("string" != typeof this.options.cancel || !e.target.nodeName) && t(e.target).closest(this.options.cancel).length;
                return !(s && !o && this._mouseCapture(e)) || (this.mouseDelayMet = !this.options.delay,
                this.mouseDelayMet || (this._mouseDelayTimer = setTimeout((function() {
                    i.mouseDelayMet = !0
                }
                ), this.options.delay)),
                this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(e),
                !this._mouseStarted) ? (e.preventDefault(),
                !0) : (!0 === t.data(e.target, this.widgetName + ".preventClickEvent") && t.removeData(e.target, this.widgetName + ".preventClickEvent"),
                this._mouseMoveDelegate = function(t) {
                    return i._mouseMove(t)
                }
                ,
                this._mouseUpDelegate = function(t) {
                    return i._mouseUp(t)
                }
                ,
                this.document.on("mousemove." + this.widgetName, this._mouseMoveDelegate).on("mouseup." + this.widgetName, this._mouseUpDelegate),
                e.preventDefault(),
                n = !0))
            }
        },
        _mouseMove: function(e) {
            if (this._mouseMoved) {
                if (t.ui.ie && (!document.documentMode || document.documentMode < 9) && !e.button)
                    return this._mouseUp(e);
                if (!e.which)
                    if (e.originalEvent.altKey || e.originalEvent.ctrlKey || e.originalEvent.metaKey || e.originalEvent.shiftKey)
                        this.ignoreMissingWhich = !0;
                    else if (!this.ignoreMissingWhich)
                        return this._mouseUp(e)
            }
            return (e.which || e.button) && (this._mouseMoved = !0),
            this._mouseStarted ? (this._mouseDrag(e),
            e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(this._mouseDownEvent, e),
            this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)),
            !this._mouseStarted)
        },
        _mouseUp: function(e) {
            this.document.off("mousemove." + this.widgetName, this._mouseMoveDelegate).off("mouseup." + this.widgetName, this._mouseUpDelegate),
            this._mouseStarted && (this._mouseStarted = !1,
            e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0),
            this._mouseStop(e)),
            this._mouseDelayTimer && (clearTimeout(this._mouseDelayTimer),
            delete this._mouseDelayTimer),
            this.ignoreMissingWhich = !1,
            n = !1,
            e.preventDefault()
        },
        _mouseDistanceMet: function(t) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function() {
            return this.mouseDelayMet
        },
        _mouseStart: function() {},
        _mouseDrag: function() {},
        _mouseStop: function() {},
        _mouseCapture: function() {
            return !0
        }
    }),
    t.ui.plugin = {
        add: function(e, i, s) {
            var o, n = t.ui[e].prototype;
            for (o in s)
                n.plugins[o] = n.plugins[o] || [],
                n.plugins[o].push([i, s[o]])
        },
        call: function(t, e, i, s) {
            var o, n = t.plugins[e];
            if (n && (s || t.element[0].parentNode && 11 !== t.element[0].parentNode.nodeType))
                for (o = 0; o < n.length; o++)
                    t.options[n[o][0]] && n[o][1].apply(t.element, i)
        }
    },
    t.ui.safeActiveElement = function(t) {
        var e;
        try {
            e = t.activeElement
        } catch (i) {
            e = t.body
        }
        return (e = e || t.body).nodeName || (e = t.body),
        e
    }
    ,
    t.ui.safeBlur = function(e) {
        e && "body" !== e.nodeName.toLowerCase() && t(e).trigger("blur")
    }
    ,
    t.widget("ui.draggable", t.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "drag",
        options: {
            addClasses: !0,
            appendTo: "parent",
            axis: !1,
            connectToSortable: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            iframeFix: !1,
            opacity: !1,
            refreshPositions: !1,
            revert: !1,
            revertDuration: 500,
            scope: "default",
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: !1,
            snapMode: "both",
            snapTolerance: 20,
            stack: !1,
            zIndex: !1,
            drag: null,
            start: null,
            stop: null
        },
        _create: function() {
            "original" === this.options.helper && this._setPositionRelative(),
            this.options.addClasses && this._addClass("ui-draggable"),
            this._setHandleClassName(),
            this._mouseInit()
        },
        _setOption: function(t, e) {
            this._super(t, e),
            "handle" === t && (this._removeHandleClassName(),
            this._setHandleClassName())
        },
        _destroy: function() {
            (this.helper || this.element).is(".ui-draggable-dragging") ? this.destroyOnClear = !0 : (this._removeHandleClassName(),
            this._mouseDestroy())
        },
        _mouseCapture: function(e) {
            var i = this.options;
            return !(this.helper || i.disabled || 0 < t(e.target).closest(".ui-resizable-handle").length || (this.handle = this._getHandle(e),
            !this.handle || (this._blurActiveElement(e),
            this._blockFrames(!0 === i.iframeFix ? "iframe" : i.iframeFix),
            0)))
        },
        _blockFrames: function(e) {
            this.iframeBlocks = this.document.find(e).map((function() {
                var e = t(this);
                return t("<div>").css("position", "absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]
            }
            ))
        },
        _unblockFrames: function() {
            this.iframeBlocks && (this.iframeBlocks.remove(),
            delete this.iframeBlocks)
        },
        _blurActiveElement: function(e) {
            var i = t.ui.safeActiveElement(this.document[0]);
            t(e.target).closest(i).length || t.ui.safeBlur(i)
        },
        _mouseStart: function(e) {
            var i = this.options;
            return this.helper = this._createHelper(e),
            this._addClass(this.helper, "ui-draggable-dragging"),
            this._cacheHelperProportions(),
            t.ui.ddmanager && (t.ui.ddmanager.current = this),
            this._cacheMargins(),
            this.cssPosition = this.helper.css("position"),
            this.scrollParent = this.helper.scrollParent(!0),
            this.offsetParent = this.helper.offsetParent(),
            this.hasFixedAncestor = 0 < this.helper.parents().filter((function() {
                return "fixed" === t(this).css("position")
            }
            )).length,
            this.positionAbs = this.element.offset(),
            this._refreshOffsets(e),
            this.originalPosition = this.position = this._generatePosition(e, !1),
            this.originalPageX = e.pageX,
            this.originalPageY = e.pageY,
            i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
            this._setContainment(),
            !1 === this._trigger("start", e) ? (this._clear(),
            !1) : (this._cacheHelperProportions(),
            t.ui.ddmanager && !i.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
            this._mouseDrag(e, !0),
            t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e),
            !0)
        },
        _refreshOffsets: function(t) {
            this.offset = {
                top: this.positionAbs.top - this.margins.top,
                left: this.positionAbs.left - this.margins.left,
                scroll: !1,
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            },
            this.offset.click = {
                left: t.pageX - this.offset.left,
                top: t.pageY - this.offset.top
            }
        },
        _mouseDrag: function(e, i) {
            if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()),
            this.position = this._generatePosition(e, !0),
            this.positionAbs = this._convertPositionTo("absolute"),
            !i) {
                if (i = this._uiHash(),
                !1 === this._trigger("drag", e, i))
                    return this._mouseUp(new t.Event("mouseup",e)),
                    !1;
                this.position = i.position
            }
            return this.helper[0].style.left = this.position.left + "px",
            this.helper[0].style.top = this.position.top + "px",
            t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
            !1
        },
        _mouseStop: function(e) {
            var i = this
              , s = !1;
            return t.ui.ddmanager && !this.options.dropBehaviour && (s = t.ui.ddmanager.drop(this, e)),
            this.dropped && (s = this.dropped,
            this.dropped = !1),
            "invalid" === this.options.revert && !s || "valid" === this.options.revert && s || !0 === this.options.revert || t.isFunction(this.options.revert) && this.options.revert.call(this.element, s) ? t(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), (function() {
                !1 !== i._trigger("stop", e) && i._clear()
            }
            )) : !1 !== this._trigger("stop", e) && this._clear(),
            !1
        },
        _mouseUp: function(e) {
            return this._unblockFrames(),
            t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e),
            this.handleElement.is(e.target) && this.element.trigger("focus"),
            t.ui.mouse.prototype._mouseUp.call(this, e)
        },
        cancel: function() {
            return this.helper.is(".ui-draggable-dragging") ? this._mouseUp(new t.Event("mouseup",{
                target: this.element[0]
            })) : this._clear(),
            this
        },
        _getHandle: function(e) {
            return !this.options.handle || !!t(e.target).closest(this.element.find(this.options.handle)).length
        },
        _setHandleClassName: function() {
            this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element,
            this._addClass(this.handleElement, "ui-draggable-handle")
        },
        _removeHandleClassName: function() {
            this._removeClass(this.handleElement, "ui-draggable-handle")
        },
        _createHelper: function(e) {
            var i = this.options
              , s = t.isFunction(i.helper);
            return (e = s ? t(i.helper.apply(this.element[0], [e])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element).parents("body").length || e.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo),
            s && e[0] === this.element[0] && this._setPositionRelative(),
            e[0] === this.element[0] || /(fixed|absolute)/.test(e.css("position")) || e.css("position", "absolute"),
            e
        },
        _setPositionRelative: function() {
            /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative")
        },
        _adjustOffsetFromHelper: function(e) {
            "string" == typeof e && (e = e.split(" ")),
            t.isArray(e) && (e = {
                left: +e[0],
                top: +e[1] || 0
            }),
            "left"in e && (this.offset.click.left = e.left + this.margins.left),
            "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
            "top"in e && (this.offset.click.top = e.top + this.margins.top),
            "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
        },
        _isRootNode: function(t) {
            return /(html|body)/i.test(t.tagName) || t === this.document[0]
        },
        _getParentOffset: function() {
            var e = this.offsetParent.offset()
              , i = this.document[0];
            return "absolute" === this.cssPosition && this.scrollParent[0] !== i && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
            e.top += this.scrollParent.scrollTop()),
            this._isRootNode(this.offsetParent[0]) && (e = {
                top: 0,
                left: 0
            }),
            {
                top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ("relative" !== this.cssPosition)
                return {
                    top: 0,
                    left: 0
                };
            var t = this.element.position()
              , e = this._isRootNode(this.scrollParent[0]);
            return {
                top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + (e ? 0 : this.scrollParent.scrollTop()),
                left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + (e ? 0 : this.scrollParent.scrollLeft())
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.element.css("marginLeft"), 10) || 0,
                top: parseInt(this.element.css("marginTop"), 10) || 0,
                right: parseInt(this.element.css("marginRight"), 10) || 0,
                bottom: parseInt(this.element.css("marginBottom"), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var e, i, s, o = this.options, n = this.document[0];
            this.relativeContainer = null,
            o.containment ? "window" !== o.containment ? "document" !== o.containment ? o.containment.constructor !== Array ? ("parent" === o.containment && (o.containment = this.helper[0].parentNode),
            (s = (i = t(o.containment))[0]) && (e = /(scroll|auto)/.test(i.css("overflow")),
            this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (e ? Math.max(s.scrollWidth, s.offsetWidth) : s.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (e ? Math.max(s.scrollHeight, s.offsetHeight) : s.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom],
            this.relativeContainer = i)) : this.containment = o.containment : this.containment = [0, 0, t(n).width() - this.helperProportions.width - this.margins.left, (t(n).height() || n.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top] : this.containment = [t(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, t(window).scrollLeft() + t(window).width() - this.helperProportions.width - this.margins.left, t(window).scrollTop() + (t(window).height() || n.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top] : this.containment = null
        },
        _convertPositionTo: function(t, e) {
            e = e || this.position;
            var i = "absolute" === t ? 1 : -1;
            t = this._isRootNode(this.scrollParent[0]);
            return {
                top: e.top + this.offset.relative.top * i + this.offset.parent.top * i - ("fixed" === this.cssPosition ? -this.offset.scroll.top : t ? 0 : this.offset.scroll.top) * i,
                left: e.left + this.offset.relative.left * i + this.offset.parent.left * i - ("fixed" === this.cssPosition ? -this.offset.scroll.left : t ? 0 : this.offset.scroll.left) * i
            }
        },
        _generatePosition: function(t, e) {
            var i, s = this.options, o = this._isRootNode(this.scrollParent[0]), n = t.pageX, r = t.pageY;
            return o && this.offset.scroll || (this.offset.scroll = {
                top: this.scrollParent.scrollTop(),
                left: this.scrollParent.scrollLeft()
            }),
            e && (this.containment && (i = this.relativeContainer ? (i = this.relativeContainer.offset(),
            [this.containment[0] + i.left, this.containment[1] + i.top, this.containment[2] + i.left, this.containment[3] + i.top]) : this.containment,
            t.pageX - this.offset.click.left < i[0] && (n = i[0] + this.offset.click.left),
            t.pageY - this.offset.click.top < i[1] && (r = i[1] + this.offset.click.top),
            t.pageX - this.offset.click.left > i[2] && (n = i[2] + this.offset.click.left),
            t.pageY - this.offset.click.top > i[3] && (r = i[3] + this.offset.click.top)),
            s.grid && (t = s.grid[1] ? this.originalPageY + Math.round((r - this.originalPageY) / s.grid[1]) * s.grid[1] : this.originalPageY,
            r = !i || t - this.offset.click.top >= i[1] || t - this.offset.click.top > i[3] ? t : t - this.offset.click.top >= i[1] ? t - s.grid[1] : t + s.grid[1],
            t = s.grid[0] ? this.originalPageX + Math.round((n - this.originalPageX) / s.grid[0]) * s.grid[0] : this.originalPageX,
            n = !i || t - this.offset.click.left >= i[0] || t - this.offset.click.left > i[2] ? t : t - this.offset.click.left >= i[0] ? t - s.grid[0] : t + s.grid[0]),
            "y" === s.axis && (n = this.originalPageX),
            "x" === s.axis && (r = this.originalPageY)),
            {
                top: r - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.offset.scroll.top : o ? 0 : this.offset.scroll.top),
                left: n - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.offset.scroll.left : o ? 0 : this.offset.scroll.left)
            }
        },
        _clear: function() {
            this._removeClass(this.helper, "ui-draggable-dragging"),
            this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(),
            this.helper = null,
            this.cancelHelperRemoval = !1,
            this.destroyOnClear && this.destroy()
        },
        _trigger: function(e, i, s) {
            return s = s || this._uiHash(),
            t.ui.plugin.call(this, e, [i, s, this], !0),
            /^(drag|start|stop)/.test(e) && (this.positionAbs = this._convertPositionTo("absolute"),
            s.offset = this.positionAbs),
            t.Widget.prototype._trigger.call(this, e, i, s)
        },
        plugins: {},
        _uiHash: function() {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            }
        }
    }),
    t.ui.plugin.add("draggable", "connectToSortable", {
        start: function(e, i, s) {
            var o = t.extend({}, i, {
                item: s.element
            });
            s.sortables = [],
            t(s.options.connectToSortable).each((function() {
                var i = t(this).sortable("instance");
                i && !i.options.disabled && (s.sortables.push(i),
                i.refreshPositions(),
                i._trigger("activate", e, o))
            }
            ))
        },
        stop: function(e, i, s) {
            var o = t.extend({}, i, {
                item: s.element
            });
            s.cancelHelperRemoval = !1,
            t.each(s.sortables, (function() {
                var t = this;
                t.isOver ? (t.isOver = 0,
                s.cancelHelperRemoval = !0,
                t.cancelHelperRemoval = !1,
                t._storedCSS = {
                    position: t.placeholder.css("position"),
                    top: t.placeholder.css("top"),
                    left: t.placeholder.css("left")
                },
                t._mouseStop(e),
                t.options.helper = t.options._helper) : (t.cancelHelperRemoval = !0,
                t._trigger("deactivate", e, o))
            }
            ))
        },
        drag: function(e, i, s) {
            t.each(s.sortables, (function() {
                var o = !1
                  , n = this;
                n.positionAbs = s.positionAbs,
                n.helperProportions = s.helperProportions,
                n.offset.click = s.offset.click,
                n._intersectsWith(n.containerCache) && (o = !0,
                t.each(s.sortables, (function() {
                    return this.positionAbs = s.positionAbs,
                    this.helperProportions = s.helperProportions,
                    this.offset.click = s.offset.click,
                    this !== n && this._intersectsWith(this.containerCache) && t.contains(n.element[0], this.element[0]) && (o = !1),
                    o
                }
                ))),
                o ? (n.isOver || (n.isOver = 1,
                s._parent = i.helper.parent(),
                n.currentItem = i.helper.appendTo(n.element).data("ui-sortable-item", !0),
                n.options._helper = n.options.helper,
                n.options.helper = function() {
                    return i.helper[0]
                }
                ,
                e.target = n.currentItem[0],
                n._mouseCapture(e, !0),
                n._mouseStart(e, !0, !0),
                n.offset.click.top = s.offset.click.top,
                n.offset.click.left = s.offset.click.left,
                n.offset.parent.left -= s.offset.parent.left - n.offset.parent.left,
                n.offset.parent.top -= s.offset.parent.top - n.offset.parent.top,
                s._trigger("toSortable", e),
                s.dropped = n.element,
                t.each(s.sortables, (function() {
                    this.refreshPositions()
                }
                )),
                s.currentItem = s.element,
                n.fromOutside = s),
                n.currentItem && (n._mouseDrag(e),
                i.position = n.position)) : n.isOver && (n.isOver = 0,
                n.cancelHelperRemoval = !0,
                n.options._revert = n.options.revert,
                n.options.revert = !1,
                n._trigger("out", e, n._uiHash(n)),
                n._mouseStop(e, !0),
                n.options.revert = n.options._revert,
                n.options.helper = n.options._helper,
                n.placeholder && n.placeholder.remove(),
                i.helper.appendTo(s._parent),
                s._refreshOffsets(e),
                i.position = s._generatePosition(e, !0),
                s._trigger("fromSortable", e),
                s.dropped = !1,
                t.each(s.sortables, (function() {
                    this.refreshPositions()
                }
                )))
            }
            ))
        }
    }),
    t.ui.plugin.add("draggable", "cursor", {
        start: function(e, i, s) {
            var o = t("body");
            s = s.options;
            o.css("cursor") && (s._cursor = o.css("cursor")),
            o.css("cursor", s.cursor)
        },
        stop: function(e, i, s) {
            (s = s.options)._cursor && t("body").css("cursor", s._cursor)
        }
    }),
    t.ui.plugin.add("draggable", "opacity", {
        start: function(e, i, s) {
            i = t(i.helper),
            s = s.options,
            i.css("opacity") && (s._opacity = i.css("opacity")),
            i.css("opacity", s.opacity)
        },
        stop: function(e, i, s) {
            (s = s.options)._opacity && t(i.helper).css("opacity", s._opacity)
        }
    }),
    t.ui.plugin.add("draggable", "scroll", {
        start: function(t, e, i) {
            i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)),
            i.scrollParentNotHidden[0] !== i.document[0] && "HTML" !== i.scrollParentNotHidden[0].tagName && (i.overflowOffset = i.scrollParentNotHidden.offset())
        },
        drag: function(e, i, s) {
            var o = s.options
              , n = !1
              , r = s.scrollParentNotHidden[0]
              , h = s.document[0];
            r !== h && "HTML" !== r.tagName ? (o.axis && "x" === o.axis || (s.overflowOffset.top + r.offsetHeight - e.pageY < o.scrollSensitivity ? r.scrollTop = n = r.scrollTop + o.scrollSpeed : e.pageY - s.overflowOffset.top < o.scrollSensitivity && (r.scrollTop = n = r.scrollTop - o.scrollSpeed)),
            o.axis && "y" === o.axis || (s.overflowOffset.left + r.offsetWidth - e.pageX < o.scrollSensitivity ? r.scrollLeft = n = r.scrollLeft + o.scrollSpeed : e.pageX - s.overflowOffset.left < o.scrollSensitivity && (r.scrollLeft = n = r.scrollLeft - o.scrollSpeed))) : (o.axis && "x" === o.axis || (e.pageY - t(h).scrollTop() < o.scrollSensitivity ? n = t(h).scrollTop(t(h).scrollTop() - o.scrollSpeed) : t(window).height() - (e.pageY - t(h).scrollTop()) < o.scrollSensitivity && (n = t(h).scrollTop(t(h).scrollTop() + o.scrollSpeed))),
            o.axis && "y" === o.axis || (e.pageX - t(h).scrollLeft() < o.scrollSensitivity ? n = t(h).scrollLeft(t(h).scrollLeft() - o.scrollSpeed) : t(window).width() - (e.pageX - t(h).scrollLeft()) < o.scrollSensitivity && (n = t(h).scrollLeft(t(h).scrollLeft() + o.scrollSpeed)))),
            !1 !== n && t.ui.ddmanager && !o.dropBehaviour && t.ui.ddmanager.prepareOffsets(s, e)
        }
    }),
    t.ui.plugin.add("draggable", "snap", {
        start: function(e, i, s) {
            var o = s.options;
            s.snapElements = [],
            t(o.snap.constructor !== String ? o.snap.items || ":data(ui-draggable)" : o.snap).each((function() {
                var e = t(this)
                  , i = e.offset();
                this !== s.element[0] && s.snapElements.push({
                    item: this,
                    width: e.outerWidth(),
                    height: e.outerHeight(),
                    top: i.top,
                    left: i.left
                })
            }
            ))
        },
        drag: function(e, i, s) {
            for (var o, n, r, h, a, l, c, p, d, f = s.options, u = f.snapTolerance, g = i.offset.left, m = g + s.helperProportions.width, _ = i.offset.top, v = _ + s.helperProportions.height, b = s.snapElements.length - 1; 0 <= b; b--)
                l = (a = s.snapElements[b].left - s.margins.left) + s.snapElements[b].width,
                p = (c = s.snapElements[b].top - s.margins.top) + s.snapElements[b].height,
                m < a - u || l + u < g || v < c - u || p + u < _ || !t.contains(s.snapElements[b].item.ownerDocument, s.snapElements[b].item) ? (s.snapElements[b].snapping && s.options.snap.release && s.options.snap.release.call(s.element, e, t.extend(s._uiHash(), {
                    snapItem: s.snapElements[b].item
                })),
                s.snapElements[b].snapping = !1) : ("inner" !== f.snapMode && (o = Math.abs(c - v) <= u,
                n = Math.abs(p - _) <= u,
                r = Math.abs(a - m) <= u,
                h = Math.abs(l - g) <= u,
                o && (i.position.top = s._convertPositionTo("relative", {
                    top: c - s.helperProportions.height,
                    left: 0
                }).top),
                n && (i.position.top = s._convertPositionTo("relative", {
                    top: p,
                    left: 0
                }).top),
                r && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: a - s.helperProportions.width
                }).left),
                h && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: l
                }).left)),
                d = o || n || r || h,
                "outer" !== f.snapMode && (o = Math.abs(c - _) <= u,
                n = Math.abs(p - v) <= u,
                r = Math.abs(a - g) <= u,
                h = Math.abs(l - m) <= u,
                o && (i.position.top = s._convertPositionTo("relative", {
                    top: c,
                    left: 0
                }).top),
                n && (i.position.top = s._convertPositionTo("relative", {
                    top: p - s.helperProportions.height,
                    left: 0
                }).top),
                r && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: a
                }).left),
                h && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: l - s.helperProportions.width
                }).left)),
                !s.snapElements[b].snapping && (o || n || r || h || d) && s.options.snap.snap && s.options.snap.snap.call(s.element, e, t.extend(s._uiHash(), {
                    snapItem: s.snapElements[b].item
                })),
                s.snapElements[b].snapping = o || n || r || h || d)
        }
    }),
    t.ui.plugin.add("draggable", "stack", {
        start: function(e, i, s) {
            var o;
            s = s.options,
            s = t.makeArray(t(s.stack)).sort((function(e, i) {
                return (parseInt(t(e).css("zIndex"), 10) || 0) - (parseInt(t(i).css("zIndex"), 10) || 0)
            }
            ));
            s.length && (o = parseInt(t(s[0]).css("zIndex"), 10) || 0,
            t(s).each((function(e) {
                t(this).css("zIndex", o + e)
            }
            )),
            this.css("zIndex", o + s.length))
        }
    }),
    t.ui.plugin.add("draggable", "zIndex", {
        start: function(e, i, s) {
            i = t(i.helper),
            s = s.options,
            i.css("zIndex") && (s._zIndex = i.css("zIndex")),
            i.css("zIndex", s.zIndex)
        },
        stop: function(e, i, s) {
            (s = s.options)._zIndex && t(i.helper).css("zIndex", s._zIndex)
        }
    }),
    t.ui.draggable,
    t.widget("ui.droppable", {
        version: "1.12.1",
        widgetEventPrefix: "drop",
        options: {
            accept: "*",
            addClasses: !0,
            greedy: !1,
            scope: "default",
            tolerance: "intersect",
            activate: null,
            deactivate: null,
            drop: null,
            out: null,
            over: null
        },
        _create: function() {
            var e, i = this.options, s = i.accept;
            this.isover = !1,
            this.isout = !0,
            this.accept = t.isFunction(s) ? s : function(t) {
                return t.is(s)
            }
            ,
            this.proportions = function() {
                if (!arguments.length)
                    return e || (e = {
                        width: this.element[0].offsetWidth,
                        height: this.element[0].offsetHeight
                    });
                e = arguments[0]
            }
            ,
            this._addToManager(i.scope),
            i.addClasses && this._addClass("ui-droppable")
        },
        _addToManager: function(e) {
            t.ui.ddmanager.droppables[e] = t.ui.ddmanager.droppables[e] || [],
            t.ui.ddmanager.droppables[e].push(this)
        },
        _splice: function(t) {
            for (var e = 0; e < t.length; e++)
                t[e] === this && t.splice(e, 1)
        },
        _destroy: function() {
            var e = t.ui.ddmanager.droppables[this.options.scope];
            this._splice(e)
        },
        _setOption: function(e, i) {
            var s;
            "accept" === e ? this.accept = t.isFunction(i) ? i : function(t) {
                return t.is(i)
            }
            : "scope" === e && (s = t.ui.ddmanager.droppables[this.options.scope],
            this._splice(s),
            this._addToManager(i)),
            this._super(e, i)
        },
        _activate: function(e) {
            var i = t.ui.ddmanager.current;
            this._addActiveClass(),
            i && this._trigger("activate", e, this.ui(i))
        },
        _deactivate: function(e) {
            var i = t.ui.ddmanager.current;
            this._removeActiveClass(),
            i && this._trigger("deactivate", e, this.ui(i))
        },
        _over: function(e) {
            var i = t.ui.ddmanager.current;
            i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this._addHoverClass(),
            this._trigger("over", e, this.ui(i)))
        },
        _out: function(e) {
            var i = t.ui.ddmanager.current;
            i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this._removeHoverClass(),
            this._trigger("out", e, this.ui(i)))
        },
        _drop: function(e, i) {
            var s = i || t.ui.ddmanager.current
              , o = !1;
            return !(!s || (s.currentItem || s.element)[0] === this.element[0]) && (this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function() {
                var i = t(this).droppable("instance");
                if (i.options.greedy && !i.options.disabled && i.options.scope === s.options.scope && i.accept.call(i.element[0], s.currentItem || s.element) && r(s, t.extend(i, {
                    offset: i.element.offset()
                }), i.options.tolerance, e))
                    return !(o = !0)
            }
            )),
            !o && !!this.accept.call(this.element[0], s.currentItem || s.element) && (this._removeActiveClass(),
            this._removeHoverClass(),
            this._trigger("drop", e, this.ui(s)),
            this.element))
        },
        ui: function(t) {
            return {
                draggable: t.currentItem || t.element,
                helper: t.helper,
                position: t.position,
                offset: t.positionAbs
            }
        },
        _addHoverClass: function() {
            this._addClass("ui-droppable-hover")
        },
        _removeHoverClass: function() {
            this._removeClass("ui-droppable-hover")
        },
        _addActiveClass: function() {
            this._addClass("ui-droppable-active")
        },
        _removeActiveClass: function() {
            this._removeClass("ui-droppable-active")
        }
    });
    var r = t.ui.intersect = function(t, e, i, s) {
        if (!e.offset)
            return !1;
        var o = (t.positionAbs || t.position.absolute).left + t.margins.left
          , n = (t.positionAbs || t.position.absolute).top + t.margins.top
          , r = o + t.helperProportions.width
          , a = n + t.helperProportions.height
          , l = e.offset.left
          , c = e.offset.top
          , p = l + e.proportions().width
          , d = c + e.proportions().height;
        switch (i) {
        case "fit":
            return l <= o && r <= p && c <= n && a <= d;
        case "intersect":
            return l < o + t.helperProportions.width / 2 && r - t.helperProportions.width / 2 < p && c < n + t.helperProportions.height / 2 && a - t.helperProportions.height / 2 < d;
        case "pointer":
            return h(s.pageY, c, e.proportions().height) && h(s.pageX, l, e.proportions().width);
        case "touch":
            return (c <= n && n <= d || c <= a && a <= d || n < c && d < a) && (l <= o && o <= p || l <= r && r <= p || o < l && p < r);
        default:
            return !1
        }
    }
    ;
    function h(t, e, i) {
        return e <= t && t < e + i
    }
    !(t.ui.ddmanager = {
        current: null,
        droppables: {
            default: []
        },
        prepareOffsets: function(e, i) {
            var s, o, n = t.ui.ddmanager.droppables[e.options.scope] || [], r = i ? i.type : null, h = (e.currentItem || e.element).find(":data(ui-droppable)").addBack();
            t: for (s = 0; s < n.length; s++)
                if (!(n[s].options.disabled || e && !n[s].accept.call(n[s].element[0], e.currentItem || e.element))) {
                    for (o = 0; o < h.length; o++)
                        if (h[o] === n[s].element[0]) {
                            n[s].proportions().height = 0;
                            continue t
                        }
                    n[s].visible = "none" !== n[s].element.css("display"),
                    n[s].visible && ("mousedown" === r && n[s]._activate.call(n[s], i),
                    n[s].offset = n[s].element.offset(),
                    n[s].proportions({
                        width: n[s].element[0].offsetWidth,
                        height: n[s].element[0].offsetHeight
                    }))
                }
        },
        drop: function(e, i) {
            var s = !1;
            return t.each((t.ui.ddmanager.droppables[e.options.scope] || []).slice(), (function() {
                this.options && (!this.options.disabled && this.visible && r(e, this, this.options.tolerance, i) && (s = this._drop.call(this, i) || s),
                !this.options.disabled && this.visible && this.accept.call(this.element[0], e.currentItem || e.element) && (this.isout = !0,
                this.isover = !1,
                this._deactivate.call(this, i)))
            }
            )),
            s
        },
        dragStart: function(e, i) {
            e.element.parentsUntil("body").on("scroll.droppable", (function() {
                e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
            }
            ))
        },
        drag: function(e, i) {
            e.options.refreshPositions && t.ui.ddmanager.prepareOffsets(e, i),
            t.each(t.ui.ddmanager.droppables[e.options.scope] || [], (function() {
                var s, o, n, h;
                this.options.disabled || this.greedyChild || !this.visible || (h = !(n = r(e, this, this.options.tolerance, i)) && this.isover ? "isout" : n && !this.isover ? "isover" : null) && (this.options.greedy && (o = this.options.scope,
                (n = this.element.parents(":data(ui-droppable)").filter((function() {
                    return t(this).droppable("instance").options.scope === o
                }
                ))).length && ((s = t(n[0]).droppable("instance")).greedyChild = "isover" === h)),
                s && "isover" === h && (s.isover = !1,
                s.isout = !0,
                s._out.call(s, i)),
                this[h] = !0,
                this["isout" === h ? "isover" : "isout"] = !1,
                this["isover" === h ? "_over" : "_out"].call(this, i),
                s && "isout" === h && (s.isout = !1,
                s.isover = !0,
                s._over.call(s, i)))
            }
            ))
        },
        dragStop: function(e, i) {
            e.element.parentsUntil("body").off("scroll.droppable"),
            e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
        }
    }) !== t.uiBackCompat && t.widget("ui.droppable", t.ui.droppable, {
        options: {
            hoverClass: !1,
            activeClass: !1
        },
        _addActiveClass: function() {
            this._super(),
            this.options.activeClass && this.element.addClass(this.options.activeClass)
        },
        _removeActiveClass: function() {
            this._super(),
            this.options.activeClass && this.element.removeClass(this.options.activeClass)
        },
        _addHoverClass: function() {
            this._super(),
            this.options.hoverClass && this.element.addClass(this.options.hoverClass)
        },
        _removeHoverClass: function() {
            this._super(),
            this.options.hoverClass && this.element.removeClass(this.options.hoverClass)
        }
    }),
    t.ui.droppable,
    t.widget("ui.resizable", t.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "resize",
        options: {
            alsoResize: !1,
            animate: !1,
            animateDuration: "slow",
            animateEasing: "swing",
            aspectRatio: !1,
            autoHide: !1,
            classes: {
                "ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
            },
            containment: !1,
            ghost: !1,
            grid: !1,
            handles: "e,s,se",
            helper: !1,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,
            zIndex: 90,
            resize: null,
            start: null,
            stop: null
        },
        _num: function(t) {
            return parseFloat(t) || 0
        },
        _isNumber: function(t) {
            return !isNaN(parseFloat(t))
        },
        _hasScroll: function(e, i) {
            if ("hidden" === t(e).css("overflow"))
                return !1;
            var s = i && "left" === i ? "scrollLeft" : "scrollTop";
            i = !1;
            return 0 < e[s] || (e[s] = 1,
            i = 0 < e[s],
            e[s] = 0,
            i)
        },
        _create: function() {
            var e, i = this.options, s = this;
            this._addClass("ui-resizable"),
            t.extend(this, {
                _aspectRatio: !!i.aspectRatio,
                aspectRatio: i.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: i.helper || i.ghost || i.animate ? i.helper || "ui-resizable-helper" : null
            }),
            this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                position: this.element.css("position"),
                width: this.element.outerWidth(),
                height: this.element.outerHeight(),
                top: this.element.css("top"),
                left: this.element.css("left")
            })),
            this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")),
            this.elementIsWrapper = !0,
            e = {
                marginTop: this.originalElement.css("marginTop"),
                marginRight: this.originalElement.css("marginRight"),
                marginBottom: this.originalElement.css("marginBottom"),
                marginLeft: this.originalElement.css("marginLeft")
            },
            this.element.css(e),
            this.originalElement.css("margin", 0),
            this.originalResizeStyle = this.originalElement.css("resize"),
            this.originalElement.css("resize", "none"),
            this._proportionallyResizeElements.push(this.originalElement.css({
                position: "static",
                zoom: 1,
                display: "block"
            })),
            this.originalElement.css(e),
            this._proportionallyResize()),
            this._setupHandles(),
            i.autoHide && t(this.element).on("mouseenter", (function() {
                i.disabled || (s._removeClass("ui-resizable-autohide"),
                s._handles.show())
            }
            )).on("mouseleave", (function() {
                i.disabled || s.resizing || (s._addClass("ui-resizable-autohide"),
                s._handles.hide())
            }
            )),
            this._mouseInit()
        },
        _destroy: function() {
            function e(e) {
                t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()
            }
            var i;
            return this._mouseDestroy(),
            this.elementIsWrapper && (e(this.element),
            i = this.element,
            this.originalElement.css({
                position: i.css("position"),
                width: i.outerWidth(),
                height: i.outerHeight(),
                top: i.css("top"),
                left: i.css("left")
            }).insertAfter(i),
            i.remove()),
            this.originalElement.css("resize", this.originalResizeStyle),
            e(this.originalElement),
            this
        },
        _setOption: function(t, e) {
            this._super(t, e),
            "handles" === t && (this._removeHandles(),
            this._setupHandles())
        },
        _setupHandles: function() {
            var e, i, s, o, n, r = this.options, h = this;
            if (this.handles = r.handles || (t(".ui-resizable-handle", this.element).length ? {
                n: ".ui-resizable-n",
                e: ".ui-resizable-e",
                s: ".ui-resizable-s",
                w: ".ui-resizable-w",
                se: ".ui-resizable-se",
                sw: ".ui-resizable-sw",
                ne: ".ui-resizable-ne",
                nw: ".ui-resizable-nw"
            } : "e,s,se"),
            this._handles = t(),
            this.handles.constructor === String)
                for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"),
                s = this.handles.split(","),
                this.handles = {},
                i = 0; i < s.length; i++)
                    o = "ui-resizable-" + (e = t.trim(s[i])),
                    n = t("<div>"),
                    this._addClass(n, "ui-resizable-handle " + o),
                    n.css({
                        zIndex: r.zIndex
                    }),
                    this.handles[e] = ".ui-resizable-" + e,
                    this.element.append(n);
            this._renderAxis = function(e) {
                var i, s, o;
                for (i in e = e || this.element,
                this.handles)
                    this.handles[i].constructor === String ? this.handles[i] = this.element.children(this.handles[i]).first().show() : (this.handles[i].jquery || this.handles[i].nodeType) && (this.handles[i] = t(this.handles[i]),
                    this._on(this.handles[i], {
                        mousedown: h._mouseDown
                    })),
                    this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (s = t(this.handles[i], this.element),
                    o = /sw|ne|nw|se|n|s/.test(i) ? s.outerHeight() : s.outerWidth(),
                    s = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""),
                    e.css(s, o),
                    this._proportionallyResize()),
                    this._handles = this._handles.add(this.handles[i])
            }
            ,
            this._renderAxis(this.element),
            this._handles = this._handles.add(this.element.find(".ui-resizable-handle")),
            this._handles.disableSelection(),
            this._handles.on("mouseover", (function() {
                h.resizing || (this.className && (n = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),
                h.axis = n && n[1] ? n[1] : "se")
            }
            )),
            r.autoHide && (this._handles.hide(),
            this._addClass("ui-resizable-autohide"))
        },
        _removeHandles: function() {
            this._handles.remove()
        },
        _mouseCapture: function(e) {
            var i, s, o = !1;
            for (i in this.handles)
                (s = t(this.handles[i])[0]) !== e.target && !t.contains(s, e.target) || (o = !0);
            return !this.options.disabled && o
        },
        _mouseStart: function(e) {
            var i, s, o = this.options, n = this.element;
            return this.resizing = !0,
            this._renderProxy(),
            i = this._num(this.helper.css("left")),
            s = this._num(this.helper.css("top")),
            o.containment && (i += t(o.containment).scrollLeft() || 0,
            s += t(o.containment).scrollTop() || 0),
            this.offset = this.helper.offset(),
            this.position = {
                left: i,
                top: s
            },
            this.size = this._helper ? {
                width: this.helper.width(),
                height: this.helper.height()
            } : {
                width: n.width(),
                height: n.height()
            },
            this.originalSize = this._helper ? {
                width: n.outerWidth(),
                height: n.outerHeight()
            } : {
                width: n.width(),
                height: n.height()
            },
            this.sizeDiff = {
                width: n.outerWidth() - n.width(),
                height: n.outerHeight() - n.height()
            },
            this.originalPosition = {
                left: i,
                top: s
            },
            this.originalMousePosition = {
                left: e.pageX,
                top: e.pageY
            },
            this.aspectRatio = "number" == typeof o.aspectRatio ? o.aspectRatio : this.originalSize.width / this.originalSize.height || 1,
            o = t(".ui-resizable-" + this.axis).css("cursor"),
            t("body").css("cursor", "auto" === o ? this.axis + "-resize" : o),
            this._addClass("ui-resizable-resizing"),
            this._propagate("start", e),
            !0
        },
        _mouseDrag: function(e) {
            var i = this.originalMousePosition
              , s = this.axis
              , o = e.pageX - i.left || 0;
            i = e.pageY - i.top || 0,
            s = this._change[s];
            return this._updatePrevProperties(),
            s && (i = s.apply(this, [e, o, i]),
            this._updateVirtualBoundaries(e.shiftKey),
            (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)),
            i = this._respectSize(i, e),
            this._updateCache(i),
            this._propagate("resize", e),
            i = this._applyChanges(),
            !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(),
            t.isEmptyObject(i) || (this._updatePrevProperties(),
            this._trigger("resize", e, this.ui()),
            this._applyChanges())),
            !1
        },
        _mouseStop: function(e) {
            this.resizing = !1;
            var i, s, o, n = this.options, r = this;
            return this._helper && (o = (i = (s = this._proportionallyResizeElements).length && /textarea/i.test(s[0].nodeName)) && this._hasScroll(s[0], "left") ? 0 : r.sizeDiff.height,
            s = i ? 0 : r.sizeDiff.width,
            i = {
                width: r.helper.width() - s,
                height: r.helper.height() - o
            },
            s = parseFloat(r.element.css("left")) + (r.position.left - r.originalPosition.left) || null,
            o = parseFloat(r.element.css("top")) + (r.position.top - r.originalPosition.top) || null,
            n.animate || this.element.css(t.extend(i, {
                top: o,
                left: s
            })),
            r.helper.height(r.size.height),
            r.helper.width(r.size.width),
            this._helper && !n.animate && this._proportionallyResize()),
            t("body").css("cursor", "auto"),
            this._removeClass("ui-resizable-resizing"),
            this._propagate("stop", e),
            this._helper && this.helper.remove(),
            !1
        },
        _updatePrevProperties: function() {
            this.prevPosition = {
                top: this.position.top,
                left: this.position.left
            },
            this.prevSize = {
                width: this.size.width,
                height: this.size.height
            }
        },
        _applyChanges: function() {
            var t = {};
            return this.position.top !== this.prevPosition.top && (t.top = this.position.top + "px"),
            this.position.left !== this.prevPosition.left && (t.left = this.position.left + "px"),
            this.size.width !== this.prevSize.width && (t.width = this.size.width + "px"),
            this.size.height !== this.prevSize.height && (t.height = this.size.height + "px"),
            this.helper.css(t),
            t
        },
        _updateVirtualBoundaries: function(t) {
            var e, i, s = this.options, o = {
                minWidth: this._isNumber(s.minWidth) ? s.minWidth : 0,
                maxWidth: this._isNumber(s.maxWidth) ? s.maxWidth : 1 / 0,
                minHeight: this._isNumber(s.minHeight) ? s.minHeight : 0,
                maxHeight: this._isNumber(s.maxHeight) ? s.maxHeight : 1 / 0
            };
            (this._aspectRatio || t) && (e = o.minHeight * this.aspectRatio,
            i = o.minWidth / this.aspectRatio,
            s = o.maxHeight * this.aspectRatio,
            t = o.maxWidth / this.aspectRatio,
            e > o.minWidth && (o.minWidth = e),
            i > o.minHeight && (o.minHeight = i),
            s < o.maxWidth && (o.maxWidth = s),
            t < o.maxHeight && (o.maxHeight = t)),
            this._vBoundaries = o
        },
        _updateCache: function(t) {
            this.offset = this.helper.offset(),
            this._isNumber(t.left) && (this.position.left = t.left),
            this._isNumber(t.top) && (this.position.top = t.top),
            this._isNumber(t.height) && (this.size.height = t.height),
            this._isNumber(t.width) && (this.size.width = t.width)
        },
        _updateRatio: function(t) {
            var e = this.position
              , i = this.size
              , s = this.axis;
            return this._isNumber(t.height) ? t.width = t.height * this.aspectRatio : this._isNumber(t.width) && (t.height = t.width / this.aspectRatio),
            "sw" === s && (t.left = e.left + (i.width - t.width),
            t.top = null),
            "nw" === s && (t.top = e.top + (i.height - t.height),
            t.left = e.left + (i.width - t.width)),
            t
        },
        _respectSize: function(t) {
            var e = this._vBoundaries
              , i = this.axis
              , s = this._isNumber(t.width) && e.maxWidth && e.maxWidth < t.width
              , o = this._isNumber(t.height) && e.maxHeight && e.maxHeight < t.height
              , n = this._isNumber(t.width) && e.minWidth && e.minWidth > t.width
              , r = this._isNumber(t.height) && e.minHeight && e.minHeight > t.height
              , h = this.originalPosition.left + this.originalSize.width
              , a = this.originalPosition.top + this.originalSize.height
              , l = /sw|nw|w/.test(i);
            i = /nw|ne|n/.test(i);
            return n && (t.width = e.minWidth),
            r && (t.height = e.minHeight),
            s && (t.width = e.maxWidth),
            o && (t.height = e.maxHeight),
            n && l && (t.left = h - e.minWidth),
            s && l && (t.left = h - e.maxWidth),
            r && i && (t.top = a - e.minHeight),
            o && i && (t.top = a - e.maxHeight),
            t.width || t.height || t.left || !t.top ? t.width || t.height || t.top || !t.left || (t.left = null) : t.top = null,
            t
        },
        _getPaddingPlusBorderDimensions: function(t) {
            for (var e = 0, i = [], s = [t.css("borderTopWidth"), t.css("borderRightWidth"), t.css("borderBottomWidth"), t.css("borderLeftWidth")], o = [t.css("paddingTop"), t.css("paddingRight"), t.css("paddingBottom"), t.css("paddingLeft")]; e < 4; e++)
                i[e] = parseFloat(s[e]) || 0,
                i[e] += parseFloat(o[e]) || 0;
            return {
                height: i[0] + i[2],
                width: i[1] + i[3]
            }
        },
        _proportionallyResize: function() {
            if (this._proportionallyResizeElements.length)
                for (var t, e = 0, i = this.helper || this.element; e < this._proportionallyResizeElements.length; e++)
                    t = this._proportionallyResizeElements[e],
                    this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(t)),
                    t.css({
                        height: i.height() - this.outerDimensions.height || 0,
                        width: i.width() - this.outerDimensions.width || 0
                    })
        },
        _renderProxy: function() {
            var e = this.element
              , i = this.options;
            this.elementOffset = e.offset(),
            this._helper ? (this.helper = this.helper || t("<div style='overflow:hidden;'></div>"),
            this._addClass(this.helper, this._helper),
            this.helper.css({
                width: this.element.outerWidth(),
                height: this.element.outerHeight(),
                position: "absolute",
                left: this.elementOffset.left + "px",
                top: this.elementOffset.top + "px",
                zIndex: ++i.zIndex
            }),
            this.helper.appendTo("body").disableSelection()) : this.helper = this.element
        },
        _change: {
            e: function(t, e) {
                return {
                    width: this.originalSize.width + e
                }
            },
            w: function(t, e) {
                var i = this.originalSize;
                return {
                    left: this.originalPosition.left + e,
                    width: i.width - e
                }
            },
            n: function(t, e, i) {
                var s = this.originalSize;
                return {
                    top: this.originalPosition.top + i,
                    height: s.height - i
                }
            },
            s: function(t, e, i) {
                return {
                    height: this.originalSize.height + i
                }
            },
            se: function(e, i, s) {
                return t.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [e, i, s]))
            },
            sw: function(e, i, s) {
                return t.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [e, i, s]))
            },
            ne: function(e, i, s) {
                return t.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [e, i, s]))
            },
            nw: function(e, i, s) {
                return t.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [e, i, s]))
            }
        },
        _propagate: function(e, i) {
            t.ui.plugin.call(this, e, [i, this.ui()]),
            "resize" !== e && this._trigger(e, i, this.ui())
        },
        plugins: {},
        ui: function() {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            }
        }
    }),
    t.ui.plugin.add("resizable", "animate", {
        stop: function(e) {
            var i = t(this).resizable("instance")
              , s = i.options
              , o = i._proportionallyResizeElements
              , n = (h = o.length && /textarea/i.test(o[0].nodeName)) && i._hasScroll(o[0], "left") ? 0 : i.sizeDiff.height
              , r = h ? 0 : i.sizeDiff.width
              , h = {
                width: i.size.width - r,
                height: i.size.height - n
            };
            r = parseFloat(i.element.css("left")) + (i.position.left - i.originalPosition.left) || null,
            n = parseFloat(i.element.css("top")) + (i.position.top - i.originalPosition.top) || null;
            i.element.animate(t.extend(h, n && r ? {
                top: n,
                left: r
            } : {}), {
                duration: s.animateDuration,
                easing: s.animateEasing,
                step: function() {
                    var s = {
                        width: parseFloat(i.element.css("width")),
                        height: parseFloat(i.element.css("height")),
                        top: parseFloat(i.element.css("top")),
                        left: parseFloat(i.element.css("left"))
                    };
                    o && o.length && t(o[0]).css({
                        width: s.width,
                        height: s.height
                    }),
                    i._updateCache(s),
                    i._propagate("resize", e)
                }
            })
        }
    }),
    t.ui.plugin.add("resizable", "containment", {
        start: function() {
            var e, i, s = t(this).resizable("instance"), o = s.options, n = s.element, r = o.containment, h = r instanceof t ? r.get(0) : /parent/.test(r) ? n.parent().get(0) : r;
            h && (s.containerElement = t(h),
            /document/.test(r) || r === document ? (s.containerOffset = {
                left: 0,
                top: 0
            },
            s.containerPosition = {
                left: 0,
                top: 0
            },
            s.parentData = {
                element: t(document),
                left: 0,
                top: 0,
                width: t(document).width(),
                height: t(document).height() || document.body.parentNode.scrollHeight
            }) : (e = t(h),
            i = [],
            t(["Top", "Right", "Left", "Bottom"]).each((function(t, o) {
                i[t] = s._num(e.css("padding" + o))
            }
            )),
            s.containerOffset = e.offset(),
            s.containerPosition = e.position(),
            s.containerSize = {
                height: e.innerHeight() - i[3],
                width: e.innerWidth() - i[1]
            },
            o = s.containerOffset,
            n = s.containerSize.height,
            r = s.containerSize.width,
            r = s._hasScroll(h, "left") ? h.scrollWidth : r,
            n = s._hasScroll(h) ? h.scrollHeight : n,
            s.parentData = {
                element: h,
                left: o.left,
                top: o.top,
                width: r,
                height: n
            }))
        },
        resize: function(e) {
            var i = t(this).resizable("instance")
              , s = i.options
              , o = i.containerOffset
              , n = i.position
              , r = i._aspectRatio || e.shiftKey
              , h = {
                top: 0,
                left: 0
            }
              , a = i.containerElement;
            e = !0;
            a[0] !== document && /static/.test(a.css("position")) && (h = o),
            n.left < (i._helper ? o.left : 0) && (i.size.width = i.size.width + (i._helper ? i.position.left - o.left : i.position.left - h.left),
            r && (i.size.height = i.size.width / i.aspectRatio,
            e = !1),
            i.position.left = s.helper ? o.left : 0),
            n.top < (i._helper ? o.top : 0) && (i.size.height = i.size.height + (i._helper ? i.position.top - o.top : i.position.top),
            r && (i.size.width = i.size.height * i.aspectRatio,
            e = !1),
            i.position.top = i._helper ? o.top : 0),
            s = i.containerElement.get(0) === i.element.parent().get(0),
            n = /relative|absolute/.test(i.containerElement.css("position")),
            s && n ? (i.offset.left = i.parentData.left + i.position.left,
            i.offset.top = i.parentData.top + i.position.top) : (i.offset.left = i.element.offset().left,
            i.offset.top = i.element.offset().top),
            n = Math.abs(i.sizeDiff.width + (i._helper ? i.offset.left - h.left : i.offset.left - o.left)),
            o = Math.abs(i.sizeDiff.height + (i._helper ? i.offset.top - h.top : i.offset.top - o.top)),
            n + i.size.width >= i.parentData.width && (i.size.width = i.parentData.width - n,
            r && (i.size.height = i.size.width / i.aspectRatio,
            e = !1)),
            o + i.size.height >= i.parentData.height && (i.size.height = i.parentData.height - o,
            r && (i.size.width = i.size.height * i.aspectRatio,
            e = !1)),
            e || (i.position.left = i.prevPosition.left,
            i.position.top = i.prevPosition.top,
            i.size.width = i.prevSize.width,
            i.size.height = i.prevSize.height)
        },
        stop: function() {
            var e = t(this).resizable("instance")
              , i = e.options
              , s = e.containerOffset
              , o = e.containerPosition
              , n = e.containerElement
              , r = (a = t(e.helper)).offset()
              , h = a.outerWidth() - e.sizeDiff.width
              , a = a.outerHeight() - e.sizeDiff.height;
            e._helper && !i.animate && /relative/.test(n.css("position")) && t(this).css({
                left: r.left - o.left - s.left,
                width: h,
                height: a
            }),
            e._helper && !i.animate && /static/.test(n.css("position")) && t(this).css({
                left: r.left - o.left - s.left,
                width: h,
                height: a
            })
        }
    }),
    t.ui.plugin.add("resizable", "alsoResize", {
        start: function() {
            var e = t(this).resizable("instance").options;
            t(e.alsoResize).each((function() {
                var e = t(this);
                e.data("ui-resizable-alsoresize", {
                    width: parseFloat(e.width()),
                    height: parseFloat(e.height()),
                    left: parseFloat(e.css("left")),
                    top: parseFloat(e.css("top"))
                })
            }
            ))
        },
        resize: function(e, i) {
            var s = t(this).resizable("instance")
              , o = s.options
              , n = s.originalSize
              , r = s.originalPosition
              , h = {
                height: s.size.height - n.height || 0,
                width: s.size.width - n.width || 0,
                top: s.position.top - r.top || 0,
                left: s.position.left - r.left || 0
            };
            t(o.alsoResize).each((function() {
                var e = t(this)
                  , s = t(this).data("ui-resizable-alsoresize")
                  , o = {}
                  , n = e.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
                t.each(n, (function(t, e) {
                    var i = (s[e] || 0) + (h[e] || 0);
                    i && 0 <= i && (o[e] = i || null)
                }
                )),
                e.css(o)
            }
            ))
        },
        stop: function() {
            t(this).removeData("ui-resizable-alsoresize")
        }
    }),
    t.ui.plugin.add("resizable", "ghost", {
        start: function() {
            var e = t(this).resizable("instance")
              , i = e.size;
            e.ghost = e.originalElement.clone(),
            e.ghost.css({
                opacity: .25,
                display: "block",
                position: "relative",
                height: i.height,
                width: i.width,
                margin: 0,
                left: 0,
                top: 0
            }),
            e._addClass(e.ghost, "ui-resizable-ghost"),
            !1 !== t.uiBackCompat && "string" == typeof e.options.ghost && e.ghost.addClass(this.options.ghost),
            e.ghost.appendTo(e.helper)
        },
        resize: function() {
            var e = t(this).resizable("instance");
            e.ghost && e.ghost.css({
                position: "relative",
                height: e.size.height,
                width: e.size.width
            })
        },
        stop: function() {
            var e = t(this).resizable("instance");
            e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0))
        }
    }),
    t.ui.plugin.add("resizable", "grid", {
        resize: function() {
            var e, i = t(this).resizable("instance"), s = i.options, o = i.size, n = i.originalSize, r = i.originalPosition, h = i.axis, a = "number" == typeof s.grid ? [s.grid, s.grid] : s.grid, l = a[0] || 1, c = a[1] || 1, p = Math.round((o.width - n.width) / l) * l, d = Math.round((o.height - n.height) / c) * c, f = n.width + p, u = n.height + d, g = s.maxWidth && s.maxWidth < f, m = s.maxHeight && s.maxHeight < u, _ = s.minWidth && s.minWidth > f;
            o = s.minHeight && s.minHeight > u;
            s.grid = a,
            _ && (f += l),
            o && (u += c),
            g && (f -= l),
            m && (u -= c),
            /^(se|s|e)$/.test(h) ? (i.size.width = f,
            i.size.height = u) : /^(ne)$/.test(h) ? (i.size.width = f,
            i.size.height = u,
            i.position.top = r.top - d) : /^(sw)$/.test(h) ? (i.size.width = f,
            i.size.height = u,
            i.position.left = r.left - p) : ((u - c <= 0 || f - l <= 0) && (e = i._getPaddingPlusBorderDimensions(this)),
            0 < u - c ? (i.size.height = u,
            i.position.top = r.top - d) : (u = c - e.height,
            i.size.height = u,
            i.position.top = r.top + n.height - u),
            0 < f - l ? (i.size.width = f,
            i.position.left = r.left - p) : (f = l - e.width,
            i.size.width = f,
            i.position.left = r.left + n.width - f))
        }
    }),
    t.ui.resizable,
    t.widget("ui.sortable", t.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "sort",
        ready: !1,
        options: {
            appendTo: "parent",
            axis: !1,
            connectWith: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            dropOnEmpty: !0,
            forcePlaceholderSize: !1,
            forceHelperSize: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            items: "> *",
            opacity: !1,
            placeholder: !1,
            revert: !1,
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1e3,
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },
        _isOverAxis: function(t, e, i) {
            return e <= t && t < e + i
        },
        _isFloating: function(t) {
            return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display"))
        },
        _create: function() {
            this.containerCache = {},
            this._addClass("ui-sortable"),
            this.refresh(),
            this.offset = this.element.offset(),
            this._mouseInit(),
            this._setHandleClassName(),
            this.ready = !0
        },
        _setOption: function(t, e) {
            this._super(t, e),
            "handle" === t && this._setHandleClassName()
        },
        _setHandleClassName: function() {
            var e = this;
            this._removeClass(this.element.find(".ui-sortable-handle"), "ui-sortable-handle"),
            t.each(this.items, (function() {
                e._addClass(this.instance.options.handle ? this.item.find(this.instance.options.handle) : this.item, "ui-sortable-handle")
            }
            ))
        },
        _destroy: function() {
            this._mouseDestroy();
            for (var t = this.items.length - 1; 0 <= t; t--)
                this.items[t].item.removeData(this.widgetName + "-item");
            return this
        },
        _mouseCapture: function(e, i) {
            var s = null
              , o = !1
              , n = this;
            return !(this.reverting || this.options.disabled || "static" === this.options.type || (this._refreshItems(e),
            t(e.target).parents().each((function() {
                if (t.data(this, n.widgetName + "-item") === n)
                    return s = t(this),
                    !1
            }
            )),
            t.data(e.target, n.widgetName + "-item") === n && (s = t(e.target)),
            !s || this.options.handle && !i && (t(this.options.handle, s).find("*").addBack().each((function() {
                this === e.target && (o = !0)
            }
            )),
            !o) || (this.currentItem = s,
            this._removeCurrentsFromItems(),
            0)))
        },
        _mouseStart: function(e, i, s) {
            var o, n, r = this.options;
            if ((this.currentContainer = this).refreshPositions(),
            this.helper = this._createHelper(e),
            this._cacheHelperProportions(),
            this._cacheMargins(),
            this.scrollParent = this.helper.scrollParent(),
            this.offset = this.currentItem.offset(),
            this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            },
            t.extend(this.offset, {
                click: {
                    left: e.pageX - this.offset.left,
                    top: e.pageY - this.offset.top
                },
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }),
            this.helper.css("position", "absolute"),
            this.cssPosition = this.helper.css("position"),
            this.originalPosition = this._generatePosition(e),
            this.originalPageX = e.pageX,
            this.originalPageY = e.pageY,
            r.cursorAt && this._adjustOffsetFromHelper(r.cursorAt),
            this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            },
            this.helper[0] !== this.currentItem[0] && this.currentItem.hide(),
            this._createPlaceholder(),
            r.containment && this._setContainment(),
            r.cursor && "auto" !== r.cursor && (n = this.document.find("body"),
            this.storedCursor = n.css("cursor"),
            n.css("cursor", r.cursor),
            this.storedStylesheet = t("<style>*{ cursor: " + r.cursor + " !important; }</style>").appendTo(n)),
            r.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")),
            this.helper.css("opacity", r.opacity)),
            r.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")),
            this.helper.css("zIndex", r.zIndex)),
            this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()),
            this._trigger("start", e, this._uiHash()),
            this._preserveHelperProportions || this._cacheHelperProportions(),
            !s)
                for (o = this.containers.length - 1; 0 <= o; o--)
                    this.containers[o]._trigger("activate", e, this._uiHash(this));
            return t.ui.ddmanager && (t.ui.ddmanager.current = this),
            t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
            this.dragging = !0,
            this._addClass(this.helper, "ui-sortable-helper"),
            this._mouseDrag(e),
            !0
        },
        _mouseDrag: function(e) {
            var i, s, o, n, r = this.options, h = !1;
            for (this.position = this._generatePosition(e),
            this.positionAbs = this._convertPositionTo("absolute"),
            this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs),
            this.options.scroll && (this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < r.scrollSensitivity ? this.scrollParent[0].scrollTop = h = this.scrollParent[0].scrollTop + r.scrollSpeed : e.pageY - this.overflowOffset.top < r.scrollSensitivity && (this.scrollParent[0].scrollTop = h = this.scrollParent[0].scrollTop - r.scrollSpeed),
            this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < r.scrollSensitivity ? this.scrollParent[0].scrollLeft = h = this.scrollParent[0].scrollLeft + r.scrollSpeed : e.pageX - this.overflowOffset.left < r.scrollSensitivity && (this.scrollParent[0].scrollLeft = h = this.scrollParent[0].scrollLeft - r.scrollSpeed)) : (e.pageY - this.document.scrollTop() < r.scrollSensitivity ? h = this.document.scrollTop(this.document.scrollTop() - r.scrollSpeed) : this.window.height() - (e.pageY - this.document.scrollTop()) < r.scrollSensitivity && (h = this.document.scrollTop(this.document.scrollTop() + r.scrollSpeed)),
            e.pageX - this.document.scrollLeft() < r.scrollSensitivity ? h = this.document.scrollLeft(this.document.scrollLeft() - r.scrollSpeed) : this.window.width() - (e.pageX - this.document.scrollLeft()) < r.scrollSensitivity && (h = this.document.scrollLeft(this.document.scrollLeft() + r.scrollSpeed))),
            !1 !== h && t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)),
            this.positionAbs = this._convertPositionTo("absolute"),
            this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"),
            this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"),
            i = this.items.length - 1; 0 <= i; i--)
                if (o = (s = this.items[i]).item[0],
                (n = this._intersectsWithPointer(s)) && s.instance === this.currentContainer && !(o === this.currentItem[0] || this.placeholder[1 === n ? "next" : "prev"]()[0] === o || t.contains(this.placeholder[0], o) || "semi-dynamic" === this.options.type && t.contains(this.element[0], o))) {
                    if (this.direction = 1 === n ? "down" : "up",
                    "pointer" !== this.options.tolerance && !this._intersectsWithSides(s))
                        break;
                    this._rearrange(e, s),
                    this._trigger("change", e, this._uiHash());
                    break
                }
            return this._contactContainers(e),
            t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
            this._trigger("sort", e, this._uiHash()),
            this.lastPositionAbs = this.positionAbs,
            !1
        },
        _mouseStop: function(e, i) {
            var s, o, n, r;
            if (e)
                return t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e),
                this.options.revert ? (o = (s = this).placeholder.offset(),
                r = {},
                (n = this.options.axis) && "x" !== n || (r.left = o.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollLeft)),
                n && "y" !== n || (r.top = o.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollTop)),
                this.reverting = !0,
                t(this.helper).animate(r, parseInt(this.options.revert, 10) || 500, (function() {
                    s._clear(e)
                }
                ))) : this._clear(e, i),
                !1
        },
        cancel: function() {
            if (this.dragging) {
                this._mouseUp(new t.Event("mouseup",{
                    target: null
                })),
                "original" === this.options.helper ? (this.currentItem.css(this._storedCSS),
                this._removeClass(this.currentItem, "ui-sortable-helper")) : this.currentItem.show();
                for (var e = this.containers.length - 1; 0 <= e; e--)
                    this.containers[e]._trigger("deactivate", null, this._uiHash(this)),
                    this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)),
                    this.containers[e].containerCache.over = 0)
            }
            return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
            "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(),
            t.extend(this, {
                helper: null,
                dragging: !1,
                reverting: !1,
                _noFinalSort: null
            }),
            this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)),
            this
        },
        serialize: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected)
              , s = [];
            return e = e || {},
            t(i).each((function() {
                var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/);
                i && s.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2]))
            }
            )),
            !s.length && e.key && s.push(e.key + "="),
            s.join("&")
        },
        toArray: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected)
              , s = [];
            return e = e || {},
            i.each((function() {
                s.push(t(e.item || this).attr(e.attribute || "id") || "")
            }
            )),
            s
        },
        _intersectsWith: function(t) {
            var e = this.positionAbs.left
              , i = e + this.helperProportions.width
              , s = this.positionAbs.top
              , o = s + this.helperProportions.height
              , n = t.left
              , r = n + t.width
              , h = t.top
              , a = h + t.height
              , l = this.offset.click.top
              , c = this.offset.click.left;
            l = "x" === this.options.axis || h < s + l && s + l < a,
            c = "y" === this.options.axis || n < e + c && e + c < r,
            c = l && c;
            return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? c : n < e + this.helperProportions.width / 2 && i - this.helperProportions.width / 2 < r && h < s + this.helperProportions.height / 2 && o - this.helperProportions.height / 2 < a
        },
        _intersectsWithPointer: function(t) {
            var e = "x" === this.options.axis || this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top, t.height);
            t = "y" === this.options.axis || this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left, t.width);
            return !(!e || !t) && (e = this._getDragVerticalDirection(),
            t = this._getDragHorizontalDirection(),
            this.floating ? "right" === t || "down" === e ? 2 : 1 : e && ("down" === e ? 2 : 1))
        },
        _intersectsWithSides: function(t) {
            var e = this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height)
              , i = this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width)
              , s = this._getDragVerticalDirection();
            t = this._getDragHorizontalDirection();
            return this.floating && t ? "right" === t && i || "left" === t && !i : s && ("down" === s && e || "up" === s && !e)
        },
        _getDragVerticalDirection: function() {
            var t = this.positionAbs.top - this.lastPositionAbs.top;
            return 0 != t && (0 < t ? "down" : "up")
        },
        _getDragHorizontalDirection: function() {
            var t = this.positionAbs.left - this.lastPositionAbs.left;
            return 0 != t && (0 < t ? "right" : "left")
        },
        refresh: function(t) {
            return this._refreshItems(t),
            this._setHandleClassName(),
            this.refreshPositions(),
            this
        },
        _connectWith: function() {
            var t = this.options;
            return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith
        },
        _getItemsAsjQuery: function(e) {
            var i, s, o, n, r = [], h = [], a = this._connectWith();
            if (a && e)
                for (i = a.length - 1; 0 <= i; i--)
                    for (s = (o = t(a[i], this.document[0])).length - 1; 0 <= s; s--)
                        (n = t.data(o[s], this.widgetFullName)) && n !== this && !n.options.disabled && h.push([t.isFunction(n.options.items) ? n.options.items.call(n.element) : t(n.options.items, n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), n]);
            function l() {
                r.push(this)
            }
            for (h.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                options: this.options,
                item: this.currentItem
            }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]),
            i = h.length - 1; 0 <= i; i--)
                h[i][0].each(l);
            return t(r)
        },
        _removeCurrentsFromItems: function() {
            var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
            this.items = t.grep(this.items, (function(t) {
                for (var i = 0; i < e.length; i++)
                    if (e[i] === t.item[0])
                        return !1;
                return !0
            }
            ))
        },
        _refreshItems: function(e) {
            this.items = [],
            this.containers = [this];
            var i, s, o, n, r, h, a, l, c = this.items, p = [[t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
                item: this.currentItem
            }) : t(this.options.items, this.element), this]], d = this._connectWith();
            if (d && this.ready)
                for (i = d.length - 1; 0 <= i; i--)
                    for (s = (o = t(d[i], this.document[0])).length - 1; 0 <= s; s--)
                        (n = t.data(o[s], this.widgetFullName)) && n !== this && !n.options.disabled && (p.push([t.isFunction(n.options.items) ? n.options.items.call(n.element[0], e, {
                            item: this.currentItem
                        }) : t(n.options.items, n.element), n]),
                        this.containers.push(n));
            for (i = p.length - 1; 0 <= i; i--)
                for (r = p[i][1],
                s = 0,
                l = (h = p[i][0]).length; s < l; s++)
                    (a = t(h[s])).data(this.widgetName + "-item", r),
                    c.push({
                        item: a,
                        instance: r,
                        width: 0,
                        height: 0,
                        left: 0,
                        top: 0
                    })
        },
        refreshPositions: function(e) {
            var i, s, o, n;
            for (this.floating = !!this.items.length && ("x" === this.options.axis || this._isFloating(this.items[0].item)),
            this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset()),
            i = this.items.length - 1; 0 <= i; i--)
                (s = this.items[i]).instance !== this.currentContainer && this.currentContainer && s.item[0] !== this.currentItem[0] || (o = this.options.toleranceElement ? t(this.options.toleranceElement, s.item) : s.item,
                e || (s.width = o.outerWidth(),
                s.height = o.outerHeight()),
                n = o.offset(),
                s.left = n.left,
                s.top = n.top);
            if (this.options.custom && this.options.custom.refreshContainers)
                this.options.custom.refreshContainers.call(this);
            else
                for (i = this.containers.length - 1; 0 <= i; i--)
                    n = this.containers[i].element.offset(),
                    this.containers[i].containerCache.left = n.left,
                    this.containers[i].containerCache.top = n.top,
                    this.containers[i].containerCache.width = this.containers[i].element.outerWidth(),
                    this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
            return this
        },
        _createPlaceholder: function(e) {
            var i, s = (e = e || this).options;
            s.placeholder && s.placeholder.constructor !== String || (i = s.placeholder,
            s.placeholder = {
                element: function() {
                    var s = e.currentItem[0].nodeName.toLowerCase()
                      , o = t("<" + s + ">", e.document[0]);
                    return e._addClass(o, "ui-sortable-placeholder", i || e.currentItem[0].className)._removeClass(o, "ui-sortable-helper"),
                    "tbody" === s ? e._createTrPlaceholder(e.currentItem.find("tr").eq(0), t("<tr>", e.document[0]).appendTo(o)) : "tr" === s ? e._createTrPlaceholder(e.currentItem, o) : "img" === s && o.attr("src", e.currentItem.attr("src")),
                    i || o.css("visibility", "hidden"),
                    o
                },
                update: function(t, o) {
                    i && !s.forcePlaceholderSize || (o.height() || o.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)),
                    o.width() || o.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10)))
                }
            }),
            e.placeholder = t(s.placeholder.element.call(e.element, e.currentItem)),
            e.currentItem.after(e.placeholder),
            s.placeholder.update(e, e.placeholder)
        },
        _createTrPlaceholder: function(e, i) {
            var s = this;
            e.children().each((function() {
                t("<td>&#160;</td>", s.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(i)
            }
            ))
        },
        _contactContainers: function(e) {
            for (var i, s, o, n, r, h, a, l, c, p = null, d = null, f = this.containers.length - 1; 0 <= f; f--)
                t.contains(this.currentItem[0], this.containers[f].element[0]) || (this._intersectsWith(this.containers[f].containerCache) ? p && t.contains(this.containers[f].element[0], p.element[0]) || (p = this.containers[f],
                d = f) : this.containers[f].containerCache.over && (this.containers[f]._trigger("out", e, this._uiHash(this)),
                this.containers[f].containerCache.over = 0));
            if (p)
                if (1 === this.containers.length)
                    this.containers[d].containerCache.over || (this.containers[d]._trigger("over", e, this._uiHash(this)),
                    this.containers[d].containerCache.over = 1);
                else {
                    for (s = 1e4,
                    o = null,
                    n = (l = p.floating || this._isFloating(this.currentItem)) ? "left" : "top",
                    r = l ? "width" : "height",
                    c = l ? "pageX" : "pageY",
                    i = this.items.length - 1; 0 <= i; i--)
                        t.contains(this.containers[d].element[0], this.items[i].item[0]) && this.items[i].item[0] !== this.currentItem[0] && (h = this.items[i].item.offset()[n],
                        a = !1,
                        e[c] - h > this.items[i][r] / 2 && (a = !0),
                        Math.abs(e[c] - h) < s && (s = Math.abs(e[c] - h),
                        o = this.items[i],
                        this.direction = a ? "up" : "down"));
                    (o || this.options.dropOnEmpty) && (this.currentContainer !== this.containers[d] ? (o ? this._rearrange(e, o, null, !0) : this._rearrange(e, null, this.containers[d].element, !0),
                    this._trigger("change", e, this._uiHash()),
                    this.containers[d]._trigger("change", e, this._uiHash(this)),
                    this.currentContainer = this.containers[d],
                    this.options.placeholder.update(this.currentContainer, this.placeholder),
                    this.containers[d]._trigger("over", e, this._uiHash(this)),
                    this.containers[d].containerCache.over = 1) : this.currentContainer.containerCache.over || (this.containers[d]._trigger("over", e, this._uiHash()),
                    this.currentContainer.containerCache.over = 1))
                }
        },
        _createHelper: function(e) {
            var i = this.options;
            return (e = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem).parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(e[0]),
            e[0] === this.currentItem[0] && (this._storedCSS = {
                width: this.currentItem[0].style.width,
                height: this.currentItem[0].style.height,
                position: this.currentItem.css("position"),
                top: this.currentItem.css("top"),
                left: this.currentItem.css("left")
            }),
            e[0].style.width && !i.forceHelperSize || e.width(this.currentItem.width()),
            e[0].style.height && !i.forceHelperSize || e.height(this.currentItem.height()),
            e
        },
        _adjustOffsetFromHelper: function(e) {
            "string" == typeof e && (e = e.split(" ")),
            t.isArray(e) && (e = {
                left: +e[0],
                top: +e[1] || 0
            }),
            "left"in e && (this.offset.click.left = e.left + this.margins.left),
            "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
            "top"in e && (this.offset.click.top = e.top + this.margins.top),
            "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var e = this.offsetParent.offset();
            return "absolute" === this.cssPosition && this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
            e.top += this.scrollParent.scrollTop()),
            (this.offsetParent[0] === this.document[0].body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                top: 0,
                left: 0
            }),
            {
                top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ("relative" !== this.cssPosition)
                return {
                    top: 0,
                    left: 0
                };
            var t = this.currentItem.position();
            return {
                top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                top: parseInt(this.currentItem.css("marginTop"), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var e, i, s = this.options;
            "parent" === s.containment && (s.containment = this.helper[0].parentNode),
            "document" !== s.containment && "window" !== s.containment || (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, "document" === s.containment ? this.document.width() : this.window.width() - this.helperProportions.width - this.margins.left, ("document" === s.containment ? this.document.height() || document.body.parentNode.scrollHeight : this.window.height() || this.document[0].body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]),
            /^(document|window|parent)$/.test(s.containment) || (e = t(s.containment)[0],
            i = t(s.containment).offset(),
            s = "hidden" !== t(e).css("overflow"),
            this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (s ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (s ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
        },
        _convertPositionTo: function(e, i) {
            i = i || this.position;
            var s = "absolute" === e ? 1 : -1
              , o = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent;
            e = /(html|body)/i.test(o[0].tagName);
            return {
                top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : e ? 0 : o.scrollTop()) * s,
                left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : e ? 0 : o.scrollLeft()) * s
            }
        },
        _generatePosition: function(e) {
            var i = this.options
              , s = e.pageX
              , o = e.pageY
              , n = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent
              , r = /(html|body)/i.test(n[0].tagName);
            return "relative" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()),
            this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (s = this.containment[0] + this.offset.click.left),
            e.pageY - this.offset.click.top < this.containment[1] && (o = this.containment[1] + this.offset.click.top),
            e.pageX - this.offset.click.left > this.containment[2] && (s = this.containment[2] + this.offset.click.left),
            e.pageY - this.offset.click.top > this.containment[3] && (o = this.containment[3] + this.offset.click.top)),
            i.grid && (e = this.originalPageY + Math.round((o - this.originalPageY) / i.grid[1]) * i.grid[1],
            o = !this.containment || e - this.offset.click.top >= this.containment[1] && e - this.offset.click.top <= this.containment[3] ? e : e - this.offset.click.top >= this.containment[1] ? e - i.grid[1] : e + i.grid[1],
            e = this.originalPageX + Math.round((s - this.originalPageX) / i.grid[0]) * i.grid[0],
            s = !this.containment || e - this.offset.click.left >= this.containment[0] && e - this.offset.click.left <= this.containment[2] ? e : e - this.offset.click.left >= this.containment[0] ? e - i.grid[0] : e + i.grid[0])),
            {
                top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : r ? 0 : n.scrollTop()),
                left: s - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : r ? 0 : n.scrollLeft())
            }
        },
        _rearrange: function(t, e, i, s) {
            i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling),
            this.counter = this.counter ? ++this.counter : 1;
            var o = this.counter;
            this._delay((function() {
                o === this.counter && this.refreshPositions(!s)
            }
            ))
        },
        _clear: function(t, e) {
            this.reverting = !1;
            var i, s = [];
            if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem),
            this._noFinalSort = null,
            this.helper[0] === this.currentItem[0]) {
                for (i in this._storedCSS)
                    "auto" !== this._storedCSS[i] && "static" !== this._storedCSS[i] || (this._storedCSS[i] = "");
                this.currentItem.css(this._storedCSS),
                this._removeClass(this.currentItem, "ui-sortable-helper")
            } else
                this.currentItem.show();
            function o(t, e, i) {
                return function(s) {
                    i._trigger(t, s, e._uiHash(e))
                }
            }
            for (this.fromOutside && !e && s.push((function(t) {
                this._trigger("receive", t, this._uiHash(this.fromOutside))
            }
            )),
            !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || s.push((function(t) {
                this._trigger("update", t, this._uiHash())
            }
            )),
            this !== this.currentContainer && (e || (s.push((function(t) {
                this._trigger("remove", t, this._uiHash())
            }
            )),
            s.push(function(t) {
                return function(e) {
                    t._trigger("receive", e, this._uiHash(this))
                }
            }
            .call(this, this.currentContainer)),
            s.push(function(t) {
                return function(e) {
                    t._trigger("update", e, this._uiHash(this))
                }
            }
            .call(this, this.currentContainer)))),
            i = this.containers.length - 1; 0 <= i; i--)
                e || s.push(o("deactivate", this, this.containers[i])),
                this.containers[i].containerCache.over && (s.push(o("out", this, this.containers[i])),
                this.containers[i].containerCache.over = 0);
            if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor),
            this.storedStylesheet.remove()),
            this._storedOpacity && this.helper.css("opacity", this._storedOpacity),
            this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex),
            this.dragging = !1,
            e || this._trigger("beforeStop", t, this._uiHash()),
            this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
            this.cancelHelperRemoval || (this.helper[0] !== this.currentItem[0] && this.helper.remove(),
            this.helper = null),
            !e) {
                for (i = 0; i < s.length; i++)
                    s[i].call(this, t);
                this._trigger("stop", t, this._uiHash())
            }
            return this.fromOutside = !1,
            !this.cancelHelperRemoval
        },
        _trigger: function() {
            !1 === t.Widget.prototype._trigger.apply(this, arguments) && this.cancel()
        },
        _uiHash: function(e) {
            var i = e || this;
            return {
                helper: i.helper,
                placeholder: i.placeholder || t([]),
                position: i.position,
                originalPosition: i.originalPosition,
                offset: i.positionAbs,
                item: i.currentItem,
                sender: e ? e.element : null
            }
        }
    })
}
));
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
var $jscomp = $jscomp || {};
$jscomp.scope = {},
$jscomp.findInternal = function(t, a, e) {
    t instanceof String && (t = String(t));
    for (var n = t.length, o = 0; o < n; o++) {
        var r = t[o];
        if (a.call(e, r, o, t))
            return {
                i: o,
                v: r
            }
    }
    return {
        i: -1,
        v: void 0
    }
}
,
$jscomp.ASSUME_ES5 = !1,
$jscomp.ASSUME_NO_NATIVE_MAP = !1,
$jscomp.ASSUME_NO_NATIVE_SET = !1,
$jscomp.SIMPLE_FROUND_POLYFILL = !1,
$jscomp.defineProperty = $jscomp.ASSUME_ES5 || "function" == typeof Object.defineProperties ? Object.defineProperty : function(t, a, e) {
    t != Array.prototype && t != Object.prototype && (t[a] = e.value)
}
,
$jscomp.getGlobal = function(t) {
    return "undefined" != typeof window && window === t ? t : "undefined" != typeof global && null != global ? global : t
}
,
$jscomp.global = $jscomp.getGlobal(this),
$jscomp.polyfill = function(t, a, e, n) {
    if (a) {
        for (e = $jscomp.global,
        t = t.split("."),
        n = 0; n < t.length - 1; n++) {
            var o = t[n];
            o in e || (e[o] = {}),
            e = e[o]
        }
        (a = a(n = e[t = t[t.length - 1]])) != n && null != a && $jscomp.defineProperty(e, t, {
            configurable: !0,
            writable: !0,
            value: a
        })
    }
}
,
$jscomp.polyfill("Array.prototype.find", (function(t) {
    return t || function(t, a) {
        return $jscomp.findInternal(this, t, a).v
    }
}
), "es6", "es3"),
function(t, a, e) {
    "function" == typeof define && define.amd ? define(["jquery"], t) : "object" === ("undefined" == typeof exports ? "undefined" : _typeof(exports)) && "undefined" == typeof Meteor ? module.exports = t(require("jquery")) : t(a || e)
}((function(t) {
    var a = function(a, e, n) {
        var o = {
            invalid: [],
            getCaret: function() {
                try {
                    var t = 0
                      , e = a.get(0)
                      , n = document.selection
                      , r = e.selectionStart;
                    if (n && -1 === navigator.appVersion.indexOf("MSIE 10")) {
                        var s = n.createRange();
                        s.moveStart("character", -o.val().length),
                        t = s.text.length
                    } else
                        (r || "0" === r) && (t = r);
                    return t
                } catch (t) {}
            },
            setCaret: function(t) {
                try {
                    if (a.is(":focus")) {
                        var e = a.get(0);
                        if (e.setSelectionRange)
                            e.setSelectionRange(t, t);
                        else {
                            var n = e.createTextRange();
                            n.collapse(!0),
                            n.moveEnd("character", t),
                            n.moveStart("character", t),
                            n.select()
                        }
                    }
                } catch (t) {}
            },
            events: function() {
                a.on("keydown.mask", (function(t) {
                    a.data("mask-keycode", t.keyCode || t.which),
                    a.data("mask-previus-value", a.val()),
                    a.data("mask-previus-caret-pos", o.getCaret()),
                    o.maskDigitPosMapOld = o.maskDigitPosMap
                }
                )).on(t.jMaskGlobals.useInput ? "input.mask" : "keyup.mask", o.behaviour).on("paste.mask drop.mask", (function() {
                    setTimeout((function() {
                        a.keydown().keyup()
                    }
                    ), 100)
                }
                )).on("change.mask", (function() {
                    a.data("changed", !0)
                }
                )).on("blur.mask", (function() {
                    i === o.val() || a.data("changed") || a.trigger("change"),
                    a.data("changed", !1)
                }
                )).on("blur.mask", (function() {
                    i = o.val()
                }
                )).on("focus.mask", (function(a) {
                    !0 === n.selectOnFocus && t(a.target).select()
                }
                )).on("focusout.mask", (function() {
                    n.clearIfNotMatch && !r.test(o.val()) && o.val("")
                }
                ))
            },
            getRegexMask: function() {
                for (var t, a, n, o, r = [], i = 0; i < e.length; i++)
                    (t = s.translation[e.charAt(i)]) ? (a = t.pattern.toString().replace(/.{1}$|^.{1}/g, ""),
                    n = t.optional,
                    (t = t.recursive) ? (r.push(e.charAt(i)),
                    o = {
                        digit: e.charAt(i),
                        pattern: a
                    }) : r.push(n || t ? a + "?" : a)) : r.push(e.charAt(i).replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&"));
                return r = r.join(""),
                o && (r = r.replace(new RegExp("(" + o.digit + "(.*" + o.digit + ")?)"), "($1)?").replace(new RegExp(o.digit,"g"), o.pattern)),
                new RegExp(r)
            },
            destroyEvents: function() {
                a.off("input keydown keyup paste drop blur focusout ".split(" ").join(".mask "))
            },
            val: function(t) {
                var e = a.is("input") ? "val" : "text";
                return 0 < arguments.length ? (a[e]() !== t && a[e](t),
                e = a) : e = a[e](),
                e
            },
            calculateCaretPosition: function(t) {
                var e = o.getMasked()
                  , n = o.getCaret();
                if (t !== e) {
                    var r = a.data("mask-previus-caret-pos") || 0;
                    e = e.length;
                    var s, i = t.length, l = t = 0, c = 0, u = 0;
                    for (s = n; s < e && o.maskDigitPosMap[s]; s++)
                        l++;
                    for (s = n - 1; 0 <= s && o.maskDigitPosMap[s]; s--)
                        t++;
                    for (s = n - 1; 0 <= s; s--)
                        o.maskDigitPosMap[s] && c++;
                    for (s = r - 1; 0 <= s; s--)
                        o.maskDigitPosMapOld[s] && u++;
                    n > i ? n = 10 * e : r >= n && r !== i ? o.maskDigitPosMapOld[n] || (r = n,
                    n = n - (u - c) - t,
                    o.maskDigitPosMap[n] && (n = r)) : n > r && (n = n + (c - u) + l)
                }
                return n
            },
            behaviour: function(e) {
                e = e || window.event,
                o.invalid = [];
                var n = a.data("mask-keycode");
                if (-1 === t.inArray(n, s.byPassKeys)) {
                    n = o.getMasked();
                    var r = o.getCaret()
                      , i = a.data("mask-previus-value") || "";
                    return setTimeout((function() {
                        o.setCaret(o.calculateCaretPosition(i))
                    }
                    ), t.jMaskGlobals.keyStrokeCompensation),
                    o.val(n),
                    o.setCaret(r),
                    o.callbacks(e)
                }
            },
            getMasked: function(t, a) {
                var r, i = [], l = void 0 === a ? o.val() : a + "", c = 0, u = e.length, p = 0, f = l.length, d = 1, m = "push", v = -1, k = 0;
                if (a = [],
                n.reverse) {
                    m = "unshift",
                    d = -1;
                    var h = 0;
                    c = u - 1,
                    p = f - 1;
                    var g = function() {
                        return -1 < c && -1 < p
                    }
                } else
                    h = u - 1,
                    g = function() {
                        return c < u && p < f
                    }
                    ;
                for (; g(); ) {
                    var y = e.charAt(c)
                      , M = l.charAt(p)
                      , b = s.translation[y];
                    b ? (M.match(b.pattern) ? (i[m](M),
                    b.recursive && (-1 === v ? v = c : c === h && c !== v && (c = v - d),
                    h === v && (c -= d)),
                    c += d) : M === r ? (k--,
                    r = void 0) : b.optional ? (c += d,
                    p -= d) : b.fallback ? (i[m](b.fallback),
                    c += d,
                    p -= d) : o.invalid.push({
                        p: p,
                        v: M,
                        e: b.pattern
                    }),
                    p += d) : (t || i[m](y),
                    M === y ? (a.push(p),
                    p += d) : (r = y,
                    a.push(p + k),
                    k++),
                    c += d)
                }
                return t = e.charAt(h),
                u !== f + 1 || s.translation[t] || i.push(t),
                i = i.join(""),
                o.mapMaskdigitPositions(i, a, f),
                i
            },
            mapMaskdigitPositions: function(t, a, e) {
                for (t = n.reverse ? t.length - e : 0,
                o.maskDigitPosMap = {},
                e = 0; e < a.length; e++)
                    o.maskDigitPosMap[a[e] + t] = 1
            },
            callbacks: function(t) {
                var r = o.val()
                  , s = r !== i
                  , l = [r, t, a, n]
                  , c = function(t, a, e) {
                    "function" == typeof n[t] && a && n[t].apply(this, e)
                };
                c("onChange", !0 === s, l),
                c("onKeyPress", !0 === s, l),
                c("onComplete", r.length === e.length, l),
                c("onInvalid", 0 < o.invalid.length, [r, t, a, o.invalid, n])
            }
        };
        a = t(a);
        var r, s = this, i = o.val();
        e = "function" == typeof e ? e(o.val(), void 0, a, n) : e,
        s.mask = e,
        s.options = n,
        s.remove = function() {
            var t = o.getCaret();
            return s.options.placeholder && a.removeAttr("placeholder"),
            a.data("mask-maxlength") && a.removeAttr("maxlength"),
            o.destroyEvents(),
            o.val(s.getCleanVal()),
            o.setCaret(t),
            a
        }
        ,
        s.getCleanVal = function() {
            return o.getMasked(!0)
        }
        ,
        s.getMaskedVal = function(t) {
            return o.getMasked(!1, t)
        }
        ,
        s.init = function(i) {
            if (i = i || !1,
            n = n || {},
            s.clearIfNotMatch = t.jMaskGlobals.clearIfNotMatch,
            s.byPassKeys = t.jMaskGlobals.byPassKeys,
            s.translation = t.extend({}, t.jMaskGlobals.translation, n.translation),
            s = t.extend(!0, {}, s, n),
            r = o.getRegexMask(),
            i)
                o.events(),
                o.val(o.getMasked());
            else {
                n.placeholder && a.attr("placeholder", n.placeholder),
                a.data("mask") && a.attr("autocomplete", "off"),
                i = 0;
                for (var l = !0; i < e.length; i++) {
                    var c = s.translation[e.charAt(i)];
                    if (c && c.recursive) {
                        l = !1;
                        break
                    }
                }
                l && a.attr("maxlength", e.length).data("mask-maxlength", !0),
                o.destroyEvents(),
                o.events(),
                i = o.getCaret(),
                o.val(o.getMasked()),
                o.setCaret(i)
            }
        }
        ,
        s.init(!a.is("input"))
    };
    t.maskWatchers = {};
    var e = function() {
        var e = t(this)
          , o = {}
          , r = e.attr("data-mask");
        if (e.attr("data-mask-reverse") && (o.reverse = !0),
        e.attr("data-mask-clearifnotmatch") && (o.clearIfNotMatch = !0),
        "true" === e.attr("data-mask-selectonfocus") && (o.selectOnFocus = !0),
        n(e, r, o))
            return e.data("mask", new a(this,r,o))
    }
      , n = function(a, e, n) {
        n = n || {};
        var o = t(a).data("mask")
          , r = JSON.stringify;
        a = t(a).val() || t(a).text();
        try {
            return "function" == typeof e && (e = e(a)),
            "object" !== _typeof(o) || r(o.options) !== r(n) || o.mask !== e
        } catch (t) {}
    }
      , o = function(t) {
        var a = document.createElement("div")
          , e = (t = "on" + t)in a;
        return e || (a.setAttribute(t, "return;"),
        e = "function" == typeof a[t]),
        e
    };
    t.fn.mask = function(e, o) {
        o = o || {};
        var r = this.selector
          , s = t.jMaskGlobals
          , i = s.watchInterval;
        s = o.watchInputs || s.watchInputs;
        var l = function() {
            if (n(this, e, o))
                return t(this).data("mask", new a(this,e,o))
        };
        return t(this).each(l),
        r && "" !== r && s && (clearInterval(t.maskWatchers[r]),
        t.maskWatchers[r] = setInterval((function() {
            t(document).find(r).each(l)
        }
        ), i)),
        this
    }
    ,
    t.fn.masked = function(t) {
        return this.data("mask").getMaskedVal(t)
    }
    ,
    t.fn.unmask = function() {
        return clearInterval(t.maskWatchers[this.selector]),
        delete t.maskWatchers[this.selector],
        this.each((function() {
            var a = t(this).data("mask");
            a && a.remove().removeData("mask")
        }
        ))
    }
    ,
    t.fn.cleanVal = function() {
        return this.data("mask").getCleanVal()
    }
    ,
    t.applyDataMask = function(a) {
        ((a = a || t.jMaskGlobals.maskElements)instanceof t ? a : t(a)).filter(t.jMaskGlobals.dataMaskAttr).each(e)
    }
    ,
    o = {
        maskElements: "input,td,span,div",
        dataMaskAttr: "*[data-mask]",
        dataMask: !0,
        watchInterval: 300,
        watchInputs: !0,
        keyStrokeCompensation: 10,
        useInput: !/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent) && o("input"),
        watchDataMask: !1,
        byPassKeys: [9, 16, 17, 18, 36, 37, 38, 39, 40, 91],
        translation: {
            0: {
                pattern: /\d/
            },
            9: {
                pattern: /\d/,
                optional: !0
            },
            "#": {
                pattern: /\d/,
                recursive: !0
            },
            A: {
                pattern: /[a-zA-Z0-9]/
            },
            S: {
                pattern: /[a-zA-Z]/
            }
        }
    },
    t.jMaskGlobals = t.jMaskGlobals || {},
    (o = t.jMaskGlobals = t.extend(!0, {}, o, t.jMaskGlobals)).dataMask && t.applyDataMask(),
    setInterval((function() {
        t.jMaskGlobals.watchDataMask && t.applyDataMask()
    }
    ), o.watchInterval)
}
), window.jQuery, window.Zepto);
!function(t) {
    var o = 1;
    t.fn.dropShadow = function(s) {
        var a = t.extend({
            left: 4,
            top: 4,
            blur: 2,
            opacity: .5,
            color: "black",
            swap: !1
        }, s)
          , i = t([]);
        return this.not(".dropShadow").each((function() {
            var e, r = t(this), d = [], n = a.blur <= 0 ? 0 : a.blur, c = 0 == n ? a.opacity : a.opacity / (8 * n), h = a.swap ? o : o + 1, p = a.swap ? o + 1 : o;
            e = this.id ? this.id + "_dropShadow" : "ds" + (1 + Math.floor(9999 * Math.random())),
            t.data(this, "shadowId", e),
            t.data(this, "shadowOptions", s),
            r.attr("shadowId", e).css("zIndex", h),
            "absolute" != r.css("position") && r.css({
                position: "relative",
                zoom: 1
            }),
            bgColor = r.css("backgroundColor"),
            "rgba(0, 0, 0, 0)" == bgColor && (bgColor = "transparent"),
            "transparent" != bgColor || "none" != r.css("backgroundImage") || "SELECT" == this.nodeName || "INPUT" == this.nodeName || "TEXTAREA" == this.nodeName ? d[0] = t("<div></div>").css("background", a.color) : d[0] = r.clone().removeAttr("id").removeAttr("name").removeAttr("shadowId").css("color", a.color),
            d[0].addClass("dropShadow").css({
                height: r.outerHeight(),
                left: n,
                opacity: c,
                position: "absolute",
                top: n,
                width: r.outerWidth(),
                zIndex: p
            });
            var l = 8 * n + 1;
            for (f = 1; f < l; f++)
                d[f] = d[0].clone();
            for (var f = 1, u = n; u > 0; )
                d[f].css({
                    left: 2 * u,
                    top: 0
                }),
                d[f + 1].css({
                    left: 4 * u,
                    top: 2 * u
                }),
                d[f + 2].css({
                    left: 2 * u,
                    top: 4 * u
                }),
                d[f + 3].css({
                    left: 0,
                    top: 2 * u
                }),
                d[f + 4].css({
                    left: 3 * u,
                    top: u
                }),
                d[f + 5].css({
                    left: 3 * u,
                    top: 3 * u
                }),
                d[f + 6].css({
                    left: u,
                    top: 3 * u
                }),
                d[f + 7].css({
                    left: u,
                    top: u
                }),
                f += 8,
                u--;
            var w = t("<div></div>").attr("id", e).addClass("dropShadow").css({
                left: r.position().left + a.left - n,
                marginTop: r.css("marginTop"),
                marginRight: r.css("marginRight"),
                marginBottom: r.css("marginBottom"),
                marginLeft: r.css("marginLeft"),
                position: "absolute",
                top: r.position().top + a.top - n,
                zIndex: p
            });
            for (f = 0; f < l; f++)
                w.append(d[f]);
            r.after(w),
            i = i.add(w),
            t(window).resize((function() {
                try {
                    w.css({
                        left: r.position().left + a.left - n,
                        top: r.position().top + a.top - n
                    })
                } catch (t) {}
            }
            )),
            o += 2
        }
        )),
        this.pushStack(i)
    }
    ,
    t.fn.redrawShadow = function() {
        return this.removeShadow(),
        this.each((function() {
            var o = t.data(this, "shadowOptions");
            t(this).dropShadow(o)
        }
        ))
    }
    ,
    t.fn.removeShadow = function() {
        return this.each((function() {
            var o = t(this).shadowId();
            t("div#" + o).remove()
        }
        ))
    }
    ,
    t.fn.shadowId = function() {
        return t.data(this[0], "shadowId")
    }
    ,
    t((function() {
        t("head").append("<style type='text/css' media='print'>.dropShadow{visibility:hidden;}</style>")
    }
    ))
}(jQuery);
!function(t) {
    function e(i) {
        if (isset(i.data.il) && 0 != i.data.il.length) {
            var s = new Image;
            t(s).bind("load", {
                il: i.data.il.slice(1),
                cb: i.data.cb,
                o: i.data.o
            }, e).error((function() {
                log("Can't load image from " + t(this).attr("src"), 2)
            }
            )).attr({
                src: i.data.il[0]
            })
        } else
            i.data.cb(i.data.o)
    }
    t.fn.extend({
        absCenter: function() {
            return t(this).css({
                left: Math.round(document.body.scrollLeft + t(window).width() / 2 - t(this).width() / 2),
                top: Math.round(document.body.scrollTop + t(window).height() / 2 - t(this).height() / 2)
            })
        },
        listImgs: function() {
            var e = []
              , i = t(this).css("background-image");
            return "none" != i && (e[e.length] = i.substr(4, i.length - 5)),
            t(this).children((function(s) {
                "none" != (i = t(this).css("background-image")) && (e[e.length] = i.substr(4, i.length - 5))
            }
            )),
            t(this).children("img").each((function(s) {
                "" != (i = t(this).attr("src")) && (e[e.length] = i)
            }
            )),
            e
        },
        preload: function() {
            return t("#imgload").show(),
            e({
                data: {
                    il: t(this).listImgs(),
                    o: this,
                    cb: function(e) {
                        t(e).dequeue()
                    }
                }
            }),
            t(this).queue((function() {
                t("#imgload").hide()
            }
            ))
        },
        insertAtCaret: function(t) {
            if (document.selection)
                this.focus(),
                sel = document.selection.createRange(),
                sel.text = t,
                this.focus();
            else if (this.selectionStart || "0" == this.selectionStart) {
                var e = this.selectionStart
                  , i = this.selectionEnd
                  , s = this.scrollTop;
                this.value = this.value.substring(0, e) + t + this.value.substring(i, this.value.length),
                this.focus(),
                this.selectionStart = e + t.length,
                this.selectionEnd = e + t.length,
                this.scrollTop = s
            } else
                this.value += t,
                this.focus()
        },
        caret: function(e, i) {
            if (0 != this.length) {
                if ("number" == typeof e)
                    return -1 == e && (e = t(this).val().length),
                    i = "number" == typeof i ? i : e,
                    this.each((function() {
                        if (this.setSelectionRange)
                            this.focus(),
                            this.setSelectionRange(e, i);
                        else if (this.createTextRange) {
                            var t = this.createTextRange();
                            t.collapse(!0),
                            t.moveEnd("character", i),
                            t.moveStart("character", e),
                            t.select()
                        }
                    }
                    ));
                if (this[0].setSelectionRange)
                    e = this[0].selectionStart,
                    i = this[0].selectionEnd;
                else if (document.selection && document.selection.createRange) {
                    var s = document.selection.createRange();
                    e = 0 - s.duplicate().moveStart("character", -1e5),
                    i = e + s.text.length
                }
                return {
                    begin: e,
                    end: i
                }
            }
        },
        helperDiv: function(e) {
            isset(e) || (e = {});
            t(this).position();
            var i = t(this).parent()
              , s = parseInt(t(this).css("zIndex"))
              , n = 0;
            e.cointaner && (i = e.cointaner),
            e.oversize && (n = e.oversize);
            var o = {};
            e.css && (o = e.css),
            o.display = "none",
            o.position = "absolute",
            o.top = parseInt(t(this).css("top")) - n,
            o.left = parseInt(t(this).css("left")) - n,
            o.width = t(this).width() + 2 * n,
            o.height = t(this).height() + 2 * n,
            s && !o.zIndex && (o.zIndex = s);
            var a = "";
            return e.id && (a = " id=" + e.id),
            t("<div" + a + "></div>").css(o).prependTo(i)
        },
        log: function(t) {
            return console.log("%s: %o", t, this),
            this
        }
    })
}(jQuery);
!function(e) {
    var t = navigator.userAgent.toLowerCase().indexOf("firefox") > -1;
    e.event.special.mousewheel = {
        setup: function() {
            var n = e.event.special.mousewheel.handler;
            this.addEventListener ? this.addEventListener(t ? "DOMMouseScroll" : "mousewheel", n, !1) : this.onmousewheel = n
        },
        teardown: function() {
            var n = e.event.special.mousewheel.handler;
            e(this).unbind("mousemove.mousewheel"),
            this.removeEventListener ? this.removeEventListener(t ? "DOMMouseScroll" : "mousewheel", n, !1) : this.onmousewheel = function() {}
            ,
            e.removeData(this, "mwcursorposdata")
        },
        handler: function(t) {
            var n = Array.prototype.slice.call(arguments, 1);
            t = window.event,
            e.extend(t, e.data(this, "mwcursorposdata") || {});
            var s = 0;
            return t.wheelDelta && (s = t.wheelDelta / 120),
            t.detail && (s = -t.detail / 3),
            t.data = t.data || {},
            t.type = "mousewheel",
            n.unshift(s),
            n.unshift(t),
            e.event.dispatch.apply(this, n)
        }
    },
    e.fn.extend({
        mousewheel: function(e) {
            return e ? this.bind("mousewheel", e) : this.trigger("mousewheel")
        },
        unmousewheel: function(e) {
            return this.unbind("mousewheel", e)
        }
    })
}(jQuery);
!function(t) {
    var n = function() {}
      , i = function(i) {
        var a = i.data
          , e = a.evt || i;
        if (n.call(this, e),
        2 == e.button && a && t.isFunction(a.callback)) {
            var c = a.callback.call(this, e);
            return "boolean" == typeof c && c
        }
        return !0
    }
      , a = function(a) {
        var e = a.data;
        e && t.isFunction(e.callback) && 2 == a.button && (e.evt = a,
        t(this).bind("mouseup", e, i).bind("mouseleave", n))
    };
    n = function() {
        var a = t(this);
        a.unbind("mouseup", i),
        a.unbind("mouseleave", n)
    }
    ;
    var e = function(n) {
        var i, a = t(this).data("no_right_click_condition");
        return t.isFunction(a) && (i = a.call(this, n)),
        "boolean" == typeof i && i
    };
    t.fn.disableContextMenu = function(n) {
        return t(this).each((function() {
            var i = t(this);
            i.data("stop_right_click_enabled") || (i.data("stop_right_click_enabled", !0),
            i.data("no_right_click_condition", n),
            this.oncontextmenu = e)
        }
        )),
        this
    }
    ,
    t.fn.enableContextMenu = function() {
        return t(this).each((function() {
            var n = t(this);
            n.data("stop_right_click_enabled") && (n.removeData("stop_right_click_enabled"),
            n.removeData("no_right_click_condition"),
            this.oncontextmenu = void 0)
        }
        )),
        this
    }
    ,
    t.fn.rightClick = function(n, i) {
        return n && t.isFunction(n) ? (t(this).each((function() {
            var n = t(this);
            n.data("right_click_enabled") || (e = e ? e.add(n) : n)
        }
        )),
        e && 0 !== e.length ? (e.bind("mousedown", {
            callback: n
        }, a),
        e.disableContextMenu(i),
        e.data("right_click_enabled", !0),
        e) : this) : this;
        var e
    }
    ,
    t.fn.removeRightClick = function() {
        return t(this).each((function() {
            var i = t(this);
            i.data("right_click_enabled") && (i.unbind("mousedown", a),
            i.removeData("right_click_enabled"),
            n.call(i),
            i.enableContextMenu())
        }
        )),
        this
    }
}(jQuery);
!function(e) {
    function t(e, r) {
        var o;
        r = r || {},
        this._id = t._generateUUID(),
        this._promise = r.promise || Promise,
        this._frameId = r.frameId || "CrossStorageClient-" + this._id,
        this._origin = t._getOrigin(e),
        this._requests = {},
        this._connected = !1,
        this._closed = !1,
        this._count = 0,
        this._timeout = r.timeout || 5e3,
        this._listener = null,
        this._installListener(),
        r.frameId && (o = document.getElementById(r.frameId)),
        o && this._poll(),
        o = o || this._createFrame(e),
        this._hub = o.contentWindow
    }
    t.frameStyle = {
        display: "none",
        position: "absolute",
        top: "-999px",
        left: "-999px"
    },
    t._getOrigin = function(e) {
        var t;
        return (t = document.createElement("a")).href = e,
        t.host || (t = window.location),
        ((t.protocol && ":" !== t.protocol ? t.protocol : window.location.protocol) + "//" + t.host).replace(/:80$|:443$/, "")
    }
    ,
    t._generateUUID = function() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function(e) {
            var t = 16 * Math.random() | 0;
            return ("x" == e ? t : 3 & t | 8).toString(16)
        }
        ))
    }
    ,
    t.prototype.onConnect = function() {
        var e = this;
        return this._connected ? this._promise.resolve() : this._closed ? this._promise.reject(new Error("CrossStorageClient has closed")) : (this._requests.connect || (this._requests.connect = []),
        new this._promise((function(t, r) {
            var o = setTimeout((function() {
                r(new Error("CrossStorageClient could not connect"))
            }
            ), e._timeout);
            e._requests.connect.push((function(e) {
                return clearTimeout(o),
                e ? r(e) : void t()
            }
            ))
        }
        )))
    }
    ,
    t.prototype.set = function(e, t) {
        return this._request("set", {
            key: e,
            value: t
        })
    }
    ,
    t.prototype.get = function() {
        var e = Array.prototype.slice.call(arguments);
        return this._request("get", {
            keys: e
        })
    }
    ,
    t.prototype.del = function() {
        var e = Array.prototype.slice.call(arguments);
        return this._request("del", {
            keys: e
        })
    }
    ,
    t.prototype.clear = function() {
        return this._request("clear")
    }
    ,
    t.prototype.getKeys = function() {
        return this._request("getKeys")
    }
    ,
    t.prototype.close = function() {
        var e = document.getElementById(this._frameId);
        e && e.parentNode.removeChild(e),
        window.removeEventListener ? window.removeEventListener("message", this._listener, !1) : window.detachEvent("onmessage", this._listener),
        this._connected = !1,
        this._closed = !0
    }
    ,
    t.prototype._installListener = function() {
        var e = this;
        this._listener = function(t) {
            var r, o, n;
            if (!e._closed && t.data && "string" == typeof t.data && ("null" === t.origin ? "file://" : t.origin) === e._origin)
                if ("cross-storage:unavailable" !== t.data) {
                    if (-1 !== t.data.indexOf("cross-storage:") && !e._connected) {
                        if (e._connected = !0,
                        !e._requests.connect)
                            return;
                        for (r = 0; r < e._requests.connect.length; r++)
                            e._requests.connect[r](o);
                        delete e._requests.connect
                    }
                    if ("cross-storage:ready" !== t.data) {
                        try {
                            n = JSON.parse(t.data)
                        } catch (e) {
                            return
                        }
                        n.id && e._requests[n.id] && e._requests[n.id](n.error, n.result)
                    }
                } else {
                    if (e._closed || e.close(),
                    !e._requests.connect)
                        return;
                    for (o = new Error("Closing client. Could not access localStorage in hub."),
                    r = 0; r < e._requests.connect.length; r++)
                        e._requests.connect[r](o)
                }
        }
        ,
        window.addEventListener ? window.addEventListener("message", this._listener, !1) : window.attachEvent("onmessage", this._listener)
    }
    ,
    t.prototype._poll = function() {
        var e, t, r;
        r = "file://" === (e = this)._origin ? "*" : e._origin,
        t = setInterval((function() {
            return e._connected ? clearInterval(t) : void (e._hub && e._hub.postMessage("cross-storage:poll", r))
        }
        ), 1e3)
    }
    ,
    t.prototype._createFrame = function(e) {
        var r, o;
        for (o in (r = window.document.createElement("iframe")).id = this._frameId,
        t.frameStyle)
            t.frameStyle.hasOwnProperty(o) && (r.style[o] = t.frameStyle[o]);
        return window.document.body.appendChild(r),
        r.src = e,
        r
    }
    ,
    t.prototype._request = function(e, t) {
        var r, o;
        return this._closed ? this._promise.reject(new Error("CrossStorageClient has closed")) : ((o = this)._count++,
        r = {
            id: this._id + ":" + o._count,
            method: "cross-storage:" + e,
            params: t
        },
        new this._promise((function(e, t) {
            var n, s, i;
            n = setTimeout((function() {
                o._requests[r.id] && (delete o._requests[r.id],
                t(new Error("Timeout: could not perform " + r.method)))
            }
            ), o._timeout),
            o._requests[r.id] = function(s, i) {
                return clearTimeout(n),
                delete o._requests[r.id],
                s ? t(new Error(s)) : void e(i)
            }
            ,
            Array.prototype.toJSON && (s = Array.prototype.toJSON,
            Array.prototype.toJSON = null),
            i = "file://" === o._origin ? "*" : o._origin,
            o._hub.postMessage(JSON.stringify(r), i),
            s && (Array.prototype.toJSON = s)
        }
        )))
    }
    ,
    "undefined" != typeof module && module.exports ? module.exports = t : "undefined" != typeof exports ? exports.CrossStorageClient = t : "function" == typeof define && define.amd ? define([], (function() {
        return t
    }
    )) : e.CrossStorageClient = t
}(this);
function _typeof(n) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(n) {
        return typeof n
    }
    : function(n) {
        return n && "function" == typeof Symbol && n.constructor === Symbol && n !== Symbol.prototype ? "symbol" : typeof n
    }
    ,
    _typeof(n)
}
!function() {
    "use strict";
    var n = "function" == typeof Symbol && "symbol" == _typeof(Symbol.iterator) ? function(n) {
        return _typeof(n)
    }
    : function(n) {
        return n && "function" == typeof Symbol && n.constructor === Symbol && n !== Symbol.prototype ? "symbol" : _typeof(n)
    }
    ;
    !function(e) {
        function t(n, e) {
            var t = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}
              , a = Object.create(n.prototype);
            for (var o in t)
                a[o] = t[o];
            return a.constructor = e,
            e.prototype = a,
            e
        }
        function a(n) {
            n = n || {},
            this.defaultProtocol = n.hasOwnProperty("defaultProtocol") ? n.defaultProtocol : c.defaultProtocol,
            this.events = n.hasOwnProperty("events") ? n.events : c.events,
            this.format = n.hasOwnProperty("format") ? n.format : c.format,
            this.formatHref = n.hasOwnProperty("formatHref") ? n.formatHref : c.formatHref,
            this.nl2br = n.hasOwnProperty("nl2br") ? n.nl2br : c.nl2br,
            this.tagName = n.hasOwnProperty("tagName") ? n.tagName : c.tagName,
            this.target = n.hasOwnProperty("target") ? n.target : c.target,
            this.validate = n.hasOwnProperty("validate") ? n.validate : c.validate,
            this.ignoreTags = [],
            this.attributes = n.attributes || n.linkAttributes || c.attributes,
            this.className = n.hasOwnProperty("className") ? n.className : n.linkClass || c.className;
            for (var e = n.hasOwnProperty("ignoreTags") ? n.ignoreTags : c.ignoreTags, t = 0; t < e.length; t++)
                this.ignoreTags.push(e[t].toUpperCase())
        }
        function o(n) {
            return n
        }
        function r(n, e, t, a) {
            for (var o = 0, r = n.length, i = e, s = [], c = void 0; o < r && (c = i.next(n[o])); )
                i = c,
                o++;
            if (o >= r)
                return [];
            for (; o < r - 1; )
                c = new g(a),
                s.push(c),
                i.on(n[o], c),
                i = c,
                o++;
            return c = new g(t),
            s.push(c),
            i.on(n[r - 1], c),
            s
        }
        function i(n) {
            return t(p, (function(n) {
                n && (this.v = n)
            }
            ), n ? {
                v: n
            } : {})
        }
        function s(n) {
            return n instanceof b || n instanceof A
        }
        var c = {
            defaultProtocol: "http",
            events: null,
            format: o,
            formatHref: o,
            nl2br: !1,
            tagName: "a",
            target: function(n, e) {
                return "url" === e ? "_blank" : null
            },
            validate: !0,
            ignoreTags: [],
            attributes: null,
            className: "linkified"
        };
        a.prototype = {
            resolve: function(n) {
                var e = n.toHref(this.defaultProtocol);
                return {
                    formatted: this.get("format", n.toString(), n),
                    formattedHref: this.get("formatHref", e, n),
                    tagName: this.get("tagName", e, n),
                    className: this.get("className", e, n),
                    target: this.get("target", e, n),
                    events: this.getObject("events", e, n),
                    attributes: this.getObject("attributes", e, n)
                }
            },
            check: function(n) {
                return this.get("validate", n.toString(), n)
            },
            get: function(e, t, a) {
                var o = void 0
                  , r = this[e];
                if (!r)
                    return r;
                switch (void 0 === r ? "undefined" : n(r)) {
                case "function":
                    return r(t, a.type);
                case "object":
                    return "function" == typeof (o = r.hasOwnProperty(a.type) ? r[a.type] : c[e]) ? o(t, a.type) : o
                }
                return r
            },
            getObject: function(n, e, t) {
                var a = this[n];
                return "function" == typeof a ? a(e, t.type) : a
            }
        };
        var l = Object.freeze({
            defaults: c,
            Options: a,
            contains: function(n, e) {
                for (var t = 0; t < n.length; t++)
                    if (n[t] === e)
                        return !0;
                return !1
            }
        })
          , u = function(n) {
            this.j = [],
            this.T = n || null
        };
        u.prototype = {
            defaultTransition: !1,
            on: function(n, e) {
                if (n instanceof Array) {
                    for (var t = 0; t < n.length; t++)
                        this.j.push([n[t], e]);
                    return this
                }
                return this.j.push([n, e]),
                this
            },
            next: function(n) {
                for (var e = 0; e < this.j.length; e++) {
                    var t = this.j[e]
                      , a = t[0]
                      , o = t[1];
                    if (this.test(n, a))
                        return o
                }
                return this.defaultTransition
            },
            accepts: function() {
                return !!this.T
            },
            test: function(n, e) {
                return n === e
            },
            emit: function() {
                return this.T
            }
        };
        var g = t(u, (function(n) {
            this.j = [],
            this.T = n || null
        }
        ), {
            test: function(n, e) {
                return n === e || e instanceof RegExp && e.test(n)
            }
        })
          , h = t(u, (function(n) {
            this.j = [],
            this.T = n || null
        }
        ), {
            jump: function(n) {
                var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null
                  , t = this.next(new n(""));
                return t === this.defaultTransition ? (t = new this.constructor(e),
                this.on(n, t)) : e && (t.T = e),
                t
            },
            test: function(n, e) {
                return n instanceof e
            }
        })
          , p = function(n) {
            n && (this.v = n)
        };
        p.prototype = {
            toString: function() {
                return this.v + ""
            }
        };
        var b = i()
          , f = i("@")
          , m = i(":")
          , d = i(".")
          , x = i()
          , y = i()
          , v = i("\n")
          , k = i()
          , w = i("+")
          , j = i("#")
          , z = i()
          , O = i("mailto:")
          , q = i("?")
          , S = i("/")
          , N = i("_")
          , T = i()
          , A = i()
          , L = i()
          , P = i("{")
          , E = i("[")
          , C = i("<")
          , R = i("(")
          , H = i("}")
          , U = i("]")
          , _ = i(">")
          , B = i(")")
          , M = i("&")
          , D = Object.freeze({
            Base: p,
            DOMAIN: b,
            AT: f,
            COLON: m,
            DOT: d,
            PUNCTUATION: x,
            LOCALHOST: y,
            NL: v,
            NUM: k,
            PLUS: w,
            POUND: j,
            QUERY: q,
            PROTOCOL: z,
            MAILTO: O,
            SLASH: S,
            UNDERSCORE: N,
            SYM: T,
            TLD: A,
            WS: L,
            OPENBRACE: P,
            OPENBRACKET: E,
            OPENANGLEBRACKET: C,
            OPENPAREN: R,
            CLOSEBRACE: H,
            CLOSEBRACKET: U,
            CLOSEANGLEBRACKET: _,
            CLOSEPAREN: B,
            AMPERSAND: M
        })
          , I = "aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|")
          , K = "0123456789".split("")
          , G = "0123456789abcdefghijklmnopqrstuvwxyz".split("")
          , Y = [" ", "\f", "\r", "\t", "\v", "Â ", "á", "á "]
          , Q = []
          , W = function(n) {
            return new g(n)
        }
          , X = W()
          , Z = W(k)
          , F = W(b)
          , J = W()
          , V = W(L);
        X.on("@", W(f)).on(".", W(d)).on("+", W(w)).on("#", W(j)).on("?", W(q)).on("/", W(S)).on("_", W(N)).on(":", W(m)).on("{", W(P)).on("[", W(E)).on("<", W(C)).on("(", W(R)).on("}", W(H)).on("]", W(U)).on(">", W(_)).on(")", W(B)).on("&", W(M)).on([",", ";", "!", '"', "'"], W(x)),
        X.on("\n", W(v)).on(Y, V),
        V.on(Y, V);
        for (var $ = 0; $ < I.length; $++) {
            var nn = r(I[$], X, A, b);
            Q.push.apply(Q, nn)
        }
        var en = r("file", X, b, b)
          , tn = r("ftp", X, b, b)
          , an = r("http", X, b, b)
          , on = r("mailto", X, b, b);
        Q.push.apply(Q, en),
        Q.push.apply(Q, tn),
        Q.push.apply(Q, an),
        Q.push.apply(Q, on);
        var rn = en.pop()
          , sn = tn.pop()
          , cn = an.pop()
          , ln = on.pop()
          , un = W(b)
          , gn = W(z)
          , hn = W(O);
        sn.on("s", un).on(":", gn),
        cn.on("s", un).on(":", gn),
        Q.push(un),
        rn.on(":", gn),
        un.on(":", gn),
        ln.on(":", hn);
        var pn = r("localhost", X, y, b);
        Q.push.apply(Q, pn),
        X.on(K, Z),
        Z.on("-", J).on(K, Z).on(G, F),
        F.on("-", J).on(G, F);
        for (var bn = 0; bn < Q.length; bn++)
            Q[bn].on("-", J).on(G, F);
        J.on("-", J).on(K, F).on(G, F),
        X.defaultTransition = W(T);
        var fn = function(n) {
            for (var e = n.replace(/[A-Z]/g, (function(n) {
                return n.toLowerCase()
            }
            )), t = n.length, a = [], o = 0; o < t; ) {
                for (var r = X, i = null, s = 0, c = null, l = -1; o < t && (i = r.next(e[o])); )
                    (r = i).accepts() ? (l = 0,
                    c = r) : l >= 0 && l++,
                    s++,
                    o++;
                if (!(l < 0)) {
                    o -= l,
                    s -= l;
                    var u = c.emit();
                    a.push(new u(n.substr(o - s, s)))
                }
            }
            return a
        }
          , mn = X
          , dn = Object.freeze({
            State: g,
            TOKENS: D,
            run: fn,
            start: mn
        })
          , xn = function(n) {
            n && (this.v = n)
        };
        xn.prototype = {
            type: "token",
            isLink: !1,
            toString: function() {
                for (var n = [], e = 0; e < this.v.length; e++)
                    n.push(this.v[e].toString());
                return n.join("")
            },
            toHref: function() {
                return this.toString()
            },
            toObject: function() {
                var n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "http";
                return {
                    type: this.type,
                    value: this.toString(),
                    href: this.toHref(n)
                }
            }
        };
        var yn = t(xn, (function(n) {
            n && (this.v = n)
        }
        ), {
            type: "email",
            isLink: !0
        })
          , vn = t(xn, (function(n) {
            n && (this.v = n)
        }
        ), {
            type: "email",
            isLink: !0,
            toHref: function() {
                return "mailto:" + this.toString()
            }
        })
          , kn = t(xn, (function(n) {
            n && (this.v = n)
        }
        ), {
            type: "text"
        })
          , wn = t(xn, (function(n) {
            n && (this.v = n)
        }
        ), {
            type: "nl"
        })
          , jn = t(xn, (function(n) {
            n && (this.v = n)
        }
        ), {
            type: "url",
            isLink: !0,
            toHref: function() {
                for (var n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "http", e = !1, t = !1, a = this.v, o = [], r = 0; a[r]instanceof z; )
                    e = !0,
                    o.push(a[r].toString().toLowerCase()),
                    r++;
                for (; a[r]instanceof S; )
                    t = !0,
                    o.push(a[r].toString()),
                    r++;
                for (; s(a[r]); )
                    o.push(a[r].toString().toLowerCase()),
                    r++;
                for (; r < a.length; r++)
                    o.push(a[r].toString());
                return o = o.join(""),
                e || t || (o = n + "://" + o),
                o
            },
            hasProtocol: function() {
                return this.v[0]instanceof z
            }
        })
          , zn = Object.freeze({
            Base: xn,
            MAILTOEMAIL: yn,
            EMAIL: vn,
            NL: wn,
            TEXT: kn,
            URL: jn
        })
          , On = function(n) {
            return new h(n)
        }
          , qn = On()
          , Sn = On()
          , Nn = On()
          , Tn = On()
          , An = On()
          , Ln = On()
          , Pn = On()
          , En = On(jn)
          , Cn = On()
          , Rn = On(jn)
          , Hn = On(jn)
          , Un = On()
          , _n = On()
          , Bn = On()
          , Mn = On()
          , Dn = On()
          , In = On(jn)
          , Kn = On(jn)
          , Gn = On(jn)
          , Yn = On(jn)
          , Qn = On()
          , Wn = On()
          , Xn = On()
          , Zn = On()
          , Fn = On()
          , Jn = On()
          , Vn = On(vn)
          , $n = On()
          , ne = On(vn)
          , ee = On(yn)
          , te = On()
          , ae = On()
          , oe = On()
          , re = On()
          , ie = On(wn);
        qn.on(v, ie).on(z, Sn).on(O, Nn).on(S, Tn),
        Sn.on(S, Tn),
        Tn.on(S, An),
        qn.on(A, Ln).on(b, Ln).on(y, En).on(k, Ln),
        An.on(A, Hn).on(b, Hn).on(k, Hn).on(y, Hn),
        Ln.on(d, Pn),
        Fn.on(d, Jn),
        Pn.on(A, En).on(b, Ln).on(k, Ln).on(y, Ln),
        Jn.on(A, Vn).on(b, Fn).on(k, Fn).on(y, Fn),
        En.on(d, Pn),
        Vn.on(d, Jn),
        En.on(m, Cn).on(S, Hn),
        Cn.on(k, Rn),
        Rn.on(S, Hn),
        Vn.on(m, $n),
        $n.on(k, ne);
        var se = [b, f, y, k, w, j, z, S, A, N, T, M]
          , ce = [m, d, q, x, H, U, _, B, P, E, C, R];
        Hn.on(P, _n).on(E, Bn).on(C, Mn).on(R, Dn),
        Un.on(P, _n).on(E, Bn).on(C, Mn).on(R, Dn),
        _n.on(H, Hn),
        Bn.on(U, Hn),
        Mn.on(_, Hn),
        Dn.on(B, Hn),
        In.on(H, Hn),
        Kn.on(U, Hn),
        Gn.on(_, Hn),
        Yn.on(B, Hn),
        Qn.on(H, Hn),
        Wn.on(U, Hn),
        Xn.on(_, Hn),
        Zn.on(B, Hn),
        _n.on(se, In),
        Bn.on(se, Kn),
        Mn.on(se, Gn),
        Dn.on(se, Yn),
        _n.on(ce, Qn),
        Bn.on(ce, Wn),
        Mn.on(ce, Xn),
        Dn.on(ce, Zn),
        In.on(se, In),
        Kn.on(se, Kn),
        Gn.on(se, Gn),
        Yn.on(se, Yn),
        In.on(ce, In),
        Kn.on(ce, Kn),
        Gn.on(ce, Gn),
        Yn.on(ce, Yn),
        Qn.on(se, In),
        Wn.on(se, Kn),
        Xn.on(se, Gn),
        Zn.on(se, Yn),
        Qn.on(ce, Qn),
        Wn.on(ce, Wn),
        Xn.on(ce, Xn),
        Zn.on(ce, Zn),
        Hn.on(se, Hn),
        Un.on(se, Hn),
        Hn.on(ce, Un),
        Un.on(ce, Un),
        Nn.on(A, ee).on(b, ee).on(k, ee).on(y, ee),
        ee.on(se, ee).on(ce, te),
        te.on(se, ee).on(ce, te);
        var le = [b, k, w, j, q, N, T, M, A];
        Ln.on(le, ae).on(f, oe),
        En.on(le, ae).on(f, oe),
        Pn.on(le, ae),
        ae.on(le, ae).on(f, oe).on(d, re),
        re.on(le, ae),
        oe.on(A, Fn).on(b, Fn).on(y, Vn);
        var ue = function(n) {
            for (var e = n.length, t = 0, a = [], o = []; t < e; ) {
                for (var r = qn, i = null, s = null, c = 0, l = null, u = -1; t < e && !(i = r.next(n[t])); )
                    o.push(n[t++]);
                for (; t < e && (s = i || r.next(n[t])); )
                    i = null,
                    (r = s).accepts() ? (u = 0,
                    l = r) : u >= 0 && u++,
                    t++,
                    c++;
                if (u < 0)
                    for (var g = t - c; g < t; g++)
                        o.push(n[g]);
                else {
                    o.length > 0 && (a.push(new kn(o)),
                    o = []),
                    t -= u,
                    c -= u;
                    var h = l.emit();
                    a.push(new h(n.slice(t - c, t)))
                }
            }
            return o.length > 0 && a.push(new kn(o)),
            a
        }
          , ge = Object.freeze({
            State: h,
            TOKENS: zn,
            run: ue,
            start: qn
        });
        Array.isArray || (Array.isArray = function(n) {
            return "[object Array]" === Object.prototype.toString.call(n)
        }
        );
        var he = function(n) {
            return ue(fn(n))
        };
        e.find = function(n) {
            for (var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, t = he(n), a = [], o = 0; o < t.length; o++) {
                var r = t[o];
                !r.isLink || e && r.type !== e || a.push(r.toObject())
            }
            return a
        }
        ,
        e.inherits = t,
        e.options = l,
        e.parser = ge,
        e.scanner = dn,
        e.test = function(n) {
            var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null
              , t = he(n);
            return 1 === t.length && t[0].isLink && (!e || t[0].type === e)
        }
        ,
        e.tokenize = he
    }(self.linkify = self.linkify || {})
}();
function setCookie(e, o, n, i, t, c) {
    var u = e + "=" + escape(o) + (n ? "; expires=" + n.toGMTString() : "") + (i ? "; path=" + i : "") + (t ? "; domain=" + t : "") + (c ? "; secure" : "");
    document.cookie = u
}
function getCookie(e) {
    var o = document.cookie
      , n = e + "="
      , i = o.indexOf("; " + n);
    if (-1 == i) {
        if (0 != (i = o.indexOf(n)))
            return null
    } else
        i += 2;
    var t = document.cookie.indexOf(";", i);
    return -1 == t && (t = o.length),
    unescape(o.substring(i + n.length, t))
}
function deleteCookie(e, o, n) {
    getCookie(e) && (document.cookie = e + "=" + (o ? "; path=" + o : "") + (n ? "; domain=" + n : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT")
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
!function(t, e) {
    function n(n, o) {
        function i(t) {
            return dt.preferFlash && ot && !dt.ignoreFlash && dt.flash[t] !== e && dt.flash[t]
        }
        function a(t) {
            return function(e) {
                var n = this._s;
                return n && n._a ? t.call(this, e) : null
            }
        }
        this.setupOptions = {
            url: n || null,
            flashVersion: 8,
            debugMode: !0,
            debugFlash: !1,
            useConsole: !0,
            consoleOnly: !0,
            waitForWindowLoad: !1,
            bgColor: "#ffffff",
            useHighPerformance: !1,
            flashPollingInterval: null,
            html5PollingInterval: null,
            flashLoadTimeout: 1e3,
            wmode: null,
            allowScriptAccess: "always",
            useFlashBlock: !1,
            useHTML5Audio: !0,
            forceUseGlobalHTML5Audio: !1,
            ignoreMobileRestrictions: !1,
            html5Test: /^(probably|maybe)$/i,
            preferFlash: !1,
            noSWFCache: !1,
            idPrefix: "sound"
        },
        this.defaultOptions = {
            autoLoad: !1,
            autoPlay: !1,
            from: null,
            loops: 1,
            onid3: null,
            onerror: null,
            onload: null,
            whileloading: null,
            onplay: null,
            onpause: null,
            onresume: null,
            whileplaying: null,
            onposition: null,
            onstop: null,
            onfinish: null,
            multiShot: !0,
            multiShotEvents: !1,
            position: null,
            pan: 0,
            playbackRate: 1,
            stream: !0,
            to: null,
            type: null,
            usePolicyFile: !1,
            volume: 100
        },
        this.flash9Options = {
            onfailure: null,
            isMovieStar: null,
            usePeakData: !1,
            useWaveformData: !1,
            useEQData: !1,
            onbufferchange: null,
            ondataerror: null
        },
        this.movieStarOptions = {
            bufferTime: 3,
            serverURL: null,
            onconnect: null,
            duration: null
        },
        this.audioFormats = {
            mp3: {
                type: ['audio/mpeg; codecs="mp3"', "audio/mpeg", "audio/mp3", "audio/MPA", "audio/mpa-robust"],
                required: !0
            },
            mp4: {
                related: ["aac", "m4a", "m4b"],
                type: ['audio/mp4; codecs="mp4a.40.2"', "audio/aac", "audio/x-m4a", "audio/MP4A-LATM", "audio/mpeg4-generic"],
                required: !1
            },
            ogg: {
                type: ["audio/ogg; codecs=vorbis"],
                required: !1
            },
            opus: {
                type: ["audio/ogg; codecs=opus", "audio/opus"],
                required: !1
            },
            wav: {
                type: ['audio/wav; codecs="1"', "audio/wav", "audio/wave", "audio/x-wav"],
                required: !1
            },
            flac: {
                type: ["audio/flac"],
                required: !1
            }
        },
        this.movieID = "sm2-container",
        this.id = o || "sm2movie",
        this.debugID = "soundmanager-debug",
        this.debugURLParam = /([#?&])debug=1/i,
        this.versionNumber = "V2.97a.20170601",
        this.altURL = this.movieURL = this.version = null,
        this.enabled = this.swfLoaded = !1,
        this.oMC = null,
        this.sounds = {},
        this.soundIDs = [],
        this.didFlashBlock = this.muted = !1,
        this.filePattern = null,
        this.filePatterns = {
            flash8: /\.mp3(\?.*)?$/i,
            flash9: /\.mp3(\?.*)?$/i
        },
        this.features = {
            buffering: !1,
            peakData: !1,
            waveformData: !1,
            eqData: !1,
            movieStar: !1
        },
        this.sandbox = {},
        this.html5 = {
            usingFlash: null
        },
        this.flash = {},
        this.ignoreFlash = this.html5Only = !1;
        var s, r, u, l, d, f, c, h, p, m, _, y, g, O, v, M, b, T, P, L, w, S, I, A, D, H, F, E, C, k, R, x, N, U, B, q, j, V, Q, W, $, G, K, X, J, Y, Z, z, tt, et, nt, ot, it, at, st, rt, ut, lt, dt = this, ft = null, ct = null, ht = navigator.userAgent, pt = t.location.href.toString(), mt = document, _t = [], yt = !1, gt = !1, Ot = !1, vt = !1, Mt = !1, bt = null, Tt = null, Pt = !1, Lt = !1, wt = 0, St = null, It = [], At = null, Dt = Array.prototype.slice, Ht = !1, Ft = 0, Et = ht.match(/(ipad|iphone|ipod)/i), Ct = ht.match(/android/i), kt = ht.match(/msie|trident/i), Rt = ht.match(/webkit/i), xt = ht.match(/safari/i) && !ht.match(/chrome/i), Nt = ht.match(/opera/i), Ut = ht.match(/(mobile|pre\/|xoom)/i) || Et || Ct, Bt = !pt.match(/usehtml5audio/i) && !pt.match(/sm2-ignorebadua/i) && xt && !ht.match(/silk/i) && ht.match(/OS\sX\s10_6_([3-7])/i), qt = mt.hasFocus !== e ? mt.hasFocus() : null, jt = xt && (mt.hasFocus === e || !mt.hasFocus()), Vt = !jt, Qt = /(mp3|mp4|mpa|m4a|m4b)/i, Wt = mt.location ? mt.location.protocol.match(/http/i) : null, $t = Wt ? "" : "//", Gt = /^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4|m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i, Kt = "mpeg4 aac flv mov mp4 m4v f4v m4a m4b mp4v 3gp 3g2".split(" "), Xt = new RegExp("\\.(" + Kt.join("|") + ")(\\?.*)?$","i");
        this.mimePattern = /^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,
        this.useAltURL = !Wt,
        J = [null, "MEDIA_ERR_ABORTED", "MEDIA_ERR_NETWORK", "MEDIA_ERR_DECODE", "MEDIA_ERR_SRC_NOT_SUPPORTED"];
        try {
            lt = Audio !== e && (Nt && opera !== e && 10 > opera.version() ? new Audio(null) : new Audio).canPlayType !== e
        } catch (t) {
            lt = !1
        }
        this.hasHTML5 = lt,
        this.setup = function(t) {
            var n = !dt.url;
            return t !== e && Ot && At && dt.ok(),
            p(t),
            Ht || (Ut ? dt.setupOptions.ignoreMobileRestrictions && !dt.setupOptions.forceUseGlobalHTML5Audio || (It.push(P.globalHTML5),
            Ht = !0) : dt.setupOptions.forceUseGlobalHTML5Audio && (It.push(P.globalHTML5),
            Ht = !0)),
            !ut && Ut && (dt.setupOptions.ignoreMobileRestrictions ? It.push(P.ignoreMobile) : (dt.setupOptions.useHTML5Audio = !0,
            dt.setupOptions.preferFlash = !1,
            Et ? dt.ignoreFlash = !0 : (Ct && !ht.match(/android\s2\.3/i) || !Ct) && (Ht = !0))),
            t && (n && I && t.url !== e && dt.beginDelayedInit(),
            I || t.url === e || "complete" !== mt.readyState || setTimeout(w, 1)),
            ut = !0,
            dt
        }
        ,
        this.supported = this.ok = function() {
            return At ? Ot && !vt : dt.useHTML5Audio && dt.hasHTML5
        }
        ,
        this.getMovie = function(e) {
            return r(e) || mt[e] || t[e]
        }
        ,
        this.createSound = function(t, n) {
            function o() {
                return i = U(i),
                dt.sounds[i.id] = new s(i),
                dt.soundIDs.push(i.id),
                dt.sounds[i.id]
            }
            var i, a = null;
            if (!Ot || !dt.ok())
                return !1;
            if (n !== e && (t = {
                id: t,
                url: n
            }),
            (i = h(t)).url = W(i.url),
            i.id === e && (i.id = dt.setupOptions.idPrefix + Ft++),
            q(i.id, !0))
                return dt.sounds[i.id];
            if (K(i))
                (a = o())._setup_html5(i);
            else {
                if (dt.html5Only || dt.html5.usingFlash && i.url && i.url.match(/data:/i))
                    return o();
                8 < f && null === i.isMovieStar && (i.isMovieStar = !!(i.serverURL || i.type && i.type.match(Gt) || i.url && i.url.match(Xt))),
                i = B(i, void 0),
                a = o(),
                8 === f ? ct._createSound(i.id, i.loops || 1, i.usePolicyFile) : (ct._createSound(i.id, i.url, i.usePeakData, i.useWaveformData, i.useEQData, i.isMovieStar, !!i.isMovieStar && i.bufferTime, i.loops || 1, i.serverURL, i.duration || null, i.autoPlay, !0, i.autoLoad, i.usePolicyFile),
                i.serverURL || (a.connected = !0,
                i.onconnect && i.onconnect.apply(a))),
                i.serverURL || !i.autoLoad && !i.autoPlay || a.load(i)
            }
            return !i.serverURL && i.autoPlay && a.play(),
            a
        }
        ,
        this.destroySound = function(t, e) {
            if (!q(t))
                return !1;
            var n, o = dt.sounds[t];
            for (o.stop(),
            o._iO = {},
            o.unload(),
            n = 0; n < dt.soundIDs.length; n++)
                if (dt.soundIDs[n] === t) {
                    dt.soundIDs.splice(n, 1);
                    break
                }
            return e || o.destruct(!0),
            delete dt.sounds[t],
            !0
        }
        ,
        this.load = function(t, e) {
            return !!q(t) && dt.sounds[t].load(e)
        }
        ,
        this.unload = function(t) {
            return !!q(t) && dt.sounds[t].unload()
        }
        ,
        this.onposition = this.onPosition = function(t, e, n, o) {
            return !!q(t) && dt.sounds[t].onposition(e, n, o)
        }
        ,
        this.clearOnPosition = function(t, e, n) {
            return !!q(t) && dt.sounds[t].clearOnPosition(e, n)
        }
        ,
        this.start = this.play = function(t, e) {
            var n = null
              , o = e && !(e instanceof Object);
            if (!Ot || !dt.ok())
                return !1;
            if (q(t, o))
                o && (e = {
                    url: e
                });
            else {
                if (!o)
                    return !1;
                o && (e = {
                    url: e
                }),
                e && e.url && (e.id = t,
                n = dt.createSound(e).play())
            }
            return null === n && (n = dt.sounds[t].play(e)),
            n
        }
        ,
        this.setPlaybackRate = function(t, e, n) {
            return !!q(t) && dt.sounds[t].setPlaybackRate(e, n)
        }
        ,
        this.setPosition = function(t, e) {
            return !!q(t) && dt.sounds[t].setPosition(e)
        }
        ,
        this.stop = function(t) {
            return !!q(t) && dt.sounds[t].stop()
        }
        ,
        this.stopAll = function() {
            for (var t in dt.sounds)
                dt.sounds.hasOwnProperty(t) && dt.sounds[t].stop()
        }
        ,
        this.pause = function(t) {
            return !!q(t) && dt.sounds[t].pause()
        }
        ,
        this.pauseAll = function() {
            var t;
            for (t = dt.soundIDs.length - 1; 0 <= t; t--)
                dt.sounds[dt.soundIDs[t]].pause()
        }
        ,
        this.resume = function(t) {
            return !!q(t) && dt.sounds[t].resume()
        }
        ,
        this.resumeAll = function() {
            var t;
            for (t = dt.soundIDs.length - 1; 0 <= t; t--)
                dt.sounds[dt.soundIDs[t]].resume()
        }
        ,
        this.togglePause = function(t) {
            return !!q(t) && dt.sounds[t].togglePause()
        }
        ,
        this.setPan = function(t, e) {
            return !!q(t) && dt.sounds[t].setPan(e)
        }
        ,
        this.setVolume = function(t, n) {
            var o, i;
            if (t !== e && !isNaN(t) && n === e) {
                for (o = 0,
                i = dt.soundIDs.length; o < i; o++)
                    dt.sounds[dt.soundIDs[o]].setVolume(t);
                return !1
            }
            return !!q(t) && dt.sounds[t].setVolume(n)
        }
        ,
        this.mute = function(t) {
            var e = 0;
            if (t instanceof String && (t = null),
            t)
                return !!q(t) && dt.sounds[t].mute();
            for (e = dt.soundIDs.length - 1; 0 <= e; e--)
                dt.sounds[dt.soundIDs[e]].mute();
            return dt.muted = !0
        }
        ,
        this.muteAll = function() {
            dt.mute()
        }
        ,
        this.unmute = function(t) {
            if (t instanceof String && (t = null),
            t)
                return !!q(t) && dt.sounds[t].unmute();
            for (t = dt.soundIDs.length - 1; 0 <= t; t--)
                dt.sounds[dt.soundIDs[t]].unmute();
            return dt.muted = !1,
            !0
        }
        ,
        this.unmuteAll = function() {
            dt.unmute()
        }
        ,
        this.toggleMute = function(t) {
            return !!q(t) && dt.sounds[t].toggleMute()
        }
        ,
        this.getMemoryUse = function() {
            var t = 0;
            return ct && 8 !== f && (t = parseInt(ct._getMemoryUse(), 10)),
            t
        }
        ,
        this.disable = function(n) {
            var o;
            if (n === e && (n = !1),
            vt)
                return !1;
            for (vt = !0,
            o = dt.soundIDs.length - 1; 0 <= o; o--)
                E(dt.sounds[dt.soundIDs[o]]);
            return E(dt),
            c(n),
            et.remove(t, "load", g),
            !0
        }
        ,
        this.canPlayMIME = function(t) {
            var e;
            return dt.hasHTML5 && (e = X({
                type: t
            })),
            !e && At && (e = t && dt.ok() ? !!(8 < f && t.match(Gt) || t.match(dt.mimePattern)) : null),
            e
        }
        ,
        this.canPlayURL = function(t) {
            var e;
            return dt.hasHTML5 && (e = X({
                url: t
            })),
            !e && At && (e = t && dt.ok() ? !!t.match(dt.filePattern) : null),
            e
        }
        ,
        this.canPlayLink = function(t) {
            return !(t.type === e || !t.type || !dt.canPlayMIME(t.type)) || dt.canPlayURL(t.href)
        }
        ,
        this.getSoundById = function(t, e) {
            return t ? dt.sounds[t] : null
        }
        ,
        this.onready = function(e, n) {
            if ("function" != typeof e)
                throw R("needFunction", "onready");
            return n || (n = t),
            _("onready", e, n),
            y(),
            !0
        }
        ,
        this.ontimeout = function(e, n) {
            if ("function" != typeof e)
                throw R("needFunction", "ontimeout");
            return n || (n = t),
            _("ontimeout", e, n),
            y({
                type: "ontimeout"
            }),
            !0
        }
        ,
        this._wD = this._writeDebug = function(t, e) {
            return !0
        }
        ,
        this._debug = function() {}
        ,
        this.reboot = function(e, n) {
            var o, i, a;
            for (o = dt.soundIDs.length - 1; 0 <= o; o--)
                dt.sounds[dt.soundIDs[o]].destruct();
            if (ct)
                try {
                    kt && (Tt = ct.innerHTML),
                    bt = ct.parentNode.removeChild(ct)
                } catch (t) {}
            if (Tt = bt = At = ct = null,
            dt.enabled = I = Ot = Pt = Lt = yt = gt = vt = Ht = dt.swfLoaded = !1,
            dt.soundIDs = [],
            dt.sounds = {},
            Ft = 0,
            ut = !1,
            e)
                _t = [];
            else
                for (o in _t)
                    if (_t.hasOwnProperty(o))
                        for (i = 0,
                        a = _t[o].length; i < a; i++)
                            _t[o][i].fired = !1;
            return dt.html5 = {
                usingFlash: null
            },
            dt.flash = {},
            dt.html5Only = !1,
            dt.ignoreFlash = !1,
            t.setTimeout((function() {
                n || dt.beginDelayedInit()
            }
            ), 20),
            dt
        }
        ,
        this.reset = function() {
            return dt.reboot(!0, !0)
        }
        ,
        this.getMoviePercent = function() {
            return ct && "PercentLoaded"in ct ? ct.PercentLoaded() : null
        }
        ,
        this.beginDelayedInit = function() {
            Mt = !0,
            w(),
            setTimeout((function() {
                return !Lt && (D(),
                L(),
                Lt = !0)
            }
            ), 20),
            O()
        }
        ,
        this.destruct = function() {
            dt.disable(!0)
        }
        ,
        s = function(t) {
            var n, o, i, a, s, r, u, l, d, c, p, m = this, _ = !1, y = [], g = 0, O = null;
            o = n = null,
            this.sID = this.id = t.id,
            this.url = t.url,
            this._iO = this.instanceOptions = this.options = h(t),
            this.pan = this.options.pan,
            this.volume = this.options.volume,
            this.isHTML5 = !1,
            this._a = null,
            p = !this.url,
            this.id3 = {},
            this._debug = function() {}
            ,
            this.load = function(t) {
                var n;
                if (t !== e ? m._iO = h(t, m.options) : (t = m.options,
                m._iO = t,
                O && O !== m.url && (m._iO.url = m.url,
                m.url = null)),
                m._iO.url || (m._iO.url = m.url),
                m._iO.url = W(m._iO.url),
                !(n = m.instanceOptions = m._iO).url && !m.url)
                    return m;
                if (n.url === m.url && 0 !== m.readyState && 2 !== m.readyState)
                    return 3 === m.readyState && n.onload && rt(m, (function() {
                        n.onload.apply(m, [!!m.duration])
                    }
                    )),
                    m;
                if (m.loaded = !1,
                m.readyState = 1,
                m.playState = 0,
                m.id3 = {},
                K(n))
                    m._setup_html5(n)._called_load || (m._html5_canplay = !1,
                    m.url !== n.url && (m._a.src = n.url,
                    m.setPosition(0)),
                    m._a.autobuffer = "auto",
                    m._a.preload = "auto",
                    m._a._called_load = !0);
                else {
                    if (dt.html5Only || m._iO.url && m._iO.url.match(/data:/i))
                        return m;
                    try {
                        m.isHTML5 = !1,
                        m._iO = B(U(n)),
                        m._iO.autoPlay && (m._iO.position || m._iO.from) && (m._iO.autoPlay = !1),
                        n = m._iO,
                        8 === f ? ct._load(m.id, n.url, n.stream, n.autoPlay, n.usePolicyFile) : ct._load(m.id, n.url, !!n.stream, !!n.autoPlay, n.loops || 1, !!n.autoLoad, n.usePolicyFile)
                    } catch (t) {
                        H({
                            type: "SMSOUND_LOAD_JS_EXCEPTION",
                            fatal: !0
                        })
                    }
                }
                return m.url = n.url,
                m
            }
            ,
            this.unload = function() {
                return 0 !== m.readyState && (m.isHTML5 ? (r(),
                m._a && (m._a.pause(),
                O = Z(m._a))) : 8 === f ? ct._unload(m.id, "about:blank") : ct._unload(m.id),
                i()),
                m
            }
            ,
            this.destruct = function(t) {
                m.isHTML5 ? (r(),
                m._a && (m._a.pause(),
                Z(m._a),
                Ht || s(),
                m._a._s = null,
                m._a = null)) : (m._iO.onfailure = null,
                ct._destroySound(m.id)),
                t || dt.destroySound(m.id, !0)
            }
            ,
            this.start = this.play = function(t, n) {
                var o, i, a, s;
                if (o = !0,
                n = n === e || n,
                t || (t = {}),
                m.url && (m._iO.url = m.url),
                m._iO = h(m._iO, m.options),
                m._iO = h(t, m._iO),
                m._iO.url = W(m._iO.url),
                m.instanceOptions = m._iO,
                !m.isHTML5 && m._iO.serverURL && !m.connected)
                    return m.getAutoPlay() || m.setAutoPlay(!0),
                    m;
                if (K(m._iO) && (m._setup_html5(m._iO),
                u()),
                1 === m.playState && !m.paused && !(o = m._iO.multiShot))
                    return m.isHTML5 && m.setPosition(m._iO.position),
                    m;
                if (t.url && t.url !== m.url && (m.readyState || m.isHTML5 || 8 !== f || !p ? m.load(m._iO) : p = !1),
                !m.loaded)
                    if (0 === m.readyState) {
                        if (m.isHTML5 || dt.html5Only) {
                            if (!m.isHTML5)
                                return m;
                            m.load(m._iO)
                        } else
                            m._iO.autoPlay = !0,
                            m.load(m._iO);
                        m.instanceOptions = m._iO
                    } else if (2 === m.readyState)
                        return m;
                return !m.isHTML5 && 9 === f && 0 < m.position && m.position === m.duration && (t.position = 0),
                m.paused && 0 <= m.position && (!m._iO.serverURL || 0 < m.position) ? m.resume() : (m._iO = h(t, m._iO),
                (!m.isHTML5 && null !== m._iO.position && 0 < m._iO.position || null !== m._iO.from && 0 < m._iO.from || null !== m._iO.to) && 0 === m.instanceCount && 0 === m.playState && !m._iO.serverURL && (o = function() {
                    m._iO = h(t, m._iO),
                    m.play(m._iO)
                }
                ,
                m.isHTML5 && !m._html5_canplay ? m.load({
                    _oncanplay: o
                }) : m.isHTML5 || m.loaded || m.readyState && 2 === m.readyState || m.load({
                    onload: o
                }),
                m._iO = c()),
                (!m.instanceCount || m._iO.multiShotEvents || m.isHTML5 && m._iO.multiShot && !Ht || !m.isHTML5 && 8 < f && !m.getAutoPlay()) && m.instanceCount++,
                m._iO.onposition && 0 === m.playState && l(m),
                m.playState = 1,
                m.paused = !1,
                m.position = m._iO.position === e || isNaN(m._iO.position) ? 0 : m._iO.position,
                m.isHTML5 || (m._iO = B(U(m._iO))),
                m._iO.onplay && n && (m._iO.onplay.apply(m),
                _ = !0),
                m.setVolume(m._iO.volume, !0),
                m.setPan(m._iO.pan, !0),
                1 !== m._iO.playbackRate && m.setPlaybackRate(m._iO.playbackRate),
                m.isHTML5 ? 2 > m.instanceCount ? (u(),
                o = m._setup_html5(),
                m.setPosition(m._iO.position),
                o.play()) : (i = new Audio(m._iO.url),
                a = function() {
                    et.remove(i, "ended", a),
                    m._onfinish(m),
                    Z(i),
                    i = null
                }
                ,
                s = function() {
                    et.remove(i, "canplay", s);
                    try {
                        i.currentTime = m._iO.position / 1e3
                    } catch (t) {}
                    i.play()
                }
                ,
                et.add(i, "ended", a),
                m._iO.volume !== e && (i.volume = Math.max(0, Math.min(1, m._iO.volume / 100))),
                m.muted && (i.muted = !0),
                m._iO.position ? et.add(i, "canplay", s) : i.play()) : (o = ct._start(m.id, m._iO.loops || 1, 9 === f ? m.position : m.position / 1e3, m._iO.multiShot || !1),
                9 !== f || o || m._iO.onplayerror && m._iO.onplayerror.apply(m))),
                m
            }
            ,
            this.stop = function(t) {
                var e = m._iO;
                return 1 === m.playState && (m._onbufferchange(0),
                m._resetOnPosition(0),
                m.paused = !1,
                m.isHTML5 || (m.playState = 0),
                d(),
                e.to && m.clearOnPosition(e.to),
                m.isHTML5 ? m._a && (t = m.position,
                m.setPosition(0),
                m.position = t,
                m._a.pause(),
                m.playState = 0,
                m._onTimer(),
                r()) : (ct._stop(m.id, t),
                e.serverURL && m.unload()),
                m.instanceCount = 0,
                m._iO = {},
                e.onstop && e.onstop.apply(m)),
                m
            }
            ,
            this.setAutoPlay = function(t) {
                m._iO.autoPlay = t,
                m.isHTML5 || (ct._setAutoPlay(m.id, t),
                t && (m.instanceCount || 1 !== m.readyState || m.instanceCount++))
            }
            ,
            this.getAutoPlay = function() {
                return m._iO.autoPlay
            }
            ,
            this.setPlaybackRate = function(t) {
                if (t = Math.max(.5, Math.min(4, t)),
                m.isHTML5)
                    try {
                        m._iO.playbackRate = t,
                        m._a.playbackRate = t
                    } catch (t) {}
                return m
            }
            ,
            this.setPosition = function(t) {
                t === e && (t = 0);
                var n = m.isHTML5 ? Math.max(t, 0) : Math.min(m.duration || m._iO.duration, Math.max(t, 0));
                if (m.position = n,
                t = m.position / 1e3,
                m._resetOnPosition(m.position),
                m._iO.position = n,
                m.isHTML5) {
                    if (m._a) {
                        if (m._html5_canplay) {
                            if (m._a.currentTime.toFixed(3) !== t.toFixed(3))
                                try {
                                    m._a.currentTime = t,
                                    (0 === m.playState || m.paused) && m._a.pause()
                                } catch (t) {}
                        } else if (t)
                            return m;
                        m.paused && m._onTimer(!0)
                    }
                } else
                    t = 9 === f ? m.position : t,
                    m.readyState && 2 !== m.readyState && ct._setPosition(m.id, t, m.paused || !m.playState, m._iO.multiShot);
                return m
            }
            ,
            this.pause = function(t) {
                return m.paused || 0 === m.playState && 1 !== m.readyState || (m.paused = !0,
                m.isHTML5 ? (m._setup_html5().pause(),
                r()) : (t || t === e) && ct._pause(m.id, m._iO.multiShot),
                m._iO.onpause && m._iO.onpause.apply(m)),
                m
            }
            ,
            this.resume = function() {
                var t = m._iO;
                return m.paused ? (m.paused = !1,
                m.playState = 1,
                m.isHTML5 ? (m._setup_html5().play(),
                u()) : (t.isMovieStar && !t.serverURL && m.setPosition(m.position),
                ct._pause(m.id, t.multiShot)),
                !_ && t.onplay ? (t.onplay.apply(m),
                _ = !0) : t.onresume && t.onresume.apply(m),
                m) : m
            }
            ,
            this.togglePause = function() {
                return 0 === m.playState ? (m.play({
                    position: 9 !== f || m.isHTML5 ? m.position / 1e3 : m.position
                }),
                m) : (m.paused ? m.resume() : m.pause(),
                m)
            }
            ,
            this.setPan = function(t, n) {
                return t === e && (t = 0),
                n === e && (n = !1),
                m.isHTML5 || ct._setPan(m.id, t),
                m._iO.pan = t,
                n || (m.pan = t,
                m.options.pan = t),
                m
            }
            ,
            this.setVolume = function(t, n) {
                return t === e && (t = 100),
                n === e && (n = !1),
                m.isHTML5 ? m._a && (dt.muted && !m.muted && (m.muted = !0,
                m._a.muted = !0),
                m._a.volume = Math.max(0, Math.min(1, t / 100))) : ct._setVolume(m.id, dt.muted && !m.muted || m.muted ? 0 : t),
                m._iO.volume = t,
                n || (m.volume = t,
                m.options.volume = t),
                m
            }
            ,
            this.mute = function() {
                return m.muted = !0,
                m.isHTML5 ? m._a && (m._a.muted = !0) : ct._setVolume(m.id, 0),
                m
            }
            ,
            this.unmute = function() {
                m.muted = !1;
                var t = m._iO.volume !== e;
                return m.isHTML5 ? m._a && (m._a.muted = !1) : ct._setVolume(m.id, t ? m._iO.volume : m.options.volume),
                m
            }
            ,
            this.toggleMute = function() {
                return m.muted ? m.unmute() : m.mute()
            }
            ,
            this.onposition = this.onPosition = function(t, n, o) {
                return y.push({
                    position: parseInt(t, 10),
                    method: n,
                    scope: o !== e ? o : m,
                    fired: !1
                }),
                m
            }
            ,
            this.clearOnPosition = function(t, e) {
                var n;
                if (t = parseInt(t, 10),
                !isNaN(t))
                    for (n = 0; n < y.length; n++)
                        t !== y[n].position || e && e !== y[n].method || (y[n].fired && g--,
                        y.splice(n, 1))
            }
            ,
            this._processOnPosition = function() {
                var t, e;
                if (!(t = y.length) || !m.playState || g >= t)
                    return !1;
                for (--t; 0 <= t; t--)
                    !(e = y[t]).fired && m.position >= e.position && (e.fired = !0,
                    g++,
                    e.method.apply(e.scope, [e.position]));
                return !0
            }
            ,
            this._resetOnPosition = function(t) {
                var e, n;
                if (!(e = y.length))
                    return !1;
                for (--e; 0 <= e; e--)
                    (n = y[e]).fired && t <= n.position && (n.fired = !1,
                    g--);
                return !0
            }
            ,
            c = function() {
                var t, e, n = m._iO, o = n.from, i = n.to;
                return e = function() {
                    m.clearOnPosition(i, e),
                    m.stop()
                }
                ,
                t = function() {
                    null === i || isNaN(i) || m.onPosition(i, e)
                }
                ,
                null === o || isNaN(o) || (n.position = o,
                n.multiShot = !1,
                t()),
                n
            }
            ,
            l = function() {
                var t, e = m._iO.onposition;
                if (e)
                    for (t in e)
                        e.hasOwnProperty(t) && m.onPosition(parseInt(t, 10), e[t])
            }
            ,
            d = function() {
                var t, e = m._iO.onposition;
                if (e)
                    for (t in e)
                        e.hasOwnProperty(t) && m.clearOnPosition(parseInt(t, 10))
            }
            ,
            u = function() {
                m.isHTML5 && j(m)
            }
            ,
            r = function() {
                m.isHTML5 && V(m)
            }
            ,
            i = function(t) {
                t || (y = [],
                g = 0),
                _ = !1,
                m._hasTimer = null,
                m._a = null,
                m._html5_canplay = !1,
                m.bytesLoaded = null,
                m.bytesTotal = null,
                m.duration = m._iO && m._iO.duration ? m._iO.duration : null,
                m.durationEstimate = null,
                m.buffered = [],
                m.eqData = [],
                m.eqData.left = [],
                m.eqData.right = [],
                m.failures = 0,
                m.isBuffering = !1,
                m.instanceOptions = {},
                m.instanceCount = 0,
                m.loaded = !1,
                m.metadata = {},
                m.readyState = 0,
                m.muted = !1,
                m.paused = !1,
                m.peakData = {
                    left: 0,
                    right: 0
                },
                m.waveformData = {
                    left: [],
                    right: []
                },
                m.playState = 0,
                m.position = null,
                m.id3 = {}
            }
            ,
            i(),
            this._onTimer = function(t) {
                var e, i = !1, a = {};
                return (m._hasTimer || t) && m._a && (t || (0 < m.playState || 1 === m.readyState) && !m.paused) && ((e = m._get_html5_duration()) !== n && (n = e,
                m.duration = e,
                i = !0),
                m.durationEstimate = m.duration,
                (e = 1e3 * m._a.currentTime || 0) !== o && (o = e,
                i = !0),
                (i || t) && m._whileplaying(e, a, a, a, a)),
                i
            }
            ,
            this._get_html5_duration = function() {
                var t = m._iO;
                return (t = m._a && m._a.duration ? 1e3 * m._a.duration : t && t.duration ? t.duration : null) && !isNaN(t) && 1 / 0 !== t ? t : null
            }
            ,
            this._apply_loop = function(t, e) {
                t.loop = 1 < e ? "loop" : ""
            }
            ,
            this._setup_html5 = function(t) {
                t = h(m._iO, t);
                var e, n = Ht ? ft : m._a, o = decodeURI(t.url);
                if (Ht ? o === decodeURI(nt) && (e = !0) : o === decodeURI(O) && (e = !0),
                n) {
                    if (n._s)
                        if (Ht)
                            n._s && n._s.playState && !e && n._s.stop();
                        else if (!Ht && o === decodeURI(O))
                            return m._apply_loop(n, t.loops),
                            n;
                    e || (O && i(!1),
                    n.src = t.url,
                    nt = O = m.url = t.url,
                    n._called_load = !1)
                } else
                    t.autoLoad || t.autoPlay ? (m._a = new Audio(t.url),
                    m._a.load()) : m._a = Nt && 10 > opera.version() ? new Audio(null) : new Audio,
                    (n = m._a)._called_load = !1,
                    Ht && (ft = n);
                return m.isHTML5 = !0,
                m._a = n,
                n._s = m,
                a(),
                m._apply_loop(n, t.loops),
                t.autoLoad || t.autoPlay ? m.load() : (n.autobuffer = !1,
                n.preload = "auto"),
                n
            }
            ,
            a = function() {
                if (m._a._added_events)
                    return !1;
                var t;
                for (t in m._a._added_events = !0,
                st)
                    st.hasOwnProperty(t) && m._a && m._a.addEventListener(t, st[t], !1);
                return !0
            }
            ,
            s = function() {
                var t;
                for (t in m._a._added_events = !1,
                st)
                    st.hasOwnProperty(t) && m._a && m._a.removeEventListener(t, st[t], !1)
            }
            ,
            this._onload = function(t) {
                var e = !!t || !m.isHTML5 && 8 === f && m.duration;
                return m.loaded = e,
                m.readyState = e ? 3 : 2,
                m._onbufferchange(0),
                e || m.isHTML5 || m._onerror(),
                m._iO.onload && rt(m, (function() {
                    m._iO.onload.apply(m, [e])
                }
                )),
                !0
            }
            ,
            this._onerror = function(t, e) {
                m._iO.onerror && rt(m, (function() {
                    m._iO.onerror.apply(m, [t, e])
                }
                ))
            }
            ,
            this._onbufferchange = function(t) {
                return !(0 === m.playState || t && m.isBuffering || !t && !m.isBuffering) && (m.isBuffering = 1 === t,
                m._iO.onbufferchange && m._iO.onbufferchange.apply(m, [t]),
                !0)
            }
            ,
            this._onsuspend = function() {
                return m._iO.onsuspend && m._iO.onsuspend.apply(m),
                !0
            }
            ,
            this._onfailure = function(t, e, n) {
                m.failures++,
                m._iO.onfailure && 1 === m.failures && m._iO.onfailure(t, e, n)
            }
            ,
            this._onwarning = function(t, e, n) {
                m._iO.onwarning && m._iO.onwarning(t, e, n)
            }
            ,
            this._onfinish = function() {
                var t = m._iO.onfinish;
                m._onbufferchange(0),
                m._resetOnPosition(0),
                m.instanceCount && (m.instanceCount--,
                m.instanceCount || (d(),
                m.playState = 0,
                m.paused = !1,
                m.instanceCount = 0,
                m.instanceOptions = {},
                m._iO = {},
                r(),
                m.isHTML5 && (m.position = 0)),
                (!m.instanceCount || m._iO.multiShotEvents) && t && rt(m, (function() {
                    t.apply(m)
                }
                )))
            }
            ,
            this._whileloading = function(t, e, n, o) {
                var i = m._iO;
                m.bytesLoaded = t,
                m.bytesTotal = e,
                m.duration = Math.floor(n),
                m.bufferLength = o,
                m.durationEstimate = m.isHTML5 || i.isMovieStar ? m.duration : i.duration ? m.duration > i.duration ? m.duration : i.duration : parseInt(m.bytesTotal / m.bytesLoaded * m.duration, 10),
                m.isHTML5 || (m.buffered = [{
                    start: 0,
                    end: m.duration
                }]),
                (3 !== m.readyState || m.isHTML5) && i.whileloading && i.whileloading.apply(m)
            }
            ,
            this._whileplaying = function(t, n, o, i, a) {
                var s = m._iO;
                return !isNaN(t) && null !== t && (m.position = Math.max(0, t),
                m._processOnPosition(),
                !m.isHTML5 && 8 < f && (s.usePeakData && n !== e && n && (m.peakData = {
                    left: n.leftPeak,
                    right: n.rightPeak
                }),
                s.useWaveformData && o !== e && o && (m.waveformData = {
                    left: o.split(","),
                    right: i.split(",")
                }),
                s.useEQData && a !== e && a && a.leftEQ && (t = a.leftEQ.split(","),
                m.eqData = t,
                m.eqData.left = t,
                a.rightEQ !== e && a.rightEQ && (m.eqData.right = a.rightEQ.split(",")))),
                1 === m.playState && (m.isHTML5 || 8 !== f || m.position || !m.isBuffering || m._onbufferchange(0),
                s.whileplaying && s.whileplaying.apply(m)),
                !0)
            }
            ,
            this._oncaptiondata = function(t) {
                m.captiondata = t,
                m._iO.oncaptiondata && m._iO.oncaptiondata.apply(m, [t])
            }
            ,
            this._onmetadata = function(t, e) {
                var n, o, i = {};
                for (n = 0,
                o = t.length; n < o; n++)
                    i[t[n]] = e[n];
                m.metadata = i,
                m._iO.onmetadata && m._iO.onmetadata.call(m, m.metadata)
            }
            ,
            this._onid3 = function(t, e) {
                var n, o, i = [];
                for (n = 0,
                o = t.length; n < o; n++)
                    i[t[n]] = e[n];
                m.id3 = h(m.id3, i),
                m._iO.onid3 && m._iO.onid3.apply(m)
            }
            ,
            this._onconnect = function(t) {
                t = 1 === t,
                (m.connected = t) && (m.failures = 0,
                q(m.id) && (m.getAutoPlay() ? m.play(e, m.getAutoPlay()) : m._iO.autoLoad && m.load()),
                m._iO.onconnect && m._iO.onconnect.apply(m, [t]))
            }
            ,
            this._ondataerror = function(t) {
                0 < m.playState && m._iO.ondataerror && m._iO.ondataerror.apply(m)
            }
        }
        ,
        A = function() {
            return mt.body || mt.getElementsByTagName("div")[0]
        }
        ,
        r = function(t) {
            return mt.getElementById(t)
        }
        ,
        h = function(t, n) {
            var o, i, a = t || {};
            for (i in o = n === e ? dt.defaultOptions : n)
                o.hasOwnProperty(i) && a[i] === e && (a[i] = "object" !== _typeof(o[i]) || null === o[i] ? o[i] : h(a[i], o[i]));
            return a
        }
        ,
        rt = function(e, n) {
            e.isHTML5 || 8 !== f ? n() : t.setTimeout(n, 0)
        }
        ,
        m = {
            onready: 1,
            ontimeout: 1,
            defaultOptions: 1,
            flash9Options: 1,
            movieStarOptions: 1
        },
        p = function(t, n) {
            var o, i = !0, a = n !== e, s = dt.setupOptions;
            for (o in t)
                if (t.hasOwnProperty(o))
                    if ("object" !== _typeof(t[o]) || null === t[o] || t[o]instanceof Array || t[o]instanceof RegExp)
                        a && m[n] !== e ? dt[n][o] = t[o] : s[o] !== e ? (dt.setupOptions[o] = t[o],
                        dt[o] = t[o]) : m[o] === e ? i = !1 : dt[o]instanceof Function ? dt[o].apply(dt, t[o]instanceof Array ? t[o] : [t[o]]) : dt[o] = t[o];
                    else {
                        if (m[o] !== e)
                            return p(t[o], o);
                        i = !1
                    }
            return i
        }
        ,
        et = function() {
            function e(t) {
                var e = (t = Dt.call(t)).length;
                return o ? (t[1] = "on" + t[1],
                3 < e && t.pop()) : 3 === e && t.push(!1),
                t
            }
            function n(t, e) {
                var n = t.shift()
                  , a = [i[e]];
                o ? n[a](t[0], t[1]) : n[a].apply(n, t)
            }
            var o = t.attachEvent
              , i = {
                add: o ? "attachEvent" : "addEventListener",
                remove: o ? "detachEvent" : "removeEventListener"
            };
            return {
                add: function() {
                    n(e(arguments), "add")
                },
                remove: function() {
                    n(e(arguments), "remove")
                }
            }
        }(),
        st = {
            abort: a((function() {}
            )),
            canplay: a((function() {
                var t, n = this._s;
                if (!n._html5_canplay) {
                    if (n._html5_canplay = !0,
                    n._onbufferchange(0),
                    t = n._iO.position === e || isNaN(n._iO.position) ? null : n._iO.position / 1e3,
                    this.currentTime !== t)
                        try {
                            this.currentTime = t
                        } catch (t) {}
                    n._iO._oncanplay && n._iO._oncanplay()
                }
            }
            )),
            canplaythrough: a((function() {
                var t = this._s;
                t.loaded || (t._onbufferchange(0),
                t._whileloading(t.bytesLoaded, t.bytesTotal, t._get_html5_duration()),
                t._onload(!0))
            }
            )),
            durationchange: a((function() {
                var t, e = this._s;
                t = e._get_html5_duration(),
                isNaN(t) || t === e.duration || (e.durationEstimate = e.duration = t)
            }
            )),
            ended: a((function() {
                this._s._onfinish()
            }
            )),
            error: a((function() {
                var t = J[this.error.code] || null;
                this._s._onload(!1),
                this._s._onerror(this.error.code, t)
            }
            )),
            loadeddata: a((function() {
                var t = this._s;
                t._loaded || xt || (t.duration = t._get_html5_duration())
            }
            )),
            loadedmetadata: a((function() {}
            )),
            loadstart: a((function() {
                this._s._onbufferchange(1)
            }
            )),
            play: a((function() {
                this._s._onbufferchange(0)
            }
            )),
            playing: a((function() {
                this._s._onbufferchange(0)
            }
            )),
            progress: a((function(t) {
                var e, n, o = this._s, i = 0;
                i = t.target.buffered;
                e = t.loaded || 0;
                var a = t.total || 1;
                if (o.buffered = [],
                i && i.length) {
                    for (e = 0,
                    n = i.length; e < n; e++)
                        o.buffered.push({
                            start: 1e3 * i.start(e),
                            end: 1e3 * i.end(e)
                        });
                    i = 1e3 * (i.end(0) - i.start(0)),
                    e = Math.min(1, i / (1e3 * t.target.duration))
                }
                isNaN(e) || (o._whileloading(e, a, o._get_html5_duration()),
                e && a && e === a && st.canplaythrough.call(this, t))
            }
            )),
            ratechange: a((function() {}
            )),
            suspend: a((function(t) {
                var e = this._s;
                st.progress.call(this, t),
                e._onsuspend()
            }
            )),
            stalled: a((function() {}
            )),
            timeupdate: a((function() {
                this._s._onTimer()
            }
            )),
            waiting: a((function() {
                this._s._onbufferchange(1)
            }
            ))
        },
        K = function(t) {
            return !(!t || !(t.type || t.url || t.serverURL)) && (!(t.serverURL || t.type && i(t.type)) && (t.type ? X({
                type: t.type
            }) : X({
                url: t.url
            }) || dt.html5Only || t.url.match(/data:/i)))
        }
        ,
        Z = function(t) {
            var n;
            return t && (n = xt ? "about:blank" : dt.html5.canPlayType("audio/wav") ? "data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==" : "about:blank",
            t.src = n,
            t._called_unload !== e && (t._called_load = !1)),
            Ht && (nt = null),
            n
        }
        ,
        X = function(t) {
            if (!dt.useHTML5Audio || !dt.hasHTML5)
                return !1;
            var n = t.url || null;
            t = t.type || null;
            var o, a = dt.audioFormats;
            if (t && dt.html5[t] !== e)
                return dt.html5[t] && !i(t);
            if (!Y) {
                for (o in Y = [],
                a)
                    a.hasOwnProperty(o) && (Y.push(o),
                    a[o].related && (Y = Y.concat(a[o].related)));
                Y = new RegExp("\\.(" + Y.join("|") + ")(\\?.*)?$","i")
            }
            return (o = n ? n.toLowerCase().match(Y) : null) && o.length ? o = o[1] : t && (o = (-1 !== (n = t.indexOf(";")) ? t.substr(0, n) : t).substr(6)),
            o && dt.html5[o] !== e ? n = dt.html5[o] && !i(o) : (t = "audio/" + o,
            n = dt.html5.canPlayType({
                type: t
            }),
            n = (dt.html5[o] = n) && dt.html5[t] && !i(t)),
            n
        }
        ,
        tt = function() {
            function t(t) {
                var e, n = e = !1;
                if (!s || "function" != typeof s.canPlayType)
                    return e;
                if (t instanceof Array) {
                    for (a = 0,
                    e = t.length; a < e; a++)
                        (dt.html5[t[a]] || s.canPlayType(t[a]).match(dt.html5Test)) && (n = !0,
                        dt.html5[t[a]] = !0,
                        dt.flash[t[a]] = !!t[a].match(Qt));
                    e = n
                } else
                    e = !(!(t = !(!s || "function" != typeof s.canPlayType) && s.canPlayType(t)) || !t.match(dt.html5Test));
                return e
            }
            if (!dt.useHTML5Audio || !dt.hasHTML5)
                return At = dt.html5.usingFlash = !0,
                !1;
            var n, o, i, a, s = Audio !== e ? Nt && 10 > opera.version() ? new Audio(null) : new Audio : null, r = {};
            for (n in i = dt.audioFormats)
                if (i.hasOwnProperty(n) && (o = "audio/" + n,
                r[n] = t(i[n].type),
                r[o] = r[n],
                n.match(Qt) ? (dt.flash[n] = !0,
                dt.flash[o] = !0) : (dt.flash[n] = !1,
                dt.flash[o] = !1),
                i[n] && i[n].related))
                    for (a = i[n].related.length - 1; 0 <= a; a--)
                        r["audio/" + i[n].related[a]] = r[n],
                        dt.html5[i[n].related[a]] = r[n],
                        dt.flash[i[n].related[a]] = r[n];
            return r.canPlayType = s ? t : null,
            dt.html5 = h(dt.html5, r),
            dt.html5.usingFlash = G(),
            At = dt.html5.usingFlash,
            !0
        }
        ,
        P = {},
        R = function() {}
        ,
        U = function(t) {
            return 8 === f && 1 < t.loops && t.stream && (t.stream = !1),
            t
        }
        ,
        B = function(t, e) {
            return t && !t.usePolicyFile && (t.onid3 || t.usePeakData || t.useWaveformData || t.useEQData) && (t.usePolicyFile = !0),
            t
        }
        ,
        u = function() {
            return !1
        }
        ,
        E = function(t) {
            for (var e in t)
                t.hasOwnProperty(e) && "function" == typeof t[e] && (t[e] = u)
        }
        ,
        C = function(t) {
            t === e && (t = !1),
            (vt || t) && dt.disable(t)
        }
        ,
        k = function(t) {
            if (t)
                if (t.match(/\.swf(\?.*)?$/i)) {
                    if (t.substr(t.toLowerCase().lastIndexOf(".swf?") + 4))
                        return t
                } else
                    t.lastIndexOf("/") !== t.length - 1 && (t += "/");
            return t = (t && -1 !== t.lastIndexOf("/") ? t.substr(0, t.lastIndexOf("/") + 1) : "./") + dt.movieURL,
            dt.noSWFCache && (t += "?ts=" + (new Date).getTime()),
            t
        }
        ,
        b = function() {
            8 !== (f = parseInt(dt.flashVersion, 10)) && 9 !== f && (dt.flashVersion = f = 8);
            var t = dt.debugMode || dt.debugFlash ? "_debug.swf" : ".swf";
            dt.useHTML5Audio && !dt.html5Only && dt.audioFormats.mp4.required && 9 > f && (dt.flashVersion = f = 9),
            dt.version = dt.versionNumber + (dt.html5Only ? " (HTML5-only mode)" : 9 === f ? " (AS3/Flash 9)" : " (AS2/Flash 8)"),
            8 < f ? (dt.defaultOptions = h(dt.defaultOptions, dt.flash9Options),
            dt.features.buffering = !0,
            dt.defaultOptions = h(dt.defaultOptions, dt.movieStarOptions),
            dt.filePatterns.flash9 = new RegExp("\\.(mp3|" + Kt.join("|") + ")(\\?.*)?$","i"),
            dt.features.movieStar = !0) : dt.features.movieStar = !1,
            dt.filePattern = dt.filePatterns[8 !== f ? "flash9" : "flash8"],
            dt.movieURL = (8 === f ? "soundmanager2.swf" : "soundmanager2_flash9.swf").replace(".swf", t),
            dt.features.peakData = dt.features.waveformData = dt.features.eqData = 8 < f
        }
        ,
        F = function(t, e) {
            ct && ct._setPolling(t, e)
        }
        ,
        q = this.getSoundById,
        N = function() {
            var t = [];
            return dt.debugMode && t.push("sm2_debug"),
            dt.debugFlash && t.push("flash_debug"),
            dt.useHighPerformance && t.push("high_performance"),
            t.join(" ")
        }
        ,
        x = function() {
            R("fbHandler");
            var t = dt.getMoviePercent()
              , e = {
                type: "FLASHBLOCK"
            };
            dt.html5Only || (dt.ok() ? dt.oMC && (dt.oMC.className = [N(), "movieContainer", "swf_loaded" + (dt.didFlashBlock ? " swf_unblocked" : "")].join(" ")) : (At && (dt.oMC.className = N() + " movieContainer " + (null === t ? "swf_timedout" : "swf_error")),
            dt.didFlashBlock = !0,
            y({
                type: "ontimeout",
                ignoreInit: !0,
                error: e
            }),
            H(e)))
        }
        ,
        _ = function(t, n, o) {
            _t[t] === e && (_t[t] = []),
            _t[t].push({
                method: n,
                scope: o || null,
                fired: !1
            })
        }
        ,
        y = function(t) {
            if (t || (t = {
                type: dt.ok() ? "onready" : "ontimeout"
            }),
            !Ot && t && !t.ignoreInit || "ontimeout" === t.type && (dt.ok() || vt && !t.ignoreInit))
                return !1;
            var e, n = {
                success: t && t.ignoreInit ? dt.ok() : !vt
            }, o = t && t.type && _t[t.type] || [], i = [], a = (n = [n],
            At && !dt.ok());
            for (t.error && (n[0].error = t.error),
            t = 0,
            e = o.length; t < e; t++)
                !0 !== o[t].fired && i.push(o[t]);
            if (i.length)
                for (t = 0,
                e = i.length; t < e; t++)
                    i[t].scope ? i[t].method.apply(i[t].scope, n) : i[t].method.apply(this, n),
                    a || (i[t].fired = !0);
            return !0
        }
        ,
        g = function() {
            t.setTimeout((function() {
                dt.useFlashBlock && x(),
                y(),
                "function" == typeof dt.onload && dt.onload.apply(t),
                dt.waitForWindowLoad && et.add(t, "load", g)
            }
            ), 1)
        }
        ,
        it = function() {
            if (ot !== e)
                return ot;
            var n, o, i = !1, a = navigator, s = t.ActiveXObject;
            try {
                o = a.plugins
            } catch (t) {
                o = void 0
            }
            if (o && o.length)
                (a = a.mimeTypes) && a["application/x-shockwave-flash"] && a["application/x-shockwave-flash"].enabledPlugin && a["application/x-shockwave-flash"].enabledPlugin.description && (i = !0);
            else if (s !== e && !ht.match(/MSAppHost/i)) {
                try {
                    n = new s("ShockwaveFlash.ShockwaveFlash")
                } catch (t) {
                    n = null
                }
                i = !!n
            }
            return ot = i
        }
        ,
        G = function() {
            var t, e, n = dt.audioFormats;
            if (Et && ht.match(/os (1|2|3_0|3_1)\s/i) ? (dt.hasHTML5 = !1,
            dt.html5Only = !0,
            dt.oMC && (dt.oMC.style.display = "none")) : !dt.useHTML5Audio || dt.html5 && dt.html5.canPlayType || (dt.hasHTML5 = !1),
            dt.useHTML5Audio && dt.hasHTML5)
                for (e in $ = !0,
                n)
                    n.hasOwnProperty(e) && n[e].required && (dt.html5.canPlayType(n[e].type) ? dt.preferFlash && (dt.flash[e] || dt.flash[n[e].type]) && (t = !0) : ($ = !1,
                    t = !0));
            return dt.ignoreFlash && (t = !1,
            $ = !0),
            dt.html5Only = dt.hasHTML5 && dt.useHTML5Audio && !t,
            !dt.html5Only
        }
        ,
        W = function(t) {
            var e, n, o = 0;
            if (t instanceof Array) {
                for (e = 0,
                n = t.length; e < n; e++)
                    if (t[e]instanceof Object) {
                        if (dt.canPlayMIME(t[e].type)) {
                            o = e;
                            break
                        }
                    } else if (dt.canPlayURL(t[e])) {
                        o = e;
                        break
                    }
                t[o].url && (t[o] = t[o].url),
                t = t[o]
            }
            return t
        }
        ,
        j = function(t) {
            t._hasTimer || (t._hasTimer = !0,
            !Ut && dt.html5PollingInterval && (null === St && 0 === wt && (St = setInterval(Q, dt.html5PollingInterval)),
            wt++))
        }
        ,
        V = function(t) {
            t._hasTimer && (t._hasTimer = !1,
            !Ut && dt.html5PollingInterval && wt--)
        }
        ,
        Q = function() {
            var t;
            if (null === St || wt)
                for (t = dt.soundIDs.length - 1; 0 <= t; t--)
                    dt.sounds[dt.soundIDs[t]].isHTML5 && dt.sounds[dt.soundIDs[t]]._hasTimer && dt.sounds[dt.soundIDs[t]]._onTimer();
            else
                clearInterval(St),
                St = null
        }
        ,
        H = function(n) {
            n = n !== e ? n : {},
            "function" == typeof dt.onerror && dt.onerror.apply(t, [{
                type: n.type !== e ? n.type : null
            }]),
            n.fatal !== e && n.fatal && dt.disable()
        }
        ,
        at = function() {
            if (Bt && it()) {
                var t, e, n = dt.audioFormats;
                for (e in n)
                    if (n.hasOwnProperty(e) && ("mp3" === e || "mp4" === e) && (dt.html5[e] = !1,
                    n[e] && n[e].related))
                        for (t = n[e].related.length - 1; 0 <= t; t--)
                            dt.html5[n[e].related[t]] = !1
            }
        }
        ,
        this._setSandboxType = function(t) {}
        ,
        this._externalInterfaceOK = function(t) {
            dt.swfLoaded || (dt.swfLoaded = !0,
            jt = !1,
            Bt && at(),
            setTimeout(d, kt ? 100 : 1))
        }
        ,
        D = function(t, n) {
            function o(t, e) {
                return '<param name="' + t + '" value="' + e + '" />'
            }
            if (yt && gt)
                return !1;
            if (dt.html5Only)
                return b(),
                dt.oMC = r(dt.movieID),
                d(),
                gt = yt = !0,
                !1;
            var i, a, s, u = n || dt.url, l = dt.altURL || u, f = A(), c = N(), h = null;
            h = (h = mt.getElementsByTagName("html")[0]) && h.dir && h.dir.match(/rtl/i);
            if (t = t === e ? dt.id : t,
            b(),
            dt.url = k(Wt ? u : l),
            n = dt.url,
            dt.wmode = !dt.wmode && dt.useHighPerformance ? "transparent" : dt.wmode,
            null !== dt.wmode && (ht.match(/msie 8/i) || !kt && !dt.useHighPerformance) && navigator.platform.match(/win32|win64/i) && (It.push(P.spcWmode),
            dt.wmode = null),
            f = {
                name: t,
                id: t,
                src: n,
                quality: "high",
                allowScriptAccess: dt.allowScriptAccess,
                bgcolor: dt.bgColor,
                pluginspage: $t + "www.macromedia.com/go/getflashplayer",
                title: "JS/Flash audio component (SoundManager 2)",
                type: "application/x-shockwave-flash",
                wmode: dt.wmode,
                hasPriority: "true"
            },
            dt.debugFlash && (f.FlashVars = "debug=1"),
            dt.wmode || delete f.wmode,
            kt)
                u = mt.createElement("div"),
                a = ['<object id="' + t + '" data="' + n + '" type="' + f.type + '" title="' + f.title + '" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">', o("movie", n), o("AllowScriptAccess", dt.allowScriptAccess), o("quality", f.quality), dt.wmode ? o("wmode", dt.wmode) : "", o("bgcolor", dt.bgColor), o("hasPriority", "true"), dt.debugFlash ? o("FlashVars", f.FlashVars) : "", "</object>"].join("");
            else
                for (i in u = mt.createElement("embed"),
                f)
                    f.hasOwnProperty(i) && u.setAttribute(i, f[i]);
            if (c = N(),
            f = A())
                if (dt.oMC = r(dt.movieID) || mt.createElement("div"),
                dt.oMC.id)
                    s = dt.oMC.className,
                    dt.oMC.className = (s ? s + " " : "movieContainer") + (c ? " " + c : ""),
                    dt.oMC.appendChild(u),
                    kt && ((i = dt.oMC.appendChild(mt.createElement("div"))).className = "sm2-object-box",
                    i.innerHTML = a),
                    gt = !0;
                else {
                    if (dt.oMC.id = dt.movieID,
                    dt.oMC.className = "movieContainer " + c,
                    i = c = null,
                    dt.useFlashBlock || (dt.useHighPerformance ? c = {
                        position: "fixed",
                        width: "8px",
                        height: "8px",
                        bottom: "0px",
                        left: "0px",
                        overflow: "hidden"
                    } : (c = {
                        position: "absolute",
                        width: "6px",
                        height: "6px",
                        top: "-9999px",
                        left: "-9999px"
                    },
                    h && (c.left = Math.abs(parseInt(c.left, 10)) + "px"))),
                    Rt && (dt.oMC.style.zIndex = 1e4),
                    !dt.debugFlash)
                        for (s in c)
                            c.hasOwnProperty(s) && (dt.oMC.style[s] = c[s]);
                    try {
                        kt || dt.oMC.appendChild(u),
                        f.appendChild(dt.oMC),
                        kt && ((i = dt.oMC.appendChild(mt.createElement("div"))).className = "sm2-object-box",
                        i.innerHTML = a),
                        gt = !0
                    } catch (t) {
                        throw Error(R("domError") + " \n" + t.toString())
                    }
                }
            return yt = !0
        }
        ,
        L = function() {
            return dt.html5Only ? (D(),
            !1) : !(ct || !dt.url) && ((ct = dt.getMovie(dt.id)) || (bt ? (kt ? dt.oMC.innerHTML = Tt : dt.oMC.appendChild(bt),
            bt = null,
            yt = !0) : D(dt.id, dt.url),
            ct = dt.getMovie(dt.id)),
            "function" == typeof dt.oninitmovie && setTimeout(dt.oninitmovie, 1),
            !0)
        }
        ,
        O = function() {
            setTimeout(v, 1e3)
        }
        ,
        M = function() {
            t.setTimeout((function() {
                dt.setup({
                    preferFlash: !1
                }).reboot(),
                dt.didFlashBlock = !0,
                dt.beginDelayedInit()
            }
            ), 1)
        }
        ,
        v = function() {
            var e, n = !1;
            dt.url && !Pt && (Pt = !0,
            et.remove(t, "load", O),
            ot && jt && !qt || (Ot || 0 < (e = dt.getMoviePercent()) && 100 > e && (n = !0),
            setTimeout((function() {
                e = dt.getMoviePercent(),
                n ? (Pt = !1,
                t.setTimeout(O, 1)) : !Ot && Vt && (null === e ? dt.useFlashBlock || 0 === dt.flashLoadTimeout ? dt.useFlashBlock && x() : !dt.useFlashBlock && $ ? M() : y({
                    type: "ontimeout",
                    ignoreInit: !0,
                    error: {
                        type: "INIT_FLASHBLOCK"
                    }
                }) : 0 !== dt.flashLoadTimeout && (!dt.useFlashBlock && $ ? M() : C(!0)))
            }
            ), dt.flashLoadTimeout)))
        }
        ,
        T = function() {
            return qt || !jt ? (et.remove(t, "focus", T),
            !0) : (qt = Vt = !0,
            Pt = !1,
            O(),
            et.remove(t, "focus", T),
            !0)
        }
        ,
        c = function(e) {
            if (Ot)
                return !1;
            if (dt.html5Only)
                return Ot = !0,
                g(),
                !0;
            var n, o = !0;
            return dt.useFlashBlock && dt.flashLoadTimeout && !dt.getMoviePercent() || (Ot = !0),
            n = {
                type: !ot && At ? "NO_FLASH" : "INIT_TIMEOUT"
            },
            (vt || e) && (dt.useFlashBlock && dt.oMC && (dt.oMC.className = N() + " " + (null === dt.getMoviePercent() ? "swf_timedout" : "swf_error")),
            y({
                type: "ontimeout",
                error: n,
                ignoreInit: !0
            }),
            H(n),
            o = !1),
            vt || (dt.waitForWindowLoad && !Mt ? et.add(t, "load", g) : g()),
            o
        }
        ,
        l = function() {
            var t, n = dt.setupOptions;
            for (t in n)
                n.hasOwnProperty(t) && (dt[t] === e ? dt[t] = n[t] : dt[t] !== n[t] && (dt.setupOptions[t] = dt[t]))
        }
        ,
        d = function() {
            if (Ot)
                return !1;
            if (dt.html5Only)
                return Ot || (et.remove(t, "load", dt.beginDelayedInit),
                dt.enabled = !0,
                c()),
                !0;
            L();
            try {
                ct._externalInterfaceTest(!1),
                F(!0, dt.flashPollingInterval || (dt.useHighPerformance ? 10 : 50)),
                dt.debugMode || ct._disableDebug(),
                dt.enabled = !0,
                dt.html5Only || et.add(t, "unload", u)
            } catch (t) {
                return H({
                    type: "JS_TO_FLASH_EXCEPTION",
                    fatal: !0
                }),
                C(!0),
                c(),
                !1
            }
            return c(),
            et.remove(t, "load", dt.beginDelayedInit),
            !0
        }
        ,
        w = function() {
            return !I && (I = !0,
            l(),
            !ot && dt.hasHTML5 && dt.setup({
                useHTML5Audio: !0,
                preferFlash: !1
            }),
            tt(),
            !ot && At && (It.push(P.needFlash),
            dt.setup({
                flashLoadTimeout: 1
            })),
            mt.removeEventListener && mt.removeEventListener("DOMContentLoaded", w, !1),
            L(),
            !0)
        }
        ,
        z = function() {
            return "complete" === mt.readyState && (w(),
            mt.detachEvent("onreadystatechange", z)),
            !0
        }
        ,
        S = function() {
            Mt = !0,
            w(),
            et.remove(t, "load", S)
        }
        ,
        it(),
        et.add(t, "focus", T),
        et.add(t, "load", O),
        et.add(t, "load", S),
        mt.addEventListener ? mt.addEventListener("DOMContentLoaded", w, !1) : mt.attachEvent ? mt.attachEvent("onreadystatechange", z) : H({
            type: "NO_DOM2_EVENTS",
            fatal: !0
        })
    }
    if (!t || !t.document)
        throw Error("SoundManager requires a browser with window and document objects.");
    var o = null;
    t.SM2_DEFER !== e && SM2_DEFER || (o = new n),
    "object" === ("undefined" == typeof module ? "undefined" : _typeof(module)) && module && "object" === _typeof(module.exports) ? (module.exports.SoundManager = n,
    module.exports.soundManager = o) : "function" == typeof define && define.amd && define((function() {
        return {
            constructor: n,
            getInstance: function(e) {
                return !t.soundManager && e instanceof Function && ((e = e(n))instanceof n && (t.soundManager = e)),
                t.soundManager
            }
        }
    }
    )),
    t.SoundManager = n,
    t.soundManager = o
}(window);
var TextModifyByTag = {
    sexModify: function(e) {
        var r = e.match(/\[SEX\=(.*?)\]/g);
        if (r)
            for (var a in r) {
                var i = r[a]
                  , c = "m" == hero.gender ? 0 : 1
                  , f = i.replace("[SEX=", "").replace("]", "").split("|")[c];
                e = e.replace(i, f)
            }
        return e
    }
};
new function() {
    $.fn.tip = function(t) {
        "" !== t && $(this).attr("tip", t)
    }
}
;
new function() {
    var t = this;
    $.fn.createDivideButton = function(i, a, d, e) {
        $(this).addClass("divide-button input-val-" + a);
        for (var s = lengthObject(i), n = 100 / s, l = 0; l < s; l++) {
            var c = i[l]
              , v = t.getBckClass(l, s, d)
              , r = $("<div>").addClass("option")
              , h = $("<div>").html(c.text).addClass("label")
              , o = $("<div>").addClass("bck " + v);
            o.attr("value", c.val),
            r.append(o, h),
            $(this).append(r),
            r.css("width", n + "%"),
            r.click((function() {
                if ($(this).parent().find(".bck").removeClass("active"),
                $(this).find(".bck").addClass("active"),
                e) {
                    var t = $(this).find(".bck").attr("value");
                    e(t)
                }
            }
            ))
        }
    }
    ,
    this.getBckClass = function(t, i, a) {
        return 0 == t ? "left " + (a ? "active" : "") : i == t + 1 ? 2 == i ? "right-no-border" : "right" : "middle"
    }
}
;
function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var o = t[n];
        o.enumerable = o.enumerable || !1,
        o.configurable = !0,
        "value"in o && (o.writable = !0),
        Object.defineProperty(e, o.key, o)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Checkbox = function() {
    "use strict";
    function e(t, n) {
        _classCallCheck(this, e),
        this.onSelected = n,
        this.el = this.getCheckboxTpl(),
        this.createCheckbox(t)
    }
    return _createClass(e, [{
        key: "createCheckbox",
        value: function(e) {
            var t = this
              , n = e.id
              , o = e.name
              , r = e.value
              , c = e.label
              , i = e.checked
              , l = e.attrs
              , a = e.i
              , s = this.el.querySelector("input")
              , u = this.el.querySelector("label");
            s.addEventListener("change", (function(e) {
                t.onSelected && t.onSelected(e)
            }
            )),
            !isset(n) && isset(a) && (n = "".concat(o, "_").concat(a)),
            setAttributes(s, {
                id: n,
                name: o,
                value: r
            }),
            isset(i) && i && (s.checked = !0),
            c && (u.setAttribute("for", n.toString()),
            "object" === _typeof(c) ? u.appendChild(c) : u.innerHTML = c),
            l && "object" === _typeof(l) && setAttributes(this.el, l)
        }
    }, {
        key: "getCheckbox",
        value: function() {
            return this.el
        }
    }, {
        key: "getCheckboxTpl",
        value: function() {
            return $('\n      <div class="checkbox-custom">\n          <input type="checkbox" id="xxx" name="xxx">\n          <label for="xxx"></label>\n      </div>\n    ')[0]
        }
    }]),
    e
}();
function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var o = t[n];
        o.enumerable = o.enumerable || !1,
        o.configurable = !0,
        "value"in o && (o.writable = !0),
        Object.defineProperty(e, o.key, o)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Radio = function() {
    "use strict";
    function e(t, n) {
        _classCallCheck(this, e),
        this.onSelected = n,
        this.el = this.getRadioTpl(),
        this.createRadio(t)
    }
    return _createClass(e, [{
        key: "createRadio",
        value: function(e) {
            var t = this
              , n = e.id
              , o = e.name
              , r = e.value
              , i = e.label
              , a = this.el.querySelector("input")
              , l = this.el.querySelector("label");
            a.addEventListener("change", (function(e) {
                t.onSelected && t.onSelected(e)
            }
            )),
            setAttributes(a, {
                id: n,
                name: o,
                value: r
            }),
            i && (l.setAttribute("for", n.toString()),
            "object" === _typeof(i) ? l.appendChild(i) : l.innerHTML = i)
        }
    }, {
        key: "getRadio",
        value: function() {
            return this.el
        }
    }, {
        key: "getRadioTpl",
        value: function() {
            return $('\n      <div class="radio-custom">\n          <input type="radio" id="xxx" name="xxx">\n          <label for="xxx"></label>\n      </div>\n    ')[0]
        }
    }]),
    e
}();
function _createForOfIteratorHelper(t, e) {
    var r = "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (!r) {
        if (Array.isArray(t) || (r = _unsupportedIterableToArray(t)) || e && t && "number" == typeof t.length) {
            r && (t = r);
            var n = 0
              , i = function() {};
            return {
                s: i,
                n: function() {
                    return n >= t.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: t[n++]
                    }
                },
                e: function(t) {
                    throw t
                },
                f: i
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var a, o = !0, s = !1;
    return {
        s: function() {
            r = r.call(t)
        },
        n: function() {
            var t = r.next();
            return o = t.done,
            t
        },
        e: function(t) {
            s = !0,
            a = t
        },
        f: function() {
            try {
                o || null == r.return || r.return()
            } finally {
                if (s)
                    throw a
            }
        }
    }
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var r = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === r && t.constructor && (r = t.constructor.name),
        "Map" === r || "Set" === r ? Array.from(t) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var r = 0, n = new Array(e); r < e; r++)
        n[r] = t[r];
    return n
}
function _classCallCheck(t, e) {
    if (!(t instanceof e))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(t, e) {
    for (var r = 0; r < e.length; r++) {
        var n = e[r];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(t, n.key, n)
    }
}
function _createClass(t, e, r) {
    return e && _defineProperties(t.prototype, e),
    r && _defineProperties(t, r),
    Object.defineProperty(t, "prototype", {
        writable: !1
    }),
    t
}
var RadioList = function() {
    "use strict";
    function t(e, r) {
        _classCallCheck(this, t),
        this.radiosData = e,
        this.defaultOptions = {
            isInline: !1
        },
        this.options = Object.assign(Object.assign({}, this.defaultOptions), r),
        this.radioListEl = this.getRadioListTpl(),
        this.createContent()
    }
    return _createClass(t, [{
        key: "getRadioListTpl",
        value: function() {
            return $("<div class='radio-list'></div>")[0]
        }
    }, {
        key: "createContent",
        value: function() {
            var t, e = _createForOfIteratorHelper(this.radiosData.radios);
            try {
                for (e.s(); !(t = e.n()).done; ) {
                    var r = t.value
                      , n = this.radiosData.onSelected ? this.radiosData.onSelected : null
                      , i = new Radio(r,n).getRadio();
                    this.radioListEl.appendChild(i),
                    this.options.isInline && this.radioListEl.classList.add("radio-list--inline")
                }
            } catch (t) {
                e.e(t)
            } finally {
                e.f()
            }
        }
    }, {
        key: "getList",
        value: function() {
            return this.radioListEl
        }
    }]),
    t
}();
function _toConsumableArray(e) {
    return _arrayWithoutHoles(e) || _iterableToArray(e) || _unsupportedIterableToArray(e) || _nonIterableSpread()
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var r = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === r && e.constructor && (r = e.constructor.name),
        "Map" === r || "Set" === r ? Array.from(e) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _iterableToArray(e) {
    if ("undefined" != typeof Symbol && null != e[Symbol.iterator] || null != e["@@iterator"])
        return Array.from(e)
}
function _arrayWithoutHoles(e) {
    if (Array.isArray(e))
        return _arrayLikeToArray(e)
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var r = 0, a = new Array(t); r < t; r++)
        a[r] = e[r];
    return a
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var r = 0; r < t.length; r++) {
        var a = t[r];
        a.enumerable = a.enumerable || !1,
        a.configurable = !0,
        "value"in a && (a.writable = !0),
        Object.defineProperty(e, a.key, a)
    }
}
function _createClass(e, t, r) {
    return t && _defineProperties(e.prototype, t),
    r && _defineProperties(e, r),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Button = function() {
    "use strict";
    function e(t) {
        _classCallCheck(this, e),
        this.disabled = !1,
        this.createButton(t)
    }
    return _createClass(e, [{
        key: "createButton",
        value: function(e) {
            var t, r = e.text, a = e.classes, n = e.action, i = e.tip, o = e.disabled;
            this.el = drawSIButton(r)[0],
            a && (t = this.el.classList).add.apply(t, _toConsumableArray(a)),
            this.el.addEventListener("click", (function(e) {
                n && n(e)
            }
            )),
            o && this.setState(!0),
            i && this.setTip(i),
            "string" != typeof r && void 0 !== r && (this.el.querySelector(".label .gfont").remove(),
            this.el.querySelector(".label").appendChild(r))
        }
    }, {
        key: "setState",
        value: function(e) {
            this.disabled = e,
            this.disabled ? this.el.classList.add("disable") : this.el.classList.remove("disable")
        }
    }, {
        key: "getState",
        value: function() {
            return this.disabled
        }
    }, {
        key: "setTip",
        value: function(e) {
            return $(this.el).tip(e)
        }
    }, {
        key: "getButton",
        value: function() {
            return this.el
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var i = 0; i < t.length; i++) {
        var n = t[i];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(e, n.key, n)
    }
}
function _createClass(e, t, i) {
    return t && _defineProperties(e.prototype, t),
    i && _defineProperties(e, i),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
function _classPrivateFieldInitSpec(e, t, i) {
    _checkPrivateRedeclaration(e, t),
    t.set(e, i)
}
function _checkPrivateRedeclaration(e, t) {
    if (t.has(e))
        throw new TypeError("Cannot initialize the same private elements twice on an object")
}
function _classPrivateFieldGet(e, t) {
    return _classApplyDescriptorGet(e, _classExtractFieldDescriptor(e, t, "get"))
}
function _classApplyDescriptorGet(e, t) {
    return t.get ? t.get.call(e) : t.value
}
function _classPrivateFieldSet(e, t, i) {
    return _classApplyDescriptorSet(e, _classExtractFieldDescriptor(e, t, "set"), i),
    i
}
function _classExtractFieldDescriptor(e, t, i) {
    if (!t.has(e))
        throw new TypeError("attempted to " + i + " private field on non-instance");
    return t.get(e)
}
function _classApplyDescriptorSet(e, t, i) {
    if (t.set)
        t.set.call(e, i);
    else {
        if (!t.writable)
            throw new TypeError("attempted to set read only private field");
        t.value = i
    }
}
var _config = new WeakMap
  , WorldConfig = function() {
    "use strict";
    function e() {
        _classCallCheck(this, e),
        _classPrivateFieldInitSpec(this, _config, {
            writable: !0,
            value: null
        })
    }
    return _createClass(e, [{
        key: "update",
        value: function(e) {
            _classPrivateFieldSet(this, _config, e)
        }
    }, {
        key: "getApiDomain",
        value: function() {
            return _classPrivateFieldGet(this, _config).api_domain
        }
    }, {
        key: "getEnableMe",
        value: function() {
            return _classPrivateFieldGet(this, _config).enableme
        }
    }, {
        key: "getEnableNar",
        value: function() {
            return _classPrivateFieldGet(this, _config).enablenar
        }
    }, {
        key: "getSkipMute",
        value: function() {
            return _classPrivateFieldGet(this, _config).skipmute
        }
    }, {
        key: "getDropDestroyLvl",
        value: function() {
            return _classPrivateFieldGet(this, _config).dropdestroylvl
        }
    }, {
        key: "getLoot",
        value: function() {
            return _classPrivateFieldGet(this, _config).loot
        }
    }, {
        key: "getTtlLootDel",
        value: function() {
            return _classPrivateFieldGet(this, _config).ttlootdel
        }
    }, {
        key: "getPvpLvlOff",
        value: function() {
            return _classPrivateFieldGet(this, _config).pvplvloff
        }
    }, {
        key: "getPvpStart",
        value: function() {
            return _classPrivateFieldGet(this, _config).pvpstart
        }
    }, {
        key: "getPvpEnd",
        value: function() {
            return _classPrivateFieldGet(this, _config).pvpend
        }
    }, {
        key: "getNonPvpStart",
        value: function() {
            return _classPrivateFieldGet(this, _config).nonpvpstart
        }
    }, {
        key: "getNonPvpEnd",
        value: function() {
            return _classPrivateFieldGet(this, _config).nonpvpend
        }
    }, {
        key: "getNpcExp",
        value: function() {
            return _classPrivateFieldGet(this, _config).npcexp
        }
    }, {
        key: "getNpcResp",
        value: function() {
            return _classPrivateFieldGet(this, _config).npcresp
        }
    }, {
        key: "getWeakTitans",
        value: function() {
            return _classPrivateFieldGet(this, _config).weaktitans
        }
    }, {
        key: "getPh",
        value: function() {
            return _classPrivateFieldGet(this, _config).ph
        }
    }, {
        key: "getPrivWorld",
        value: function() {
            return _classPrivateFieldGet(this, _config).priv_world
        }
    }, {
        key: "getQuestExp",
        value: function() {
            return _classPrivateFieldGet(this, _config).questexp
        }
    }, {
        key: "getSupervisorIds",
        value: function() {
            return _classPrivateFieldGet(this, _config).supervisorIds
        }
    }, {
        key: "getWantedShow",
        value: function() {
            return _classPrivateFieldGet(this, _config).wanted_show
        }
    }, {
        key: "getWorldName",
        value: function() {
            return _classPrivateFieldGet(this, _config).worldname
        }
    }, {
        key: "getPvp",
        value: function() {
            return _classPrivateFieldGet(this, _config).pvp
        }
    }, {
        key: "getHardcore",
        value: function() {
            return _classPrivateFieldGet(this, _config).hardcore
        }
    }, {
        key: "getBrutal",
        value: function() {
            return _classPrivateFieldGet(this, _config).brutal
        }
    }, {
        key: "getRpg",
        value: function() {
            return _classPrivateFieldGet(this, _config).rpg
        }
    }]),
    e
}();
function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
function log() {
    var e = ""
      , o = !1;
    if (arguments.length > 1)
        switch (parseInt(arguments[1])) {
        case 1:
            e = "Warning: ",
            0 == hero.uprawnienia && arguments[0].match(/Pakiet odrzucony, poprzednie/) && (o = !0);
            break;
        case 2:
            e = "Error: ";
            break;
        case 3:
            o = !0,
            e = "Fatal error: ",
            $("#console").show();
            break;
        default:
            e = "Unknow: "
        }
    arguments.length > 2 && arguments[2] && (e = ""),
    $("#contxt").append("<DIV" + (arguments.length > 1 ? " class=loglvl_" + arguments[1] : "") + ">" + e + arguments[0] + "</DIV>").scrollTop(999999),
    "" == e || o || $("#warn").fadeIn()
}
function installAddon(e) {
    g.addons.push(e);
    var o = new Date;
    o.setTime(o.getTime() + 2592e6),
    setCookie("addons", g.addons.join(" "), o),
    log("Script " + e + " added succesfully.")
}
function consoleParse(cmnd) {
    if ("." == cmnd.substr(0, 1))
        return _g("console&custom=" + esc(cmnd));
    var c = cmnd.split(" ");
    cmd = c[0],
    c[0] = "";
    var par = c.join(" ").substr(1)
      , gm_cmd = ["tp", "loc", "nloc", "noclip"];
    switch (cmd) {
    case "ver":
        log("Margonem MMORPG ver 2.0");
        break;
    case "about":
        log("Margonem MMORPG (c) by Thinker 2005-2009 [www.margonem.pl, thinker@margonem.pl]");
        break;
    case "cls":
        $("#contxt").empty();
        break;
    case "dump":
        log("<b>Dumping variable " + par + "</b><br>" + dump(eval(par)));
        break;
    case "show":
        if ("loots" === par)
            return;
        $("#" + par).show(),
        "battle" == par && (hideTroopsIfNotPositioned(),
        g.lock.add("battle"));
        break;
    case "hide":
        $("#" + par).hide();
        break;
    case "stop":
        stopEngine();
        break;
    case "ff":
        _g("fight&a=f");
        break;
    case "fb":
        _g("fight&a=break");
        break;
    case "group":
        log(sound.manager.getActiveGroup());
        break;
    case "equip":
        var l = location.host.split(".")
          , w = l[0];
        for (var k in 0 == w.indexOf("game") && (w = w.substr(4)),
        isset(g.worldConfig.getWorldName()) && (w = g.worldConfig.getWorldName()),
        g.item)
            "g" == g.item[k].loc && log(g.item[k].name + " ITEM#" + g.item[k].hid + "." + w);
        break;
    case "addon":
        if (par.length < 5)
            break;
        if (!par.match(/^https?:\/\/.+\..+/)) {
            log('Wrong addon url, missing "http://" prefix', 1);
            break
        }
        if (par = par.replace(/\s/g, ""),
        g.addons.indexOf(par) >= 0) {
            log("This addon is installed already");
            break
        }
        var url = par
          , res = /^https?:\/\/addons2\.margonem\.pl\/get\/(\d*?)\/(\d*?)verified\.js$/.exec(url);
        null === res || parseInt(res[0]) == Math.floor(parseInt(res[1]) / 1e3) ? mAlert(_t("install-not-verified-addon %url%", {
            "%url%": escapeHTML(url)
        }), 2, [function() {
            installAddon(url)
        }
        , function() {}
        ]) : installAddon(url);
        break;
    case "adreset":
        g.addons = [],
        setCookie("addons", "", 0),
        setCookie("__mExts", "", 0),
        log("Addons cleared.");
        break;
    case "gadblock":
        var d = new Date
          , val = "off" == par ? 0 : 1;
        d.setTime(d.getTime() + 2592e6),
        setCookie("__nga", val, d),
        log(1 == val ? "Global addon blocked ('gadblock off' to unblock)" : "Global addon unblocked ('gadblock on' to block)");
        break;
    case "tp":
        _g("gm&a=teleport&target=" + par);
        break;
    case "loc":
        _g("gm&a=locate&who=" + esc(par));
        break;
    case "nloc":
        _g("gm&a=npclocate&who=" + esc(par));
        break;
    case "noclip":
        g.npccol = [],
        map.col = "",
        isset(map.nodes) && map.nodes.removeAllCollisions();
        break;
    case "outfit":
        var _img = new Image;
        _img.src = par,
        log("outfit " + par),
        _img.onload = function() {
            hero.fw = this.width / 4,
            hero.fh = this.height / 4,
            $("#hero").css("background-image", "url(" + par + ")"),
            log("Outfit loaded")
        }
        ,
        _img.onerror = function() {
            log("Error while loading outfit file.", 2)
        }
        ;
        break;
    case "respnpc":
        _g("gm&a=respnpc");
        break;
    case "":
        break;
    default:
        log("<i>> " + cmnd.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;") + "</i>");
        try {
            eval(cmnd)
        } catch (e) {
            log(e, 2, !0)
        }
    }
}
function dump(e, o) {
    var a = "";
    if (o || (o = 0),
    o > 3)
        return "";
    for (var r = "", t = 0; t < o + 1; t++)
        r += "&nbsp;&nbsp;";
    if ("object" == _typeof(e))
        for (var n in e) {
            var l = e[n];
            "object" == _typeof(l) ? (a += r + "'" + n + "' :<BR>",
            a += dump(l, o + 1)) : a += void 0 === l ? r + "'" + n + '\' => "undefinied"<BR>' : r + "'" + n + "' => \"" + l.toString().replace(/</g, "&lt;") + '"<BR>'
        }
    else
        a = "===>" + e + "<===(" + _typeof(e) + ")";
    return a
}
function MatchmakingTutorial() {
    var t, a = this;
    this.init = function() {
        this.initData()
    }
    ,
    this.initData = function() {
        t = {
            id0: [{
                p: 0,
                t: ".MM-button-bar>.MM-stat-button",
                h: a.tLang("progress-h"),
                txt: a.tLang("tid0txt0")
            }, {
                p: 1,
                t: ".MM-button-bar>.MM-fight-button",
                h: a.tLang("look-for-battle"),
                txt: a.tLang("tid0txt1")
            }, {
                p: 2,
                t: ".MM-button-bar>.MM-rank-button",
                h: a.tLang("ranking"),
                txt: a.tLang("tid0txt2")
            }],
            id1: [{
                p: 0,
                t: ".MM-dialog-space>.on-progress",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt0")
            }, {
                p: 1,
                t: ".tokens-amount-1",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt1")
            }, {
                p: 2,
                t: ".progress-buttons-wrapper>.details-btn",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt2")
            }, {
                p: 2,
                t: ".left-side>.outfit-wrapper",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt3")
            }, {
                p: 2,
                t: ".progress-buttons-wrapper>.go-to-shop-btn",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt4")
            }, {
                p: 2,
                t: ".progress-bar:first",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt5")
            }, {
                p: 2,
                t: ".item-chest-slot:first",
                h: a.tLang("progress-wnd-h"),
                txt: a.tLang("tid1txt6")
            }],
            id2: [{
                p: 0,
                t: ".MM-dialog-space>.on-statistics",
                h: a.tLang("your-stats-h"),
                txt: a.tLang("tid2txt0")
            }, {
                p: 2,
                t: ".MM-table-container>.MM-table-statistics",
                h: a.tLang("your-stats-h"),
                txt: a.tLang("tid2txt1")
            }, {
                p: 1,
                t: ".MM-table-container>.MM-table-statistics",
                h: a.tLang("your-stats-h"),
                txt: a.tLang("tid2txt2")
            }, {
                p: 0,
                t: ".MM-table-container>.MM-table-statistics",
                h: a.tLang("your-stats-h"),
                txt: a.tLang("tid2txt3")
            }],
            id3: [{
                p: 2,
                t: ".MM-dialog-space>.on-history",
                h: a.tLang("battle-history-h"),
                txt: a.tLang("tid3txt0")
            }],
            id4: [{
                p: 2,
                t: ".MM-dialog-space>.on-season",
                h: a.tLang("season-h"),
                txt: a.tLang("tid4txt0")
            }, {
                p: 2,
                t: ".season-wnd>.reward-wrapper",
                h: a.tLang("season-h"),
                txt: a.tLang("tid4txt1")
            }, {
                p: 2,
                t: ".winners-wrapper",
                h: a.tLang("season-h"),
                txt: a.tLang("tid4txt2")
            }, {
                p: 2,
                t: ".your-season-record",
                h: a.tLang("season-h"),
                txt: a.tLang("tid4txt3")
            }, {
                p: 2,
                t: ".your-career-record",
                h: a.tLang("season-h"),
                txt: a.tLang("tid4txt4")
            }],
            id5: [{
                p: 2,
                t: ".MM-dialog-space>.on-global",
                h: a.tLang("general-ranking-h"),
                txt: a.tLang("tid5txt0")
            }],
            id6: [{
                p: 2,
                t: ".MM-dialog-space>.on-clan",
                h: a.tLang("clan-ranking-h"),
                txt: a.tLang("tid6txt0")
            }],
            id7: [{
                p: 2,
                t: ".MM-dialog-space>.on-friends",
                h: a.tLang("friends-ranking-h"),
                txt: a.tLang("tid7txt0")
            }]
        }
    }
    ,
    this.initTutorialStateInMMWnd = function() {
        this.getTutorialState() && $("#MM-window").find(".my-checkbox").addClass("active")
    }
    ,
    this.getLastStep = function(t) {
        var a = margoStorage.get("MM_Tutorial/" + t);
        return null == a ? (margoStorage.set("MM_Tutorial/" + t, -1),
        -1) : a
    }
    ,
    this.clearTutorial = function() {
        margoStorage.remove("MM_Tutorial")
    }
    ,
    this.setCloudWatchInStorage = function(a, i) {
        t["id" + a].length <= i + 1 ? margoStorage.set("MM_Tutorial/" + a, "watched") : margoStorage.set("MM_Tutorial/" + a, i)
    }
    ,
    this.createOverlayAndMarkObj = function(t) {
        var a = $("<div>").addClass("matchmaking-tutorial-overlay");
        t.addClass("tutorial-element-on-top");
        var i = t.css("position");
        "abosolute" != i && "relative" != i && t.addClass("add-relative"),
        a.insertBefore(t)
    }
    ,
    this.removeOverlayAndMark = function() {
        $("#MM-window").find(".matchmaking-tutorial-overlay").remove(),
        $("#MM-window").find(".tutorial-element-on-top").removeClass("tutorial-element-on-top add-relative"),
        $("#MM-window").find(".tutorial-element-on-top").removeClass("tutorial-element-on-top")
    }
    ,
    this.getCloudTip = function() {
        return $('<div class="cloud-tip">\t<div class="close">\t\t<div class="cross"></div>\t</div>\t<div class="header"></div>\t<div class="content"></div>\t<div class="cloud-tail"></div>\t<div class="next"></div></div>')
    }
    ,
    this.createCloudTip = function(i, n, e) {
        var o = a.getCloudTip()
          , s = t["id" + i][n];
        $("body").append(o),
        o.attr("id", "cloud-tip"),
        o.find(".header").html(s.h),
        o.find(".content").html(s.txt),
        o.find(".cloud-tail").addClass("pos-" + s.p),
        o.find(".close").click((function() {
            a.removeCloundAndOverlay()
        }
        )),
        o.find(".next").html(_t("next", null, "tutorials")),
        o.find(".next").click((function() {
            e.unbind("click", a.clickMarkElement),
            a.removeCloundAndOverlay(),
            a.setTutorialByIdQuick(i)
        }
        )),
        e.bind("click", a.clickMarkElement),
        a.setCloudWatchInStorage(i, n)
    }
    ,
    this.clickMarkElement = function() {
        $(this).unbind("click", a.clickMarkElement),
        a.removeCloundAndOverlay()
    }
    ,
    this.nextStep = function(i, n) {
        isset(t["id" + i][n]) && a.setTutorialByIdQuick(i)
    }
    ,
    this.setTutorialById = function(t) {
        setTimeout((function() {
            a.setTutorialByIdQuick(t)
        }
        ), 50)
    }
    ,
    this.checkCloudExist = function() {
        return $("#cloud-tip").length > 0
    }
    ,
    this.setTutorialByIdQuick = function(i) {
        if (a.getTutorialState() && !a.checkCloudExist()) {
            var n = a.getLastStep(i);
            if ("watched" != n) {
                n++;
                var e = $("#MM-window").find(t["id" + i][n].t);
                a.createOverlayAndMarkObj(e),
                a.createCloudTip(i, n, e),
                a.setCloudPosition(i, n, e)
            }
        }
    }
    ,
    this.getTutorialState = function() {
        var t = margoStorage.get("MM_Tutorial/status");
        return null === t ? (margoStorage.set("MM_Tutorial/status", !1),
        !1) : t
    }
    ,
    this.setCloudPosition = function(a, i, n) {
        var e, o, s = n.offset().left, r = n.offset().top, d = $("#cloud-tip");
        switch (t["id" + a][i].p) {
        case 0:
            e = s + n.width() / 2,
            o = r + n.height() + 20;
            break;
        case 1:
            e = s + n.width() / 2,
            o = r - d.height() - 30;
            break;
        case 2:
            e = s + n.width() / 2 - d.width(),
            o = r - d.height() - 30
        }
        d.css({
            left: e,
            top: o
        })
    }
    ,
    this.removeCloud = function() {
        $("#cloud-tip").remove()
    }
    ,
    this.removeCloundAndOverlay = function() {
        this.removeCloud(),
        this.removeOverlayAndMark()
    }
    ,
    this.tLang = function(t) {
        return _t(t, null, "matchmaking-tutorial")
    }
    ,
    this.init()
}
function MargoStorage() {
    var t = localStorage
      , e = "MargonemOld"
      , o = null
      , r = function() {
        t.setItem(e, JSON.stringify(o))
    };
    this.get = function(t, e) {
        for (var r = t.split("/"), i = o; r.length; ) {
            var n = r.splice(0, 1)[0];
            if (void 0 === i[n])
                return void 0 === e ? null : e;
            i = i[n]
        }
        return i
    }
    ,
    this.set = function(t, e) {
        for (var i = t.split("/"), n = o; i.length > 1; ) {
            var l = i.splice(0, 1)[0];
            void 0 === n[l] && (n[l] = {}),
            n = n[l]
        }
        n[i[0]] = e,
        r()
    }
    ,
    this.remove = function(t) {
        for (var e = t.split("/"), i = o, n = e.splice(0, 1)[0]; e.length >= 1; )
            i = i[n],
            n = e.splice(0, 1)[0];
        if (void 0 === i[n])
            throw t + " not found in storage";
        delete i[n],
        r()
    }
    ,
    null == (o = JSON.parse(t.getItem(e))) && (o = {},
    r())
}
margoStorage = new MargoStorage;
function messageController() {
    var e, t, n = "MessageController";
    function a(e, t) {
        return e + "_" + t
    }
    function r(t, n, a) {
        if (e[t])
            throw "MESSAGE ID: ".concat(t, " ALREADY EXIST! YOU NEED USE ANOTHER!");
        e[t] = {
            keyName: n,
            groupParamsAmount: a || !1
        }
    }
    function o(t, n, r) {
        var o = ""
          , i = function(t) {
            return e[t].groupParamsAmount
        }(t);
        return o = r ? function(e, t, n, r) {
            var o, i = a(e, t);
            if (r) {
                o = "";
                for (var s = 0; s < n.length; s += r) {
                    var I = s
                      , l = s + r;
                    o += u(e, i, m(n.slice(I, l))) + "[br]"
                }
            } else {
                o = u(e, i, m(n))
            }
            return o
        }(t, n, r, i) : function(e, t) {
            var n = a(e, t);
            return u(e, n)
        }(t, n),
        o
    }
    function i(t) {
        return e[t].keyName
    }
    function s(e) {
        return t[e].keyName
    }
    function m(e) {
        for (var t = {}, n = 0; n < e.length; n++)
            t["%params".concat(n, "%")] = e[n];
        return t
    }
    function u(e, t, a) {
        var r = _t(t, a || null, n);
        return function(e, t) {
            if (!t) {
                var n = "MESSAGE ID: ".concat(e, ", not created in workLog OR created and empty OR not updated dictionaries");
                message(n),
                console.warn(n)
            }
        }(e, r),
        r
    }
    function I(e, t) {
        var n = o(e, i(e), t);
        n && message(n)
    }
    function l(e, a, r) {
        var m = o(e, i(e), a);
        if (m) {
            var u = parsePopupBB(function(e, a) {
                var r = function(e) {
                    return t[e]
                }(e);
                if (!r)
                    return a;
                var o = s(e);
                return _t(o, {
                    "%params0%": a
                }, n)
            }(e, m));
            g.askre = r,
            mAlert(u, 2, [function() {
                _g(g.askre + "1")
            }
            , function() {
                _g(g.askre + "0")
            }
            ])
        }
    }
    function c(t) {
        return !!function(t) {
            return e[t]
        }(t) || (console.warn("ID: ".concat(t, " NOT DECLARE IN CLIENT!")),
        message("ID: ".concat(t, " NOT DECLARE IN CLIENT!")),
        !1)
    }
    this.init = function() {
        e = {},
        r(1001001, "ItemClassIsNotValid"),
        r(1001002, "ItemCanNotBeCursed"),
        r(1001003, "ItemIsProgressable"),
        r(1001004, "ItemMustBeInInventory"),
        r(1001005, "IngredientMustBeInBag"),
        r(1001006, "NotEnoughGold"),
        r(1001007, "NotEnoughIngredients"),
        r(1001008, "BonusSelectorApplyError"),
        r(1001009, "BonusSelectorSelectError"),
        r(1001010, "IngredientIsWorthless"),
        r(1001011, "ItemLevelIsTooLow"),
        r(1001012, "ProgressOverflow"),
        r(1001013, "ItemIsUpgradable"),
        r(1001014, "ItemIsCompleted"),
        r(1001015, "BoundConfirm"),
        r(1001016, "SelfItemUpgrade"),
        r(1001017, "ItemCannotBeTimeLimited"),
        r(1001018, "ItemIsRequiredInQuest"),
        r(1002001, "ItemUpgraded"),
        r(1101001, "MissingSelectedStat"),
        r(1201001, "ForceBindingConfirmation"),
        r(1005001, "MatchCommonOnly"),
        r(1005002, "MatchUniqueOnly"),
        r(1005003, "MatchHeroicOnly"),
        r(1005004, "MatchUpgradeOnly"),
        r(1005005, "MatchLegendaryOnly"),
        r(1005006, "MatchArtifactOnly"),
        r(1003001, "ItemIsDeleted"),
        r(1003002, "ItemLocationIsNotInPlayer"),
        r(1003003, "ItemStateIsEquipped"),
        r(1003004, "ItemStateIsNotInBag"),
        r(1003005, "ItemRarityIsNotSalvageable"),
        r(1003006, "ItemClassIsNotSalvageable"),
        r(1003007, "ItemLevelIsTooLow"),
        r(1003008, "ItemValueIsWorthless"),
        r(1003009, "ItemIsRequiredInQuest"),
        r(1003010, "ItemIsCursed"),
        r(1003011, "ItemExpires"),
        r(1004001, "ItemsInBattleSets", 2),
        r(1301001, "GuestCantUseCredits"),
        r(1301002, "InvalidCurrency"),
        r(1301003, "NotEnoughGold"),
        r(1301004, "NotEnoughCredits"),
        r(1401001, "ItemMustBeInBag"),
        r(1401002, "NotUpgraded"),
        r(1004002, "ItemNotInBag"),
        r(1004003, "NotEnoughItems"),
        r(1004004, "BagIsFull"),
        r(1004005, "RequiredTakeOffTwoItems"),
        r(1004006, "ItemIsNotEquippable"),
        r(1004007, "ItemIsAlreadyEquipped"),
        r(1004008, "ItemIsExpired"),
        r(1004009, "ItemReqNotFullfilled"),
        r(1004010, "ItemNoUsesLeft"),
        r(1004011, "ItemUsedInBattle"),
        r(1006001, "NotSummable"),
        r(1006002, "DifferentLevels"),
        r(1006003, "DifferentExpires"),
        r(1006004, "DifferentCustomTeleports"),
        r(1006005, "SelectedOutfitMissmatch"),
        r(1007001, "InvalidOperation"),
        r(1008001, "TalismanSuccessful"),
        r(1008002, "TalismanAlreadyActivated"),
        r(1101002, "MissingSelectorStat"),
        r(1601001, "TooFastLinkedGetLinkedItem"),
        r(1501001, "LinkedItemDoesNotExist"),
        r(1501002, "TooMuchLinkedItem"),
        r(1501003, "ChatCharacterLimitExceeded"),
        r(1701001, "TooHighLevelToAttack"),
        r(1702002, "GroupFightConfirm"),
        r(1801001, "EnhancementLimitExceed"),
        r(1902001, "InvalidAuctionTime"),
        r(2101001, "FreeSkillsTime"),
        r(1905001, "AuctionSellConfirm"),
        r(1901001, "ChangeAllAuctionsTime"),
        r(1904001, "FeaturedAuctionLimitReached"),
        r(1903001, "ObservedAuction"),
        r(2201001, "TradeAcceptCanceled", 1),
        r(2202001, "AcceptanceIsLocked"),
        r(2202002, "OfferIsChanged"),
        r(2301001, "ClanNameChange", 2),
        r(2302001, "ClanNameIsTooLong "),
        r(2302002, "ClanNameIsImproper"),
        r(2302003, "ClanNameContainsTooManyCapitalLetters"),
        r(2302004, "ClanNameContainsInvalidCapitalLetters"),
        r(2302005, "ClanNameContainsForbiddenPhrases"),
        r(2401001, "CouldNotThrowAwayQuestItem"),
        r(2501001, "ExpbackCreditsConfirm", 1),
        r(1801012, "ItemSplitLimit"),
        r(1801013, "ShopBuyLimit"),
        r(1801014, "MailSendLimit"),
        r(1801015, "TradeLimit"),
        r(1801016, "AuctionSellLimit"),
        r(1801017, "ItemGroundDropLimit"),
        r(1801018, "ItemGroundTakeLimit"),
        t = {},
        function(e, n) {
            if (t[e])
                throw "WRAPPER MESSAGE ID: ".concat(e, " ALREADY EXIST! YOU NEED USE ANOTHER!");
            t[e] = {
                keyName: n
            }
        }(1004001, "confirm-prompt-ask-message-wrapper"),
        function() {
            for (var r in e) {
                var o = a(r, i(r));
                _t(o, null, n)
            }
            for (var m in t) {
                var u = s(m);
                _t(u, null, n)
            }
        }()
    }
    ,
    this.updateData = function(e) {
        for (var t in e)
            if (c(t)) {
                var n = e[t].params
                  , a = e[t].confirm;
                if (a)
                    return void l(t, n, a);
                I(t, n)
            }
    }
}
function nightController() {
    var t = null
      , n = function(t) {
        var n = t.night;
        if ("REMOVE" == n.action && (r(null),
        i()),
        "CREATE" == n.action) {
            if (r(t),
            i(),
            n.dayNightCycle)
                return;
            if (get_config_opt(11))
                return;
            o(t.night)
        }
    }
      , i = function() {
        $(".nightfilterwrapper").remove()
    }
      , r = function(n) {
        t = n
    }
      , o = function(t) {
        if (checkFilterDataCorrect(t) && (i(),
        !isset(t.remove))) {
            var n = $("#ground").width()
              , r = $("#ground").height()
              , o = $('<div class="nightfilterwrapper"></div>');
            o.css({
                width: n,
                height: r,
                background: "rgba(".concat(t.color.r, ",").concat(t.color.g, ",").concat(t.color.b, ",").concat(t.color.a, ")"),
                zIndex: getLayerOrder(map.y, 11)
            }),
            $("#base").append(o)
        }
    };
    this.init = function() {}
    ,
    this.updateData = n,
    this.rebuiltAfterSettingsSave = function() {
        null != t && n(t)
    }
}
function CrossStorage() {
    var t = this;
    this.storage = null,
    this._isConnected = !1,
    this.init = function() {
        var n = t.getHitUrl();
        return t.storage = new CrossStorageClient(n),
        t.storage.onConnect().then((function() {
            t._isConnected = !0
        }
        ), (function(t) {}
        ))
    }
    ,
    this.getHitUrl = function() {
        return "".concat(_COMMONS_PATH, "/cross-storage/hub.html")
    }
    ,
    this.set = function(n, e) {
        return "string" == typeof e ? t.storage.set(n, e) : t.storage.set(n, JSON.stringify(e))
    }
    ,
    this.get = function(n) {
        return t.storage.get(n)
    }
}
function _slicedToArray(e, t) {
    return _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _unsupportedIterableToArray(e, t) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var n = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === n && e.constructor && (n = e.constructor.name),
        "Map" === n || "Set" === n ? Array.from(e) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var n = 0, a = new Array(t); n < t; n++)
        a[n] = e[n];
    return a
}
function _iterableToArrayLimit(e, t) {
    var n = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (null != n) {
        var a, i, r = [], l = !0, s = !1;
        try {
            for (n = n.call(e); !(l = (a = n.next()).done) && (r.push(a.value),
            !t || r.length !== t); l = !0)
                ;
        } catch (e) {
            s = !0,
            i = e
        } finally {
            try {
                l || null == n.return || n.return()
            } finally {
                if (s)
                    throw i
            }
        }
        return r
    }
}
function _arrayWithHoles(e) {
    if (Array.isArray(e))
        return e
}
function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
function _defineProperty(e, t, n) {
    return t in e ? Object.defineProperty(e, t, {
        value: n,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : e[t] = n,
    e
}
function disableItemsManager() {
    var e = this;
    this.CONST = {
        AUCTION: "AUCTION"
    },
    this.allKinds = ["mail", "shop", "barter", "salvage", "enhance", "enhance-ingr", "extraction", "bonus-reselect", this.CONST.AUCTION],
    this.allDisableItemStats = null,
    this.allDisableItemClass = null,
    this.allAllowItemClass = null,
    this.allEnableTpl = null,
    this.disableExpiresStat = null,
    this.disableEq = null,
    this.disabledItems = [],
    this.activeDisableKinds = {},
    this.init = function() {
        e.initAllDisableKinds()
    }
    ,
    this.testExpires = function() {
        for (var t in e.allDisableItemStats) {
            if (e.allDisableItemStats[t].includes("expires"))
                return void console.error("[DisableItemsManager.js, testExpires] Stat expires is forbidden")
        }
    }
    ,
    this.testKinds = function(t) {
        for (var n = 0; n < e.allKinds.length; n++) {
            var a = e.allKinds[n];
            if (!t.hasOwnProperty(a))
                return console.error("[DisableItemsManager.js, testKinds] Has not property:", a, t),
                void console.trace()
        }
    }
    ,
    this.initAllDisableKinds = function() {
        e.allDisableItemStats = _defineProperty({
            mail: ["permbound", "soulbound"],
            shop: [],
            barter: [],
            salvage: ["cursed", "artisan_worthless", {
                lvl: ["<", 20]
            }],
            enhance: ["cursed", {
                lvl: ["<", 20]
            }],
            "enhance-ingr": ["cursed", "artisan_worthless", {
                lvl: ["<", 20]
            }],
            extraction: [],
            "bonus-reselect": []
        }, e.CONST.AUCTION, ["noauction", "permbound"]),
        e.allAllowItemStats = _defineProperty({
            mail: [],
            shop: [],
            barter: [],
            salvage: [],
            enhance: [],
            "enhance-ingr": [],
            extraction: ["enhancement_upgrade_lvl"],
            "bonus-reselect": ["bonus"]
        }, e.CONST.AUCTION, []),
        e.allDisableItemClass = _defineProperty({
            mail: [],
            shop: [17, 19, 25, 26, 27],
            barter: [],
            salvage: [],
            enhance: [],
            "enhance-ingr": [],
            extraction: [],
            "bonus-reselect": []
        }, e.CONST.AUCTION, [17, 18, 19, 25, 26, 27]),
        e.allAllowItemClass = _defineProperty({
            mail: [],
            shop: [],
            barter: [],
            salvage: Array.from({
                length: 14
            }, (function(e, t) {
                return t + 1
            }
            )),
            enhance: Array.from({
                length: 14
            }, (function(e, t) {
                return t + 1
            }
            )),
            "enhance-ingr": Array.from({
                length: 14
            }, (function(e, t) {
                return t + 1
            }
            )),
            extraction: [],
            "bonus-reselect": []
        }, e.CONST.AUCTION, []),
        e.allEnableTpl = _defineProperty({
            mail: null,
            shop: null,
            barter: null,
            salvage: null,
            enhance: null,
            "enhance-ingr": null,
            extraction: null,
            "bonus-reselect": null
        }, e.CONST.AUCTION, null),
        e.enableLinkedConditions = _defineProperty({
            mail: null,
            shop: null,
            barter: null,
            salvage: null,
            enhance: null,
            "enhance-ingr": [{
                classes: [26],
                stats: ["enhancement_add"]
            }, {
                classes: [26],
                stats: ["enhancement_add_point"]
            }],
            extraction: null,
            "bonus-reselect": null
        }, e.CONST.AUCTION, null),
        e.disableExpiresStat = _defineProperty({
            mail: null,
            shop: null,
            barter: !0,
            salvage: "all",
            enhance: "all",
            "enhance-ingr": "all",
            extraction: null,
            "bonus-reselect": null
        }, e.CONST.AUCTION, null),
        e.disableEq = _defineProperty({
            mail: !1,
            shop: !1,
            barter: !1,
            salvage: !0,
            enhance: !1,
            "enhance-ingr": !0,
            extraction: !0,
            "bonus-reselect": !0
        }, e.CONST.AUCTION, null),
        e.testKinds(e.allAllowItemStats),
        e.testKinds(e.allAllowItemClass),
        e.testKinds(e.allEnableTpl),
        e.testKinds(e.disableExpiresStat),
        e.testKinds(e.disableEq),
        e.testExpires()
    }
    ,
    this.addToActiveDisableKinds = function(t) {
        e.activeDisableKinds[t] = !0
    }
    ,
    this.removeFromActiveDisableKinds = function(t) {
        delete e.activeDisableKinds[t]
    }
    ,
    this.addDisableClassToItem = function(t, n) {
        t.addClass(n + "-disable disable-item-mark"),
        e.addDisableIcon(t)
    }
    ,
    this.addDisableIcon = function(e) {
        if (!e.find(".choose-icon").length) {
            var t = "disable-icon";
            if (!e.find(".".concat(t)).length) {
                var n = $("<div>").addClass(t);
                e.append(n)
            }
        }
    }
    ,
    this.removeDisableIcon = function(e) {
        e.find(".disable-icon").remove()
    }
    ,
    this.prepareClassToDisable = function(e) {
        for (var t = e.split(","), n = Array.from(new Array(27), (function(e, t) {
            return t + 1
        }
        )); t.length; ) {
            var a = parseInt(t[0])
              , i = n.indexOf(a);
            i > -1 && n.splice(i, 1),
            t.splice(0, 1)
        }
        return n
    }
    ,
    this.checkShopItemShouldBeDisable = function(t) {
        var n = get_shop_purchase();
        return "*" != n && ("" == n || e.prepareClassToDisable(n).indexOf(t.cl) > -1)
    }
    ,
    this.manageItemDisableInHeroEQ = function(t, n) {
        e.manageItemDisable(t, n, e.activeDisableKinds)
    }
    ,
    this.manageItemDisable = function(t, n, a) {
        if (!e.checkLinkedConditionsFulfilled(a, t)) {
            var i = e.createArrayResult(a, t);
            for (var r in i) {
                var l = i[r];
                l && e.addDisableClassToItem(n, l)
            }
        }
    }
    ,
    this.checkRequires = function(t, n) {
        if (e.checkLinkedConditionsFulfilled(n, t))
            return !0;
        var a = e.createArrayResult(n, t);
        for (var i in a)
            if (a[i])
                return !0;
        return !1
    }
    ,
    this.createArrayResult = function(t, n) {
        var a = [];
        return a.push(e.checkShops(t, n)),
        a.push(e.checkStats(t, n)),
        a.push(e.checkStats(t, n, !1)),
        a.push(e.checkExpires(t, n)),
        a.push(e.checkClass(t, n)),
        a.push(e.checkClass(t, n, !1)),
        a.push(e.checkEq(t, n)),
        a.push(e.checkTpl(t, n)),
        a
    }
    ,
    this.checkShops = function(t, n) {
        if (e.activeDisableKinds.shop) {
            if (is_only_buy_shop())
                return !1;
            if (e.checkShopItemShouldBeDisable(n))
                return "shop"
        }
        return !1
    }
    ,
    this.checkStats = function(t, n) {
        var a = !(arguments.length > 2 && void 0 !== arguments[2]) || arguments[2];
        for (var i in t) {
            if (!e.checkDisableKindExist(i))
                return !1;
            if ("shop" != i || !is_only_buy_shop())
                for (var r = a ? e.allDisableItemStats[i] : e.allAllowItemStats[i], l = 0; l < r.length; l++) {
                    var s = r[l];
                    if (!(!e.statCheckCanDisabled(n, s) && a || e.statCheckCanDisabled(n, s) && !a))
                        return i
                }
        }
        return !1
    }
    ,
    this.checkStat = function(e, t) {
        return e.hasOwnProperty(t)
    }
    ,
    this.statCheckCanDisabled = function(t, n) {
        var a = parseItemStat(t.stat);
        if ("object" === _typeof(n))
            for (var i in n) {
                if (!e.checkStat(a, i))
                    return !0;
                var r = _slicedToArray(n[i], 2)
                  , l = r[0]
                  , s = r[1]
                  , o = a[i];
                if (count(l, o, s))
                    return !0
            }
        else if (e.checkStat(a, n))
            return !0;
        return !1
    }
    ,
    this.checkClass = function(t, n) {
        var a = !(arguments.length > 2 && void 0 !== arguments[2]) || arguments[2];
        for (var i in t) {
            if (!e.checkDisableItemClassNameExist(i))
                return !1;
            var r = a ? e.allDisableItemClass[i] : e.allAllowItemClass[i];
            if (("shop" != i || !is_only_buy_shop()) && (r.length && (r.indexOf(n.cl) > -1 && a || -1 === r.indexOf(n.cl) && !a)))
                return i
        }
        return !1
    }
    ,
    this.checkExpires = function(t, n) {
        var a = parseItemStat(n.stat);
        for (var i in t) {
            if (!e.checkDisableItemClassNameExist(i))
                return !1;
            var r = e.disableExpiresStat[i];
            if (("shop" != i || !is_only_buy_shop()) && (null != r && e.checkStat(a, "expires"))) {
                var l = checkItemExpires(n);
                switch (r) {
                case null:
                    break;
                case !0:
                    if (l)
                        return i;
                    break;
                case !1:
                    if (!l)
                        return i;
                    break;
                case "all":
                    return i;
                default:
                    return console.error("[DisableItemsManager.js, checkExpires] BAD TYPE EXPIRES OPTION", r),
                    !1
                }
            }
        }
        return !1
    }
    ,
    this.checkEq = function(t, n) {
        for (var a in t) {
            if (!e.checkDisableKindExist(a))
                return !1;
            if (null !== e.disableEq[a] && (0 !== n.st && e.disableEq[a]))
                return a
        }
        return !1
    }
    ,
    this.createResultItemData = function(e, t) {
        return {
            itemView: e[0],
            disableKind: t
        }
    }
    ,
    this.checkTpl = function(t, n) {
        for (var a in t)
            if (null != e.allEnableTpl[a] && !e.allEnableTpl[a].includes(n.tpl))
                return a;
        return !1
    }
    ,
    this.checkLinkedConditionsFulfilled = function(t, n) {
        for (var a in t)
            if (null != e.enableLinkedConditions[a])
                for (var i in e.enableLinkedConditions[a]) {
                    var r = e.enableLinkedConditions[a][i];
                    if (e.checkOneLinkedRecord(r, n))
                        return !0
                }
        return !1
    }
    ,
    this.checkOneLinkedRecord = function(t, n) {
        var a = [];
        if (t.stats) {
            for (var i = [], r = 0; r < t.stats.length; r++) {
                var l = t.stats[r];
                i.push(e.statCheckCanDisabled(n, l))
            }
            var s = e.checkIsArrayWithAllTheSameVal(i, !0);
            a.push(s)
        }
        return t.classes && a.push(t.classes.includes(n.cl)),
        e.checkIsArrayWithAllTheSameVal(a, !0)
    }
    ,
    this.checkIsArrayWithAllTheSameVal = function(e, t) {
        return e.every((function(e) {
            return e == t
        }
        ))
    }
    ,
    this.getEnabledItems = function() {
        var t = getHItems();
        return Object.keys(t).map(Number).filter((function(t) {
            return !e.disabledItems.includes(t)
        }
        ))
    }
    ,
    this.startSpecificItemKindDisable = function(t, n) {
        if (e.checkDisableKindExist(t)) {
            e.addToActiveDisableKinds(t);
            var a = getHItems();
            for (var i in n && e.addToEnableTplByKind(t, n),
            a) {
                var r = $("#item" + i);
                if (!r.length)
                    return console.warn("[DisableItemsManager.js, startSpecificItemKindDisable] $view not find", i);
                e.manageItemDisable(a[i], r, e.activeDisableKinds)
            }
        }
    }
    ,
    this.endSpecificItemKindDisable = function(t) {
        e.checkDisableKindExist(t) && (e.removeFromActiveDisableKinds(t),
        e.removeFromEnableTpl(t),
        e.manageOfDeleteDisableItemMarkClass(t))
    }
    ,
    this.manageOfDeleteDisableItemMarkClass = function(t) {
        var n = t + "-disable"
          , a = $("." + n)
          , i = e;
        a.removeClass(n),
        a.each((function() {
            for (var e = 0; e < i.allKinds.length; e++) {
                var t = i.allKinds[e];
                if ($(this).hasClass(t + "-disable"))
                    return
            }
            $(this).removeClass("disable-item-mark"),
            i.removeDisableIcon($(this))
        }
        ))
    }
    ,
    this.addToEnableTplByKind = function(t, n) {
        e.allEnableTpl[t] = n
    }
    ,
    this.removeFromEnableTpl = function(t) {
        e.allEnableTpl[t] = null
    }
    ,
    this.checkDisableKindExist = function(t) {
        return !!e.allDisableItemStats[t] || (console.error("[DisableItemsManager.js, checkDisableKindExist] Bad disable kind!!! ", t),
        !1)
    }
    ,
    this.checkDisableItemClassNameExist = function(t) {
        return !!e.allDisableItemClass[t] || (console.error("[DisableItemsManager.js, checkDisableItemClassNameExist] Bad disable ItemClass!!! ", t),
        !1)
    }
}
function _createForOfIteratorHelper(e, r) {
    var t = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (!t) {
        if (Array.isArray(e) || (t = _unsupportedIterableToArray(e)) || r && e && "number" == typeof e.length) {
            t && (e = t);
            var o = 0
              , n = function() {};
            return {
                s: n,
                n: function() {
                    return o >= e.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: e[o++]
                    }
                },
                e: function(e) {
                    throw e
                },
                f: n
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var i, a = !0, s = !1;
    return {
        s: function() {
            t = t.call(e)
        },
        n: function() {
            var e = t.next();
            return a = e.done,
            e
        },
        e: function(e) {
            s = !0,
            i = e
        },
        f: function() {
            try {
                a || null == t.return || t.return()
            } finally {
                if (s)
                    throw i
            }
        }
    }
}
function _unsupportedIterableToArray(e, r) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, r);
        var t = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === t && e.constructor && (t = e.constructor.name),
        "Map" === t || "Set" === t ? Array.from(e) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(e, r) : void 0
    }
}
function _arrayLikeToArray(e, r) {
    (null == r || r > e.length) && (r = e.length);
    for (var t = 0, o = new Array(r); t < r; t++)
        o[t] = e[t];
    return o
}
function itemsMovedManager() {
    var e = this
      , r = this;
    this.items = [],
    this.init = function() {}
    ,
    this.addItem = function(r, t, o) {
        e.items.push({
            id: r.id,
            loc: t
        }),
        e.createMoveItem(r.id, o)
    }
    ,
    this.createMoveItem = function(r, t) {
        g.item[r];
        var o = $("#item" + r);
        e.addChooseToViews(r, o, "moved disable-item-mark", t)
    }
    ,
    this.removeMoveItem = function(r) {
        g.item[r];
        var t = $("#item" + r);
        e.removeClassFromElements(t, "moved disable-item-mark")
    }
    ,
    this.removeItem = function(t) {
        e.items = e.items.filter((function(e) {
            return e.id == t && r.removeMoveItem(e.id),
            e.id != t
        }
        ))
    }
    ,
    this.removeItemsByTarget = function(t) {
        var o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : [];
        e.items = e.items.filter((function(e) {
            return 0 === o.length ? (e.loc === t && r.removeMoveItem(e.id),
            e.loc !== t) : (e.loc !== t || o.includes(e.id) || r.removeMoveItem(e.id),
            e.loc !== t || o.includes(e.id))
        }
        ))
    }
    ,
    this.addChooseToViews = function(r, t, o, n) {
        var i, a = _createForOfIteratorHelper(Array.isArray(t) ? t : [t]);
        try {
            for (a.s(); !(i = a.n()).done; ) {
                var s = i.value;
                e.addChooseToOneView(r, s, o, n)
            }
        } catch (e) {
            a.e(e)
        } finally {
            a.f()
        }
    }
    ,
    this.addChooseToOneView = function(e, r, t, o) {
        if (!r.find(".choose-icon").length) {
            var n = $("<div>").addClass("choose-icon")
              , i = $("<div>").addClass("click-area");
            r.addClass(t),
            r.append(n),
            r.append(i),
            i.click((function(e) {
                e.stopPropagation(),
                o && o()
            }
            ))
        }
    }
    ,
    this.removeChooseIcon = function(e) {
        e.find(".choose-icon").remove(),
        e.find(".click-area").remove()
    }
    ,
    this.removeClassFromElements = function(r, t) {
        var o, n = _createForOfIteratorHelper(Array.isArray(r) ? r : [r]);
        try {
            for (n.s(); !(o = n.n()).done; ) {
                var i = o.value;
                i.removeClass(t),
                e.removeChooseIcon(i)
            }
        } catch (e) {
            n.e(e)
        } finally {
            n.f()
        }
    }
}
function BusinessCardsManager() {
    var n = {}
      , t = function(t) {
        return n[t]
    }
      , i = function() {
        return new BusinessCard
    }
      , a = function(t) {
        return !!n[t]
    }
      , r = function(t, i) {
        n[t] = i
    };
    this.init = function() {}
    ,
    this.updateData = function(n) {
        for (var u in n) {
            var s = n[u]
              , e = s.id
              , c = null;
            a(e) ? c = t(e) : ((c = i()).init(),
            r(e, c)),
            c.updateData(s)
        }
    }
    ,
    this.getCard = t,
    this.checkCardExist = a
}
function BusinessCard() {
    var t = null
      , n = null
      , i = null
      , s = null
      , e = null
      , u = null
      , c = null;
    this.getAcc = function() {
        return t
    }
    ,
    this.getIcon = function() {
        return n
    }
    ,
    this.getId = function() {
        return i
    }
    ,
    this.getLvl = function() {
        return s
    }
    ,
    this.getNick = function() {
        return e
    }
    ,
    this.getProf = function() {
        return u
    }
    ,
    this.getSex = function() {
        return c
    }
    ,
    this.init = function() {}
    ,
    this.updateData = function(l) {
        isset(l.acc) && (t = l.acc),
        isset(l.icon) && (n = l.icon),
        isset(l.id) && (i = l.id),
        isset(l.lvl) && (s = l.lvl),
        isset(l.nick) && (e = l.nick),
        isset(l.prof) && (u = l.prof),
        isset(l.sex) && (c = l.sex)
    }
}
function ChatTemplates() {
    var a = {}
      , n = function() {
        a["chat-channel-card-wrapper"] = '\n    <div class="chat-channel-card-wrapper">\n\n    </div>',
        a["chat-channel-card"] = '\n    <div class="chat-channel-card">\n        <div class="chat-channel-card-icon"></div>\n        <div class="chat-channel-not-read-counter"></div>\n    </div>',
        a["chat-configure-window"] = '\n    <div class="chat-configure-window">\n        <div class="middle-graphic"></div>\n        <div class="chat-option-header" data-trans="#notifications#chat_lang"></div>\n        <div class="notification-text" data-trans="#notifications_on_global_chat#chat_lang"></div>\n        <div class="notification-configuration"></div>\n        <div class="chat-option-header" data-trans="#formatting#chat_lang"></div>\n        <div class="time-configuration"></div>\n        <div class="tag-configuration"></div>\n    </div>\n',
        a["info-icon"] = '<div class="info-icon"></div>',
        a["chat-input-wrapper"] = '\n    <div class="chat-input-wrapper">\n        <div class="control-wrapper">\n            <div class="menu-card">\n                <div class="card-name"></div>\n                <div class="card-remove close-button"></div>\n                <div class="card-list"></div>\n            </div>\n            <div class="private-nick"></div>\n            <div class="style-message"></div>\n            <div class="chat-notification-wrapper"></div>\n            <div class="chat-config-wrapper"></div>\n        </div>\n        <div class="magic-input-wrapper"></div>\n    </div>',
        a["new-chat-message"] = '\n    <div class="new-chat-message">\n        <span class="information-part">\n            <span class="ts-section"></span>\n            <span class="channel-section"></span>\n            <span class="author-section"></span>\n            \x3c!--<span class="receiver-arrow-section">-></span>--\x3e\n            <span class="receiver-section"></span>\n        </span>\n        <span class="message-part">\n            <span class="message-section"></span>\n        </span>\n\n    </div>\n',
        a["chat-message-wrapper"] = '\n    <div class="scroll-wrapper chat-message-wrapper">\n        <div class="scroll-pane"></div>\n    </div>',
        a["chat-notification-wrapper"] = '\n    <div class="chat-notification-wrapper">\n\n    </div>',
        a["new-chat-window"] = '\n    <div class="new-chat-window">\n        <div class="chat-channel-card-wrapper"></div>\n        <div class="chat-message-wrapper"></div>\n        <div class="chat-input-wrapper"></div>\n    </div>\n'
    };
    this.get = function(n) {
        if (a[n])
            return $(a[n]);
        console.error("Templates not exist!", n)
    }
    ,
    this.init = function() {
        n()
    }
}
function ChatChannelCardWrapper() {
    var a, n = null, t = {}, e = function() {
        n = g.chatController.getChatTemplates().get("chat-channel-card-wrapper")
    }, c = function() {
        g.chatController.getChatWindow().get$chatWindow().find(".chat-channel-card-wrapper").replaceWith(n)
    }, o = function() {
        var a = ChatData.CHANNEL;
        for (var t in a) {
            var e = h(a[t]);
            n.append(e)
        }
    }, r = function() {
        var a = ChatData.CHANNEL;
        for (var n in a)
            t[n] = 0
    }, h = function(a) {
        var n = g.chatController.getChatTemplates().get("chat-channel-card");
        n.addClass("".concat(a, "-channel")),
        n.on("click", (function() {
            g.chatController.getChatChannelsAvailable().checkAvailableProcedure(a) && (l(a, !1),
            g.chatController.getChatWindow().setChannel(a))
        }
        ));
        var t = g.chatController.chatLang(a.toLocaleLowerCase());
        return n.tip(t),
        n
    }, l = function(a, t) {
        var e = t ? "block" : "none";
        0 == t && (i(a),
        C(a)),
        n.find(".".concat(a, "-channel")).find(".chat-channel-not-read-counter").css("display", e)
    }, i = function(a) {
        t[a] = 0
    }, C = function(a) {
        var e = t[a];
        n.find(".".concat(a, "-channel")).find(".chat-channel-not-read-counter").html(e > 99 ? "+99" : e)
    };
    this.init = function() {
        e(),
        c(),
        o(),
        r()
    }
    ,
    this.addOneMessageCounterProcedure = function(n, e, c) {
        if (!c && hero.nick != e && a != n) {
            var o = g.chatController.getChatConfig().getMessagesAddToGlobalData(n, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD);
            a == ChatData.CHANNEL.GLOBAL && o || (!function(a) {
                t[a]++
            }(n),
            C(n),
            l(n, !0))
        }
    }
    ,
    this.setChannelCard = function(t) {
        a = t,
        n.find(".chat-channel-card").removeClass("active"),
        n.find(".".concat(t, "-channel")).addClass("active")
    }
    ,
    this.getActiveChannelName = function() {
        return a
    }
}
function ChatChannelsAvailable() {
    var a = {}
      , e = function() {
        var e = ChatData.AVAILABLE;
        for (var n in e)
            a[n] = e[n]
    }
      , n = function(e) {
        if (isset(a[e]))
            return !!a[e];
        errorReport("ChatChannelAvailable.js", "checkAvailable", "channelName: " + e + " not exist in ", a)
    };
    this.init = function() {
        e()
    }
    ,
    this.setAvailable = function(e, n) {
        isset(a[e]) ? a[e] = n : errorReport("ChatChannelAvailable.js", "setAvailable", "channelName: " + e + " not exist in ", a)
    }
    ,
    this.checkAvailableProcedure = function(a) {
        return !!n(a) || (message(g.chatController.chatLang("channel_not_available", {
            "%channel%": a.toLowerCase()
        })),
        !1)
    }
    ,
    this.checkAvailable = n
}
function ChatConfig() {
    var t = null
      , a = null
      , o = null
      , e = {}
      , S = function() {
        for (var a in t = {},
        ChatData.MESSAGES_ADD_TO_GLOBAL) {
            var o = ChatData.MESSAGES_ADD_TO_GLOBAL[a]
              , e = copyStructure(o);
            for (var S in t[a] = e,
            e) {
                var r = s(ChatData.STATIC_KEYS.MESSAGES_ADD_TO_GLOBAL, a, S);
                null !== r && (e[S] = r)
            }
        }
    }
      , r = function() {
        for (var t in a = {},
        ChatData.MESSAGE_SECTIONS_VISIBLE) {
            var o = ChatData.MESSAGE_SECTIONS_VISIBLE[t]
              , e = copyStructure(o);
            for (var S in a[t] = e,
            e) {
                var r = s(t, S);
                null !== r && (e[S] = r)
            }
        }
    }
      , n = function() {
        for (var t in o = {},
        ChatData.INPUT_CHANNEL_HEADER) {
            var a = ChatData.INPUT_CHANNEL_HEADER[t];
            o[a.name] = {
                heroMsgColor: a.heroMsgColor,
                otherMsgColor: a.otherMsgColor
            }
        }
    }
      , s = function(t, a, o) {
        return isset(e[t]) && isset(e[t][a]) ? isset(o) ? isset(e[t][a][o]) ? e[t][a][o] : null : e[t][a] : null
    };
    this.init = function() {
        S(),
        r(),
        n()
    }
    ,
    this.setStorageData = function(t, a) {
        var o = t[0]
          , S = t[1]
          , r = isset(t[2]) ? t[2] : null;
        e[o] || (e[o] = {}),
        null == r ? e[o][S] = a : (e[o][S] || (e[o][S] = {}),
        e[o][S][r] = a)
    }
    ,
    this.getStorageData = s,
    this.allStorageData = function() {
        return e
    }
    ,
    this.getMessageSectionData = function(t, o) {
        return isset(ChatData.MESSAGE_SECTIONS_VISIBLE[t]) ? isset(ChatData.MESSAGE_SECTIONS_VISIBLE[t][o]) ? a[t][o] : (errorReport("ChatConfig.js", "getMessageSectionData", "SUB_SECTION: ".concat(o, " not exist!"), ChatData.MESSAGE_SECTIONS_VISIBLE[t][o]),
        !1) : (errorReport("ChatConfig.js", "getMessageSectionData", "SECTION: ".concat(t, " not exist!"), ChatData.MESSAGE_SECTIONS_VISIBLE),
        !1)
    }
    ,
    this.getMessagesAddToGlobalData = function(a, o) {
        return a == ChatData.CHANNEL.GLOBAL || (isset(ChatData.MESSAGES_ADD_TO_GLOBAL[a]) ? isset(ChatData.MESSAGES_ADD_TO_GLOBAL_OPT[o]) ? t[a][o] : (errorReport("ChatConfig.js", "getMessagesAddToGlobalData", "OPT: ".concat(o, " not exist!"), ChatData.MESSAGES_ADD_TO_GLOBAL_OPT),
        !1) : (errorReport("ChatConfig.js", "getMessagesAddToGlobalData", "SECTION: ".concat(a, " not exist!"), ChatData.MESSAGES_ADD_TO_GLOBAL[a]),
        !1))
    }
    ,
    this.getChannelColor = function(t, a) {
        var e = a ? "heroMsgColor" : "otherMsgColor";
        return o[t][e]
    }
    ,
    this.updateSectionsVisible = r,
    this.updateMessagesAddToGlobal = S
}
function ChatConfigureWindow() {
    var a = null
      , t = null
      , e = function() {
        t = g.chatController.getChatTemplates().get("chat-configure-window"),
        (a = g.windowManager.add({
            content: t,
            title: g.chatController.chatLang("chat_options"),
            nameWindow: g.windowsData.name.CHAT_CONFIGURE,
            onclose: function() {
                c(),
                g.chatController.getChatInputWrapper().clearChatConfigureWindow()
            }
        })).addToAlertLayer(),
        a.center()
    }
      , n = function() {
        var t = a.$.find(".time-configuration").empty()
          , e = g.chatController.getChatConfig().getMessageSectionData(ChatData.MESSAGE_SECTIONS.TS, ChatData.MESSAGE_SUB_SECTIONS.TWELVE_HOUR)
          , n = {
            radios: [{
                value: 1,
                label: "12h",
                selected: e
            }, {
                value: 0,
                label: "24h",
                selected: !e
            }],
            name: ChatData.MESSAGE_SUB_SECTIONS.TWELVE_HOUR,
            onSelected: l
        }
          , o = g.chatController.getChatConfig().getMessageSectionData(ChatData.MESSAGE_SECTIONS.TS, ChatData.MESSAGE_SUB_SECTIONS.ALL_UNIT)
          , S = {
            radios: [{
                value: 0,
                label: "hh:mm",
                selected: !o
            }, {
                value: 1,
                label: "hh:mm:ss",
                selected: o
            }],
            name: ChatData.MESSAGE_SUB_SECTIONS.ALL_UNIT,
            onSelected: l
        }
          , i = new RadioList.default(n,{
            isInline: !0,
            label: g.chatController.chatLang("time_format")
        }).getList()
          , c = new RadioList.default(S,{
            isInline: !0,
            label: g.chatController.chatLang("hour_format")
        }).getList()
          , C = createCheckBox(g.chatController.chatLang("show_time"), "", (function(a) {
            g.chatController.getChatConfig().setStorageData([ChatData.MESSAGE_SECTIONS.TS, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY], a),
            a ? (i.classList.add("active-section"),
            c.classList.add("active-section")) : (i.classList.remove("active-section"),
            c.classList.remove("active-section")),
            g.chatController.rebuiltMessage()
        }
        ));
        g.chatController.getChatConfig().getMessageSectionData(ChatData.MESSAGE_SECTIONS.TS, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY) && (C.find(".checkbox").addClass("active"),
        i.classList.add("active-section"),
        c.classList.add("active-section")),
        t.append(C),
        t[0].appendChild(i),
        t[0].appendChild(c)
    }
      , o = function() {
        var t = a.$.find(".tag-configuration").empty()
          , e = g.chatController.getChatConfig().getMessageSectionData(ChatData.MESSAGE_SECTIONS.CHANNEL_TAG, ChatData.MESSAGE_SUB_SECTIONS.ALL_TAG)
          , n = {
            radios: [{
                value: 1,
                label: _t("full_channel_tag", null, "chat_lang"),
                selected: e
            }, {
                value: 0,
                label: _t("shot_channel_tag", null, "chat_lang"),
                selected: !e
            }],
            name: ChatData.MESSAGE_SUB_SECTIONS.ALL_TAG,
            onSelected: l
        }
          , o = _t("tag_format", null, "chat_lang")
          , S = $("<div>").addClass("small-icon-wrapper").append(g.chatController.getChatTemplates().get("info-icon").addClass("small-info").tip(_t("tag_format_tip", null, "chat_lang")))
          , i = new RadioList.default(n,{
            isInline: !0,
            label: o,
            elementAfterLabel: S[0]
        }).getList()
          , c = createCheckBox(_t("tag_show_options", null, "chat_lang"), "", (function(a) {
            g.chatController.getChatConfig().setStorageData([ChatData.MESSAGE_SECTIONS.CHANNEL_TAG, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY], a),
            a ? i.classList.add("active-section") : i.classList.remove("active-section"),
            g.chatController.rebuiltMessage()
        }
        ));
        g.chatController.getChatConfig().getMessageSectionData(ChatData.MESSAGE_SECTIONS.CHANNEL_TAG, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY) && (c.find(".checkbox").addClass("active"),
        i.classList.add("active-section")),
        t.append(c),
        t[0].appendChild(i)
    }
      , l = function(a, t) {
        var e = a.target.value
          , n = a.target.name;
        "1" === e && (e = !0),
        "0" === e && (e = !1);
        var o = g.chatController.getChatConfig();
        switch (n) {
        case ChatData.MESSAGE_SUB_SECTIONS.ALL_TAG:
            o.setStorageData([ChatData.MESSAGE_SECTIONS.CHANNEL_TAG, n], e);
            break;
        case ChatData.MESSAGE_SUB_SECTIONS.ALL_UNIT:
        case ChatData.MESSAGE_SUB_SECTIONS.TWELVE_HOUR:
            o.setStorageData([ChatData.MESSAGE_SECTIONS.TS, n], e)
        }
        g.chatController.rebuiltMessage()
    }
      , S = function() {
        var t = ChatData.CHANNEL
          , e = a.$.find(".notification-configuration");
        for (var n in t)
            if (n != ChatData.CHANNEL.GLOBAL) {
                var o = i(n, n);
                e.append(o)
            }
    }
      , i = function(a, t) {
        var e = createCheckBox(_t(a.toLowerCase(), null, "chat_lang"), t, (function(t) {
            g.chatController.getChatConfig().setStorageData([ChatData.STATIC_KEYS.MESSAGES_ADD_TO_GLOBAL, a, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD], t),
            g.chatController.rebuiltMessage()
        }
        ));
        return g.chatController.getChatConfig().getMessagesAddToGlobalData(a, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD) && e.find(".checkbox").addClass("active"),
        e
    }
      , c = function() {
        a.remove()
    };
    this.init = function() {
        e(),
        S(),
        n(),
        o()
    }
    ,
    this.closeWindow = c
}
function ChatController() {
    var e = null
      , t = null
      , n = null
      , a = null
      , i = null
      , s = null
      , r = null
      , u = null
      , h = null
      , l = null
      , o = function() {
        e = new ChatTemplates,
        u = new ChatDataUpdater,
        i = new ChatPrivateMessageData,
        a = new ChatChannelsAvailable,
        t = new ChatConfig,
        n = new ChatInputWrapper,
        s = new ChatChannelCardWrapper,
        r = new ChatMessageWrapper,
        h = new ChatWindow,
        e.init(),
        u.init(),
        a.init(),
        i.init(),
        h.init(),
        t.init(),
        n.init(),
        s.init(),
        r.init(),
        C()
    }
      , C = function() {
        l = {};
        var e = ChatData.CHANNEL;
        for (var t in e)
            l[t] = {}
    }
      , c = function(e) {
        var t = [];
        for (var n in e)
            t.push(e[n]);
        return t.sort((function(e, t) {
            return e.getTs() - t.getTs()
        }
        )),
        t
    }
      , g = function() {
        var e = [];
        for (var t in l) {
            var n = l[t];
            for (var a in n)
                e.push(n[a])
        }
        return e
    }
      , d = function(e, t, n) {
        l[n][t] = e
    };
    this.init = function() {
        o(),
        h.setChannel(ChatData.CHANNEL.GLOBAL)
    }
    ,
    this.getChatConfig = function() {
        return t
    }
    ,
    this.getChatWindow = function() {
        return h
    }
    ,
    this.getChatDataUpdater = function() {
        return u
    }
    ,
    this.getChatTemplates = function() {
        return e
    }
    ,
    this.getChatInputWrapper = function() {
        return n
    }
    ,
    this.getChatMessageWrapper = function() {
        return r
    }
    ,
    this.getChatChannelCardWrapper = function() {
        return s
    }
    ,
    this.getChatChannelsAvailable = function() {
        return a
    }
    ,
    this.getChatPrivateMessageData = function() {
        return i
    }
    ,
    this.addMessage = function(e) {
        if (null != e.id) {
            var t = e.id
              , n = e.channel
              , a = new ChatMessage;
            e.receiverBusinessCard && e.authorBusinessCard && e.authorBusinessCard.getNick() != hero.nick && i.addReceiveMessageUser(e.authorBusinessCard.getNick()),
            e.receiverBusinessCard && e.authorBusinessCard && e.authorBusinessCard.getNick() == hero.nick && i.addSendMessageUser(e.receiverBusinessCard.getNick()),
            d(a, t, n),
            a.init(e),
            a.updateMessage(),
            a.appendMessageToChannel()
        } else
            errorReport("ChatController.js", "addMessage", "Chat message id == undefined !")
    }
    ,
    this.rebuiltMessage = function() {
        r.clearAllMessageWrapperChannel(),
        t.updateSectionsVisible(),
        t.updateMessagesAddToGlobal();
        var e = g()
          , n = c(e);
        for (var a in n)
            n[a].updateMessage(),
            n[a].appendMessageToChannel(!0);
        r.updateScroll()
    }
    ,
    this.checkMessageExist = function(e, t) {
        return !!l[t][e]
    }
    ,
    this.addToMessageList = d,
    this.clearMessageList = function(e) {
        l[e] = {}
    }
    ,
    this.chatLang = function(e, t) {
        return _t(e, t || null, "chat_lang")
    }
    ,
    this.getMessageList = function() {
        return l
    }
}
var _ChatData$SERVER_CHAN, _ChatData$MESSAGES_AD2, _ChatData$MESSAGE_SEC, _ChatData$MESSAGE_SUB, _TS, _CHANNEL_TAG, _ChatData$MESSAGE_SEC2, _ChatData$AVAILABLE, _ChatData$INPUT_CHANN, _ChatData$INPUT_CHANN2;
function _defineProperty(t, a, e) {
    return a in t ? Object.defineProperty(t, a, {
        value: e,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : t[a] = e,
    t
}
var ChatData = {
    CHANNEL: null,
    SERVER_CHANNEL: null,
    INPUT_CHANNEL_HEADER: null,
    INPUT_REGEXP: null,
    CHANNEL_INPUT_DATA: null,
    MESSAGE_SECTIONS_VISIBLE: null,
    MESSAGE_SECTIONS: null,
    MESSAGE_SUB_SECTIONS: null,
    MESSAGE_LINK_REGEXP: null,
    MESSAGE_MARK_REGEXP: null,
    NOTIFICATION: null,
    AVAILABLE: null,
    MESSAGES_ADD_TO_GLOBAL: null,
    STATIC_KEYS: null
}
  , TS = "TS"
  , CHANNEL_TAG = "CHANNEL_TAG"
  , DISPLAY = "DISPLAY"
  , ALL_TAG = "ALL_TAG"
  , TWELVE_HOUR = "TWELVE_HOUR"
  , ALL_UNIT = "ALL_UNIT"
  , ADD = "ADD";
ChatData.STYLE = {
    SPECIAL: "special",
    NAR: "nar",
    ME: "me"
},
ChatData.STATIC_KEYS = {
    MESSAGES_ADD_TO_GLOBAL: "MESSAGES_ADD_TO_GLOBAL"
},
ChatData.NOTIFICATION = {
    WATCH: "WATCH",
    WARNING: "WARNING",
    MUTE: "MUTE"
},
ChatData.CHANNEL = {
    GLOBAL: "GLOBAL",
    LOCAL: "LOCAL",
    GROUP: "GROUP",
    CLAN: "CLAN",
    SYSTEM: "SYSTEM",
    PRIVATE: "PRIVATE"
},
ChatData.MESSAGES_ADD_TO_GLOBAL_OPT = _defineProperty({}, ADD, ADD),
ChatData.SERVER_CHANNEL = (_defineProperty(_ChatData$SERVER_CHAN = {}, ChatData.CHANNEL.LOCAL, "local"),
_defineProperty(_ChatData$SERVER_CHAN, ChatData.CHANNEL.GLOBAL, "global"),
_defineProperty(_ChatData$SERVER_CHAN, ChatData.CHANNEL.GROUP, "party"),
_defineProperty(_ChatData$SERVER_CHAN, ChatData.CHANNEL.CLAN, "clan"),
_defineProperty(_ChatData$SERVER_CHAN, ChatData.CHANNEL.SYSTEM, "system"),
_defineProperty(_ChatData$SERVER_CHAN, ChatData.CHANNEL.PRIVATE, "personal"),
_ChatData$SERVER_CHAN),
ChatData.MESSAGES_ADD_TO_GLOBAL = (_defineProperty(_ChatData$MESSAGES_AD2 = {}, ChatData.CHANNEL.LOCAL, _defineProperty({}, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD, !0)),
_defineProperty(_ChatData$MESSAGES_AD2, ChatData.CHANNEL.GROUP, _defineProperty({}, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD, !0)),
_defineProperty(_ChatData$MESSAGES_AD2, ChatData.CHANNEL.CLAN, _defineProperty({}, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD, !0)),
_defineProperty(_ChatData$MESSAGES_AD2, ChatData.CHANNEL.SYSTEM, _defineProperty({}, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD, !0)),
_defineProperty(_ChatData$MESSAGES_AD2, ChatData.CHANNEL.PRIVATE, _defineProperty({}, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD, !0)),
_ChatData$MESSAGES_AD2),
ChatData.MESSAGE_SECTIONS = (_defineProperty(_ChatData$MESSAGE_SEC = {}, TS, TS),
_defineProperty(_ChatData$MESSAGE_SEC, CHANNEL_TAG, CHANNEL_TAG),
_ChatData$MESSAGE_SEC),
ChatData.MESSAGE_SUB_SECTIONS = (_defineProperty(_ChatData$MESSAGE_SUB = {}, DISPLAY, DISPLAY),
_defineProperty(_ChatData$MESSAGE_SUB, TWELVE_HOUR, TWELVE_HOUR),
_defineProperty(_ChatData$MESSAGE_SUB, ALL_UNIT, ALL_UNIT),
_defineProperty(_ChatData$MESSAGE_SUB, ALL_TAG, ALL_TAG),
_ChatData$MESSAGE_SUB),
ChatData.MESSAGE_SECTIONS_VISIBLE = (_defineProperty(_ChatData$MESSAGE_SEC2 = {}, TS, (_defineProperty(_TS = {}, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY, !0),
_defineProperty(_TS, ChatData.MESSAGE_SUB_SECTIONS.TWELVE_HOUR, !1),
_defineProperty(_TS, ChatData.MESSAGE_SUB_SECTIONS.ALL_UNIT, !1),
_TS)),
_defineProperty(_ChatData$MESSAGE_SEC2, CHANNEL_TAG, (_defineProperty(_CHANNEL_TAG = {}, ChatData.MESSAGE_SUB_SECTIONS.DISPLAY, !0),
_defineProperty(_CHANNEL_TAG, ChatData.MESSAGE_SUB_SECTIONS.ALL_TAG, !0),
_CHANNEL_TAG)),
_ChatData$MESSAGE_SEC2),
ChatData.MESSAGE_LINK_REGEXP = {
    PROFILE: {
        getText: function() {
            return "[" + g.chatController.chatLang("playerProfile") + "]"
        },
        style: '{"color":"green"}',
        htmlClass: "chat-message-profile-link",
        getTip: function() {
            return _t("player_profile")
        },
        getPattern: function() {
            return isPl() ? new RegExp("https://www.margonem.pl/profile/view,([0-9]+)#char_([0-9]+),([a-zA-Z]+)","g") : new RegExp("https://margonem.com/profile/view,([0-9]+)($|\\s|#char_([0-9]+)($|\\s|,([a-zA-Z]+)($|\\s)))","g")
        }
    },
    CLAN_PROFILE: {
        getText: function() {
            return "[" + g.chatController.chatLang("clanProfile") + "]"
        },
        style: '{"color":"violet"}',
        htmlClass: "chat-message-clan-link",
        getTip: function() {
            return _t("clan_page", null, "clan")
        },
        getPattern: function() {
            var t = isPl() ? "www.margonem.pl" : "margonem.com";
            return new RegExp("https://" + t + "/guilds/view,([a-z]+),([0-9]+)","g")
        }
    }
},
ChatData.MESSAGE_MARK_REGEXP = {
    ASD: {
        text: "[ASD]",
        style: '{"color":"yellow"}',
        dynamicMark: !1,
        getPattern: function() {
            return new RegExp("ASD([0-9]{3})","g")
        }
    },
    QWE: {
        text: "[QWE]",
        style: '{"color":"orange"}',
        dynamicMark: !1,
        getPattern: function() {
            return new RegExp("QWE([0-9]{3})","g")
        }
    },
    ZXC: {
        text: "[ZXC]",
        style: '{"color":"red"}',
        dynamicMark: !1,
        getTip: function() {
            return "ZXC_TEST"
        },
        getPattern: function() {
            return new RegExp("ZXC([0-9]{3})","g")
        }
    },
    NICK: {
        style: '{"color":"#48D1CC","font-weight": "bold"}',
        dynamicMark: function(t) {
            return t[0]
        },
        getPattern: function() {
            return new RegExp("(" + hero.nick + ")","g")
        }
    }
},
ChatData.AVAILABLE = (_defineProperty(_ChatData$AVAILABLE = {}, ChatData.CHANNEL.GLOBAL, !0),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.LOCAL, !0),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.TRADE, !0),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.GROUP, !1),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.CLAN, !1),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.SYSTEM, !0),
_defineProperty(_ChatData$AVAILABLE, ChatData.CHANNEL.PRIVATE, !0),
_ChatData$AVAILABLE),
ChatData.INPUT_CHANNEL_HEADER = (_defineProperty(_ChatData$INPUT_CHANN = {}, ChatData.CHANNEL.GLOBAL, {
    name: ChatData.CHANNEL.GLOBAL,
    short: {
        pl: "o",
        en: "o"
    },
    heroMsgColor: "#FFFFFF",
    otherMsgColor: "#FFFFFF",
    remove: !1,
    menu: !0
}),
_defineProperty(_ChatData$INPUT_CHANN, ChatData.CHANNEL.LOCAL, {
    name: ChatData.CHANNEL.LOCAL,
    short: {
        pl: "l",
        en: "l"
    },
    heroMsgColor: "#FFD",
    otherMsgColor: "#FFD",
    remove: !0,
    menu: !0
}),
_defineProperty(_ChatData$INPUT_CHANN, ChatData.CHANNEL.GROUP, {
    name: ChatData.CHANNEL.GROUP,
    short: {
        pl: "g",
        en: "p"
    },
    heroMsgColor: "#B554FF",
    otherMsgColor: "#B554FF",
    remove: !0,
    menu: !0
}),
_defineProperty(_ChatData$INPUT_CHANN, ChatData.CHANNEL.CLAN, {
    name: ChatData.CHANNEL.CLAN,
    short: {
        pl: "k",
        en: "g"
    },
    heroMsgColor: "#FFA500",
    otherMsgColor: "#FFA500",
    remove: !0,
    menu: !0
}),
_defineProperty(_ChatData$INPUT_CHANN, ChatData.CHANNEL.SYSTEM, {
    name: ChatData.CHANNEL.SYSTEM,
    short: {
        pl: "s",
        en: "s"
    },
    heroMsgColor: "#B1B7BD",
    otherMsgColor: "#B1B7BD",
    remove: !0,
    menu: !1
}),
_defineProperty(_ChatData$INPUT_CHANN, ChatData.CHANNEL.PRIVATE, {
    name: ChatData.CHANNEL.PRIVATE,
    short: {
        pl: "p",
        en: "p"
    },
    heroMsgColor: "#fc0",
    otherMsgColor: "#cf0",
    remove: !0,
    menu: !1
}),
_ChatData$INPUT_CHANN),
ChatData.INPUT_CHANNEL_MODE = (_defineProperty(_ChatData$INPUT_CHANN2 = {}, ChatData.STYLE.SPECIAL, {
    name: ChatData.STYLE.SPECIAL,
    short: "s",
    request: "special"
}),
_defineProperty(_ChatData$INPUT_CHANN2, ChatData.STYLE.NAR, {
    name: ChatData.STYLE.NAR,
    short: "n",
    request: "nar"
}),
_defineProperty(_ChatData$INPUT_CHANN2, ChatData.STYLE.ME, {
    name: ChatData.STYLE.ME,
    short: "m",
    request: "me"
}),
_ChatData$INPUT_CHANN2),
ChatData.INPUT_REGEXP = {
    $_LINKED_ITEMS: {
        tag: "$_LINKED_ITEMS",
        getSrc: function() {
            return createTextGraphic("[" + g.chatController.chatLang("Item") + "]", 13, "yellow", "").url
        },
        getPattern: function() {
            return new RegExp("ITEM#([0-9a-z]{64}|[0-9]{7,11})(\\.[a-z]+|)(\\s|&nbsp;)","g")
        }
    },
    $_TEST_ASD_ITEMS: {
        tag: "$_TEST_ASD_ITEMS",
        getSrc: function() {
            return createTextGraphic("[ASD_TEST]", 13, "pink", "").url
        },
        getPattern: function() {
            return new RegExp("ASD([0-9]{3})","g")
        }
    },
    $_TEST_QWE_ITEMS: {
        tag: "$_TEST_QWE_ITEMS",
        getSrc: function() {
            return createTextGraphic("[QWE_TEST]", 13, "orange", "").url
        },
        getPattern: function() {
            return new RegExp("QWE([0-9]{3})","g")
        }
    },
    $_TEST_ZXC_ITEMS: {
        tag: "$_TEST_ZXC_ITEMS",
        getSrc: function() {
            return createTextGraphic("[ZXC_TEST]", 13, "red", "").url
        },
        getPattern: function() {
            return new RegExp("ZXC([0-9]{3})","g")
        }
    },
    $_PROFILE_ITEMS: {
        tag: "$_PROFILE_ITEMS",
        getSrc: function() {
            return createTextGraphic("[" + g.chatController.chatLang("playerProfile") + "]", 13, "green", "").url
        },
        getPattern: function() {
            return isPl() ? new RegExp("https://www.margonem.pl/profile/view,([0-9]+)#char_([0-9]+),([a-zA-Z]+)(\\s|&nbsp;)","g") : new RegExp("https://margonem.com/profile/view,([0-9]+)(\\s|&nbsp;|(#char_([0-9]+)(\\s|&nbsp;|,([a-zA-Z]+)\\s|&nbsp;)))","g")
        }
    },
    $_CLAN_ITEMS: {
        tag: "$_CLAN_ITEMS",
        getSrc: function() {
            return createTextGraphic("[" + g.chatController.chatLang("clanProfile") + "]", 13, "violet", "").url
        },
        getPattern: function() {
            return new RegExp("https://www.margonem.pl/guilds/view,([a-z]+),([0-9]+)(\\s|&nbsp;)","g")
        }
    }
},
ChatData.CHANNEL_INPUT_DATA = [{
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.GROUP
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.GROUP);
        return new RegExp("^/" + t + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.LOCAL
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.LOCAL);
        return new RegExp("^/" + t + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.CLAN
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.CLAN);
        return new RegExp("^/" + t + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.GLOBAL
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.GLOBAL);
        return new RegExp("^/" + t + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.GLOBAL,
            style: ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.SPECIAL].request
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.GLOBAL)
          , a = ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.SPECIAL].short;
        return new RegExp("^/" + t + a + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.LOCAL,
            style: ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.SPECIAL].request
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.LOCAL)
          , a = ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.SPECIAL].short;
        return new RegExp("^/" + t + a + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.LOCAL,
            style: ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.ME].request
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.LOCAL)
          , a = ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.ME].short;
        return new RegExp("^/" + t + a + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function() {
        return {
            channel: ChatData.SERVER_CHANNEL.LOCAL,
            style: ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.NAR].request
        }
    },
    getPattern: function() {
        var t = g.chatController.getChatDataUpdater().getShortInputChannelData(ChatData.INPUT_CHANNEL_HEADER.LOCAL)
          , a = ChatData.INPUT_CHANNEL_MODE[ChatData.STYLE.NAR].short;
        return new RegExp("^/" + t + a + "(\\s|&nbsp;)","g")
    }
}, {
    callback: function(t) {
        return g.chatController.getChatInputWrapper().setChannel(ChatData.INPUT_CHANNEL_HEADER.PRIVATE, t),
        {
            channel: ChatData.SERVER_CHANNEL.PRIVATE,
            receiver: t
        }
    },
    getValFromPatter: !0,
    getPattern: function() {
        return new RegExp("^@([_a-zA-Z]+)(\\s|&nbsp;)","g")
    }
}];
function ChatDataUpdater() {
    var e = function(e) {
        var a = function(e) {
            var a = [];
            for (var t in e) {
                var r = e[t]
                  , n = o(t);
                if (n && r.msg) {
                    var s = r.msg;
                    for (var i in s) {
                        var l = s[i];
                        l.channel = n,
                        a.push(l)
                    }
                }
            }
            return a
        }(e);
        if (a.length) {
            var n = t(a);
            r(n)
        }
    }
      , a = function(a) {
        e(a)
    }
      , t = function(e) {
        var a = [];
        for (var t in e)
            a.push(e[t]);
        return a.sort((function(e, a) {
            return e.ts - a.ts
        }
        )),
        a
    }
      , r = function(e) {
        for (var a in e) {
            var t = e[a]
              , r = t.id
              , n = t.channel
              , s = n == ChatData.CHANNEL.SYSTEM;
            if (!g.chatController.checkMessageExist(r, n))
                if (s && t.code) {
                    g.chatController.addToMessageList(t, r, n);
                    var o = JSON.parse(t.code);
                    g.codeMessageManager.updateData(o.message, CodeMessageData.SOURCE.CHAT, t)
                } else {
                    var i = t.sender
                      , l = isset(t.receiver) ? t.receiver : null
                      , c = t.ts
                      , h = t.msg
                      , C = isset(t.style) ? t.style : null
                      , u = g.businessCardManager.getCard(i)
                      , f = null;
                    if (u || s)
                        if (null == l || s || (f = g.businessCardManager.getCard(l))) {
                            var v = {
                                ts: c,
                                id: r,
                                style: C,
                                channel: n,
                                authorBusinessCard: u,
                                receiverBusinessCard: f,
                                text: h
                            };
                            g.chatController.addMessage(v)
                        } else
                            errorReport("ChatDataUpdater.js", "updateMessages", "receiverBusinessCard not exist! Receiver id:" + l);
                    else
                        errorReport("ChatDataUpdater.js", "updateMessages", "authorBusinessCard not exist! Author id:" + i)
                }
        }
    }
      , n = function(e) {
        var a = o(e);
        g.chatController.getChatMessageWrapper().clearAllMessageFromWrapperByChannelName(a),
        g.chatController.clearMessageList(a)
    }
      , s = function(e) {
        var a = g.chatController.getChatInputWrapper()
          , t = ChatData.NOTIFICATION.MUTE;
        a.getChatNotificationManager().setMuteLeftSeconds(e, (function() {
            var r = g.chatController.chatLang("MUTE_NEXT_MESSAGE_TIME") + " " + e + "s";
            a.getChatNotificationView().turnOnNotification(t, r)
        }
        ), (function() {
            e--;
            var r = g.chatController.chatLang("MUTE_NEXT_MESSAGE_TIME") + " " + e + "s";
            a.getChatNotificationView().turnOnNotification(t, r)
        }
        ), (function() {
            a.getChatNotificationView().turnOffNotification(t)
        }
        ))
    }
      , o = function(e) {
        for (var a in ChatData.SERVER_CHANNEL)
            if (e == ChatData.SERVER_CHANNEL[a])
                return a;
        return "trade" == e ? null : (errorReport("ChatDataUpdater.js", "getChannelNameByServerChannelName", "Incorrect serverChannelName!", e),
        ChatData.CHANNEL.LOCAL)
    };
    this.init = function() {}
    ,
    this.getServerChannelNameByChannelName = function(e) {
        var a = ChatData.SERVER_CHANNEL[e];
        return a || (errorReport("ChatDataUpdater.js", "getChannelNameByServerChannelName", "Incorrect serverChannelName!", a),
        ChatData.SERVER_CHANNEL.LOCAL)
    }
    ,
    this.getShortInputChannelData = function(e) {
        var a = null;
        return isPl() && (a = e.short.pl),
        isEn() && (a = e.short.en),
        a
    }
    ,
    this.setDataFromServerStorage = function() {
        var e = g.serverStorage.get(ServerStorageData.CHAT);
        if (e && e.channel) {
            console.log("setChatChannel!");
            var a = e.channel;
            if (!g.chatController.getChatChannelsAvailable().checkAvailableProcedure(a))
                return;
            g.chatController.getChatWindow().setChannel(a)
        }
    }
    ,
    this.updateData = function(e) {
        isset(e.channels) && a(e.channels),
        isset(e.clear) && n(e.clear),
        isset(e.muteLeftSeconds) && s(e.muteLeftSeconds)
    }
}
function ChatInputWrapper() {
    var n = ChatData.CHANNEL.GLOBAL
      , t = null
      , a = null
      , e = null
      , i = null
      , c = null
      , o = null
      , r = null
      , l = null
      , u = function() {
        (a = $("<div>").addClass("clear-cross")).tip(_t("reset", null, "ah_filter_history")),
        a.on("click", (function() {
            D(!1),
            e.setInput("")
        }
        )),
        t.find(".magic-input-wrapper").append(a)
    }
      , s = function() {
        G(null)
    }
      , f = function() {
        var n = $("<div>").addClass("chat-config-wrapper-button");
        n.on("click", (function() {
            l ? C() : h()
        }
        )),
        n.tip(g.chatController.chatLang("config_button")),
        t.find(".chat-config-wrapper").append(n)
    }
      , h = function() {
        (l = new ChatConfigureWindow).init()
    }
      , C = function() {
        l.closeWindow(),
        d()
    }
      , d = function() {
        l = null
    }
      , p = function() {
        t.find(".private-nick").css("color", ChatData.INPUT_CHANNEL_HEADER.PRIVATE.heroMsgColor)
    }
      , v = function() {
        var n = t.find(".card-remove");
        n.on("click", (function() {
            var n = g.chatController.getChatChannelCardWrapper().getActiveChannelName()
              , t = ChatData.INPUT_CHANNEL_HEADER[n];
            A(t)
        }
        )),
        n.tip(_t("reset", null, "ah_filter_history"))
    }
      , N = function() {
        t.find(".card-name").on("click", (function(n) {
            n.stopPropagation(),
            B()
        }
        )),
        m()
    }
      , m = function() {
        var n = ChatData.INPUT_CHANNEL_HEADER
          , a = t.find(".card-list");
        for (var e in n)
            L(n[e], a);
        $("body").on("click", (function(n) {
            E() && S()
        }
        ))
    }
      , L = function(n, t) {
        if (n.menu) {
            var a = n.short[_l()]
              , e = n.heroMsgColor
              , i = $("<div>").addClass("input-channel-item").html(g.chatController.chatLang(n.name.toLowerCase()) + " /" + a);
            i.css("color", e),
            _(i, n),
            t.append(i, n)
        }
    }
      , _ = function(n, t) {
        n.on("click", (function() {
            A(t)
        }
        ))
    }
      , A = function(a, i, l) {
        var u, s = a.name, f = a.heroMsgColor;
        g.chatController.getChatChannelsAvailable().checkAvailableProcedure(s) && (o = i || null,
        r = l || null,
        n = s,
        R(s),
        w(f),
        u = g.chatController.getChatChannelCardWrapper().getActiveChannelName() == n ? "none" : "inline-block",
        t.find(".card-remove").css("display", u),
        V(o),
        U(r),
        c.setVisible(n),
        e.setColorInput(f))
    }
      , w = function(n) {
        t.find(".card-name").css("color", n)
    }
      , E = function() {
        return "none" != t.find(".card-list").css("display")
    }
      , k = function() {
        (i = new ChatNotificationView).init(t.find(".chat-notification-wrapper"))
    }
      , y = function() {
        (c = new ChatNotificationManager).init()
    }
      , b = function() {
        (e = new MagicInput3).init($("#bottombar").find(".magic-input"), ChatData.INPUT_REGEXP, ChatData.CHANNEL_INPUT_DATA, g.chatController.chatLang("chat_placeholder"), P, I)
    }
      , I = function(n) {
        g.chatController.getChatMessageWrapper().updateScroll(),
        D(!n)
    }
      , D = function(n) {
        var t = a.css("display");
        "none" == t && n ? a.css("display", "block") : "block" != t || n || a.css("display", "none")
    }
      , P = function(t) {
        if ("" == t)
            return !1;
        if ("" == t.trim())
            return !1;
        if (c.checkBlockadeLeftSeconds(n))
            return message(g.chatController.chatLang("toFastMessageSendOn") + g.chatController.chatLang(n.toLocaleLowerCase())),
            !1;
        var a = H(t)
          , e = a.channel
          , i = a.receiver ? "&receiver=" + a.receiver : ""
          , o = a.style ? "&style=" + a.style : "";
        return console.log(a),
        _g("chat&channel=" + e + i + o, {
            c: a.html
        }),
        !0
    }
      , H = function(n) {
        var t = ChatData.CHANNEL_INPUT_DATA;
        for (var a in t) {
            var e = T(n, t[a]);
            if (e)
                return e
        }
        return {
            channel: ChatData.SERVER_CHANNEL.GLOBAL,
            html: n
        }
    }
      , T = function(n, t) {
        var a = t.getPattern().exec(n);
        if (a) {
            var e = null;
            if (e = t ? t.callback(a[1]) : t.callback())
                return e.html = n.replace(t.getPattern(), ""),
                e
        }
        return null
    }
      , W = function() {
        t = g.chatController.getChatTemplates().get("chat-input-wrapper")
    }
      , M = function() {
        g.chatController.getChatWindow().get$chatWindow().find(".chat-input-wrapper").replaceWith(t)
    }
      , R = function(n) {
        t.find(".card-name").html(g.chatController.chatLang(n.toLowerCase()))
    }
      , V = function(n) {
        t.find(".private-nick").html(n || "")
    }
      , U = function(n) {
        t.find(".style-message").html(n || "")
    }
      , S = function() {
        t.find(".card-list").css("display", "none")
    }
      , B = function() {
        E() ? S() : t.find(".card-list").css("display", "block")
    }
      , G = function(n) {
        n
    };
    this.init = function() {
        s(),
        W(),
        b(),
        y(),
        k(),
        p(),
        M(),
        N(),
        v(),
        f(),
        u()
    }
    ,
    this.setChannel = A,
    this.focus = function() {
        e.focus()
    }
    ,
    this.setInput = function(n) {
        e.setInput(n)
    }
    ,
    this.getVal = function() {
        return e.getFullInputVal()
    }
    ,
    this.getChannelName = function() {
        return n
    }
    ,
    this.getPrivateReceiver = function() {
        return o
    }
    ,
    this.getStyleMessage = function() {
        return r
    }
    ,
    this.clearChatConfigureWindow = d,
    this.getChatNotificationManager = function() {
        return c
    }
    ,
    this.getChatNotificationView = function() {
        return i
    }
}
function ChatMessage() {
    var n = null
      , e = null
      , t = null
      , a = null
      , i = null
      , r = null
      , c = null
      , s = null
      , l = null
      , u = function(n) {
        e = n.ts,
        t = n.channel,
        i = n.authorBusinessCard,
        r = n.receiverBusinessCard,
        a = n.text,
        n.authorBusinessCard && (c = i.getNick()),
        n.receiverBusinessCard && (s = r.getNick()),
        n.style && (l = n.style)
    }
      , h = function() {
        n = f()
    }
      , f = function() {
        return g.chatController.getChatTemplates().get("new-chat-message")
    }
      , d = function() {
        var e = c == hero.nick ? "hero-msg" : "other-msg";
        n.addClass(e)
    }
      , C = function() {
        n.css("color");
        var e = g.chatController.getChatConfig()
          , a = hero.nick == c
          , i = e.getChannelColor(t, a);
        n.css("color", i)
    }
      , p = function(n, e) {
        if ("inline" == n.css("display") != e) {
            var t = e ? "inline" : "none";
            n.css("display", t)
        }
    }
      , v = function() {
        var e = n.find(".author-section");
        2 != l && c || e.css("display", "none"),
        e.text("<" + c + (s ? " " : ">")),
        m()
    }
      , k = function() {
        var e = n.find(".receiver-section")
          , t = (n.find(".receiver-arrow-section"),
        !!s);
        p(e, t),
        t && (e.html("->" + s + "> "),
        m())
    }
      , m = function() {
        var n = A();
        n && E(n)
    }
      , A = function() {
        var e = hero.nick;
        return t == ChatData.CHANNEL.SYSTEM ? null : t == ChatData.CHANNEL.PRIVATE ? c == e ? {
            nick: s,
            $clickField: n.find(".receiver-section")
        } : {
            nick: c,
            $clickField: n.find(".author-section")
        } : c == e ? null : {
            nick: c,
            $chatMessage: n,
            $clickField: n.find(".author-section")
        }
    }
      , E = function(n) {
        n.$clickField.addClass("click-able"),
        n.$clickField.on("click", (function() {
            console.log(n.nick),
            g.chatController.getChatInputWrapper().setChannel(ChatData.INPUT_CHANNEL_HEADER.PRIVATE, n.nick)
        }
        )),
        n.$clickField.on("contextmenu", (function(e, t) {
            console.log(n);
            var a = []
              , i = $(this).parent().parent();
            N(n.nick, a),
            M(i, a),
            L(n.nick, a),
            P(n.nick, a);
            var r = getE(e, t);
            g.interface.showPopupMenu(a, r)
        }
        )),
        n.$clickField.tip(g.chatController.chatLang("privMessageTo") + n.nick)
    }
      , N = function(n, e) {
        e.push([_t("send_message", null, "chat"), function() {
            g.chatController.getChatInputWrapper().setChannel(ChatData.INPUT_CHANNEL_HEADER.PRIVATE, n)
        }
        ])
    }
      , M = function(n, e) {
        n.hasClass(ChatData.CHANNEL.CLAN + "-channel-in-" + ChatData.CHANNEL.GLOBAL + "-channel") && e.push([_t("to-clan"), function() {
            g.chatController.getChatWindow().setChannel(o.CHANNEL.CLAN)
        }
        ]),
        n.hasClass(ChatData.CHANNEL.GROUP + "-channel-in-" + ChatData.CHANNEL.GLOBAL + "-channel") && e.push([_t("to-group"), function() {
            g.chatController.getChatWindow().setChannel(o.CHANNEL.GROUP)
        }
        ])
    }
      , L = function(n, e) {
        e.push([_t("player_nick", null, "clan"), function() {
            g.chatController.getChatInputWrapper().setInput(n + " ")
        }
        ])
    }
      , P = function(n, e) {
        var t = g.hero.d.uprawnienia;
        0 != t && n != hero.nick && "System" != n && (e.push(["MC Panel", function() {
            g.mcAddon || (g.mcAddon = new MCAddon(self),
            g.mcAddon.init()),
            g.mcAddon.update(n)
        }
        ]),
        4 != t && 16 != t || e.push(["SMC Panel", function() {
            g.smcAddon && g.smcAddon.close(),
            g.smcAddon = new SMCAddon(n),
            g.smcAddon.init()
        }
        ]))
    }
      , T = function() {
        var e = t == ChatData.CHANNEL.SYSTEM
          , i = S(a, e);
        n.find(".message-section").html(i)
    }
      , R = function() {
        l && n.find(".message-part").addClass("special-style-" + l)
    }
      , S = function(n, e) {
        e && (n = parseChatBB(n));
        for (var t = [B(n, e)], a = 0; a < t.length; a++) {
            var i = t[a]
              , r = i.textContent;
            if ("#text" != i.nodeName) {
                if (i.hasClass("mark-message-span"))
                    continue;
                r = e ? i.html() : i.text()
            }
            y(r) ? (x(t, a),
            D(a, t, r, e),
            a--) : checkReceiveMessageHaveLinkedItem(r, !1) ? (x(t, a),
            I(a, t, parseReceiveMessageWithLinkedItem(r, !1, e)),
            a--) : _(r) && (x(t, a),
            I(a, t, H(a, t, r, e)),
            a--)
        }
        return t
    }
      , _ = function(n) {
        var e = ChatData.MESSAGE_MARK_REGEXP;
        for (var t in e) {
            if (e[t].getPattern().exec(n))
                return !0
        }
        return !1
    }
      , H = function(n, e, t, a) {
        var i = ChatData.MESSAGE_MARK_REGEXP;
        for (var r in i) {
            var c = i[r];
            if (c.getPattern().exec(t))
                return parseReceiveMessageWithMark(t, c, a)
        }
    }
      , D = function(n, e, t, a) {
        var i = linkify.tokenize(t);
        for (var r in i) {
            var c = i[r];
            if (c.isLink)
                I(n, e, w(c)),
                n++;
            else {
                var s = c.toString();
                I(n, e, [B(s, a)]),
                n++
            }
        }
    }
      , x = function(n, e) {
        n.splice(e, 1)
    }
      , y = function(n) {
        var e = linkify.tokenize(n);
        for (var t in e)
            if (e[t].isLink)
                return !0;
        return !1
    }
      , I = function(n, e, t) {
        for (var a = 0; a < t.length; a++) {
            var i = n + a;
            e.splice(i, 0, t[a])
        }
    }
      , w = function(n) {
        var e = n.toObject("https")
          , t = F(e.href);
        return t ? W(e, t) : G(e)
    }
      , W = function(n, e) {
        var t = $("<span>")
          , a = null
          , i = e.htmlClass
          , r = e.getTip;
        try {
            a = JSON.parse(e.style)
        } catch (n) {
            errorReport("ChatMessage.js", "createLinkNodeFromWhiteList", "Incorrect JSON format!", a)
        }
        return null != i && t.addClass(i),
        null != a && t.css(a),
        null != r && t.tip(r()),
        t.addClass('message-mark "mark-message-span'),
        t.text(e.getText()),
        t.click((function() {
            g.iframeWindowManager.newPlayerProfile({
                staticUrl: n.href
            })
        }
        )),
        [t]
    }
      , G = function(n) {
        var e = $("<u>");
        return e.addClass("link mark-message-span"),
        e.text(n.href),
        e.click((function() {
            window.goToUrl(n.href)
        }
        )),
        [e]
    }
      , B = function(n, e) {
        var t;
        return e ? ((t = document.createElement("span")).innerHTML = n,
        t = $("<span>").html(n)) : t = document.createTextNode(n),
        t
    }
      , F = function(n) {
        var e = ChatData.MESSAGE_LINK_REGEXP;
        for (var t in e) {
            var a = e[t];
            if (a.getPattern().exec(n))
                return a
        }
        return null
    };
    this.init = function(e) {
        h(),
        u(e),
        n.addClass("chat-" + t + "-message")
    }
    ,
    this.getTs = function() {
        return e
    }
    ,
    this.updateMessage = function() {
        d(),
        C(),
        v(),
        k(),
        T(),
        R()
    }
    ,
    this.appendMessageToChannel = function(e) {
        g.chatController.getChatMessageWrapper().appendMessageToMessageWrapper(t, c, n, e)
    }
}
var getPrepareDataToCreateElementsArray = function(a, t, e) {
    for (var r, n = a.length, s = 0, i = 0, c = t.getPattern(), l = [], p = []; null !== (r = c.exec(a)); ) {
        var m = r.index;
        if (i < m) {
            var u = a.substr(i, m - i);
            p.push(createTxtSpanString(u, e)),
            l.push(getMarksData(a, r, t)),
            p.push(createItemSpanString(s, e))
        } else
            l.push(getMarksData(a, r, t)),
            p.push(createItemSpanString(s, e));
        s++,
        i = r.index + r[0].length
    }
    if (i != n) {
        var g = a.substr(i, n - 1);
        p.push(createTxtSpanString(g, e))
    }
    return {
        htmlString: p,
        marksDataArray: l
    }
}
  , getMarksData = function(a, t, e) {
    if (e.dynamicMark) {
        for (var r = {
            style: e.style,
            dynamicData: []
        }, n = 1; n < t.length; n++) {
            var s = t[n];
            s = (s = s.replaceAll("&quot;", "")).replaceAll('"', ""),
            r.dynamicData.push(s)
        }
        return r
    }
    return {
        style: e.style,
        text: e.text
    }
}
  , getArrayWith$spanTextAnd$linkedItems = function(a, t, e) {
    var r = e ? $("<div>" + a.htmlString.join("") + "</div>") : $("<div>").html(a.htmlString)
      , n = [];
    for (var s in a.marksDataArray) {
        var i = a.marksDataArray[s]
          , c = createMarkItemSpan(i, t);
        r.find(".mark-" + s).replaceWith(c)
    }
    return r.children().each((function() {
        n.push($(this))
    }
    )),
    n
}
  , createMarkItemSpan = function(a, t) {
    var e = $("<span>")
      , r = null;
    try {
        r = JSON.parse(a.style)
    } catch (t) {
        errorReport("ChatMessageWithMarkReplace.js", "createMarkItemSpan", "Incorrect JSON format!", a.style)
    }
    null != r && e.css(r);
    var n = null
      , s = null;
    return t.dynamicMark ? (n = t.dynamicMark(a.dynamicData),
    t.getDynamicTip && (s = t.getDynamicTip(a.dynamicData))) : (n = a.text,
    t.getTip && (s = t.getTip())),
    e.text(n),
    e.addClass("mark-message-span"),
    null != s && e.tip(s),
    e
}
  , createTxtSpanString = function(a, t) {
    return t ? '<span class="mark-text-span">'.concat(a, "</span>") : $("<span>").addClass("mark-text-span").text(a)
}
  , createItemSpanString = function(a, t) {
    return t ? '<span class="mark-'.concat(a, '"></span>') : $("<span>").addClass("mark-message-span mark-".concat(a))
}
  , parseReceiveMessageWithMark = function(a, t, e) {
    var r = getPrepareDataToCreateElementsArray(a, t, e);
    return getArrayWith$spanTextAnd$linkedItems(r, t, e)
};
function ChatMessageWrapper() {
    var e, a, t = function() {
        a = 0
    }, n = function() {}, r = function() {
        e.trigger("scrollBottom")
    }, s = function() {
        e.trigger("update")
    }, i = function() {
        var a = ChatData.CHANNEL;
        for (var t in a) {
            var n = d(t);
            e.find(".scroll-pane").append(n)
        }
    }, o = function() {
        e = g.chatController.getChatTemplates().get("chat-message-wrapper")
    }, d = function(e) {
        var a = $("<div>").addClass("one-message-wrapper");
        return a.addClass("".concat(e, "-message-wrapper")),
        a
    }, c = function(a) {
        g.chatController.getChatWindow().get$chatWindow().find(".chat-message-wrapper").replaceWith(e)
    }, p = function() {
        return e.hasClass("scrollable")
    };
    this.init = function() {
        t(),
        o(),
        c(),
        i(),
        n(),
        s()
    }
    ,
    this.setChannelMessageWrapper = function(a) {
        e.find(".one-message-wrapper").removeClass("active"),
        e.find(".".concat(a, "-message-wrapper")).addClass("active")
    }
    ,
    this.appendMessageToMessageWrapper = function(a, t, n, i) {
        var o = p();
        if ((e.find(".".concat(a, "-message-wrapper")).append(n),
        a != ChatData.CHANNEL.GLOBAL) && g.chatController.getChatConfig().getMessagesAddToGlobalData(a, ChatData.MESSAGES_ADD_TO_GLOBAL_OPT.ADD)) {
            var d = n.clone(!0);
            d.addClass(a + "-channel-in-" + ChatData.CHANNEL.GLOBAL + "-channel"),
            e.find(".".concat(ChatData.CHANNEL.GLOBAL, "-message-wrapper")).append(d)
        }
        g.chatController.getChatChannelCardWrapper().addOneMessageCounterProcedure(a, t, i),
        s();
        var c = p();
        !o && c && r()
    }
    ,
    this.updateScroll = s,
    this.setScrollOnBottom = r,
    this.manageChatWidgetAmountAfterAddMessage = function() {
        !0 !== g.getFirstNotInit() && (g.interface.isShowLeftColumn() || "+99" != g.widgetManager.widgets.getWidgetAmount(g.widgetsData.name.CHAT) && (a++,
        g.widgetManager.widgets.updateAmount(g.widgetsData.name.CHAT, a)))
    }
    ,
    this.resetHideChatMessageCounterAndChatWidgetAmount = function() {
        t(),
        g.widgetManager.widgets.updateAmount(g.widgetsData.name.CHAT, "")
    }
    ,
    this.clearAllMessageWrapperChannel = function() {
        e.find(".one-message-wrapper").empty()
    }
    ,
    this.clearAllMessageFromWrapperByChannelName = function(a) {
        e.find(".chat-" + a + "-message").remove()
    }
}
function _defineProperty(t, n, e) {
    return n in t ? Object.defineProperty(t, n, {
        value: e,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : t[n] = e,
    t
}
function ChatNotificationManager() {
    var t = null
      , n = null
      , e = function() {
        var n;
        _defineProperty(n = {}, ChatData.CHANNEL.GLOBAL, null),
        _defineProperty(n, ChatData.CHANNEL.LOCAL, null),
        _defineProperty(n, ChatData.CHANNEL.TRADE, null),
        _defineProperty(n, ChatData.CHANNEL.GROUP, null),
        _defineProperty(n, ChatData.CHANNEL.CLAN, null),
        _defineProperty(n, ChatData.CHANNEL.PRIVATE, null),
        t = n
    }
      , a = function(n, e, a, i) {
        var r = ts() + 1e3 * e;
        t[n] = setInterval((function() {
            a && a(),
            ts() < r || i && (i(n),
            l(n))
        }
        ), 1e3)
    }
      , i = function(t, e, a) {
        var i = ts() + 1e3 * t;
        n = setInterval((function() {
            e && e(),
            ts() < i || a && (u(),
            a())
        }
        ), 1e3)
    }
      , r = function(n) {
        return !!t[n]
    }
      , o = function() {
        return !!n
    }
      , l = function(n) {
        clearInterval(t[n]),
        t[n] = null
    }
      , u = function() {
        clearInterval(n),
        n = null
    };
    this.init = function() {
        e()
    }
    ,
    this.setBlockadeLeftSeconds = function(t, n, e, i, o) {
        r(t) && l(t),
        e && e(t),
        a(t, n, i, o)
    }
    ,
    this.setMuteLeftSeconds = function(t, n, e, a) {
        o() && u(),
        n && n(),
        e && e(),
        i(t, e, a)
    }
    ,
    this.checkBlockadeLeftSeconds = r,
    this.setVisible = function(t) {
        var n = r(t)
          , e = ChatData.NOTIFICATION.WATCH
          , a = g.chatController.getChatInputWrapper().getChatNotificationView();
        n ? a.turnOnNotification(e) : a.turnOffNotification(e)
    }
}
function ChatNotificationView() {
    var t = null
      , i = function(i) {
        i.replaceWith(t)
    }
      , n = function() {
        var t = ChatData.NOTIFICATION;
        for (var i in t) {
            var n = a(i);
            o(n)
        }
    }
      , a = function(t) {
        var i = $("<div>").addClass("chat-notification chat-notification-" + t);
        return i.tip("chat-notification-".concat(t)),
        i
    }
      , o = function(i) {
        t.append(i)
    }
      , c = function() {
        t = g.chatController.getChatTemplates().get("chat-notification-wrapper")
    }
      , f = function(i) {
        t.find(".chat-notification-".concat(i)).css("display", "none")
    };
    this.init = function(t) {
        for (var a in c(),
        n(),
        i(t),
        ChatData.NOTIFICATION)
            f(a)
    }
    ,
    this.turnOnNotification = function(i, n) {
        var a = t.find(".chat-notification-".concat(i));
        a.css("display", "inline-block"),
        n && a.tip(n)
    }
    ,
    this.turnOffNotification = f
}
function ChatPrivateMessageData() {
    var e = []
      , t = [];
    this.init = function() {}
    ,
    this.addSendMessageUser = function(t) {
        e.push(t)
    }
    ,
    this.addReceiveMessageUser = function(e) {
        t.push(e)
    }
    ,
    this.getLastUserWhoSendToHeroPrivateMessage = function() {
        var e = t.length;
        return t[e - 1]
    }
    ,
    this.getLastUserWhoGetFromHeroPrivateMessage = function() {
        var t = e.length;
        return e[t - 1]
    }
}
function ChatWindow() {
    var t = null
      , e = function() {
        t = g.chatController.getChatTemplates().get("new-chat-window")
    }
      , a = function() {
        $("body").find("#centerbox2").append(t)
    };
    this.init = function() {
        e(),
        a()
    }
    ,
    this.setChatOverAdditionalBarPanel = function(e) {
        var a = e ? 49 : 0;
        t.css("bottom", a + "px")
    }
    ,
    this.get$chatWindow = function() {
        return t
    }
    ,
    this.setChannel = function(t, e) {
        var a = ChatData.INPUT_CHANNEL_HEADER[t]
          , n = e || null;
        g.chatController.getChatChannelCardWrapper().setChannelCard(t),
        g.chatController.getChatInputWrapper().setChannel(a, null, n),
        g.chatController.getChatMessageWrapper().setChannelMessageWrapper(t),
        g.chatController.getChatMessageWrapper().updateScroll(),
        g.chatController.getChatMessageWrapper().setScrollOnBottom()
    }
    ,
    this.setChatState = function(e) {
        t.removeClass("state-0 state-1 state-2 state-3"),
        t.addClass("state-" + e)
    }
}
function MagicInput3() {
    var n = null
      , t = null
      , i = ""
      , u = null
      , o = function(t) {
        n.attr("placeholder", t)
    }
      , c = function() {
        t.append(n)
    }
      , e = function(n) {
        n
    }
      , a = function(n) {
        u = n
    }
      , l = function() {
        (n = $("<input/>").addClass("magic-input")).html("")
    }
      , r = function() {
        t = $("<div>").addClass("magic-input-wrapper")
    }
      , f = function(n) {
        n.replaceWith(t),
        t.css("display", "block"),
        $("#inpchat").remove(),
        $("#bottxt").remove()
    }
      , s = function() {
        n.on("keyup", (function(n) {
            if ("Enter" == n.originalEvent.key) {
                var t = g();
                t = t.replace(/(?=\s)[^\r\n\t]/g, " "),
                u(t),
                d(""),
                p(""),
                $(this).blur()
            }
        }
        ))
    }
      , p = function(t) {
        return n.val(t)
    }
      , d = function(n) {
        i = n
    }
      , h = function() {
        n.focus()
    }
      , v = function(n) {
        h(),
        p(n)
    };
    isTextNode = function(n) {
        return "#text" == n.nodeName
    }
    ;
    var g = function() {
        return n.val()
    };
    this.init = function(n, t, i, u, p, d) {
        a(p),
        e(d),
        l(),
        o(u),
        r(),
        c(),
        f(n),
        s()
    }
    ,
    this.addToInput = function(n) {
        v(i + n)
    }
    ,
    this.focus = h,
    this.setInput = v,
    this.setColorInput = function(t) {
        n.css({
            "caret-color": t,
            color: t
        })
    }
    ,
    this.getFullInputVal = g
}
function _toConsumableArray(t) {
    return _arrayWithoutHoles(t) || _iterableToArray(t) || _unsupportedIterableToArray(t) || _nonIterableSpread()
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var n = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === n && t.constructor && (n = t.constructor.name),
        "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _iterableToArray(t) {
    if ("undefined" != typeof Symbol && null != t[Symbol.iterator] || null != t["@@iterator"])
        return Array.from(t)
}
function _arrayWithoutHoles(t) {
    if (Array.isArray(t))
        return _arrayLikeToArray(t)
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var n = 0, a = new Array(e); n < e; n++)
        a[n] = t[n];
    return a
}
function checkItemGoldLimitReach(t) {
    var e = parseItemStat(g.item[t].stat)
      , n = null;
    return isset(e.gold) && (n = parseInt(e.gold)),
    isset(e.goldpack) && (n = parseInt(e.goldpack)),
    !!(n && n + hero.gold > hero.goldlim) && (moveItemSafe(t, "st=1"),
    !0)
}
function checkMailGoldLimitReach(t, e, n) {
    var a = t;
    return !!(a && a + hero.gold > hero.goldlim) && (mAlert(_t("gold_limit_reach_info %loss%", {
        "%loss%": a + hero.gold - hero.goldlim
    }, "item"), 2, [function() {
        _g("mail&a=get&id=" + e)
    }
    , function() {}
    ]),
    !0)
}
function checkMailDelGoldLimitReach(t, e, n) {
    var a = t;
    return !!(a && a + hero.gold > hero.goldlim) && (mAlert(_t("gold_limit_reach_info %loss%", {
        "%loss%": a + hero.gold - hero.goldlim
    }, "item"), 2, [function() {
        _g("mail&a=del&id=" + e)
    }
    , function() {}
    ]),
    !0)
}
function mAlert(t, e, n, a) {
    if ($("#alert").hide(),
    $("#alert .a2").remove(),
    $("#alert .a1").after($("<div>").addClass("a2")),
    $("#alert .a2").html(t),
    isset(e) || (e = 0),
    $("#alert").attr("class", "").addClass("mode" + e + (isset(a) ? " hmode_" + a : "")),
    3 == e && $("#alert .a2").append('<div class="mAlertInputContainer"><div class="bLeft"></div><input maxlength="25" name="mAlertInput" /><div class="bRight"></div></div>'),
    $("#a_ok").toggleClass("bal_yes", 2 == e).toggleClass("bal_ok", 2 != e).show(),
    $("#a_cancel").toggleClass("bal_no", 2 == e).toggleClass("bal_cancel", 2 != e).show(),
    1 == e || 2 == e || 3 == e || 4 == e)
        $("#a_ok").unbind("click").click((function() {
            $("#a_ok").unbind("click"),
            $("#alert").fadeOut(300),
            $("#a_ok").blur()
        }
        )),
        $("#a_cancel").unbind("click").click((function() {
            $("#a_cancel").unbind("click"),
            $("#alert").fadeOut(300),
            $("#a_ok").blur()
        }
        )),
        isset(n) && (n.length >= 1 && "function" == typeof n[0] && $("#a_ok").click(n[0]),
        n.length >= 2 && "function" == typeof n[1] && $("#a_cancel").click(n[1]));
    else {
        var r = "#a_ok"
          , l = "#a_cancel";
        5 == e && (r = "#a_cancel",
        l = "#a_ok"),
        $(l).hide(),
        $(r).unbind("click").click((function() {
            $(r).unbind("click"),
            $("#alert").fadeOut(300),
            $(r).blur()
        }
        )),
        isset(n) && n && $(r).click(n)
    }
    $("#alert").absCenter().fadeIn("fast", (function() {
        $('#alert input[name="mAlertInput"]').focus()
    }
    ))
}
function fadeMsg() {
    for (var t in g.msg)
        if ("function" != typeof g.msg[t]) {
            g.msg[t].t--;
            var e = g.msg[t].t;
            if (e > 0)
                e < 25 && !$.fx.off && g.msg[t].e.css("opacity", e / 25);
            else
                for (var n in g.msg[t].e.remove(),
                delete g.msg[t],
                $("#msg").absCenter(),
                g.msg)
                    g.msg[n].s = !1
        }
}
function calculateDiff(t, e) {
    var n = Math.abs(isset(e) ? t - e : t) / 60;
    return n < 110 ? _t("time_min %val%", {
        "%val%": Math.round(n)
    }, "time_diff") : n < 1440 ? _t("time_h %val%", {
        "%val%": Math.round(n / 60)
    }, "time_diff") : _t("time_days %val%", {
        "%val%": Math.round(n / 1440)
    }, "time_diff")
}
function removeMessages(t) {
    var e = new RegExp(t,"g")
      , n = !1;
    for (var a in g.msg) {
        var r = g.msg[a].e.html();
        e.test(r) && (g.msg[a].t = 0,
        n = !0)
    }
    n && fadeMsg()
}
function message(t) {
    var e = g.msg.length;
    t = decodeHtmlEntities(t),
    $("<div id=msg" + e + ' onclick="g.msg[' + e + '].t=1">' + parseContentBB(t) + "</div>").appendTo("#msg"),
    g.msg[e] = {
        t: 100,
        e: $("#msg" + e),
        s: !1
    },
    $("#msg").absCenter()
}
function achMessage(t) {
    var e = g.msg.length
      , n = t.split(",");
    $('<div id="msg' + e + '" class="achievement" onclick="g.msg[' + e + '].t=1">' + parsePopupBB(n[3]) + "</div>").appendTo("#msg"),
    g.msg[e] = {
        t: 100,
        e: $("#msg" + e),
        s: !1
    },
    $("#msg").absCenter()
}
function showDialog(t, e) {
    var n = t.lastIndexOf(".")
      , a = t.length - n;
    n > 0 && (4 == a || 5 == a) ? ($("#dlgwin .w2").css("backgroundImage", "url(img/".concat(t, "?v=").concat(_CLIENTVER, ")")).html(e),
    $("#dlgtitle").empty()) : ($("#dlgwin .w2").css("backgroundImage", "url(img/empty-title.png?v=".concat(_CLIENTVER, ")")).html(e),
    $("#dlgtitle").html(t)),
    $("#dlgwin").absCenter().fadeIn("fast"),
    $("#dlgwin .w1").css("backgroundPosition", "0 " + ($("#dlgwin .w1").height() - 28) + "px"),
    g.lock.add("dialogalert")
}
function isset(t) {
    return void 0 !== t
}
function urlencode(t) {
    return escape(t).replace(/\+/g, "%2B").replace(/%20/g, "+").replace(/\*/g, "%2A").replace(/\//g, "%2F").replace(/@/g, "%40")
}
function addslashes(t) {
    return (t + "").replace(/([\\"'])/g, "\\$1").replace(/\u0000/g, "\\0")
}
function is_int(t) {
    var e = parseInt(t);
    return !isNaN(e) && (t == e && t.toString() == e.toString())
}
function ts() {
    var t = new Date;
    return parseInt(t.getTime())
}
function unix_time(t) {
    var e = (new Date).getTime() / 1e3;
    return isset(t) ? e : Math.round(e)
}
function datediff(t, e) {
    void 0 === e && (e = unix_time());
    var n = ["", 0]
      , a = Math.abs(Math.ceil((t - e) / 60));
    return n[1] = t - e > 0 ? "+" : "-",
    n[0] = a < 110 ? Math.round(a) + "min" : a < 1440 ? Math.round(a / 60) + "h" : Math.round(a / 1440) + " dni",
    n
}
function ut_date(t) {
    var e = new Date(1e3 * t)
      , n = e.getFullYear();
    return e.getDate() + "/" + (e.getMonth() + 1) + "/" + n
}
function ut_time(t) {
    var e = new Date(Math.round(1e3 * t));
    return e.getHours() + ":" + zero(e.getMinutes()) + ":" + zero(e.getSeconds())
}
function ut_time_ns(t) {
    var e = new Date(Math.round(1e3 * t));
    return e.getHours() + ":" + zero(e.getMinutes())
}
function ut_fulltime(t, e) {
    var n = new Date(1e3 * t);
    return n.getDate() + "/" + zero(n.getMonth() + 1) + "/" + (isset(e) ? n.getFullYear() : zero(n.getFullYear() % 100)) + " " + zero(n.getHours()) + ":" + zero(n.getMinutes()) + (isset(e) ? ":" + zero(n.getSeconds()) : "")
}
function getCurrentDate() {
    var t = new Date
      , e = zero(t.getDate())
      , n = zero(t.getMonth() + 1)
      , a = t.getFullYear();
    return "".concat(e, ".").concat(n, ".").concat(a)
}
function c_date(t) {
    var e = new Date;
    return e.setTime(e.getTime() + 864e4 * t),
    e
}
function cutFloat(t, e) {
    if (!(t.toString().indexOf(".") >= 0))
        return t;
    var n = Math.pow(10, 12)
      , a = (Math.floor(t * n) / n).toString();
    return a.substring(0, a.indexOf(".") + e + 1)
}
function roundParser(t) {
    var e = (t = Math.floor(t)).toString().length % 3
      , n = t.toString().length
      , a = ""
      , r = t / Math.pow(10, n > 9 ? 9 : n - (0 == e ? 3 : e))
      , l = {
        0: "",
        3: "k",
        6: "m",
        9: "g"
    };
    for (var i in l)
        n > parseInt(i) && (a = l[i]);
    return {
        val: r,
        postfix: a
    }
}
function roundNumber(t, e) {
    return Math.round(t * Math.pow(10, e)) / Math.pow(10, e)
}
function parsePrice(t) {
    return "" == (t += "") || " " == t ? "" : "g" == (t = t.split(",").join(".")).slice(-1) || "G" == t.slice(-1) ? Math.round(1e9 * parseFloat(t)) : "m" == t.slice(-1) || "M" == t.slice(-1) ? Math.round(1e6 * parseFloat(t)) : "k" == t.slice(-1) || "K" == t.slice(-1) ? Math.round(1e3 * parseFloat(t)) : parseInt(t)
}
function zero(t, e) {
    for (isset(e) || (e = 2),
    t = t.toString(); t.length < e; )
        t = "0" + t;
    return t
}
function mp(t) {
    return t > 0 ? "+" + t : t
}
function loadImgs(t, e) {
    evImg({
        data: {
            il: t,
            cb: e
        }
    })
}
function evImg(t) {
    if (isset(t.data.il) && 0 != t.data.il.length) {
        var e = new Image;
        $(e).bind("load", {
            il: t.data.il.slice(1),
            cb: t.data.cb
        }, evImg).error((function() {
            log("Can't load image from " + $(this).attr("src"), 2)
        }
        )).attr({
            src: t.data.il[0]
        })
    } else
        t.data.cb()
}
function listImgs(t) {
    var e = []
      , n = $(t).css("background-image");
    return "none" != n && (e[e.length] = n.substr(5, n.length - 7)),
    $(t + " *").each((function(t) {
        "none" != (n = $(this).css("background-image")) && (e[e.length] = n.substr(5, n.length - 7))
    }
    )),
    $(t + " img").each((function(t) {
        "" != (n = $(this).attr("src")) && (e[e.length] = n)
    }
    )),
    e
}
function showObj(t) {
    $("#imgload").show(),
    loadImgs(listImgs(t), (function() {
        $("#imgload").hide(),
        $(t).fadeIn(250)
    }
    ))
}
function esc(t) {
    return t ? encodeURIComponent(t) : ""
}
function strip_tags(html, allowed) {
    if (arguments.length < 3)
        html = html.replace(/<\/?(?!\!)[^>]*>/gi, " ");
    else {
        var specified = eval("[" + arguments[2] + "]");
        if (allowed) {
            var regex = "</?(?!(" + specified.join("|") + "))\b[^>]*>";
            html = html.replace(new RegExp(regex,"gi"), " ")
        } else {
            var regex = "</?(" + specified.join("|") + ")\b[^>]*>";
            html = html.replace(new RegExp(regex,"gi"), " ")
        }
    }
    var clean_string = html;
    return clean_string
}
function checkFraud(t) {
    if (new RegExp(["hasÅ", "pass", "login", "logo", "konto"].join("|"),"ig").test(t))
        return !0;
    var e = new RegExp("https?://([-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|])","ig")
      , n = new RegExp("^http://([a-z1-9.]*?)(margonem.pl)[^/\\?=a-z]?","ig")
      , a = null;
    if (e.test(t))
        do {
            if ((a = e.exec(t)) && n.test(a[0]))
                return !0
        } while (a);
    return !1
}
function parseLinks(t) {
    return t.replace(new RegExp("https?://([-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|])","ig"), '<a href="$1" onclick="goToUrl(\'$1\');return false;">$1</a>')
}
function showEnWindow(t, e, n, a) {
    if (g.lock.add("en_window"),
    isset(n)) {
        var r = ["class"];
        for (var l in $("#en_wnd").attr("class", "en-window-wrapper"),
        r)
            if ("class" === r[l])
                $("#en_wnd").addClass(n.class)
    }
    $("#enwnd_header_txt").html(goldTxt(t)),
    $("#enwnd_content").html(e),
    $("#en_wnd").show().absCenter(),
    $("#en_wnd .close-button").unbind("click").bind("click", (function() {
        (!isset(a) || a()) && hideEnWindow()
    }
    ))
}
function goldTxt(t, e) {
    return '<span class="' + (e ? "gfont gfont-all" : "gfont") + '" name="' + t + '">' + t + "</span>"
}
function copyStructure(t) {
    return JSON.parse(JSON.stringify(t))
}
function hideEnWindow() {
    g.lock.remove("en_window"),
    $("#en_wnd").hide()
}
function drawButton(t, e) {
    return '<div onclick="' + e + '" class=mButton><div class=inner-part></div><div class=left></div><div class=right></div><div class="content">' + goldTxt(t) + "</div></div>"
}
function tutorialStart(t) {}
function strtotime(t, e) {
    var n, a, r, l, i = "";
    if ("now" === (t = (t = t.replace(/\s{2,}|^\s|\s$/g, " ")).replace(/[\t\r\n]/g, "")))
        return null === e || isNaN(e) ? (new Date).getTime() / 1e3 | 0 : 0 | e;
    if (!isNaN(i = Date.parse(t)))
        return i / 1e3 | 0;
    e = e ? new Date(1e3 * e) : new Date,
    t = t.toLowerCase();
    var o = {
        day: {
            sun: 0,
            mon: 1,
            tue: 2,
            wed: 3,
            thu: 4,
            fri: 5,
            sat: 6
        },
        mon: ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"]
    }
      , s = function(t) {
        var n = t[2] && "ago" === t[2]
          , a = (a = "last" === t[0] ? -1 : 1) * (n ? -1 : 1);
        switch (t[0]) {
        case "last":
        case "next":
            switch (t[1].substring(0, 3)) {
            case "yea":
                e.setFullYear(e.getFullYear() + a);
                break;
            case "mon":
                e.setMonth(e.getMonth() + a);
                break;
            case "wee":
                e.setDate(e.getDate() + 7 * a);
                break;
            case "day":
                e.setDate(e.getDate() + a);
                break;
            case "hou":
                e.setHours(e.getHours() + a);
                break;
            case "min":
                e.setMinutes(e.getMinutes() + a);
                break;
            case "sec":
                e.setSeconds(e.getSeconds() + a);
                break;
            default:
                var r = o.day[t[1].substring(0, 3)];
                if (void 0 !== r) {
                    var l = r - e.getDay();
                    0 === l ? l = 7 * a : l > 0 ? "last" === t[0] && (l -= 7) : "next" === t[0] && (l += 7),
                    e.setDate(e.getDate() + l)
                }
            }
            break;
        default:
            if (!/\d+/.test(t[0]))
                return !1;
            switch (a *= parseInt(t[0], 10),
            t[1].substring(0, 3)) {
            case "yea":
                e.setFullYear(e.getFullYear() + a);
                break;
            case "mon":
                e.setMonth(e.getMonth() + a);
                break;
            case "wee":
                e.setDate(e.getDate() + 7 * a);
                break;
            case "day":
                e.setDate(e.getDate() + a);
                break;
            case "hou":
                e.setHours(e.getHours() + a);
                break;
            case "min":
                e.setMinutes(e.getMinutes() + a);
                break;
            case "sec":
                e.setSeconds(e.getSeconds() + a)
            }
        }
        return !0
    };
    if (null !== (r = t.match(/^(\d{2,4}-\d{2}-\d{2})(?:\s(\d{1,2}:\d{2}(:\d{2})?)?(?:\.(\d+))?)?$/)))
        return r[2] ? r[3] || (r[2] += ":00") : r[2] = "00:00:00",
        (l = r[1].split(/-/g))[1] = o.mon[l[1] - 1] || l[1],
        l[0] = +l[0],
        l[0] = l[0] >= 0 && l[0] <= 69 ? "20" + (l[0] < 10 ? "0" + l[0] : l[0] + "") : l[0] >= 70 && l[0] <= 99 ? "19" + l[0] : l[0] + "",
        parseInt(this.strtotime(l[2] + " " + l[1] + " " + l[0] + " " + r[2]) + (r[4] ? r[4] / 1e3 : ""), 10);
    if (null === (r = t.match(new RegExp("([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?","gi"))))
        return !1;
    for (n = 0,
    a = r.length; n < a; n++)
        if (!s(r[n].split(" ")))
            return !1;
    return e.getTime() / 1e3 | 0
}
function getAllProfName(t) {
    return {
        m: _t("prof_mag", null, "eq_prof"),
        w: _t("prof_warrior", null, "eq_prof"),
        p: _t("prof_paladyn", null, "eq_prof"),
        t: _t("prof_tracker", null, "eq_prof"),
        h: _t("prof_hunter", null, "eq_prof"),
        b: _t("prof_bladedancer", null, "eq_prof")
    }[t]
}
function getHalfByte(t, e) {
    return t >> 4 * e & 15
}
function parseItemStat(t) {
    t = t.split(";");
    for (var e = {}, n = 0; n < t.length; n++) {
        var a = t[n].split("=");
        e[a[0]] = isset(a[1]) ? a[1] : null
    }
    return e
}
function checkItemExpires(t) {
    return ts() / 1e3 > parseItemStat(t.stat).expires
}
function checkItemStat(t, e) {
    return parseItemStat(t.stat).hasOwnProperty(e)
}
function getAmountItem(t) {
    var e = parseItemStat(t.stat);
    return parseInt(e.amount)
}
function getAmmoItem(t) {
    var e = parseItemStat(t.stat);
    return parseInt(e.ammo)
}
function getParseGold(t) {
    var e = t.toString().length > 9 ? 12 : 10
      , n = t.toString().length > 9 ? "." : " ";
    return round(t, e, n, 3)
}
function itemIsDisabled(t) {
    return t.hasClass("disable-item-mark")
}
function setBarterItem(t) {
    if (g.barter && g.barter.checkShowAffectedOfferId()) {
        var e = t.attr("id").substr(4);
        g.barter.setBarterItem(g.item[e])
    }
}
function setAuctionOffItem(t) {
    if (!g.auctions)
        return !1;
    var e = t.attr("id").substr(4);
    return g.auctions.putAuctionOffItem(g.item[e]),
    !0
}
function setSalvageItem(t) {
    if (!g.crafting || !g.crafting.salvage)
        return !1;
    var e = t.attr("id").substr(4);
    return g.crafting.salvage.onClickInventoryItem(g.item[e]),
    !0
}
function setEnhanceItem(t) {
    if (!g.crafting || !g.crafting.enhancement)
        return !1;
    var e = t.attr("id").substr(4);
    return g.crafting.enhancement.onClickInventoryItem(g.item[e]),
    !0
}
function setExtractionItem(t) {
    if (!g.crafting || !g.crafting.extraction)
        return !1;
    var e = t.attr("id").substr(4);
    return g.crafting.extraction.onClickInventoryItem(g.item[e]),
    !0
}
function setBonusReselectItem(t) {
    if (!g.bonusReselectWindow)
        return !1;
    var e = t.attr("id").substr(4);
    return g.bonusReselectWindow.onClickInventoryItem(g.item[e]),
    !0
}
function htmlspecialchars(t) {
    return t = (t = (t = t.replace(/&/g, "&amp;")).replace(/"/g, "&quot;")).replace(/'/g, "&#039;")
}
function getStartMonth(t) {
    return new Date(1e3 * t).getMonth()
}
function getStartDay(t) {
    return new Date(1e3 * t).getDate()
}
function getStartWeekDay(t) {
    return new Date(1e3 * t).getDay()
}
function getStartYear(t) {
    return new Date(1e3 * t).getFullYear()
}
function showIthanMap() {
    var t = new Image;
    t.src = CFG.npath + "ithan-bard-map.png",
    t.onload = function() {
        mAlert('<img style="width:' + t.width + ";height:" + t.height + ';" src="' + CFG.npath + 'ithan-bard-map.png" />')
    }
}
function _l() {
    var t = location.host.split(".")
      , e = "pl";
    if ("com" === t[t.length - 1])
        e = "en";
    return e
}
function extMgrCookieGet(t) {
    var e = getCookie("__mExts");
    if (isset(t) && t)
        return e;
    if (null !== e) {
        var n = {};
        e = e.split(",");
        for (var a = 0; a < e.length; a++) {
            var r = parseInt(e[a].substr(1));
            isNaN(r) || (n[r] = e[a].substr(0, 1))
        }
        return n
    }
    return {}
}
Array.prototype.indexOf || (Array.prototype.indexOf = function(t) {
    var e = this.length >>> 0
      , n = Number(arguments[1]) || 0;
    for ((n = n < 0 ? Math.ceil(n) : Math.floor(n)) < 0 && (n += e); n < e; n++)
        if (n in this && this[n] === t)
            return n;
    return -1
}
),
window.isInt = function(t) {
    return !isNaN(t) && (0 | (e = parseFloat(t))) === e;
    var e
}
,
window.isIntVal = function(t) {
    var e = parseInt(t);
    return !Number.isNaN(parseInt(e)) && e == t
}
,
window.isStringVal = function(t) {
    return "string" == typeof t
}
,
window.isFloatVal = function(t) {
    var e = parseFloat(t);
    return !Number.isNaN(parseFloat(e)) && e == t
}
,
window.isPl = function() {
    return "pl" == _l()
}
,
window.isEn = function() {
    return "en" == _l()
}
,
$(document).ready((function() {
    $(window).on("error", (function() {}
    )),
    $(document).mouseover((function(t) {
        if (isset(g) && g.away.update(),
        $targ = $(t.target),
        $targ.attr("rollover")) {
            var e = $targ.css("backgroundPosition");
            "" == t.target.id && $targ.attr("id", "rndid#" + Math.random()),
            isset(e) || "" == $targ.css("backgroundPositionX") || (e = $targ.css("backgroundPositionX") + " " + $targ.css("backgroundPositionY")),
            isset(e) || (e = "0 0");
            var n = e.split(" ");
            $targ.data("bp", e).css("backgroundPosition", n[0] + " -" + $targ.attr("rollover") + "px")
        }
        $targ.attr("rollover2") && (isset(e = $targ.css("backgroundPosition")) || (e = "0 0"),
        $targ.data("bp", e).css("backgroundPosition", "-" + $targ.attr("rollover2") + "px 0"));
        $targ.attr("wmap") && map.highlightMap($targ.attr("wmap"))
    }
    )),
    $(document).mouseout((function(t) {
        $targ = $(t.target),
        $targ.attr("rollover") && $targ.css("backgroundPosition", $targ.data("bp")),
        $targ.attr("rollover2") && $targ.css("backgroundPosition", $targ.data("bp")),
        $targ.attr("wmap") && map.fadeoutMap($targ.attr("wmap"))
    }
    ))
}
)),
window.round = function(t, e, n) {
    var a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
    e = isset(e) ? e : 1;
    var r = (t = Math.abs(parseFloat(t))) < 0 ? "-" : ""
      , l = "";
    if (10 === e)
        isset(n) || (n = " "),
        l = t.toString().length < 4 ? t : t.toString().replace(/(\d)(?=(?:\d{3})+$)/g, "$1" + n);
    else {
        var i = roundParser(t);
        if (isset(n) || (n = "."),
        l = Math.round(i.val * Math.pow(10, e - 1)) / Math.pow(10, e - 1),
        a && (l = cutFloat(l, a)),
        l = (l += i.postfix).replace(/\./, n),
        t < 9999)
            return r + t
    }
    return r + l
}
,
window.formNumberToNumbersGroup = function(t) {
    var e = t.toString().split("").reverse()
      , n = [];
    if (t.toString().indexOf(".") > -1)
        return t;
    for (var a = 0; a < e.length; a++) {
        a % 3 == 0 && 0 != a && n.push(" "),
        n.push(e[a])
    }
    return n.reverse(),
    n.join("")
}
;
var _tMessagesQueue = []
  , _tQueueTimeout = null
  , _tDefaultCategory = "default";
function _tSend() {
    _tMessagesQueue = []
}
function invertKeyInputOnSpecificMap(t) {
    if ([3714].indexOf(t) > -1)
        return !0
}
function setNormalKeySet(t) {
    t ? (g.keys.wsad = {
        65: "W",
        87: "N",
        68: "E",
        83: "S"
    },
    g.keys.arrows = {
        37: "W",
        38: "N",
        39: "E",
        40: "S"
    }) : (g.keys.wsad = {
        65: "E",
        87: "S",
        68: "W",
        83: "N"
    },
    g.keys.arrows = {
        37: "E",
        38: "S",
        39: "W",
        40: "N"
    })
}
function createTranslationsAttrData(t, e) {
    var n = {};
    for (var a in e) {
        if (!checkCorrectParameter(a))
            return console.error("Translations.js", "createTranslationsAttrData", "Translations parameter name is incorrect!", a),
            n;
        var r = getParams(a)
          , l = new RegExp("%" + r + "(.*?)%","g")
          , i = t.match(l);
        manageOneAttrData(t, n, i)
    }
    return n
}
function checkCorrectParameter(t) {
    return "%" == t[0] && "%" == t[t.length - 1]
}
function getParams(t) {
    var e = t.substring(0, t.length - 1);
    return e = e.substring(1)
}
function manageOneAttrData(t, e, n) {
    for (var a in n) {
        var r = n[a].split(":")
          , l = n[a]
          , i = r[0];
        if (1 == r.length)
            e[i] = {
                fullStr: l,
                strAttr: i,
                modify: null
            };
        else {
            if (e[i])
                return void console.error("Translations", "manageOneAttrData", "With modify, parameter name can occurred only one in all string!", t);
            if (r.length > 2)
                return void console.error("Translations", "manageOneAttrData", "Only one modify require!", r);
            i = r[0] + "%";
            var o = r[1].slice(0, -1);
            e[i] = {
                fullStr: l,
                strAttr: i,
                modify: o
            }
        }
    }
}
function getNewValAfterModify(t, e) {
    switch (e) {
    case "GET_LEFT":
        return getSecondLeft(t, {
            short: !0
        });
    case "GET_CURRENCY":
        return getCurrency(t);
    case "ARRAY_PARAM":
        return arrayParams(t)
    }
    return console.error("Translations", "getNewValAfterModify", "Unregistered translations modify:", e),
    t
}
function getCurrency(t) {
    return arrayParams(t, (function(t) {
        var e = t.split("=");
        if (2 != e.length)
            return console.error("[Translations.js] getCurrency Incorrect currency data", t),
            "";
        var n = e[0];
        return e[1] + " " + getCurrencyTextByChar(n)
    }
    ))
}
function getCurrencyTextByChar(t) {
    switch (t) {
    case "z":
        return _t("cost_gold");
    case "s":
        return _t("sl");
    default:
        return console.error("[Translations.js] getCurrencyTextByChar Currency not exist", t),
        ""
    }
}
function arrayParams(t, e) {
    var n = t.split(";");
    if (1 == n.length)
        return e ? e(t) : t;
    var a = "";
    for (var r in n) {
        var l = n[r];
        a += e ? e(l) : l,
        a += parseInt(r) + 1 == n.length - 1 ? " i " : ", "
    }
    return a.substring(0, a.length - 2),
    a.substring(0, a.length - 2)
}
function getTranslationsWithParameters(t, e, n) {
    var a = createTranslationsAttrData(t, e);
    for (var r in e) {
        var l = void 0
          , i = void 0
          , o = a[r];
        if (o && o.modify) {
            var s = o.fullStr
              , u = o.modify;
            l = getNewValAfterModify(e[r], u),
            i = s
        } else
            l = e[r],
            i = r;
        t = n ? t.replace(new RegExp(i,"g"), '<span class="damage">' + l + "</span>") : t.replace(new RegExp(i,"g"), l)
    }
    return t
}
function createSiInput(t) {
    var e = t.cl
      , n = t.type
      , a = t.placeholder
      , r = t.changeClb
      , l = t.clearClb
      , i = null
      , o = (i = n && "number" == n ? $('<div class="si-input">\n        <input type="number" class="default">\n        <div class="clear-cross"></div>\n    </div>') : $('<div class="si-input">\n        <input class="default">\n        <div class="clear-cross"></div>\n    </div>')).find("input")
      , s = i.find(".clear-cross");
    function u() {
        var t = i.hasClass("isClearCross");
        "" === o.val() ? t && i.removeClass("isClearCross") : t || i.addClass("isClearCross")
    }
    return e && i.addClass(e),
    s.tip(_t("delete")),
    s.on("click", (function() {
        var t = o.val();
        "" != o.val("") && o.val(""),
        u(),
        l && l(t)
    }
    )),
    o.on("change", (function(t) {
        if (u(),
        !t.isTrigger && r) {
            var e = o.val();
            r(e)
        }
    }
    )),
    o.keyup((function() {
        u()
    }
    )),
    a && createInputPlaceholder(a),
    i
}
function createInputPlaceholder(t, e) {
    e.attr("placeholder", t)
}
function createSiCheckBox(t, e, n) {
    var a = $('<div class="one-checkbox">\n        <div class="checkbox"></div>\n        <span class="label"></span>\n    </div>');
    return a.addClass(e),
    a.find(".label").html(t),
    a.click((function() {
        var t = $(this).find(".checkbox");
        t.toggleClass("active");
        var e = t.hasClass("active");
        n(e, a)
    }
    )),
    a
}
function createSiMenu(t, e, n, a) {
    var r = function(t, e) {
        var n = $("<option>").html(t);
        return n.attr("value", e),
        n
    }
      , l = function() {
        for (var t in e) {
            var n = r(e[t].text, e[t].val);
            o(n)
        }
    }
      , i = function() {
        a && t.on("change", (function() {
            a(t.val())
        }
        ))
    }
      , o = function(e) {
        t.append(e)
    }
      , s = function() {
        t.getValue = function() {
            return t.val()
        }
    };
    (function() {
        t.addClass("menu default"),
        t.data(e)
    }
    )(),
    l(),
    i(),
    s()
}
function createSmallDraconiteIcon(t) {
    return createSmallCurrencyIconWithCost(t, "small-draconite")
}
function createSmallGoldIcon(t) {
    return createSmallCurrencyIconWithCost(t, "small-money")
}
function createSmallCurrencyIconWithCost(t, e) {
    var n = $("<span>").addClass("small-currency-icon")
      , a = $("<div>").addClass("icon ".concat(e))
      , r = $("<span>").addClass("value").html(formNumberToNumbersGroup(t));
    return n.append(r),
    n.append(a),
    n
}
function createSmallButtonWithBackground(t, e, n) {
    var a, r, l = $('<div class="button">\n        <div class="background"></div>\n        <div class="label"></div>\n    </div>')[0], i = $('<div class="add-bck"></div>')[0];
    return l.append(i),
    l.classList.add("small"),
    l.classList.add("small-button-with-background"),
    (a = l.classList).add.apply(a, _toConsumableArray(e)),
    (r = i.classList).add.apply(r, _toConsumableArray(t)),
    l.addEventListener("click", n),
    l
}
function _t(t, e, n) {
    var a = isset(n) ? n : _tDefaultCategory;
    if (isset(__translations[a]) && isset(__translations[a][t])) {
        var r = __translations[a][t];
        return isset(e) && (r = getTranslationsWithParameters(r, e)),
        r
    }
    for (var l = !1, i = 0; i < _tMessagesQueue.length; i++)
        if (_tMessagesQueue[i].m == t && a == _tMessagesQueue[i].c) {
            l = !0;
            break
        }
    return l || (_tMessagesQueue.push({
        m: t,
        c: a
    }),
    clearTimeout(_tQueueTimeout),
    _tQueueTimeout = setTimeout((function() {
        _tSend()
    }
    ), 500)),
    "[T:" + a + "]" + t
}
function lengthObject(t) {
    var e, n = 0;
    for (e in t)
        t.hasOwnProperty(e) && n++;
    return n
}
function createMMButton(t, e, n) {
    var a = $('<div class="MM-button"><div class="left"></div><div class="content"><span class="gfont">' + t + '</span></div><div class="right"></div></div>');
    e.append(a),
    a.click(n)
}
function createBigButtonButton(t, e, n) {
    var a = $('<div class="big-button"><div class="left"></div><div class="content"><span class="gfont">' + t + '</span></div><div class="right"></div></div>');
    e.append(a),
    a.click(n)
}
function drawSIButton(t) {
    var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "def"
      , n = "def" === e ? "SI-button" : "btn-".concat(e);
    return $('<div class="' + n + '"> <div class=left></div> <div class=label>      <span class="gfont" name="' + t + '">' + t + "</span>  </div><div class=right></div></div>")
}
function initClanAttrChange() {
    var t = {
        "[name=clan-list-item-menu]": _t("clan_list", null, "clan"),
        "[name=clan-official-page-item-menu]": _t("clan-official-page", null, "clan"),
        "[name=clan-private-page-item-menu]": _t("clan_priv-page", null, "clan"),
        "[name=clan-recruit-item-menu]": _t("clan_recruit", null, "clan"),
        "[name=clan-members-item-menu]": _t("clan_members", null, "clan"),
        "[name=clan-treasure-item-menu]": _t("clan_treasury", null, "clan"),
        "[name=clan-manage-item-menu]": _t("clan_manage", null, "clan"),
        "[name=clan-diplomacy-item-menu]": _t("clan_diplomacy", null, "clan"),
        "[name=clan-history-item-menu]": _t("clan_history", null, "clan"),
        "[name=clan-close-item-menu]": _t("close"),
        "[name=clan-skills-item-menu]": _t("clan_skills", null, "clan"),
        "[name=clan-quests-item-menu]": _t("clan_quests", null, "clan")
    };
    for (var e in t)
        $(e).attr("name", t[e])
}
function initBMAttrChange() {
    var t = {
        "[name=add-normal-attack-bm]": _t("add-normal-attack", null, "skills"),
        "[name=add-move-bm]": _t("add-move", null, "skills"),
        "[name=save-and-close-bm]": _t("save-btn", null, "skills"),
        "[name=clear-bm-list]": _t("clear-list", null, "skills"),
        "[name=close-bm]": _t("close")
    };
    for (var e in t)
        $(e).attr("name", t[e])
}
function initStaticStrings() {
    var t = {
        "#bm-label1": "DostÄpne od 25 poziomu",
        "#bm-label2": _t("mbattle"),
        "#add-normal-attack-bm": _t("add-normal-attack", null, "skills"),
        "#add-move-bm": _t("add-move", null, "skills"),
        "#save-and-close-bm": _t("save-btn", null, "skills"),
        "#clear-bm-list": _t("clear-list", null, "skills"),
        "#close-bm": _t("close"),
        "[name=add-normal-attack-bm]": _t("add-normal-attack", null, "skills"),
        "[name=add-move-bm]": _t("add-move", null, "skills"),
        "[name=save-and-close-bm]": _t("save-btn", null, "skills"),
        "[name=clear-bm-list]": _t("clear-list", null, "skills"),
        "[name=close-bm]": _t("close"),
        "#ban-reason-label": _t("banday_reason_label"),
        "#clan-list-item-menu": _t("clan_list", null, "clan"),
        "#clan-official-page-item-menu": _t("clan-official-page", null, "clan"),
        "#clan-private-page-item-menu": _t("clan_priv-page", null, "clan"),
        "#clan-recruit-item-menu": _t("clan_recruit", null, "clan"),
        "#clan-members-item-menu": _t("clan_members", null, "clan"),
        "#clan-treasure-item-menu": _t("clan_treasury", null, "clan"),
        "#clan-manage-item-menu": _t("clan_manage", null, "clan"),
        "#clan-diplomacy-item-menu": _t("clan_diplomacy", null, "clan"),
        "#clan-history-item-menu": _t("clan_history", null, "clan"),
        "#clan-close-item-menu": _t("close"),
        "#clan-skills-item-menu": _t("clan_skills", null, "clan"),
        "#clan-quests-item-menu": _t("clan_quests", null, "clan"),
        "[name=clan-list-item-menu]": _t("clan_list", null, "clan"),
        "[name=clan-official-page-item-menu]": _t("clan-official-page", null, "clan"),
        "[name=clan-private-page-item-menu]": _t("clan_priv-page", null, "clan"),
        "[name=clan-recruit-item-menu]": _t("clan_recruit", null, "clan"),
        "[name=clan-members-item-menu]": _t("clan_members", null, "clan"),
        "[name=clan-treasure-item-menu]": _t("clan_treasury", null, "clan"),
        "[name=clan-manage-item-menu]": _t("clan_manage", null, "clan"),
        "[name=clan-diplomacy-item-menu]": _t("clan_diplomacy", null, "clan"),
        "[name=clan-history-item-menu]": _t("clan_history", null, "clan"),
        "[name=clan-close-item-menu]": _t("close"),
        "[name=clan-skills-item-menu]": _t("clan_skills", null, "clan"),
        "[name=clan-quests-item-menu]": _t("clan_quests", null, "clan"),
        "#match-details-title-txt": _t("details", null, "matchmaking"),
        "#for-you-disabled-text": _t("for_you_alert"),
        "#pre-premium-header-txt": _t("iconstar"),
        "#for-you-txt": _t("badged", null, "extManager"),
        "#match-details-txt": _t("details_progress", null, "matchmaking"),
        "#_t1": _t("loading_inprogress", null, "static"),
        "#_t2": _t("loading_inprogress_long", null, "static"),
        "#_t3": _t("stamina_renew_4h", null, "static"),
        "#st_pay_1": _t("for_today", null, "static"),
        "#st_pay_2": _t("for_week", null, "static"),
        "#st_pay_8": _t("for_30days", null, "static"),
        "#imgload": _t("just_while...", null, "static"),
        "#_t4": _t("item_drop_question", null, "static"),
        "#_t5": _t("item_drop_throw", null, "static"),
        "#_t6": _t("item_drop_destroy", null, "static"),
        "#_t7": _t("item_drop_nothing", null, "static"),
        "#_t8": _t("item_throw_*info", null, "static"),
        "#opt1": _t("opt_1", null, "opts"),
        "#opt6": _t("opt_6", null, "opts"),
        "#opt2": _t("opt_2", null, "opts"),
        "#opt3": _t("opt_3", null, "opts"),
        "#opt5": _t("opt_5", null, "opts"),
        "#opt4": _t("opt_4", null, "opts"),
        "#opt7": _t("opt_7", null, "opts"),
        "#opt8": _t("opt_8", null, "opts"),
        "#opt9": _t("opt_9", null, "opts"),
        "#opt10": _t("opt_10", null, "opts"),
        "#opt11": _t("opt_11", null, "opts"),
        "#opt12": _t("opt_12", null, "opts"),
        "#opt13": _t("opt_13", null, "opts"),
        "#opt14": _t("opt_14", null, "opts"),
        "#opt16": _t("opt_16", null, "opts"),
        "#opt27": _t("opt_27", null, "opts"),
        "#b_quests|tip": _t("quests_tip", null, "buttons"),
        "#b_clans|tip": _t("clans_tip", null, "buttons"),
        "#b_pvp|tip": _t("pvp_tip", null, "buttons"),
        "#b_recipes|tip": _t("b_recipes", null, "buttons"),
        "#b_config|tip": _t("config_tip", null, "buttons"),
        "#b_map|tip": _t("map_tip", null, "buttons"),
        "#b_skills|tip": _t("skills_tip", null, "buttons"),
        "#b_friends|tip": _t("friends_tip", null, "buttons"),
        "#b_addons|tip": _t("addons_tip", null, "buttons"),
        "#skillSwitch|tip": _t("skillset_chng", null, "buttons"),
        "#bchat|tip": _t("chat_button_nfo", null, "buttons"),
        "#b_news|tip": _t("news", null, "news"),
        "#b_help|tip": _t("help_tip", null, "buttons"),
        "#b_matchmaking|tip": _t("matchmaking"),
        "#_t9": _t("chathorror_header", null, "static"),
        "#_t10": _t("chathorror_send", null, "static"),
        "#_t11": _t("chathorror_cancel", null, "static"),
        "#_t12": _t("chathorror_config", null, "static"),
        "#_t13": _t("yt_close", null, "static"),
        "#_t14": _t("hide", null, "static"),
        "#warn|tip": _t("warn_tip", null, "static"),
        "#bm_party|tip": _t("bm_party_tip", null, "static"),
        "#bm_movie|tip": _t("bm_movie_tip", null, "static"),
        "#bm_register|tip": _t("bm_register", null, "ingame_register"),
        "#new_event_calendar|tip": _t("event_calendar", null, "event_calendar"),
        "#_t15": _t("addon_list_h2", null, "static"),
        "#_t16": _t("addon_list_mine", null, "static"),
        "#_t17": _t("addon_active", null, "static"),
        "#_t18": _t("addon_name", null, "static"),
        "#_t19": _t("addon_run", null, "static"),
        "#_t20": _t("addon_save", null, "static"),
        "#h1_add_active": _t("addons_active", null, "static"),
        "#_t21": _t("addon_start_header", null, "static"),
        "#_t22": _t("addon_start_txt", null, "static"),
        "#addon_help_txt": _t("addon_help_txt", null, "extManager"),
        "#ad_type_txt": _t("ad_type_txt", null, "extManager"),
        "#ad_opt_badged": _t("ad_opt_badged", null, "extManager"),
        "#ad_opt_verified": _t("ad_opt_verified", null, "extManager"),
        "#ad_opt_all": _t("ad_opt_all", null, "extManager"),
        "#ad_opt_popular": _t("ad_opt_popular", null, "extManager"),
        "#ad_opt_unverified": _t("ad_opt_unverified", null, "extManager"),
        "#pvpIndicatorsListButton|tip": _t("show_list", null, "pklist"),
        "#mytr_gold|tip": _t("mytr_gold_tip", null, "static"),
        "#au0": _t("au_auction_list", null, "auction"),
        "#au1": _t("au_cat1", null, "auction"),
        "#au2": _t("au_cat2", null, "auction"),
        "#au3": _t("au_cat3", null, "auction"),
        "#au4": _t("au_cat4", null, "auction"),
        "#au5": _t("au_cat5", null, "auction"),
        "#au6": _t("au_cat6", null, "auction"),
        "#au7": _t("au_cat7", null, "auction"),
        "#au8": _t("au_cat8", null, "auction"),
        "#au9": _t("au_cat9", null, "auction"),
        "#au10": _t("au_cat10", null, "auction"),
        "#au11": _t("au_cat11", null, "auction"),
        "#au12": _t("au_cat12", null, "auction"),
        "#au13": _t("au_cat13", null, "auction"),
        "#au14": _t("au_cat14", null, "auction"),
        "#au15": _t("au_cat15", null, "auction"),
        "#au16": _t("au_cat16", null, "auction"),
        "#au21": _t("au_cat21", null, "auction"),
        "#au22": _t("au_cat22", null, "auction"),
        "#au23": _t("au_cat23", null, "auction"),
        "#au99": _t("au_cat99", null, "auction"),
        "#_t23": _t("au_yours", null, "auction"),
        "#_t24": _t("au_yours_nfo", null, "auction"),
        "#_24_2": _t("price_th", null, "auction"),
        "#_t25": _t("au_buynow", null, "auction"),
        "#_t26": _t("au_time", null, "auction"),
        "#_t27": _t("au_limit_nfo", null, "auction"),
        "#_t28": _t("au_buynow_price", null, "auction"),
        "#_t29": _t("au_sl", null, "auction"),
        "#_t30": _t("au_price_info_txt", null, "auction"),
        "#depo-txt-rent": _t("depo-txt-rent", null, "depo"),
        "#_t31": _t("depo_info_msg", null, "depo"),
        "#_t32": _t("depo_next_renew", null, "depo"),
        "#db_txt": _t("depo-balance", null, "depo"),
        "#_t33|tip": _t("add_normal_attack_tip", null, "bm"),
        "#_t34|tip": _t("remove_all_fromlist", null, "bm"),
        "#_t35|tip": _t("hide_editor_panel", null, "bm"),
        "#_t36": _t("auto_skills_list", null, "bm"),
        "#bm_rpt_switch|tip": _t("loop_skills", null, "bm"),
        "#autobattleButton|tip": _t("auto_btn_txt", null, "battle"),
        "#surrenderBattleButton": _t("surrender", null, "battle"),
        "#surrenderBattleButton|tip": _t("surrender-tip", null, "battle"),
        "#event_calendar_switch|tip": _t("show_calendar", null, "event_calendar"),
        "#_t37": _t("actions_head", null, "help"),
        "#_t38": _t("actions_txt", null, "help"),
        "#_t39": _t("battle_help_txt", null, "help"),
        "#_t40": _t("gold_shop_head_info"),
        "#_t41": _t("add_gold_sl_au"),
        "#_t42": _t("au_price_info_txt_gold", null, "auction"),
        "#_t43": _t("add_gold_sl_au_info"),
        "#itemWaitBox .hoverbutton|tip": _t("item_wait_info"),
        "#addon_search_div span": _t("add_search", null, "extManager"),
        "#ah_price_special|placeholder": _t("gold_price_placeholder"),
        "#intelect-increase": _t("intelect-increase"),
        "#dexternity-increase": _t("dexternity-increase"),
        "#strength-increase": _t("strength-increase")
    };
    for (var e in t) {
        var n = e.split("|");
        1 == n.length ? $(n[0]).html(t[e]) : 2 == n.length && $(n[0]).attr(n[1], t[e])
    }
}
function getSecondLeft(t, e) {
    var n = Math.floor(t / 60)
      , a = Math.floor(n / 60)
      , r = Math.floor(a / 24)
      , l = t - 60 * n
      , i = n - 60 * a
      , o = a - 24 * r;
    return e ? 0 == r && 0 == a ? i + "m : " + l + "s" : 0 == r ? o + "h : " + i + "m" : r + "d : " + o + "h" : r + "d : " + o + "h : " + i + "m : " + l + "s"
}
function calculateDiffFull(t, e) {
    var n = 1e3 * (t - e)
      , a = Math.floor(n / 864e5)
      , r = Math.floor(n % 864e5 / 36e5)
      , l = Math.floor(n % 36e5 / 6e4)
      , i = Math.floor(n % 6e4 / 1e3)
      , o = a < 1
      , s = o && r < 1
      , u = a > 0;
    return (o ? "" : _t("time_days_short %val%", {
        "%val%": a
    }, "time_diff")) + " " + (s ? "" : _t("time_h_short %val%", {
        "%val%": r
    }, "time_diff")) + " " + _t("time_min_short %val%", {
        "%val%": l
    }, "time_diff") + " " + (u ? "" : _t("time_sec_short %val%", {
        "%val%": i
    }, "time_diff"))
}
function convertTimeToSec(t) {
    var e, n = t.replace(/[0-9]/g, ""), a = t.replace(/\D/g, "");
    switch (n) {
    case "d":
        e = 60 * a * 60 * 24;
        break;
    case "h":
        e = 60 * a * 60;
        break;
    case "m":
        e = 60 * a;
        break;
    case "s":
        e = a
    }
    return e
}
function convertSecToTime(t) {
    var e = Math.floor(t / 86400);
    t -= 86400 * e;
    var n = Math.floor(t / 3600);
    t -= 3600 * n;
    var a = Math.floor(t / 60);
    return {
        d: e,
        h: n,
        m: a,
        s: t -= 60 * a
    }
}
window.siblings = function(t) {
    return _toConsumableArray(t.parentElement.children).filter((function(e) {
        return e !== t
    }
    ))
}
,
window.count = function(t, e, n) {
    switch (t) {
    case "<":
        return e < n;
    case "<=":
        return e <= n;
    case ">":
        return e > n;
    case ">=":
        return e >= n;
    case "==":
        return e == n;
    case "===":
        return e === n
    }
}
,
window.removeFromArray = function(t, e) {
    var n = t.indexOf(e);
    return n > -1 && (t.splice(n, 1),
    !0)
}
,
window.arrayEquals = function(t, e) {
    var n = t.slice().sort()
      , a = e.slice().sort();
    return JSON.stringify(n) === JSON.stringify(a)
}
,
window.setAttributes = function(t, e) {
    for (var n in e)
        t.setAttribute(n, e[n])
}
,
window.throttle = function(t, e) {
    var n;
    return function() {
        var a = arguments
          , r = this;
        n || (t.apply(r, a),
        n = !0,
        setTimeout((function() {
            return n = !1
        }
        ), e))
    }
}
,
window.debounce = function(t, e) {
    var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]
      , a = null;
    return function(r) {
        var l = arguments
          , i = this
          , o = n && !a
          , s = function() {
            return t.apply(i, l)
        };
        clearTimeout(a),
        a = setTimeout(s, e),
        o && s()
    }
}
,
window.createItem = function(t) {
    var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : t.tip;
    return $('<div class="item" id="item'.concat(t.id, '" ctip="t_item"></div>')).attr("tip", e)
}
,
window.removeSpaces = function(t) {
    return t.replace(/\s/g, "")
}
,
window.removeClassStartingWith = function(t, e) {
    var n = new RegExp("\\b" + e + "[^ ]*[ ]?\\b","g");
    return t.className = t.className.replace(n, ""),
    t
}
,
window.roundShorten = function(t) {
    return round(t, 9, ".", 2).replace(/^(\d*)[.](\d*)([kmg])$/g, (function(t, e, n, a, r, l) {
        return 3 === e.length && 2 === n.length ? "".concat(e).concat(a) : 2 === e.length && 2 === n.length ? "".concat(e, ".").concat(n.slice(0, -1)).concat(a) : l
    }
    ))
}
,
window.createButton = function(t, e) {
    var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2]
      , a = drawSIButton(t)[0];
    return a.classList.add(e),
    n && a.addEventListener("click", n),
    a
}
,
window.checkItemsAmount = function(t) {
    var e = g.hItems
      , n = 0;
    for (var a in e) {
        var r = e[a];
        r.st > 0 || r.tpl == t && (n += parseInt(parseItemStat(r.stat).amount))
    }
    return n
}
,
window.decodeHtmlEntities = function(t) {
    var e = document.createElement("textarea");
    return e.innerHTML = t,
    e.value
}
,
window.isItemInSell = function(t) {
    return !(!g.shop || 0 === g.shop.id) && $("#shop_sell #item" + t).length > 0
}
,
window.itemRarity = {
    common: {
        name: _t("rarity_common", null, "item"),
        namePlural: _t("rarity_plural_common", null, "item"),
        color: "#9da1a7",
        sort: 1
    },
    unique: {
        name: _t("rarity_unique", null, "item"),
        namePlural: _t("rarity_plural_unique", null, "item"),
        color: "#fffb00",
        sort: 2
    },
    heroic: {
        name: _t("rarity_heroic", null, "item"),
        namePlural: _t("rarity_plural_heroic", null, "item"),
        color: "#38b8eb",
        sort: 3
    },
    upgraded: {
        name: _t("rarity_upgraded", null, "item"),
        namePlural: _t("rarity_plural_upgraded", null, "item"),
        color: "#ff59af",
        sort: 4
    },
    legendary: {
        name: _t("rarity_legendary", null, "item"),
        namePlural: _t("rarity_plural_legendary", null, "item"),
        color: "#ff8400",
        sort: 5
    },
    artefact: {
        name: _t("rarity_artefact", null, "item"),
        namePlural: _t("rarity_plural_artefact", null, "item"),
        color: "#e84646",
        sort: 6
    }
},
window.errorReport = function(t, e, n, a) {
    a = a || "",
    console.error("[".concat(t, ", ").concat(e, "] ").concat(n), a)
}
,
window.configIcon = function() {
    var t = document.createElement("div");
    return t.classList.add("config-icon"),
    t
}
;
function _slicedToArray(a, e) {
    return _arrayWithHoles(a) || _iterableToArrayLimit(a, e) || _unsupportedIterableToArray(a, e) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(a, e) {
    if (a) {
        if ("string" == typeof a)
            return _arrayLikeToArray(a, e);
        var r = Object.prototype.toString.call(a).slice(8, -1);
        return "Object" === r && a.constructor && (r = a.constructor.name),
        "Map" === r || "Set" === r ? Array.from(a) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? _arrayLikeToArray(a, e) : void 0
    }
}
function _arrayLikeToArray(a, e) {
    (null == e || e > a.length) && (e = a.length);
    for (var r = 0, t = new Array(e); r < e; r++)
        t[r] = a[r];
    return t
}
function _iterableToArrayLimit(a, e) {
    var r = null == a ? null : "undefined" != typeof Symbol && a[Symbol.iterator] || a["@@iterator"];
    if (null != r) {
        var t, l, s = [], b = !0, _ = !1;
        try {
            for (r = r.call(a); !(b = (t = r.next()).done) && (s.push(t.value),
            !e || s.length !== e); b = !0)
                ;
        } catch (a) {
            _ = !0,
            l = a
        } finally {
            try {
                b || null == r.return || r.return()
            } finally {
                if (_)
                    throw l
            }
        }
        return s
    }
}
function _arrayWithHoles(a) {
    if (Array.isArray(a))
        return a
}
if ("undefined" == typeof ut_date && (window.ut_date = function(a) {
    var e = new Date(1e3 * a)
      , r = e.getFullYear();
    return e.getDate() + "/" + (e.getMonth() + 1) + "/" + r
}
),
"undefined" == typeof htmlspecialchars && (window.htmlspecialchars = function(a) {
    return a = (a = (a = a.replace(/&/g, "&amp;")).replace(/"/g, "&quot;")).replace(/'/g, "&#039;")
}
),
"undefined" == typeof _l && (window._l = function() {
    var a = location.host.split(".")
      , e = "pl";
    if ("com" === a[a.length - 1])
        e = "en";
    return e
}
),
"undefined" == typeof parseItemStat && (window.parseItemStat = function(a) {
    a = a.split(";");
    for (var e = {}, r = 0; r < a.length; r++) {
        var t = a[r].split("=");
        e[t[0]] = isset(t[1]) ? t[1] : null
    }
    return e
}
),
"undefined" == typeof calculateDiffFull && (window.calculateDiffFull = function(a, e) {
    var r = 1e3 * (a - e)
      , t = Math.floor(r / 864e5)
      , l = Math.floor(r % 864e5 / 36e5)
      , s = Math.floor(r % 36e5 / 6e4)
      , b = Math.floor(r % 6e4 / 1e3)
      , _ = t < 1
      , n = _ && l < 1
      , c = t > 0;
    return (_ ? "" : _t("time_days_short %val%", {
        "%val%": t
    }, "time_diff")) + " " + (n ? "" : _t("time_h_short %val%", {
        "%val%": l
    }, "time_diff")) + " " + _t("time_min_short %val%", {
        "%val%": s
    }, "time_diff") + " " + (c ? "" : _t("time_sec_short %val%", {
        "%val%": b
    }, "time_diff"))
}
),
"undefined" == typeof convertTimeToSec && (window.convertTimeToSec = function(a) {
    var e, r = a.replace(/[0-9]/g, ""), t = a.replace(/\D/g, "");
    switch (r) {
    case "d":
        e = 60 * t * 60 * 24;
        break;
    case "h":
        e = 60 * t * 60;
        break;
    case "m":
        e = 60 * t;
        break;
    case "s":
        e = t
    }
    return e
}
),
"undefined" == typeof convertSecToTime && (window.convertSecToTime = function(a) {
    var e = Math.floor(a / 86400);
    a -= 86400 * e;
    var r = Math.floor(a / 3600);
    a -= 3600 * r;
    var t = Math.floor(a / 60);
    return {
        d: e,
        h: r,
        m: t,
        s: a -= 60 * t
    }
}
),
window.createTransVal = function(a) {
    var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : ""
      , r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : ""
      , t = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : "";
    return {
        "%val%": "".concat(r).concat(a).concat(e).concat(t)
    }
}
,
void 0 === _t)
    var _t = function(a, e, r) {
        var t = isset(r) ? r : "default";
        if (isset(__translations[t]) && isset(__translations[t][a])) {
            var l = __translations[t][a];
            if (isset(e))
                for (var s in e)
                    l = l.replace(s, e[s]);
            return l
        }
        return "[T:" + t + "]" + a
    };
function itemTip(a, e) {
    var r = window.htmlspecialchars;
    e || (r = function(a) {
        return a
    }
    );
    var t = ["", "", "", "", "", "", "", "", "", ""];
    if (void 0 === l)
        var l = {};
    isset(a.name) && (t[0] = '<b class="item-name">'.concat(parseItemBB(a.name), "</b>")),
    isset(a.cl) && (t[1] = '<span class="type-text">' + _t("itype %type% %value%", {
        "%type%": _t("type"),
        "%value%": eq.classes[a.cl]
    }) + "</span><br />");
    var s = !1
      , b = !1
      , _ = !1
      , n = a.stat.split(";")
      , c = n.indexOf("cursed") >= 0
      , o = c ? _t("cursed_prefix") + " " : "";
    for (var i in n)
        if ("string" == typeof n[i]) {
            var v = n[i].split("=");
            switch (v[0]) {
            case "name":
                t[0] = "<b>" + r(parseItemBB(v[1])) + "</b>",
                t[0] += "<i>" + r(parseItemBB(a.name)) + "</i>";
                break;
            case "rarity":
                if ("common" === v[1])
                    break;
                t[0] += '<b class="'.concat(v[1], '">* ').concat(o).concat(_t("type_".concat(v[1])), " *</b>");
                break;
            case "unique":
                t[0] += "<b class=unique>* " + o + _t("type_unique") + " *</b>";
                break;
            case "heroic":
                t[0] += "<b class=heroic>* " + o + _t("type_heroic") + " *</b>";
                break;
            case "legendary":
                t[0] += "<b class=legendary>* " + o + _t("type_legendary") + " *</b>";
                break;
            case "artefact":
                t[0] += "<b class=artefact>* " + o + _t("type_artifact") + " *</b>";
                break;
            case "upgraded":
                t[0] += "<b class=upgraded>* " + o + _t("type_modified") + " *</b>";
                break;
            case "enhancement_upgrade_lvl":
                var u = $(t[0]);
                u.append(" +".concat(v[1])),
                t[0] = u[0].outerHTML;
                break;
            case "bonus":
                var p = _slicedToArray(v[1].split(","), 2)
                  , k = p[0]
                  , d = p[1]
                  , m = "(+"
                  , f = ")"
                  , h = ""
                  , g = void 0;
                switch (k) {
                case "critmval":
                    h = "%",
                    g = _t("bonus_of-".concat(k, " %val%"), createTransVal(d, h, m, f), "newOrder");
                    break;
                case "sa":
                    g = _t("no_percent_bonus_sa %val%", createTransVal(d / 100, h, m, f));
                    break;
                case "ac":
                    g = _t("item_".concat(k, " %val%"), createTransVal(d, h, m, f));
                    break;
                case "act":
                case "resfire":
                case "reslight":
                case "resfrost":
                    h = "%",
                    g = _t("item_".concat(k, " %val%"), createTransVal(d, h, m, f), "newOrder");
                    break;
                case "crit":
                case "critval":
                case "resdmg":
                    h = "%",
                    g = _t("bonus_".concat(k, " %val%"), createTransVal(d, h, m, f), "newOrder");
                    break;
                case "slow":
                    g = _t("bonus_".concat(k, " %val%"), createTransVal(d / 100, h, m, f));
                    break;
                default:
                    g = _t("bonus_".concat(k, " %val%"), createTransVal(d, h, m, f))
                }
                t[4] += '<span style="color: #87f187;">'.concat(_t("enh_bonus %val%", {
                    "%val%": g
                }), "</span><br>");
                break;
            case "bonus_not_selected":
                t[4] += '<span style="color: #FE5555;">'.concat(_t("bonus_not_selected"), "</span><br>");
                break;
            case "upg":
                var w = parseItemStat(a.stat);
                t[0] += "<b class=upgraded>* " + _t("type_modification %val%", {
                    "%val%": v[1]
                }) + " *</b>",
                isset(w.upgby) && (t[7] += '<span style="color:yellow">' + _t("type_modification_upgb %val% %name%", {
                    "%val%": v[1],
                    "%name%": w.upgby
                }) + "</span><br />");
                break;
            case "improve":
                var y = v[1].split(",")
                  , q = 1;
                switch (y[0]) {
                case "armor":
                case "jewels":
                    q = 1.3;
                    break;
                case "armorb":
                case "weapon":
                    q = 1
                }
                t[3] += _t("improves %items%", {
                    "%items%": _t("improve_" + y[0])
                }) + "<br />",
                t[3] += _t("types_list %upg_normal% %upg_uni% %upg_hero%", {
                    "%upg_normal%": Math.round(q * y[1]),
                    "%upg_uni%": Math.round(q * y[1] * .7),
                    "%upg_hero%": Math.round(q * y[1] * .4)
                }) + "<br />",
                t[3] += _t("improve_item_bound_info") + "<br />";
                break;
            case "upgby":
            case "doubleshoot":
            case "created":
            case "lootbox":
            case "lootbox2":
            case "animation":
            case "unbind_credits":
            case "book":
            case "price":
            case "resp":
            case "key":
            case "mkey":
            case "rkey":
            case "rlvl":
            case "motel":
            case "emo":
            case "quest":
            case "play":
            case "szablon":
            case "null":
            case "progress":
                break;
            case "lowreq":
                if (!v[1])
                    break;
                t[0] += "<b class=upgraded>* " + _t("type_lower_req %val%", {
                    "%val%": v[1]
                }) + " *</b>";
                break;
            case "expires":
                if (v[1] - unix_time() < 0) {
                    var x = !0;
                    t[11] = '<b class="item-expired expires">' + _t("item_expired") + "</b>"
                } else
                    t[11] = '<b class="item-expired">' + _t("valid_expires %date%", {
                        "%val%": calculateDiffFull(v[1], unix_time())
                    }) + "</b>";
                break;
            case "expire_date":
                t[1] += _t("expire_date %date%", {
                    "%date%": v[1]
                }) + "<br>";
                break;
            case "expire_duration":
                var T = convertTimeToSec(v[1])
                  , I = convertSecToTime(T)
                  , M = "";
                for (var S in I)
                    if (0 !== I[S])
                        switch (S) {
                        case "d":
                            M += _t("time_days %val%", {
                                "%val%": I[S]
                            }, "time_diff") + " ";
                            break;
                        case "h":
                            M += _t("time_h %val%", {
                                "%val%": I[S]
                            }, "time_diff") + " ";
                            break;
                        case "m":
                            M += _t("time_min %val%", {
                                "%val%": I[S]
                            }, "time_diff") + " ";
                            break;
                        case "s":
                            M += _t("time_sec %val%", {
                                "%val%": I[S]
                            }, "time_diff")
                        }
                t[11] = '<b class="item-expired">' + _t("expire_duration %time%", {
                    "%time%": M
                }) + "</b>";
                break;
            case "ac":
                t[1] += _t("item_ac %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "act":
                t[1] += _t("item_act %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "resfire":
                t[1] += _t("item_resfire %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "reslight":
                t[1] += _t("item_reslight %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "resfrost":
                t[1] += _t("item_resfrost %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "dmg":
                t[1] += _t("item_dmg %val%", {
                    "%val%": v[1].replace(",", "-")
                }) + "<br>";
                break;
            case "pdmg":
                t[1] += _t("item_pdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "perdmg":
                t[1] += _t("item_perdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "zr":
                t[2] += _t("item_zr %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "sila":
                t[2] += _t("item_sila %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "int":
                t[2] += _t("item_int %val%") + "<br>";
                break;
            case "lowcritallval":
                t[3] += _t("bonus_lowcritallval %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lowheal2turns":
                t[3] += _t("bonus_lowheal2turns %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "resacdmg":
                t[3] += _t("bonus_resacdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "resmanaendest":
                t[3] += _t("bonus_resmanaendest %val%", {
                    "%val%": v[1],
                    "%val2%": Math.max(1, Math.round(.444 * v[1]))
                }) + "<br>";
                break;
            case "str":
                t[2] += _t("skill_str %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "of-str":
                t[2] += _t("skill_of-str %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "agi":
                t[2] += _t("skills_agi %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "firebon":
                t[2] += _t("skills_firebon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lightbon":
                t[2] += _t("skills_lightbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "frostbon":
                t[2] += _t("skills_frostbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critslow":
                t[3] += _t("skills_critslow_new_old %val%", {
                    "%val%": 10 * v[1]
                }) + "<br>";
                break;
            case "critsa":
                t[3] += _t("skills_critsa %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lastcrit":
                t[3] += _t("skills_lastcrit %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "decevade":
                t[3] += _t("skills_decevade %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "redslow":
                t[3] += _t("skills_redslow %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "woundred":
                t[3] += _t("skills_woundred %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "healpower":
                t[3] += _t("skills_healpower %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "engback":
                t[3] += _t("skills_engback %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "sa-clothes":
                t[3] += _t("skills_sa-clothes %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "red-sa":
                t[3] += _t("skills_red-sa %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "footshoot":
                t[3] += _t("skills_footshoot %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critwound":
                t[3] += _t("skills_critwound %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "swing":
                t[3] += _t("skills_swing %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "distract":
                t[3] += _t("skills_distract %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "injure":
                t[3] += _t("skills_injure %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "rage":
                t[3] += _t("skills_rage %val% %turn%", {
                    "%val%": v[1],
                    "%turn%": parseInt(v[1]) > 1 ? _t("turns") : _t("turn")
                }) + "<br>";
                break;
            case "reusearrows":
                t[3] += _t("skills_reusearrows %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "pcontra":
                t[3] += _t("skills_pcontra %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "fastarrow":
                t[3] += _t("skills_fastarrow %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "bandage":
                t[3] += _t("skills_bandage %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "set":
                t[3] += _t("skills_set %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "fireshield":
                t[3] += _t("skills_fireshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "frostshield":
                t[3] += _t("skills_frostshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lightshield":
                t[3] += _t("skills_lightshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "longfireshield":
                t[3] += _t("skills_longfireshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "longfrostshield":
                t[3] += _t("skills_longfrostshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "longlightshield":
                t[3] += _t("skills_longlightshield %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "soullink":
                t[3] += _t("skills_soullink %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "poisonbon":
                t[3] += _t("skills_poisonbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "of-thirdatt":
                t[3] += _t("skills_of-thirdatt %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "woundchance":
                t[3] += _t("skills_woundchance %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "wounddmgbon":
                t[3] += _t("skills_wounddmgbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "arrowrain":
                t[3] += _t("skills_arrowrain %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "disturb":
                t[3] += _t("skills_disturb %val%", {
                    "%val%": v[1],
                    "%val2%": 2 * parseInt(v[1])
                }) + "<br>";
                break;
            case "shout":
                t[3] += _t("skills_shout %val%", {
                    "%val%": v[1] > 1 ? _t("enemies %amount%", {
                        "%amount%": v[1]
                    }) : _t("oneenemy")
                }) + "<br>";
                break;
            case "insult":
                t[3] += _t("skills_insult %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "frostpunch":
                t[2] += _t("skills_frostpunch %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "redstun":
                t[3] += _t("skills_redstun %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lightmindmg":
                t[2] += _t("skills_lightmindmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "actdmg":
                t[2] += _t("skills_actdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "hpsa":
                t[2] += _t("skills_hpsa %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "mresdmg":
                t[2] += _t("skills_mresdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "cursed":
                t[7] += _t("item_cursed") + "<br>";
                break;
            case "reqw":
                t[9] += '<b class="att">' + _t("skills_req_weapon");
                var A = v[1].split(",");
                for (var i in A)
                    t[9] += (isset(eq.weapon[A[i]]) ? eq.weapon[A[i]] : "???") + (isset(A[parseInt(i) + 1]) ? ", " : "");
                t[9] += "</b><br>";
                break;
            case "rskl":
                isset(a.tmpSkills) && isset(a.tmpSkills.names) && (B = v[1].split("-"),
                isset(a.tmpSkills.names[B[0]]) ? t[9] += '<b class="att' + (B[1] > a.tmpSkills.names[B[0]].l ? " noreq" : "") + '">' + _t("skills_req_skill") + "<br>&nbsp;&nbsp;&nbsp;" + (isset(a.tmpSkills.names[B[0]]) ? a.tmpSkills.names[B[0]].n : "???") + " (" + B[1] + ")</b><br>" : t[9] += '<b class="att noreq">error</b>');
                break;
            case "hp":
                t[3] += _t("bonus_hp %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "sa1":
            case "sa":
                t[3] += _t("no_percent_bonus_sa %val%", {
                    "%val%": mp(v[1] / 100)
                }) + "<br>";
                break;
            case "ds":
                t[3] += _t("bonus_ds %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "dz":
                t[3] += _t("bonus_dz %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "di":
                t[3] += _t("bonus_di %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "da":
                t[3] += _t("bonus_da %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "gold":
                if (v[1].split(":").length > 1) {
                    M = (z = v[1].replace(/[\(\)]/g, "")).split(":");
                    z = _t("start") + " " + M[0] + " " + _t("stop") + " " + M[1]
                } else
                    z = mp(v[1]);
                t[3] += _t("bonus_gold %val%", {
                    "%val%": z
                }) + "<br>";
                break;
            case "creditsbon":
                v[1] && v[1] > 1 ? t[3] += _t("bonus_creditsbon %val%", {
                    "%val%": v[1]
                }) + "<br>" : t[3] += _t("bonus_creditsbon") + "<br>";
                break;
            case "runes":
                t[3] += _t("bonus_runes %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "goldpack":
                t[3] += _t("bonus_goldpack %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "leczy":
                if (v[1] > 0)
                    t[3] += _t("bonus_leczy %val%", {
                        "%val%": v[1]
                    }) + "<br>";
                else if (v[1].split(":").length > 1) {
                    var z;
                    M = (z = v[1].replace(/[\(\)]/g, "")).split(":");
                    z = _t("start") + " " + M[0] + " " + _t("stop") + " " + M[1],
                    t[3] += _t("bonus_truje2 %val%", {
                        "%val%": z
                    }) + "<br>"
                } else
                    t[3] += _t("bonus_truje %val%", {
                        "%val%": Math.abs(v[1])
                    }) + "<br>";
                break;
            case "perheal":
                v[1] > 0 ? t[3] += _t("bonus_perheal %val%", {
                    "%val%": v[1]
                }) + "</span><br>" : t[3] += _t("bonus_perheal_minus %val%", {
                    "%val%": Math.abs(v[1]) + "%"
                }) + "</span><br>";
                break;
            case "stamina":
                t[3] += _t("stamina %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "fullheal":
                t[3] += _t("bonus_fullheal %val%", {
                    "%val%": round(v[1], 2)
                }) + "<br>";
                break;
            case "perheal":
                t[3] += _t("bonus_perheal %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "blok":
                t[3] += _t("bonus_blok %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "crit":
                t[3] += _t("bonus_crit %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "of-crit":
                t[3] += _t("bonus_of-crit %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critval":
                t[3] += _t("bonus_critval %val%", {
                    "%val%": (v[1].startsWith("-") ? "" : "+") + v[1]
                }) + "<br>";
                break;
            case "of-critval":
                t[3] += _t("bonus_of-critval %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critmval":
                t[3] += _t("bonus_of-critmval %val%", {
                    "%val%": (v[1].startsWith("-") ? "" : "+") + v[1]
                }) + "<br>";
                break;
            case "critmval_f":
                t[3] += _t("bonus_critmval_f %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critmval_c":
                t[3] += _t("bonus_critmval_c %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "critmval_l":
                t[3] += _t("bonus_critmval_l %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "heal":
                t[3] += _t("bonus_heal %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "evade":
                t[3] += _t("bonus_evade %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "pierce":
                t[3] += _t("bonus_pierce %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "pierceb":
                t[3] += _t("bonus_pierceb %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "contra":
                t[3] += _t("bonus_contra %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "parry":
                t[3] += _t("bonus_parry %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "revive":
                t[3] += _t("revive %amount%", {
                    "%amount%": v[1]
                }) + "<br>";
                break;
            case "frost":
                B = v[1].split(","),
                t[2] += _t("bonus_frost %val% %slow%", {
                    "%val%": B[1],
                    "%slow%": B[0] / 100
                }) + "<br>";
                break;
            case "poison":
                B = v[1].split(","),
                t[2] += _t("bonus_poison %val% %slow%", {
                    "%val%": B[1],
                    "%slow%": B[0] / 100
                }) + "<br>";
                break;
            case "slow":
                t[3] += _t("bonus_slow %val%", {
                    "%val%": v[1] / 100
                }) + "<br>";
                break;
            case "wound":
                B = v[1].split(","),
                t[3] += _t("bonus_wound %val% %dmg%", {
                    "%val%": B[0],
                    "%dmg%": B[1]
                }) + "<br>";
                break;
            case "fire":
                t[2] += _t("bonus_fire %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "light":
                t[2] += _t("bonus_light %val%", {
                    "%val%": v[1].replace(",", "-")
                }) + "<br>";
                break;
            case "adest":
                t[3] += _t("bonus_adest %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "absorb":
                t[3] += _t("bonus_absorb %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "absorbm":
                t[3] += _t("bonus_absorbm %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "hpbon":
                t[3] += _t("bonus_hpbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "acdmg":
                t[3] += _t("bonus_acdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "resdmg":
                t[3] += _t("bonus_resdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "energy":
                v[1] > 0 ? t[3] += _t("bonus_energy1 %val%", {
                    "%val%": v[1]
                }) + "<br>" : t[3] += _t("bonus_energy2 %val%", {
                    "%val%": Math.abs(v[1])
                }) + "<br>";
                break;
            case "energybon":
                t[3] += _t("bonus_energybon %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "energygain":
                t[3] += _t("bonus_energygain %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "en-regen":
                t[3] += _t("bonus_en-regen %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "energyp":
                v[1] > 0 ? t[3] += _t("bonus_energyp1 %val%", {
                    "%val%": mp(v[1])
                }) + "<br>" : t[3] += _t("bonus_energyp2 %val%", {
                    "%val%": Math.abs(v[1])
                }) + "<br>";
                break;
            case "mana":
                v[1] > 0 ? t[3] += _t("bonus_mana1 %val%", {
                    "%val%": v[1]
                }) + "<br>" : t[3] += _t("bonus_mana2 %val%", {
                    "%val%": Math.abs(v[1])
                }) + "<br>";
                break;
            case "manabon":
                t[3] += _t("bonus_manabon %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "managain":
                t[3] += _t("bonus_managain %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "manastr":
                t[3] += _t("bonus_manastr %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "manarestore":
                t[3] += _t("bonus_manarestore %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "manatransfer":
                t[3] += _t("bonus_manatransfer %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "stun":
                t[3] += _t("bonus_stun %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "freeze":
                t[3] += _t("bonus_freeze %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "hpcost":
                t[3] += _t("bonus_hpcost %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "cover":
                t[3] += _t("bonus_cover %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "allslow":
                t[3] += _t("bonus_allslow %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "firearrow":
            case "firepunch":
            case "firebolt":
                t[3] += _t("bonus_firebolt %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "firewall":
                t[3] += _t("bonus_firewall %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "thunder":
                t[3] += _t("bonus_thunder %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "storm":
                t[3] += _t("bonus_storm %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lowdmg":
                t[3] += _t("bonus_lowdmg %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "blizzard":
                t[3] += _t("bonus_blizzard %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "sunshield":
                t[3] += _t("bonus_sunshield %val%", {
                    "%val%": v[1],
                    "%val2%": v[1] / 2
                }) + "<br>";
                break;
            case "sunreduction":
                t[3] += _t("bonus_sunreduction %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "healall":
                t[3] += _t("bonus_healall %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "heal1":
                t[3] += _t("bonus_heal1 %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "aura-ac":
                t[3] += _t("bonus_aura-ac %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "aura-resall":
                t[3] += _t("bonus_aura-resall %val%", {
                    "%val%": mp(v[1])
                }) + "<br>";
                break;
            case "aura-sa":
                t[3] += _t("bonus_aura-sa %val%", {
                    "%val%": mp(v[1] / 100)
                }) + "<br>";
                break;
            case "absorbd":
                t[3] += _t("bonus_absorbd %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "stinkbomb":
                t[3] += _t("bonus_stinkbomb %val% %crit%", {
                    "%val%": 2 * parseInt(v[1]),
                    "%crit%": v[1]
                }) + "<br>";
                break;
            case "target_rarity":
                var j = _t("type_".concat(v[1]));
                t[3] += _t("bonus_".concat(v[0], " %val%"), {
                    "%val%": j
                }) + "<br>";
                break;
            case "bonus_reselect":
                t[3] += _t("bonus_".concat(v[0])) + "<br>";
                break;
            case "force_binding":
                t[3] += _t("".concat(v[0])) + "<br>";
                break;
            case "abdest":
                t[3] += _t("bonus_abdest %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "endest":
                t[3] += _t("bonus_endest %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "manadest":
                t[3] += _t("bonus_manadest %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lowevade":
                t[3] += _t("bonus_lowevade %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "lowcrit":
                t[3] += _t("bonus_lowcrit %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "arrowblock":
                t[3] += _t("bonus_arrowblock %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "honorbon":
                t[3] += _t("bonus_honorbon %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "enhancement_add":
                t[3] += _t("bonus_enhancement_add %val%", {
                    "%val%": v[1] + "%"
                }) + "<br>";
                break;
            case "enhancement_add_point":
                t[3] += _t("bonus_enhancement_add_point") + "<br>";
                break;
            case "quest_expbon":
                v[1] > 0 ? t[3] += _t("bonus_quest_expbon higher %val%", {
                    "%val%": v[1] + "%"
                }) + "<br>" : t[3] += _t("bonus_quest_expbon lower %val%", {
                    "%val%": v[1] + "%"
                }) + "<br>";
                break;
            case "bag":
                var D = "pl" == _l() ? $.inArray(v[1] % 10, [2, 3, 4]) < 0 || v[1] >= 6 && v[1] <= 19 ? "Ã³w" : "y" : v[1] > 1 ? "s" : "";
                t[3] += _t("bonus_bag %val%", {
                    "%val%": v[1],
                    "%posfix%": D
                }) + "<br>";
                break;
            case "pkey":
                t[3] += _t("bonus_pkey") + "<br>";
                break;
            case "rkeydesc":
                t[3] += _t("bonus_rkeydesc", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "btype":
                t[4] += _t("bonus_btype %val%", {
                    "%val%": eq.classes[v[1]].toLowerCase()
                }) + "<br>";
                break;
            case "respred":
                t[3] += _t("bonus_respred %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "afterheal":
            case "afterheal2":
                var B = v[1].split(",");
                t[3] += B[0] + _t("bonus_afterheal2 %val%", {
                    "%val%": B[1]
                }) + "<br>";
                break;
            case "action":
                var R = v[1].split(",");
                switch (R[0]) {
                case "flee":
                    t[3] += _t("flee_item_description") + "<br />";
                    break;
                case "mail":
                    t[3] += _t("mail_item_description") + "<br />";
                    break;
                case "auction":
                    t[3] += _t("auction_item_description") + "<br />";
                    break;
                case "nloc":
                    "*" == R[1] ? t[3] += _t("nloc_heros_item_description") + "<br />" : t[3] += _t("nloc_monster_item_description") + "<br />";
                    break;
                case "fatigue":
                    var V = parseInt(R[1]);
                    t[3] += V > 0 ? _t("fatigue_positive %val%", {
                        "%val%": Math.abs(V)
                    }) + "<br />" : _t("fatigue_negative %val%", {
                        "%val%": Math.abs(V)
                    }) + "<br />";
                    break;
                case "fightperheal":
                    2 == R.length ? t[3] += _t("fightperheal %amount%", {
                        "%amount%": R[1]
                    }) + "<br/>" : 3 == R.length && (t[3] += _t("fightperheal %from% %to%", {
                        "%from%": R[1],
                        "%to%": R[2]
                    }) + "<br/>");
                    break;
                case "deposit":
                    t[3] += _t("call_depo") + "<br />";
                    break;
                case "clandeposit":
                    t[3] += _t("call_clandepo") + "<br />";
                    break;
                case "shop":
                    t[3] += _t("call_shop") + "<br />"
                }
                break;
            case "recipe":
                t[3] = _t("recipe_dbl_click") + "<br>";
                break;
            case "outfit_selector":
                t[3] += _t("outfit_selector") + "<br />";
                break;
            case "outfit":
                var E = ""
                  , L = !1;
                (B = v[1].split(","))[0] < 1 ? L = !0 : E = 1 == B[0] ? _t("outfit_1min") : B[0] < 5 ? B[0] + _t("outfit_mins1") : B[0] < 99 ? B[0] + _t("outfit_mins2") : B[0] < 300 ? round(B[0] / 60) + _t("outfit_hrs1") : round(B[0] / 60) + _t("outfit_hrs2");
                var O = "";
                isset(B[2]) && (O = _t("in") + B[2]),
                t[3] += L ? _t("outfit_change_perm") + O + "<br>" : _t("outfit_change_for %time%", {
                    "%time%": E
                }) + O + "<br>";
                break;
            case "battlestats":
                isset(l.skills) || (l.skills = new skills),
                t[3] += _t("battlestats", {
                    "%val%": l.skills.parseStatsToItemTip(v[1])
                }) + "<br/>";
                break;
            case "freeskills":
                t[3] += _t("freeskills", {
                    "%val%": v[1]
                }) + "<br />";
                break;
            case "npc_expbon":
                v[1] > 0 ? t[3] += _t("npx_expbon higher %amount%", {
                    "%amount%": Math.abs(v[1]) + "%"
                }) + "<br/>" : v[1] < 0 && (t[3] += _t("npx_expbon lower %amount%", {
                    "%amount%": Math.abs(v[1]) + "%"
                }) + "<br/>");
                break;
            case "npc_lootbon":
                t[3] += _t("npx_lootbon higher %amount%", {
                    "%amount%": v[1]
                }) + "<br/>";
                break;
            case "timelimit":
                if ((B = v[1].split(","))[0] < 1 ? t[3] += _t("timelimit_can be used %val% sec", {
                    "%val%": B[0]
                }) + "<br>" : 1 == B[0] ? t[3] += _t("timelimit_can be used every min") + "<br>" : B[0] < 5 ? t[3] += _t("timelimit_can be used %val% minutes", {
                    "%val%": B[0]
                }) + "<br>" : t[3] += _t("timelimit_can be used %val% minutes2", {
                    "%val%": B[0]
                }) + "<br>",
                isset(B[1])) {
                    var F = Math.floor((parseInt(B[1]) - unix_time()) / 60);
                    t[3] += F < 0 ? _t("timelimit_readyToUse_now") + "<br>" : F < 1 ? _t("timelimit_readyToUse_inawhile") + "<br>" : 1 == F ? _t("timelimit_readyToUse_inaminute") + "<br>" : F < 5 ? _t("timelimit_readyToUse_in %val% sec", {
                        "%val%": F
                    }) + "<br>" : _t("timelimit_readyToUse_in %val% min", {
                        "%val%": F
                    }) + "<br>"
                }
                break;
            case "ttl":
                25 == a.cl && ("t" == a.loc || "n" == a.loc || "o" == a.loc || "r" == a.loc || "d" == a.loc || "c" == a.loc || "g" == a.loc && (0 == a.st || 9 == a.st) || "s" == a.loc && 0 == a.st) ? t[4] += _t("ttl1 %date%", {
                    "%val%": v[1]
                }) + "<br />" : t[4] += _t("ttl2 %date%", {
                    "%val%": v[1]
                }) + "<br />";
                break;
            case "ammo":
            case "amount":
                var U = parseItemStat(a.stat);
                if (parseInt("ammo" == v[0] ? U.ammo : U.amount) <= 1 && !1,
                isset(U.quest) && !1,
                10 != a.st) {
                    var C = isRanges(v[1]) ? getRanges(v[1]) : v[1];
                    t[4] += c ? '<span class="amount-text">' + _t("cursed_amount %val%", {
                        "%val%": C
                    }) + "</span><br>" : '<span class="amount-text">' + _t("amount %val% %split%", {
                        "%val%": C,
                        "%split%": ""
                    }) + "</span><br>"
                }
                break;
            case "cansplit":
                0 != a.st && 9 != a.st && "o" != a.loc || (t[4] += (parseInt(v[1]) ? _t("split_possible") : _t("split_impossible")) + "<br>");
                break;
            case "nosplit":
                t[4] += _t("split_impossible") + "<br>";
                break;
            case "maxuselvl":
                t[9] = '<b class="att">' + _t("maxuselvl") + v[1] + "</b><br>" + t[9];
                break;
            case "maxstatslvl":
                t[9] = '<b class="att">' + _t("maxstatslvl") + v[1] + "</b><br>" + t[9];
                break;
            case "capacity":
                10 != a.st && (t[4] += _t("capacity %val%", {
                    "%val%": v[1]
                }) + "<br>");
                break;
            case "noauction":
                var W = !1;
                for (var i in n)
                    "permbound" == n[i] && (W = !0);
                if (W)
                    break;
                t[4] += _t("noauction") + "<br>";
                break;
            case "nodepo":
                if (25 == a.cl && "g" == a.loc && 0 != a.st && 9 != a.st)
                    break;
                t[4] += _t("nodepo_info") + "<br />";
                break;
            case "nodepoclan":
                W = !1;
                for (var i in n)
                    "permbound" == n[i] && (W = !0);
                if (W)
                    break;
                t[4] += _t("nodepoclan_info") + "<br />";
                break;
            case "legbon":
                t[5] += "<i class=legbon>";
                var Y = null;
                switch ((B = v[1].split(","))[0]) {
                case "verycrit":
                    null == Y && (Y = 13);
                case "holytouch":
                    null == Y && (Y = 7);
                case "curse":
                    null == Y && (Y = 9);
                case "pushback":
                    null == Y && (Y = 8);
                case "lastheal":
                    null == Y && (Y = 18);
                case "critred":
                    null == Y && (Y = 20);
                case "resgain":
                    null == Y && (Y = 16);
                case "dmgred":
                    null == Y && (Y = 16);
                case "cleanse":
                    null == Y && (Y = 12);
                case "glare":
                    null == Y && (Y = 9),
                    t[5] += _t("legbon_" + B[0], {
                        "%val%": Y
                    });
                    break;
                default:
                    t[5] += _t("legbon_undefined %val%", {
                        "%val%": B[0]
                    })
                }
                t[5] += "</i>";
                break;
            case "legbon_test":
                t[5] += "<i class=legbon>";
                Y = null;
                switch ((B = v[1].split(","))[0]) {
                case "verycrit":
                case "holytouch":
                case "curse":
                case "pushback":
                case "lastheal":
                case "critred":
                case "resgain":
                case "dmgred":
                case "cleanse":
                case "glare":
                    t[5] += "TEST: " + _t("legbon_" + B[0], {
                        "%val%": B[1]
                    });
                    break;
                default:
                    t[5] += _t("legbon_undefined %val%", {
                        "%val%": B[0]
                    })
                }
                t[5] += "</i>";
                break;
            case "lvlnext":
                t[9] += '<b class="lvl-next">' + _t("match_bonus_" + v[0] + " %val%", {
                    "%val%": v[1]
                }) + "</b>";
                break;
            case "lvlupgcost":
            case "lvlupgs":
                t[4] += _t("match_bonus_" + v[0] + " %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "upglvl":
                t[4] += _t("match_bonus_" + v[0] + " %val%", {
                    "%val%": _t(v[1])
                }) + "<br>";
                break;
            case "expadd":
                t[4] += _t("bonus_" + v[0] + " %val%", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "townlimit":
                t[5] += "<i class=idesc>" + _t("townlimit") + "</i>";
                break;
            case "teleport":
                t[7] = "<i class=idesc>" + _t("teleport") + "</i>" + t[7];
                break;
            case "custom_teleport":
                1 == v.length ? t[7] += "<i class=idesc>" + _t("dbl_click_to_set") + "</i>" : t[7] = "<i class=idesc>" + _t("teleport") + "</i> " + t[7];
                break;
            case "furniture":
                t[6] += _t("furniture", null, "itemtip") + "<br>";
                break;
            case "nodesc":
                t[6] += "<i class=idesc>" + _t("nodesc") + "</i>";
                break;
            case "pumpkin_weight":
                var H = "".concat(v[1] / 1e3, "kg");
                t[7] += '<i class="idesc">'.concat(_t("pumpkin_weight"), " ").concat(H, "</i><br>");
                break;
            case "opis":
                U = parseItemStat(a.stat);
                v[1] = v[1].replace(/#DATE#|#YEAR#/g, (function(a) {
                    switch (a) {
                    case "#DATE#":
                        return isset(U.created) ? ut_date(U.created) : ut_date(unix_time());
                    case "#YEAR#":
                        return isset(U.created) ? ut_date(U.created).substr(-4) : (new Date).getFullYear()
                    }
                }
                )),
                t[7] += "<i class=idesc>" + parseItemBB(v[1]) + "</i>";
                break;
            case "loot":
                var G = "";
                2 == (B = v[1].split(","))[2] && (G = _t("with_player")),
                B[2] > 2 && (G = _t("with_company")),
                t[7] += "<i class=looter>" + r(_t("loot_with %day% %npc% %grpinf% %name%", {
                    "%day%": ut_date(B[3]),
                    "%npc%": B[4],
                    "%grpinf%": G,
                    "%name%": B[0]
                })) + "</i><br>";
                break;
            case "timelimit_upgmax":
                t[3] += _t("Corecttimelimit_upgmax", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "upgtimelimit":
                t[4] += _t("Corectupgtimelimit") + "<br>";
                break;
            case "timelimit_upgs":
                t[3] += _t("Corecttimelimit_upgs", {
                    "%val%": v[1]
                }) + "<br>";
                break;
            case "soulbound":
                s = !0;
                break;
            case "permbound":
                b = !0;
                break;
            case "canpreview":
                t[8] += _t("canpreviewitem") + "<br>";
                break;
            case "recovered":
                t[8] += _t("recovered") + "<br>";
                break;
            case "binds":
                _ = !0;
                break;
            case "unbind":
                t[8] += _t("unbind") + "<br>";
                break;
            case "undoupg":
                t[8] += _t("undoupg") + "<br>";
                break;
            case "notakeoff":
                t[8] = _t("notakeoff") + "<br>";
                break;
            case "summonparty":
                t[8] = _t("summonparty") + "<br>";
                break;
            case "lvl":
                t[9] += '<b class="att' + (v[1] > hero.lvl ? " noreq" : "") + '">' + _t("lvl %lvl%", {
                    "%lvl%": v[1]
                }) + "</b><br>";
                break;
            case "reqp":
                t[9] += '<b class="att' + (v[1].indexOf(hero.prof) < 0 ? " noreq" : "") + '">' + _t("reqp") + " ";
                for (var J = 0; J < v[1].length; J++)
                    t[9] += (J ? ", " : "") + eq.prof[v[1].charAt(J)];
                t[9] += "</b><br>";
                break;
            case "reqgold":
                t[9] += '<b class="att' + (v[1] > hero.gold ? " noreq" : "") + '">' + _t("reqgold %val%", {
                    "%val%": v[1]
                }) + "</b><br>";
                break;
            case "reqs":
                t[9] += '<b class="att' + (v[1] > hero.bstr ? " noreq" : "") + '">' + _t("reqs %val%", {
                    "%val%": v[1]
                }) + "</b><br>";
                break;
            case "reqz":
                t[9] += '<b class="att' + (v[1] > hero.bagi ? " noreq" : "") + '">' + _t("reqz %val%", {
                    "%val%": v[1]
                }) + "</b><br>";
                break;
            case "reqi":
                t[9] += '<b class="att' + (v[1] > hero.bint ? " noreq" : "") + '">' + _t("reqi %val%", {
                    "%val%": v[1]
                }) + "</b><br>";
                break;
            case "pet":
                var K = v[1].split(",");
                for (J = 2; J < K.length; J++)
                    if ("elite" != K[J] && "quest" != K[J] && "heroic" != K[J] && "legendary" != K[J]) {
                        var N = K[J].split("|");
                        if (N.length) {
                            t[2] = '<span style="color:lime">' + _t("pet_tasks") + "<br />";
                            for (i = 0; i < N.length; i++)
                                t[2] += "- " + N[i].replace(/#.*/, "") + "<br />";
                            t[2] += "</span>"
                        }
                        break
                    }
                v[1].match(/quest/) && (t[2] += _t("pet_logout_hide") + "<br />");
                break;
            case "outexchange":
            case "artisan_worthless":
                t[8] += _t(v[0]) + "<br>";
                break;
            default:
                "" != v[0] && (t[3] += _t("unknown_stat %val%", {
                    "%val%": v[0]
                }) + "<br>")
            }
        }
    var P = t[8];
    return b ? "n" == a.loc ? t[8] = _t("permbound") + "<br>" : (22 != a.cl || isset(x) && x ? t[8] = _t("permbound_item") + "<br>" : t[8] = _t("permbound1") + "<br>",
    t[8] += P) : s ? (22 != a.cl || isset(x) && x ? t[8] = _t("soulbound2") + "<br>" : t[8] = _t("soulbound1") + "<br>",
    t[8] += P) : _ && (22 == a.cl ? t[8] += isset(x) && x ? "" : _t("binds1") + "<br>" : t[8] += _t("binds2") + "<br>"),
    a.pr && (!isset(a.cl) || 25 != a.cl || "n" == a.loc || "t" == a.loc && isset(a.cl) && 25 == a.cl) ? t[9] += '<div class="value-item">' + _t("item_value %val%", {
        "%val%": round(a.pr, 3)
    }) + "</div>" : t[9] = t[9].replace(/\<br>$/g, ""),
    t.join("")
}
isRanges = function(a) {
    return a.includes(":") && a.split(":").length > 1
}
,
getRanges = function(a) {
    var e = a.replace(/[\(\)]/g, "").split(":");
    return _t("start") + " " + e[0] + " " + _t("stop") + " " + e[1]
}
,
eq = {
    wx: [37, 0, 37, 74, 0, 37, 74, 37, 0, 0],
    wy: [0, 36, 36, 36, 72, 72, 72, 108, 108, 0],
    classes: ["", _t("cl_onehanded", null, "eq_cl"), _t("cl_twohanded", null, "eq_cl"), _t("cl_bastard", null, "eq_cl"), _t("cl_distance", null, "eq_cl"), _t("cl_helpers", null, "eq_cl"), _t("cl_wands", null, "eq_cl"), _t("cl_staffs", null, "eq_cl"), _t("cl_armor", null, "eq_cl"), _t("cl_helmets", null, "eq_cl"), _t("cl_boots", null, "eq_cl"), _t("cl_gloves", null, "eq_cl"), _t("cl_rings", null, "eq_cl"), _t("cl_neclaces", null, "eq_cl"), _t("cl_shield", null, "eq_cl"), _t("cl_neutral", null, "eq_cl"), _t("cl_usable", null, "eq_cl"), _t("cl_gold", null, "eq_cl"), _t("cl_keys", null, "eq_cl"), _t("cl_quests", null, "eq_cl"), _t("cl_renewable", null, "eq_cl"), _t("cl_arrows", null, "eq_cl"), _t("cl_talisman", null, "eq_cl"), _t("cl_books", null, "eq_cl"), _t("cl_bags", null, "eq_cl"), _t("cl_bless", null, "eq_cl"), _t("cl_improve", null, "eq_cl"), _t("recipe", null, "recipes")],
    prof: {
        w: _t("prof_warrior", null, "eq_prof"),
        p: _t("prof_paladyn", null, "eq_prof"),
        m: _t("prof_mag", null, "eq_prof"),
        h: _t("prof_hunter", null, "eq_prof"),
        b: _t("prof_bladedancer", null, "eq_prof"),
        t: _t("prof_tracker", null, "eq_prof")
    },
    weapon: {
        sw: _t("w_meele", null, "eq_w"),
        "1h": _t("w_onehanded", null, "eq_w"),
        "2h": _t("w_twohanded", null, "eq_w"),
        bs: _t("w_bastard", null, "eq_w"),
        dis: _t("w_distance", null, "eq_w"),
        fire: _t("w_fire", null, "eq_w"),
        light: _t("w_light", null, "eq_w"),
        frost: _t("w_frost", null, "eq_w"),
        sh: _t("w_shield", null, "eq_w"),
        h: _t("w_helper", null, "eq_w"),
        poison: _t("w_poison")
    }
};
soundManager.url = "js/",
soundManager.flashVersion = 9,
soundManager.useFlashBlock = !1;
var sound = {
    manager: new MargoSound
};
function MargoSound() {
    var t = this;
    this.data = {
        position: 0,
        file: null,
        play: 0,
        shuffle: 1,
        quality: "lq",
        volume: 100
    },
    this.synchro = {
        game: !1,
        map: !1,
        manager: !1,
        activated: !1
    },
    this.playing = null,
    this.tmpPlaying = null,
    this.activeFile = null,
    this.fadeLength = 2e3,
    this.intervalCounter = 0,
    this.id = 0,
    this.passingThrough = !1,
    this.volumeMarkerDraggable = !1,
    this.init = function() {
        null != this.data.file && this.groupCompare(this.data.file, this.getMapFile()) ? this.playing = this.getNextSound(this.data.position, !1, this.data.file) : this.playing = this.getNextSound(0, !1, this.getMapFile()),
        1 == parseInt(this.data.play) && this.playing.play()
    }
    ,
    this.getMapFile = function() {
        var t = /(.*?)\.jpg/.exec(map.bg);
        return isset(sound.bgList[t[1]]) ? sound.bgList[t[1]] : "l.mp3"
    }
    ,
    this.groupCompare = function(t, i) {
        return !t && !i && (void 0 !== sound.fileList[t][0] && void 0 !== sound.fileList[i][0] && sound.fileList[t][0] == sound.fileList[i][0])
    }
    ,
    this.getNextSound = function(i, a, s) {
        return this.activeFile = s,
        soundManager.createSound({
            id: "sound" + t.id++,
            position: i,
            volume: a ? 0 : t.data.volume,
            url: "https://micc.garmory-cdn.cloud/music/" + t.data.quality + "/" + s,
            whileplaying: function() {
                var i = this.duration - this.position;
                if (i < t.fadeLength && 3 == this.readyState ? (0 == t.passingThrough && (t.passingThrough = !0,
                t.tmpPlaying = t.getNextSound(0, !!t.data.shuffle, t.getNextFile()),
                t.tmpPlaying.play()),
                this.setVolume(i / t.fadeLength * 100 * (t.data.volume / 100))) : t.intervalCounter >= 10 ? (t.saveSettings(),
                t.intervalCounter = 0) : t.intervalCounter++,
                this.volume < t.data.volume)
                    if (this.position < t.fadeLength) {
                        var a = this.position / t.fadeLength * 100 * (t.data.volume / 100);
                        this.setVolume(a > 100 ? 100 : a)
                    } else
                        this.setVolume(t.data.volume)
            },
            onfinish: function() {
                t.playing.destruct(),
                t.playing = t.tmpPlaying,
                t.passingThrough = !1
            }
        })
    }
    ,
    this.attachVolumeMarkerDrag = function() {
        this.volumeMarkerDraggable || ($("#volumeSlider .marker").draggable({
            axis: "y",
            containment: "parent",
            stop: function() {
                sound.manager.setVolume(2 * Math.abs(parseInt($("#volumeSlider .marker").css("top")) - 50))
            },
            drag: function() {
                sound.manager.setVolume(2 * Math.abs(parseInt($("#volumeSlider .marker").css("top")) - 50))
            }
        }),
        this.volumeMarkerDraggable = !0)
    }
    ,
    this.setVolume = function(t) {
        t = parseInt(t < 0 ? 0 : t > 100 ? 100 : t),
        this.data.volume = t,
        this.saveSettings(),
        this.playing && this.playing.setVolume(t)
    }
    ,
    this.volumeDown = function() {
        this.setVolume(this.data.volume - 5)
    }
    ,
    this.volumeUp = function() {
        this.setVolume(this.data.volume + 5)
    }
    ,
    this.getNextFile = function() {
        var t = this.getMapFile()
          , i = sound.fileList[this.activeFile][0];
        if (this.data.shuffle && 0 != i) {
            var a = this.getActiveGroup();
            if (a.length > 0)
                do {
                    t = a[Math.floor(Math.random() * (a.length - 1 - 0 + 1))]
                } while (t == this.activeFile)
        }
        return t
    }
    ,
    this.getActiveGroup = function() {
        var t = sound.fileList[this.activeFile][0]
          , i = [];
        for (var a in sound.fileList)
            sound.fileList[a][0] == t && i.push(a);
        return i
    }
    ,
    this.initSettings = function() {
        var t = getCookie("margoSound");
        if (t) {
            var i = t.split(",");
            if (void 0 !== i[0] && void 0 !== i[1] && !isNaN(parseInt(i[1])) && void 0 !== i[2] && void 0 !== i[3] && void 0 !== i[4] && void 0 !== i[5])
                return this.data.position = i[1],
                this.data.file = i[0],
                this.data.play = i[2],
                this.data.shuffle = i[3],
                this.data.quality = i[4],
                this.data.volume = parseInt(i[5]),
                this.data.volume = this.data.volume < 0 ? 0 : this.data.volume > 100 ? 100 : this.data.volume,
                !0
        }
    }
    ,
    this.saveSettings = function() {
        var t = new Date;
        t.setTime(t.getTime() + 31104e7);
        var i = 0;
        this.playing && null != this.playing.position && (i = this.playing.position),
        setCookie("margoSound", this.activeFile + "," + i + "," + this.data.play + "," + this.data.shuffle + "," + this.data.quality + "," + this.data.volume, t, !1, !1, !1)
    }
    ,
    this.synchroStart = function(t) {
        this.synchro[t] = !0,
        this.synchro.map && this.synchro.manager && this.synchro.game && !this.synchro.activated && (this.init(),
        this.synchro.activated = !0)
    }
    ,
    this.start = function() {
        this.stop(),
        this.playing = this.getNextSound(0, !1, this.getMapFile()),
        this.playing && this.playing.play(),
        this.data.play = 1,
        1 == this.data.play ? $("#startbutton").addClass("active") : $("#startbutton").removeClass("active")
    }
    ,
    this.stop = function() {
        this.data.play = 0,
        this.saveSettings(),
        this.playing && this.playing.destruct(),
        1 == this.data.play ? $("#startbutton").addClass("active") : $("#startbutton").removeClass("active")
    }
    ,
    this.toggleStart = function() {
        1 == this.data.play ? this.stop() : this.start()
    }
    ,
    this.toggleShuffle = function() {
        this.data.shuffle = 1 == this.data.shuffle ? 0 : 1,
        this.saveSettings(),
        1 == this.data.shuffle ? $("#shufflebutton").addClass("active") : $("#shufflebutton").removeClass("active")
    }
    ,
    this.toggleQuality = function() {
        this.data.quality = "lq" == this.data.quality ? "hq" : "lq",
        "hq" == this.data.quality ? $("#hdbutton").addClass("active") : $("#hdbutton").removeClass("active"),
        this.saveSettings(),
        this.data.play && (this.engineStop(),
        this.initSettings(),
        this.init())
    }
    ,
    this.engineStop = function() {
        this.playing && this.playing.destruct(),
        this.tmpPlaying && this.tmpPlaying.destruct()
    }
    ,
    this.generateMenu = function() {
        var t = '<div id=soundInterface>\n               <div onclick="sound.manager.toggleStart(); return false;" tip="' + _t("start_stop", null, "music_interface") + '" id=startbutton class=' + (1 == sound.manager.data.play ? "active" : "") + '></div>\n               <div onclick="sound.manager.toggleShuffle(); return false;" tip="' + _t("on_off", null, "music_interface") + '" id=shufflebutton class=' + (1 == sound.manager.data.shuffle ? "active" : "") + '></div>\n               <div onclick="sound.manager.toggleQuality();return false;" tip="' + _t("quality_change", null, "music_interface") + '" id=hdbutton class=' + ("hq" == sound.manager.data.quality ? "active" : "") + '></div>\n               <div id=volumeSlider><div tip="' + _t("volume_change", null, "music_interface") + '" onmouseover="sound.manager.attachVolumeMarkerDrag()" class=marker style="top:' + (50 - this.data.volume / 100 * 50) + 'px"></div></div>\n               </div>';
        return this.volumeMarkerDraggable = !1,
        t
    }
    ,
    this.initSettings()
}
soundManager.onready((function() {
    sound.manager.synchroStart("manager")
}
)),
sound.bgList = {
    "002": "002.mp3",
    "003": "003.mp3",
    "004": "004.mp3",
    "006": "006.mp3",
    "013": "013.mp3",
    "014": "014.mp3",
    "015": "015.mp3",
    "027": "027.mp3",
    "27n": "027.mp3",
    "032": "032.mp3",
    "007": "007.mp3",
    "07n": "007.mp3",
    "018": "018.mp3",
    "019": "019.mp3",
    "19n": "019.mp3",
    "035": "035.mp3",
    "35n": "035.mp3",
    "005": "005.mp3",
    "008": "008.mp3",
    "009": "009.mp3",
    "010": "010.mp3",
    "011": "011.mp3",
    "012": "012.mp3",
    "021": "021.mp3",
    "033": "033.mp3",
    "034": "034.mp3",
    aa1: "a.mp3",
    aa2: "a.mp3",
    bb: "b.mp3",
    cc1: "c.mp3",
    cc2: "c.mp3",
    dd1: "d.mp3",
    dd2: "d.mp3",
    dd3: "d.mp3",
    dd4: "d.mp3",
    ee: "e.mp3",
    f: "f.mp3",
    g: "g.mp3",
    h: "h.mp3",
    i: "i.mp3",
    j: "j.mp3",
    k: "k.mp3",
    l: "l.mp3"
},
sound.fileList = {
    "002.mp3": [1],
    "003.mp3": [2],
    "004.mp3": [1],
    "006.mp3": [1],
    "013.mp3": [2],
    "014.mp3": [2],
    "015.mp3": [2],
    "027.mp3": [1],
    "032.mp3": [3],
    "007.mp3": [4],
    "018.mp3": [8],
    "019.mp3": [7],
    "035.mp3": [4],
    "005.mp3": [3],
    "008.mp3": [3],
    "009.mp3": [3],
    "010.mp3": [4],
    "011.mp3": [4],
    "012.mp3": [3],
    "021.mp3": [4],
    "033.mp3": [8],
    "034.mp3": [7],
    "a.mp3": [0],
    "b.mp3": [0],
    "c.mp3": [6],
    "d.mp3": [6],
    "e.mp3": [5],
    "f.mp3": [0],
    "g.mp3": [0],
    "h.mp3": [0],
    "i.mp3": [6],
    "j.mp3": [5],
    "k.mp3": [5],
    "l.mp3": [5]
},
sound.groups = {
    0: "no_group",
    1: "bad_caves",
    2: "caves",
    3: "bad_fields",
    4: "fields",
    5: "insides",
    6: "bad_insides",
    7: "sea",
    8: "desert"
};
function ground() {
    var t = this
      , e = "#ground";
    this.id = -1,
    this.loaded = !1,
    this.col = "",
    this.water = [];
    var r = 256
      , i = 256
      , a = 0
      , o = 0;
    this.maplist = [],
    this.setCoords = function(t) {
        for (var e in this.maplist = [],
        t = t.split(";")) {
            var r = t[e].split(",");
            this.maplist[parseInt(r[0])] = {
                name: r[1],
                x: parseInt(r[2]),
                y: parseInt(r[3]),
                width: parseInt(r[4]),
                height: parseInt(r[5])
            }
        }
        this.highlightMarker(),
        $("#mapfilter").trigger("keyup")
    }
    ,
    $("#mapfilter").keyup((function() {
        var t = 0
          , e = []
          , r = $("#mapfilter").val().toLowerCase();
        for (var i in map.maplist) {
            var a = map.maplist[i];
            t < 200 && ("" == r || a.name.toLowerCase().indexOf(r) >= 0) && (e[t] = "<b wmap=" + i + ">" + escapeHTML(a.name) + "</b>"),
            t++
        }
        e.sort((function(t, e) {
            var r = t.replace(/Å/, "S").substring(t.indexOf(">") + 1, t.length - 5)
              , i = e.replace(/Å/, "S").substring(e.indexOf(">") + 1, e.length - 5);
            return r == i ? 0 : r > i ? 1 : -1
        }
        )),
        $("#maplist").html(e.join(""))
    }
    )),
    this.overmap = !1,
    $("#inmap2 IMG").mousemove((function(t) {
        var e = $("#inmap2")
          , r = t.clientX - g.left
          , i = t.clientY - g.top
          , a = map.overmap
          , o = !1;
        if (i > 350 && (o = !0),
        r += e.scrollLeft(),
        i += e.scrollTop(),
        !(a && r >= a.x && r <= a.x + a.width && i >= a.y && i <= a.y + a.width)) {
            for (var s in map.maplist)
                if (r >= (a = map.maplist[s]).x + 20 && r <= a.x + a.width + 20 && i >= a.y + 5 && i <= a.y + a.height + 5) {
                    map.overmap = a;
                    var n = $("#maptip");
                    return n.html(a.name).css({
                        left: a.x
                    }),
                    void n.css({
                        top: o ? a.y - n.outerHeight() : a.y + a.height
                    }).show()
                }
            map.overmap = !1,
            $("#maptip").hide()
        }
    }
    )),
    $("#maptip").mouseover((function(t) {
        $(this).hide()
    }
    )),
    this._u = function(t) {
        for (var r in t)
            is_int(t[r]) ? this[r] = parseInt(t[r]) : this[r] = t[r],
            "bg" == r && sound.manager.synchroStart("map"),
            "welcome" == r && "" != t[r] && message(t[r]);
        if (t.file) {
            var i = {
                579: 1,
                1058: 1,
                1059: 1,
                1060: 1,
                1062: 1,
                1084: 1
            };
            if (!isset(i[this.id]) && !isset(i[this.mainid]) && hero.lvl < 7 ? tutorialStart(9) : isset(i[this.id]) && tutorialStart(2),
            [2, 9, 35].indexOf(this.id) >= 0 && "en" == _l() && tutorialStart(21),
            $(e).css({
                width: 32 * this.x,
                height: 32 * this.y
            }),
            img = new Image,
            g.gameLoader.startStep("map"),
            $(img).on("load", (function() {
                g.gameLoader.finishStep("map");
                var t = $(this).attr("src");
                $("#bground").css({
                    backgroundImage: "url(" + t + ")"
                }),
                $($(this).attr("obj")).css({
                    backgroundImage: "url(" + t + ")"
                }),
                map.loaded = !0;
                var e = this.width
                  , r = this.height
                  , i = Math.min(.5, 500 / Math.max(e, r));
                r = Math.round(r * i),
                e = Math.round(e * i),
                $("#inmap").html("<img src=" + t + ' style="width:' + e + "px; height:" + r + "px; margin-top:" + (256 - (r >> 1)) + "px; margin-left:" + (256 - (e >> 1)) + 'px"><div id=mapdot></div>'),
                map.mmh = r,
                map.mmw = e,
                map.mmr = i;
                var a = invertKeyInputOnSpecificMap(map.id);
                setNormalKeySet(!a)
            }
            )).on("error", (function() {
                log($(this).attr("src"), 2)
            }
            )).attr({
                obj: e,
                src: g.mpath + this.file
            }),
            $("#botloc").attr("tip", escapeHTML(this.name)),
            this.water) {
                var a = this.water.split("|");
                this.water = [];
                for (var o = 0; o < a.length; o++)
                    for (var s = a[o].split(","), n = 1 * s[0]; n <= 1 * s[1]; n++)
                        this.water[n + 256 * s[2]] = 4 * s[3]
            } else
                this.water = [];
            this.setBack(this.bg),
            this.bB()
        }
        t.external_properties && t.external_properties.weather && this.weatherRayControllerServe(t.external_properties),
        t.external_properties && t.external_properties.mapFilter && this.weatherRayControllerServe(t.external_properties),
        t.external_properties && t.external_properties.night && g.nightController.updateData(t.external_properties),
        this.setBallTip()
    }
    ,
    this.weatherRayControllerServe = function(e) {
        get_config_opt(16) || e.weather && t.setWeather(e.weather),
        e.mapFilter && setMapFilter(e.mapFilter)
    }
    ,
    this.setWeather = function(t) {
        var e = t.list;
        if (e)
            for (var r in e) {
                var i = e[r].action
                  , a = e[r].name;
                "CREATE" == i && changeWeather(a),
                "REMOVE" == i && removeWeather(a)
            }
    }
    ,
    this.setBallTip = function() {
        var t = 0
          , e = _t("pvp_mode", null, "map") + " ";
        switch (this.pvp) {
        case 0:
        case 3:
            t = 3,
            e += _t("pvp_off", null, "map");
            break;
        case 1:
            tutorialStart(15),
            t = 2,
            e += _t("pvp_ask", null, "map");
            break;
        case 2:
            tutorialStart(15),
            t = 0,
            e += _t("pvp_on", null, "map");
            break;
        case 4:
            tutorialStart(15),
            t = 1,
            e += _t("pvp_arena", null, "map")
        }
        isset(this.conquer) ? (null == g.pvpIndicator && (g.pvpIndicator = new PvpIndicator),
        0 != this.conquer ? /m|t|b/.test(hero.prof) && this.conquer < 0 || /w|p|h/.test(hero.prof) && this.conquer > 0 ? (g.pvpIndicator.setValue(Math.abs(this.conquer)),
        multiplier = 1 + Math.abs(this.conquer) / 100 * 3,
        e += '<br /><span style="color:lime">' + _t("location_conquered %percent%", {
            "%percent%": Math.abs(this.conquer)
        }, "map") + "<br>" + _t("multiplier_counter+ %val%", {
            "%val%": roundNumber(multiplier, 2)
        }, "map") + "</span>") : (g.pvpIndicator.setValue(-1 * Math.abs(this.conquer)),
        multiplier = 1 + Math.abs(this.conquer) / 100 * 3,
        e += '<br /><span style="color:red">' + _t("location_lost %percent%", {
            "%percent%": Math.abs(this.conquer)
        }, "map") + "<br>" + _t("multiplier_counter- %val%", {
            "%val%": roundNumber(multiplier, 2)
        }, "map") + "</span>") : e += "<br />" + _t("location_conquer_possible"),
        g.pvpIndicator.toggleShow(!0)) : g.worldConfig.getPvp() ? e += "<br />" + _t("click_to_show_locationdata", null, "map") : g.worldConfig.getBrutal() || (e += "<br />" + _t("click_to_show_killers", null, "map")),
        $("#pvpmode").unbind("click"),
        $("#pvpStatMainBox .bgLayer").attr("tip", e),
        $("#pvpmode").attr("tip", e).css({
            backgroundPosition: "0 -" + 17 * t + "px"
        }).click((function() {
            null != g.pvpIndicator ? g.pvpIndicator.toggleShow() : g.worldConfig.getPvp() ? _g("conquer") : g.worldConfig.getBrutal() || PK_watch.start()
        }
        ))
    }
    ,
    this.setBack = function(t) {
        var e = {
            "bridge01.jpg": "001.jpg",
            "castle03.jpg": "020.jpg",
            "castletown01.jpg": "035.jpg",
            "castletown02.jpg": "026.jpg",
            "cave01.jpg": "004.jpg",
            "cave02.jpg": "027.jpg",
            "cave04.jpg": "003.jpg",
            "evilcastle02.jpg": "015.jpg",
            "farmvillage01.jpg": "007.jpg",
            "forest01.jpg": "009.jpg",
            "foresttown01.jpg": "007.jpg",
            "fort01.jpg": "035.jpg",
            "fort02.jpg": "031.jpg",
            "grassland01.jpg": "010.jpg",
            "heaven02.jpg": "030.jpg",
            "mine01.jpg": "020.jpg",
            "minetown01.jpg": "035.jpg",
            "minetown02.jpg": "025.jpg",
            "mountain01.jpg": "005.jpg",
            "plan-astr.jpg": "002.jpg",
            "posttown01.jpg": "035.jpg",
            "posttown02.jpg": "026.jpg",
            "ruins01.jpg": "011.jpg",
            "sewer01.jpg": "020.jpg",
            "shop01.jpg": "017.jpg",
            "snowfield01.jpg": "012.jpg",
            "swamp01.jpg": "008.jpg",
            "woods01.jpg": "010.jpg",
            "matchmaking.jpg": "matchmaking.jpg"
        };
        t.length <= 7 ? $("#battle").css("backgroundImage", "url(" + CFG.bpath + t + ")") : $("#battle").css("backgroundImage", "url(img/b/" + (isset(e[t]) ? e[t] : "011.jpg") + ")"),
        "matchmaking.jpg" != t && $("#tradeground").css("backgroundImage", $("#battle").css("backgroundImage"))
    }
    ,
    this.cols = function(t) {
        for (var e = 0, r = [], i = 0; i < t.length; i++) {
            var a = t.charCodeAt(i);
            if (a > 95 && a < 123)
                for (var o = 95; o < a; o++)
                    for (var s = 0; s < 6; s++)
                        r[e++] = "0";
            else {
                a -= 32;
                for (o = 0; o < 6; o++)
                    r[e++] = a & Math.pow(2, o) ? "1" : "0"
            }
        }
        this.col = r.join(""),
        this.nodes = new MapNodesContainer(this.x,this.y,isCollision,isPermanentlyCollision)
    }
    ,
    $("#base").scroll((function() {
        $("#bground").css({
            top: $("#base").scrollTop(),
            left: $("#base").scrollLeft(),
            backgroundPosition: "-" + $("#base").scrollLeft() + "px -" + $("#base").scrollTop() + "px"
        })
    }
    )),
    this.center = function(t, e, s) {
        var n = Math.min(32 * this.x - 512, t - r)
          , p = Math.min(32 * this.y - $("#base").height(), e - i);
        isset(s) && s ? $("#base").stop().animate({
            scrollLeft: n,
            scrollTop: p
        }, 500) : ($("#base").scrollLeft(n).scrollTop(p),
        $("#bground").css({
            top: $("#base").scrollTop(),
            left: $("#base").scrollLeft(),
            backgroundPosition: "-" + $("#base").scrollLeft() + "px -" + $("#base").scrollTop() + "px"
        })),
        a = t,
        o = e,
        this.scrollpos = [n, p],
        this.offset = [Math.floor($("#base").scrollLeft() / 32), Math.floor($("#base").scrollTop() / 32)]
    }
    ,
    this.cmpMCLCOC = function() {
        map.mClC > n ? s = 0 : s++,
        n = map.mClC
    }
    ,
    this.resizeView = function(t, e) {
        if (!isset(t))
            t = 512,
            e = 512 - (3 == g.chat.state || 0 == g.chat.state || "none" == $("#chat").css("display") ? 0 : $("#chat").height() - 4);
        $("#base").width(t).height(e),
        $("#trade").css("top", e - 512),
        $("#bground").width(t).height(e),
        $("#battle").css("top", e - 512 - (g.battle && "big" == getCookie("battleLogSize") ? 66 : 0)),
        r = t >> 1,
        i = e >> 1,
        this.center(a, o)
    }
    ,
    this.mClC = 0;
    var s = 0
      , n = 0;
    this.getBC = function() {
        return s
    }
    ,
    this.o = function() {
        return "o"
    }
    ,
    this.showMini = function(t) {
        if ($("#inmap .trackDot").remove(),
        tutorialStart(10),
        !isset(t))
            t = 0;
        this.maplist.length ? setTimeout(this.markerAnimator, 300) : _g("minimap");
        var e = 256 - (this.mmw >> 1) + Math.round((32 * hero.x + 16) * this.mmr)
          , r = 256 - (this.mmh >> 1) + Math.round((32 * hero.y + 16) * this.mmr);
        if ($("#mapdot").css({
            top: r - 2,
            left: e - 2
        }),
        questTrack.activeTrack)
            for (var i in questTrack.trackList[questTrack.activeTrack]) {
                var a = questTrack.trackList[questTrack.activeTrack][i]
                  , o = $('.trackDot[mappos="' + a.pos[1] + "_" + a.pos[2] + '"]');
                o.length ? o.attr("tip", o.attr("tip") + "<br />" + a.txt) : $("#inmap").append($('<div class="trackDot"></div>').attr("tip", htmlspecialchars(a.txt)).css({
                    top: 256 - (this.mmh >> 1) + Math.round((32 * parseInt(a.pos[2]) + 16) * this.mmr) - 2,
                    left: 256 - (this.mmw >> 1) + Math.round((32 * parseInt(a.pos[1]) + 16) * this.mmr) - 2
                }).attr("mappos", a.pos[1] + "_" + a.pos[2]))
            }
        1 == t ? $("#inmap2wrapper").show() : 2 == t && $("#inmap2wrapper").hide(),
        $("#minimap").fadeIn("fast"),
        $("#mapfilter").val("").trigger("keyup"),
        this.tab = t,
        g.lock.add("minimap")
    }
    ,
    this.bB = function() {
        $("#base").click((function() {
            map.manageClickMCLC()
        }
        )),
        $(document).keypress((function(t) {
            map.mClC > 100 && (map.mClC = 0),
            map.mClC++
        }
        ))
    }
    ,
    this.manageClickMCLC = function() {
        map.mClC > 100 && (map.mClC = 0),
        map.mClC++
    }
    ,
    this.toggle = function() {
        var t = $("#minimap");
        "none" == t.css("display") ? this.showMini(2) : (t.fadeOut(),
        g.lock.remove("minimap"))
    }
    ,
    this.highlightMap = function(t) {
        var e = this.maplist[t];
        $("#hlmap").css({
            left: e.x,
            top: e.y - 1,
            width: e.width - 2,
            height: e.height - 2
        }).show()
    }
    ,
    this.highlightMarker = function() {
        if (!isset(this.marker)) {
            var t = 0 == this.mainid ? this.id : this.mainid
              , e = this.maplist[t];
            void 0 !== e && (this.marker = $(document.createElement("div")).css({
                position: "absolute",
                left: e.x + 1,
                top: e.y + 1,
                width: e.width,
                height: e.height,
                "background-color": "#ff0000",
                opacity: .5
            }),
            $("#inmap2").append(this.marker),
            this.marker.attr("tip", "<center><strong>" + _t("you_are_here", null, "map") + "</strong><br />" + escapeHTML(this.maplist[t].name) + (0 == this.mainid ? "" : ", " + this.name) + "</center>"))
        }
        this.markerAnimator()
    }
    ,
    this.markerAnimator = function() {
        isset(map.marker) && map.marker.is(":visible") && (128 & hero.opt || map.marker.animate({
            opacity: .2 == map.marker.css("opacity") ? .5 : .2
        }, 500, "swing", map.markerAnimator))
    }
    ,
    this.fadeoutMap = function(t) {
        $("#hlmap").hide()
    }
    ;
    var p = function(t) {
        for (var e = null, r = null, i = 0; i < t.length; i++) {
            var a = t[i];
            (null == e || a.fScore < e.fScore) && (r = i,
            e = a)
        }
        return r
    };
    this.hce = function(t, e) {
        return Math.abs(t.x - e.x) + Math.abs(t.y - e.y)
    }
    ,
    this.hce8 = function(t, e) {
        return Math.sqrt(Math.pow(t.x - e.x, 2) + Math.pow(t.y - e.y, 2))
    }
    ,
    this.nodeSetLoop = function(t, e, r) {
        var i = []
          , a = [];
        for (i.push(t); i.length > 0; ) {
            var o = p(i)
              , s = i[o];
            if (i.splice(o, 1),
            a.push(s),
            s.id == e.id)
                return s;
            var n = s.getNeighbors()
              , l = s.gScore + 1;
            for (var h in n) {
                var c = n[h];
                if (-1 == a.indexOf(c) && r(s, c, e, i, l))
                    return c
            }
        }
    }
    ,
    this.findStep = function(t, e, r, i, a) {
        if (null !== e.group && r.group == e.group)
            return !0;
        if (-1 == i.indexOf(e) && i.push(e),
        null !== e.gScore && a >= e.gScore)
            return !1;
        var o = a + map.hce8(e, r);
        return e.setFromAndScore(t, a, o),
        !1
    }
    ,
    this.mapStep = function(t, e, r, i, a) {
        if (e.isBlocked())
            return !1;
        if (-1 == i.indexOf(e))
            i.push(e);
        else if (a >= e.gScore)
            return !1;
        var o = a + map.hce(e, r);
        return e.setFromAndScore(t, a, o),
        !1
    }
}
function MapNode(t, e, r) {
    var i = this;
    return this.id = r(t, e),
    this.x = t,
    this.y = e,
    this.neighbors = [],
    this.blocked = !1,
    this.permanently = !1,
    this.group = null,
    i.gScore = null,
    i.fScore = null,
    i.from = null,
    this.inTouchWith = function(t) {
        return Math.abs(t.x - i.x) <= 1 && Math.abs(t.y - i.y) <= 1
    }
    ,
    this.setCollision = function(t) {
        i.permanently && !t || (i.blocked = t)
    }
    ,
    this.setPermanentlyCollision = function() {
        i.permanently = !0
    }
    ,
    this.forceRemoveCollision = function() {
        i.permanently = !1,
        i.blocked = !1,
        i.setGroupId(0)
    }
    ,
    this.isBlocked = function() {
        return i.blocked
    }
    ,
    this.getNeighbors = function() {
        return i.neighbors
    }
    ,
    this.isFreeAndWithoutGroup = function() {
        return null === i.group && !i.blocked
    }
    ,
    this.setGroupId = function(t) {
        i.group = t
    }
    ,
    this.hasSameGroup = function(t) {
        return i.group == t.group && null !== i.group
    }
    ,
    this.setScore = function(t, e) {
        i.gScore = t,
        i.fScore = e
    }
    ,
    this.setFromAndScore = function(t, e, r) {
        i.from = t,
        i.gScore = e,
        i.fScore = r
    }
    ,
    this.clear = function() {
        i.gScore = null,
        i.fScore = null,
        i.from = null
    }
    ,
    this.reload = function(t) {
        i.neighbors = [];
        var e = [{
            x: 0,
            y: -1
        }, {
            x: 0,
            y: 1
        }, {
            x: -1,
            y: 0
        }, {
            x: 1,
            y: 0
        }]
          , a = [];
        for (var o in e) {
            var s = e[o]
              , n = r(i.x + s.x, i.y + s.y);
            a.push(n)
        }
        for (var o in a) {
            var p = a[o];
            isset(t[p]) && i.inTouchWith(t[p]) && i.neighbors.push(t[p])
        }
    }
    ,
    this
}
function MapNodesContainer(t, e, r, i) {
    var a = this
      , o = 0
      , s = []
      , n = new function() {
        var t = [!0];
        this.getFree = function() {
            for (var e = 0; e < t.length; e++)
                if (0 == t[e])
                    return t[e] = !0,
                    e;
            return t.push(!0),
            t.length - 1
        }
        ,
        this.release = function(e) {
            t[e] = !1
        }
    }
    ;
    function p(t) {
        for (var e = t; e < o; e++) {
            var r = a.nodes[e];
            if (r.isFreeAndWithoutGroup())
                return r
        }
        return null
    }
    function l(t, r) {
        return t * e + r
    }
    this.nodes = {},
    this.getNode = function(t, e) {
        var r = l(t, e)
          , i = a.nodes[r];
        return isset(i) && i.x == t && i.y == e ? i : null
    }
    ,
    this.getAllNeighbors = function(t) {
        var e = []
          , r = [];
        for (t.isBlocked() || r.push(t); r.length > 0; ) {
            t = r.shift();
            e.push(t);
            var i = t.getNeighbors();
            for (var a in i) {
                var o = i[a];
                if (!o.isBlocked())
                    if (-1 == r.indexOf(o))
                        -1 == e.indexOf(o) && r.push(o)
            }
        }
        return e
    }
    ,
    this.clearAllNodes = function() {
        for (var t in a.nodes)
            a.nodes[t].clear()
    }
    ,
    this.createGroups = function() {
        for (var t = 0, e = p(t), r = 0; null != e; ) {
            t = e.id;
            var i = a.getAllNeighbors(e);
            if (i.length > 0) {
                var o = n.getFree();
                for (var s in i)
                    i[s].setGroupId(o);
                r++
            }
            e = p(t)
        }
        return r
    }
    ,
    this.changeCollision = function(t, e, r) {
        var i = a.getNode(t, e);
        null !== i && (groupId = i.group,
        i.setCollision(r)),
        null !== groupId && -1 == s.indexOf(groupId) && s.push(groupId)
    }
    ,
    this.removeAllCollisions = function() {
        for (var t in a.nodes) {
            a.nodes[t].forceRemoveCollision()
        }
    }
    ,
    this.reloadGroups = function() {
        for (var t in a.nodes) {
            var e = a.nodes[t];
            -1 != s.indexOf(e.group) && e.setGroupId(null)
        }
        for (var t in s)
            n.release(s[t]);
        s = [],
        a.createGroups()
    }
    ,
    function() {
        o = map.x * map.y;
        for (var t = 0; t < map.x; t++)
            for (var e = 0; e < map.y; e++) {
                var s = new MapNode(t,e,l);
                a.nodes[s.id] = s
            }
        for (var n in a.nodes) {
            s = a.nodes[n];
            var p = r(s.x, s.y);
            i(s.x, s.y) && s.setPermanentlyCollision(),
            s.setCollision(p),
            s.reload(a.nodes)
        }
        a.createGroups()
    }()
}
function player() {
    var t = this
      , s = ""
      , i = this;
    this.autoWalkLock = !1,
    this.updated = !1,
    this.autoFightLock = !1,
    this.ml = [],
    this.mts = [];
    var a = {
        pid: getCookie("mchar_id"),
        x: -1,
        y: -1,
        rx: -1,
        ry: -1,
        mx: -1,
        my: -1,
        step: 0,
        fw: 32,
        fh: 48,
        remoteDir: 0,
        isMoving: 0,
        dir: -1,
        sendDir: -1,
        hp: 1,
        maxhp: 1,
        ml: [],
        clanrank: 100
    };
    for (var e in a)
        this[e] = a[e];
    delete a,
    this.pid < 1 && (this.pid = getCookie("user_id")),
    this.hash = getCookie("chash"),
    this.hash && (this.hash = this.hash.substr(0, 10)),
    this.statsval = [];
    var h = -1
      , r = 0
      , o = null
      , l = $("<div id=hero tip='" + _t("my_character", null, "map") + "'></div>").click((function(t) {
        hero.click(t)
    }
    ));
    $("#base").append(l),
    this.checkNPCRoadCollision = function(t, s) {
        if (road.length)
            for (var i = 0; i < road.length; i++)
                if (road[i].x == t && road[i].y == s) {
                    road = road.splice(i + 1, road.length - i);
                    break
                }
    }
    ,
    this.addStep = function(t) {
        this.ml.push(t),
        this.mts.push(unix_time(!1, !0))
    }
    ,
    this.resetSteps = function() {
        this.ml = [],
        this.mts = []
    }
    ,
    this.sliceSteps = function(t) {
        this.ml = this.ml.slice(t),
        this.mts = this.mts.slice(t)
    }
    ,
    this.updateWStat = function(t, s, i, a) {
        a || (a = s),
        isset(t[s]) ? this[a] = t[s] : this[a] = i
    }
    ,
    this.inMove = function() {
        return -1 != this.dir && (road.length > 0 || (hero.isMoving < 4 || (-1 != h || !hero.sendDir)))
    }
    ,
    this.setHeroInLastServerPos = function() {
        road.length && (road = []),
        t.x = t.lastServerX,
        t.y = t.lastServerY,
        hero.centerViewOnMe()
    }
    ,
    this._u = function(t, s) {
        var i = this.x >= 0 ? this.x : null
          , a = this.y >= 0 ? this.y : null
          , e = this.clan
          , h = isset(this.lvl) ? this.lvl : null;
        for (var o in t)
            "dir" != o && (is_int(t[o]) ? this[o] = parseInt(t[o]) : this[o] = t[o]);
        if (t.hasOwnProperty("x") && (this.lastServerX = t.x),
        t.hasOwnProperty("y") && (this.lastServerY = t.y),
        1 == h && 2 == this.lvl && tutorialStart(4),
        isset(this.wanted) && this.wanted >= 90 && $("#hero").attr("tip", "<center>" + _t("my_character", null, "map") + '</center><b><span style="color:red">' + _t("my_char_wanted", null, "map") + "</span></b>"),
        isset(this.preview_acc) && this.lvl < 20) {
            var l = getCookie("reg_noshow");
            null !== l && parseInt(l) || "en" != _l() || $("#bm_register").show()
        }
        if (!isset(this.clan) && isset(e) && ($(".clan").fadeOut(),
        g.lock.remove("clans")),
        this.clan && newChatMode && g.chatController.getChatChannelsAvailable().setAvailable(ChatData.CHANNEL.CLAN, !0),
        this.lvl >= 25) {
            25 == this.lvl && tutorialStart(16),
            $("#skillSwitch").show();
            var n = "";
            switch (hero.cur_skill_set) {
            case 1:
                n = "first";
                break;
            case 2:
                n = "second";
                break;
            case 3:
                n = "third";
                break;
            default:
                n = "none"
            }
            $("#skillSwitch").attr("class", n)
        }
        if (isset(t.cur_battle_set) && isset(g.battlesets) && g.battlesets.update(t.cur_battle_set),
        isset(t.clanrank) && g.clan && g.clan.ranks && (g.clan.myrank = g.clan.ranks[this.clan.rank].r),
        1 == t.back || (i != this.x || a != this.y) && g.lock.check() && this.ml.length > 0)
            this.resetSteps(),
            road.length && (road = []);
        else if (this.ml.length > 0) {
            var p = -1;
            for (var o in this.ml)
                this.ml[o] == this.x + "," + this.y && (p = parseInt(o));
            if (p >= 0)
                this.sliceSteps(p + 1),
                this.x = i,
                this.y = a;
            else {
                var d = this.ml[0].split(",");
                Math.abs(d[0] - this.x) + Math.abs(d[1] - this.y) > 1 && (this.resetSteps(),
                this.rx = this.x,
                this.ry = this.y)
            }
        }
        if (i != this.x || a != this.y) {
            !function t() {
                hero.rx >= 0 && hero.rx >= 0 ? hero.centerViewOnMe() : setTimeout((function() {
                    t()
                }
                ), 50)
            }()
        }
        if (isset(t.dir) && (this.remoteDir = t.dir,
        this.inMove() && !s.d || (this.dir = this.remoteDir)),
        isset(t.img)) {
            this.icon = g.opath + "postacie" + this.img;
            var c = new Image;
            $(c).on("load", (function() {
                hero.fw = this.width >> 2,
                hero.fh = this.height >> 2;
                var t = Math.round(32 * hero.rx + 16 - hero.fw / 2)
                  , s = Math.round(32 * hero.ry + 32 - hero.fh)
                  , i = Math.round(hero.rx) + 256 * Math.round(hero.ry)
                  , a = 0;
                isset(map) && isset(map.water[i]) && (a = map.water[i]),
                $("#hero").css({
                    backgroundImage: "url(" + $(this).attr("src") + ")",
                    width: hero.fw,
                    height: hero.fh - (a / 4 > 8 ? a - 32 : a),
                    left: t,
                    top: s + (a / 4 > 8 ? 0 : a),
                    backgroundPosition: hero.step * hero.fw + "px " + -hero.dir * hero.fh + "px",
                    zIndex: getLayerOrder(hero.y, 10)
                }),
                __tutorials.val || Highlighter.startH.synchroStart("hero"),
                progressbar.reposition()
            }
            )).on("error", (function() {
                log($(this).attr("src"), 2)
            }
            )).attr({
                src: this.icon
            }),
            $("#b_pvp").data("bp", this.pvp ? "-200px 0px" : "-200px -27px").css("backgroundPosition", this.pvp ? "-200px 0px" : "-200px -27px")
        }
        if (isset(t.nick)) {
            var u = this.nick + " Â· " + this.lvl + this.prof;
            u.length > 30 ? $("#nick").html(u).css({
                "font-size": "12px"
            }) : $("#nick").html(u)
        }
        if (isset(t.bag) && (g.bag = t.bag,
        $("#bag").css({
            top: -198 * g.bag
        }),
        $("#hlbag").css({
            left: 25 + 33 * g.bag
        })),
        isset(t.warrior_stats)) {
            var m = t.warrior_stats;
            this.updateWStat(m, "st", 0),
            this.updateWStat(m, "ag", 0),
            this.updateWStat(m, "it", 0),
            this.updateWStat(m, "resfire", 0),
            this.updateWStat(m, "resfrost", 0),
            this.updateWStat(m, "reslight", 0),
            this.resis = this.resfire + "/" + this.reslight + "/" + this.resfrost,
            this.updateWStat(m, "act", 0),
            this.updateWStat(m, "hp", 0),
            this.updateWStat(m, "maxhp", 0),
            this.updateWStat(m, "sa", 0),
            this.updateWStat(m, "crit", 0),
            this.updateWStat(m, "ac", 0),
            this.updateWStat(m, "evade", [0, 0]),
            this.updateWStat(m, "lowcrit", 0),
            this.updateWStat(m, "heal", 0),
            this.updateWStat(m, "manadest", 0),
            this.updateWStat(m, "endest", 0),
            this.updateWStat(m, "acdmg", 0),
            this.updateWStat(m, "slow", 0),
            this.updateWStat(m, "mana", 0),
            this.updateWStat(m, "absorb", 0),
            this.updateWStat(m, "absorbm", 0),
            this.updateWStat(m, "acmdmg", 0),
            this.updateWStat(m, "managain", 0),
            this.updateWStat(m, "of_crit", 0),
            this.updateWStat(m, "of_critval", 0),
            this.updateWStat(m, "blok", 0, "block"),
            this.updateWStat(m, "critval", 0),
            this.updateWStat(m, "energy", 0),
            this.updateWStat(m, "lowevade", 0),
            this.updateWStat(m, "energygain", 0),
            this.updateWStat(m, "of_poison1", 0),
            this.updateWStat(m, "poison1", 0);
            var v = [];
            if (isset(m.attack)) {
                var f = m.attack;
                for (var x in f) {
                    var b = f[x];
                    switch (b.average = Math.round((b.min + b.max) / 2),
                    x) {
                    case "physicalMainHand":
                        v.push(b.average);
                        break;
                    case "physicalOffHand":
                        v.push(b.average + "o");
                        break;
                    case "lightning":
                        v.push(b.average + "l");
                        break;
                    case "fire":
                        v.push(b.average + "f");
                        break;
                    case "frost":
                        v.push(b.average + "c");
                        break;
                    case "poisonMainHand":
                        this.poison1 = b.average;
                        break;
                    case "poisonOffHand":
                        this.of_poison1 = b.average;
                        break;
                    default:
                        console.log('Error: "'.concat(x, '" attack stat is not exist.'))
                    }
                }
            }
            this.dmg = v.join(","),
            this.updateWStat(m, "critmval", 0),
            this.updateWStat(m, "critmval_f", 0),
            this.updateWStat(m, "critmval_c", 0),
            this.updateWStat(m, "critmval_l", 0),
            this.critmval2 = this.critmval_f + "," + this.critmval_c + "," + this.critmval_l
        }
        if (isset(t.gold) || isset(t.ttl) || isset(t.credits) || isset(t.ph) || isset(t.hp) || isset(t.warrior_stats)) {
            isset(t.credits) && $("#premiumshop .sl_amount_ps").html(t.credits),
            $("#base3").html("<div>" + this.st + "</div><div>" + this.ag + "</div><div>" + this.it).attr("tip", _t("base_stats", null, "player") + "<br>" + this.bstr + "/" + this.bagi + "/" + this.bint),
            $("#gold").html(round(this.gold, 10)).attr("tip", _t("goldlimit", null, "player") + "<br>" + round(this.goldlim, 10)),
            $("#ah_gl").html(round(this.goldlim, 10));
            var _ = parseFloat(this.hp) / parseFloat(this.maxhp);
            if (isset(t.hp) && _ <= .2 && this.hp > 1) {
                tutorialStart(5);
                var y = 0;
                for (var k in g.item)
                    if ("g" == g.item[k].loc && g.item[k].stat.indexOf("leczy") >= 0 && y++,
                    y >= 5)
                        break;
                y < 5 && "none" == $("#lehim_button").css("display") && $("#hieronim_button").fadeIn()
            }
            $("#life2").css("width", Math.round(1 + 106 * _) + "px"),
            $("#life1").attr("tip", "<B>" + _t("life_points", null, "player") + ":</B>" + round(this.hp, 10) + " / " + round(this.maxhp, 10)),
            this.nextexp = Math.round(Math.pow(this.lvl, 4) + 10);
            var S = Math.round(Math.pow(this.lvl - 1, 4) + 10);
            1 == this.lvl && (S = 0);
            var w = Math.min(Math.max((this.exp - S) / (this.nextexp - S), .001), 1);
            $("#exp2").css("width", Math.round(1 + 106 * w) + "px"),
            $("#exp1").attr("tip", "<B>" + _t("experience", null, "player") + ":</B>" + round(this.exp, Math.ceil(this.exp.toString().length / 3) < 2 ? 2 : Math.ceil(this.exp.toString().length / 3)) + " / " + round(this.nextexp, Math.ceil(this.nextexp.toString().length / 3) < 2 ? 2 : Math.ceil(this.nextexp.toString().length / 3)) + "<br>" + _t("to %lvl% %exp%", {
                "%lvl%": this.lvl + 1,
                "%exp%": round(this.nextexp - this.exp, 10)
            }, "player"));
            var M = this.resis.split("/");
            v = this.dmg.toString().split(",");
            for (var k in this.fulldmg = [],
            v) {
                var W = (v[k] + "").charAt(v[k].length - 1);
                this.fulldmg += '<span class="dmg' + (W > "a" ? W : "") + ' dmg-stat">+' + round(parseInt(v[k]), 1) + "</span>"
            }
            (this.of_poison1 > 0 || this.poison1 > 0) && (this.fulldmg += '<span class="dmg-poison dmg-stat">+' + round(parseInt(this.of_poison1 + this.poison1), 1) + "</span>"),
            this.resist = "<span class=dmgf>" + M[0] + "</span> / <span class=dmgl>" + M[1] + "</span> / <span class=dmgc>" + M[2] + '</span> / <span style="color:lime">' + this.act + "</span> %",
            this.statsval[0] = this.fulldmg + "<br>" + this.ac + "<br>" + this.sa + "<br><br>" + this.resist;
            var C = this.ttl_value
              , I = _t("limit_on_day", {
                "%val%": Math.round(C / 60)
            });
            this.statsval[1] = this.honor + "<br>" + this.credits + '<br><span tip="' + I + '">' + Math.max(0, this.ttl) + "</span>",
            this.statsval[1] += '<div class="stats-row"><div class="golden-text">' + _t("dragon_runes") + ":</div><span>" + this.runes + "</span></div>",
            "en" == _l() && (this.statsval[1] += '<div class="golden-text" id="ach_link" onclick="_g(\'ach\')">' + _t("ach_btn") + "</div>");
            var P = Math.round(20 * this.block / this.lvl)
              , L = " (" + (P > 50 ? 50 : P) + "%)"
              , O = "";
            this.of_crit >= .01 && (O = _t("critical_dmg_help_txt %crit% %crit_val%", {
                "%crit%": this.of_crit,
                "%crit_val%": this.of_critval
            }));
            var E = this.critmval2.split(",")
              , N = ""
              , A = !1
              , H = ""
              , T = 0;
            for (var k in E) {
                var B = "";
                switch (parseInt(k)) {
                case 0:
                    B = _t("fire", null, "critval");
                    break;
                case 1:
                    B = _t("cold", null, "critval");
                    break;
                case 2:
                    B = _t("lightning", null, "critval")
                }
                N += _t("m_crit_strenght %name% %val%", {
                    "%name%": B,
                    "%val%": E[k]
                }) + (2 != k ? "<br />" : ""),
                parseFloat(E[k]) != this.critmval && (A = !0),
                T += parseFloat(E[k])
            }
            H = A ? '<span tip="' + N + '">' + Math.round(T / 3 * Math.pow(10, 2)) / Math.pow(10, 2) + "*</span>" : this.critmval,
            this.statsval[2] = "<span " + ("" != O ? 'tip="' + O + '"' : "") + ">" + this.crit + "%" + ("" != O ? "*" : "") + "</span><br><span  " + ("" != O ? 'tip="' + O + '"' : "") + ">x" + this.critval + ("" != O ? "*" : "") + "</span><br>x" + H + "<br>" + (isset(this.evade) ? this.evade[0] + " (" + this.evade[1] + "%)" : 0) + "<br>" + (isset(this.block) ? this.block + L : 0),
            this.statsval[3] = this.heal + "<br>" + (isset(this.absorb) ? this.absorb : 0) + "<br>" + (isset(this.absorbm) ? this.absorbm : 0) + "<br>" + (isset(this.energy) ? this.energy : 0) + "<br>" + (isset(this.mana) ? this.mana : 0),
            this.statsval[4] = sound.manager.generateMenu(),
            $("#stats").html("<b>" + this.statsval[r] + "</b>"),
            $("#exp2").css("backgroundImage", "url(img/" + (this.ttl > 0 ? "exp.png?v=".concat(_CLIENTVER) : "noexp.png?v=".concat(_CLIENTVER, ")"))),
            this.ttl <= 0 && "none" == $("#hieronim_button").css("display") && !g.worldConfig.getPvp() && "pl" == _l() && $("#lehim_button").fadeIn()
        }
        if (isset(t.mails)) {
            var D = this.mails_all > 29;
            this.mails > 0 && !g.mails ? $("#mailnotifier").html(this.mails + (D ? "!" : "")).attr("tip", _t("last_mail_msg %from%", {
                "%from%": this.mails_last
            }) + (D ? "<br>" + _t("mail_box_full") : "")).animate({
                top: 485
            }) : $("#mailnotifier").animate({
                top: 512
            }),
            this.mails > 0 && g.mails && _g("mail&a=refresh")
        }
        if (isset(t.stasis)) {
            var R = t.stasis;
            R > 0 ? emotion("stasis", this.id, !1) : removeEmotionBySourceIdAndEmoType("stasis", this.id),
            this.setStasisMapOverlay(R)
        }
        if (isset(t.stasis_incoming_seconds)) {
            var z = t.stasis_incoming_seconds;
            z > 0 ? emotion("away", this.id, !1) : removeEmotionBySourceIdAndEmoType("away", this.id),
            this.stasisIncomingInfo(z)
        }
        $.fx.off = 128 & hero.opt,
        4096 & hero.opt ? $(".itemHighlighter").addClass("nodisp") : $(".itemHighlighter").removeClass("nodisp"),
        this.updated = !0,
        "hero" == g.talk.dialogCloud && createDialogCloud("hero")
    }
    ,
    this.setStasisMapOverlay = function(t) {
        var s = $("#stasis-overlay");
        t ? (s.show(),
        s.find(".stasis-overlay__title").text(_t("stasis")),
        s.find(".stasis-overlay__text").html(_t("stasis_overlay_text"))) : s.hide()
    }
    ,
    this.stasisIncomingInfo = function(t) {
        var s = t
          , i = $("#stasis-incoming-overlay")
          , a = i.find(".stasis-incoming-overlay__text")
          , e = function() {
            a.html(_t("stasis-incoming", {
                "%val%": s--
            })),
            0 === s && h()
        }
          , h = function() {
            o && clearInterval(o)
        };
        h(),
        t ? (e(),
        o = setInterval(e, 1e3),
        i.show()) : i.hide()
    }
    ,
    this.updatePet = function(t) {
        var s = !0;
        for (var i in t) {
            s = !1;
            break
        }
        isset(this.pet) ? s ? (this.pet.remove(),
        delete this.pet) : this.pet.update(t) : (t.own = !0,
        this.pet = new Pet(t,this),
        this.pet.update(t, !0))
    }
    ,
    $("#stats").click((function(t) {
        var s = $("#stats").offset()
          , i = t.clientX - s.left - 2;
        t.clientY - s.top > 25 || i < 0 || (4 == (r = Math.min(Math.floor(i / 23), 4)) && (hero.statsval[4] = sound.manager.generateMenu()),
        $("#stats").html("<b>" + hero.statsval[r] + "</b>").css({
            backgroundPosition: "0 -" + 98 * r + "px"
        }))
    }
    )),
    this.togglePvp = function() {
        this.pvp = this.pvp ? 0 : 1,
        _g("setpvp&mode=" + this.pvp),
        $("#b_pvp").data("bp", this.pvp ? "-200px 0px" : "-200px -27px").css("backgroundPosition", this.pvp ? "-200px 0px" : "-200px -27px")
    }
    ,
    this.centerViewOnMe = function() {
        this.run();
        var t = Math.round(32 * this.rx + 16 - this.fw / 2)
          , s = Math.round(32 * this.ry + 32 - this.fh)
          , i = Math.round(this.rx) + 256 * Math.round(this.ry);
        isset(map.water[i]) && map.water[i],
        map.center(t, s)
    }
    ,
    this.run = function() {
        if (this.rx != this.x || this.ry != this.y) {
            Math.abs(this.rx - this.x) + Math.abs(this.ry - this.y) > 3 ? (this.rx = this.x,
            this.ry = this.y,
            this.step = 0,
            isset(this.pet) && this.pet.update()) : (this.rx < this.x && (this.rx += .25),
            this.rx > this.x && (this.rx -= .25),
            this.ry < this.y && (this.ry += .25),
            this.ry > this.y && (this.ry -= .25),
            this.step = this.x == this.rx && this.y == this.ry ? 0 : Math.floor(2 * (this.rx + this.ry)) % 4);
            var t = Math.round(32 * this.rx + 16 - this.fw / 2)
              , s = Math.round(32 * this.ry + 32 - this.fh)
              , i = Math.round(this.rx) + 256 * Math.round(this.ry)
              , a = 0;
            isset(map.water[i]) && (a = map.water[i]),
            $("#hero").css({
                left: t,
                top: s + (a / 4 > 8 ? 0 : a),
                height: this.fh - (a / 4 > 8 ? a - 32 : a),
                zIndex: getLayerOrder(hero.y, 10),
                width: t + this.fw > 32 * map.x ? this.fw - (t + this.fw - 32 * map.x) : this.fw
            }),
            g.lock.check() || map.center(t, s),
            $("#botloc").text(this.x + "," + this.y)
        } else
            hero.isMoving < 4 && (hero.isMoving++,
            -1 != h && 0 == road.length && (this.dir = h,
            hero.isMoving = 0,
            h = -1));
        $("#hero").css({
            backgroundPosition: this.step * this.fw + "px " + -this.dir * this.fh + "px"
        }),
        "en" == _l() && this.updated && questTrack.draw(),
        isset(this.pet) && this.pet.move()
    }
    ,
    this.go = function(t) {
        if ((g.lock.check() || g.menu) && (road = []),
        g.lock.check() || g.menu || hero.ml.length > 9 || "block" == $("#alert").css("display"))
            return !1;
        if (hero.rx != hero.x || hero.ry != hero.y)
            return !1;
        hero.isMoving = 0;
        var i = hero.x
          , a = hero.y;
        switch (t) {
        case "W":
            1 == hero.dir ? i = hero.x - 1 : hero.dir = 1;
            break;
        case "E":
            2 == hero.dir ? i = hero.x + 1 : hero.dir = 2;
            break;
        case "N":
            3 == hero.dir ? a = hero.y - 1 : hero.dir = 3;
            break;
        case "S":
            0 == hero.dir ? a = hero.y + 1 : hero.dir = 0;
            break;
        case "R":
            var e = road.length - 1;
            i > road[e].x ? hero.dir = 1 : i < road[e].x ? hero.dir = 2 : a > road[e].y ? hero.dir = 3 : a < road[e].y && (hero.dir = 0),
            i = road[e].x,
            a = road[e].y,
            road = road.slice(0, -1)
        }
        "R" != t && road.length && (road = []);
        var h = !0;
        if (hero.ml.length) {
            var r = hero.ml[hero.ml.length - 1].split(",");
            Math.abs(i - parseInt(r[0])) + Math.abs(a - parseInt(r[1])) > 1 && (h = !1,
            hero.resetSteps())
        }
        if (i >= 0 && a >= 0 && i < map.x && a < map.y && !isset(g.npccol[i + 256 * a]) && (!map.col || "0" == map.col.charAt(i + a * map.x)) && Math.abs(hero.rx - hero.x) + Math.abs(hero.ry - hero.y) < .3 && h) {
            var o = i + "," + a;
            if (hero.x != i || hero.y != a) {
                hero.addStep(o);
                var l = null !== g.lastClickedTarget && $(g.lastClickedTarget).hasClass("npc");
                !isset(g.gw[i + "." + a]) || 2048 & hero.opt || hero.autoWalkLock || l ? isset(g.gw[i + "." + a]) || (hero.autoWalkLock = !1) : (s = o,
                setTimeout((function() {
                    hero.autowalk()
                }
                ), 500))
            }
            return hero.x = i,
            hero.y = a,
            isset(hero.pet) && hero.pet.update(),
            !0
        }
        return !1
    }
    ,
    this.autowalk = function() {
        s == this.rx + "," + this.ry && _g("walk")
    }
    ,
    this.click = function(t) {
        var s = []
          , i = getGroundItem();
        if (i)
            for (var a = 0; a < i.length; a++)
                s.push([_t("take", null, "menu") + " " + i[a].name, '_g("takeitem&id=' + i[a].id + '")']);
        var e = getRenewableNpc();
        if (e)
            for (a = 0; a < e.length; a++)
                s.push([_t("take", null, "menu") + " " + e[a].nick, '_g("talk&id=' + e[a].id + '")']);
        isset(g.gw[this.x + "." + this.y]) && s.push([_t("go", null, "menu"), '_g("walk")']),
        hero.lvl > 19 && s.push([_t("emo_mad", null, "menu"), '_g("emo&a=angry")']),
        s.length && showMenu(t, s, !0)
    }
    ,
    this.isBlockedSearchPath = function() {
        return map.id >= 3277 && map.id <= 3280 || 3714 == map.id
    }
    ,
    this.blockedInfoSearchPath = function() {
        mAlert(_t("block_mouse_move"))
    }
    ,
    this.searchPath = function(t, s) {
        if (i.isBlockedSearchPath())
            return i.blockedInfoSearchPath();
        var a = map.nodes.getNode(hero.x, hero.y)
          , e = map.nodes.getNode(t, s);
        a.hasSameGroup(e) || (map.nodes.clearAllNodes(),
        a.setScore(0, map.hce8(e, a)),
        e = map.nodeSetLoop(e, a, map.findStep)),
        map.nodes.clearAllNodes(),
        a.setScore(0, map.hce(a, e)),
        map.nodeSetLoop(a, e, map.mapStep);
        var h = e;
        for (road = []; null !== h && h.id != a.id; )
            road.push({
                x: h.x,
                y: h.y
            }),
            h = h.from;
        null !== h && road.push({
            x: h.x,
            y: h.y
        }),
        road.length > 1 && null == g.playerCatcher.follow && $("#target").stop().css({
            left: 32 * road[0].x,
            top: 32 * road[0].y,
            display: "block",
            opacity: 1,
            "z-index": 1
        }).fadeOut(1e3)
    }
    ,
    this.mClick = function(t) {
        if (!(64 & hero.opt && !g.playerCatcher.follow || g.lock.check() || "block" == $("#alert").css("display"))) {
            var s = $("#ground").offset()
              , i = t.clientX - s.left >> 5
              , a = t.clientY - s.top >> 5;
            hero.searchPath(i, a)
        }
    }
    ,
    $("#ground").click((function(t) {
        !$(t.target).hasClass("endtalk2") && "block" == $("#bubbledialog").css("display") && g.talk.id && isset(g.talk.bubbleEndLineCommand) ? _g(g.talk.bubbleEndLineCommand) : hero.mClick(t)
    }
    ))
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
function _slicedToArray(t, e) {
    return _arrayWithHoles(t) || _iterableToArrayLimit(t, e) || _unsupportedIterableToArray(t, e) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var i = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === i && t.constructor && (i = t.constructor.name),
        "Map" === i || "Set" === i ? Array.from(t) : "Arguments" === i || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var i = 0, s = new Array(e); i < e; i++)
        s[i] = t[i];
    return s
}
function _iterableToArrayLimit(t, e) {
    var i = null == t ? null : "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (null != i) {
        var s, a, r = [], n = !0, o = !1;
        try {
            for (i = i.call(t); !(n = (s = i.next()).done) && (r.push(s.value),
            !e || r.length !== e); n = !0)
                ;
        } catch (t) {
            o = !0,
            a = t
        } finally {
            try {
                n || null == i.return || i.return()
            } finally {
                if (o)
                    throw a
            }
        }
        return r
    }
}
function _arrayWithHoles(t) {
    if (Array.isArray(t))
        return t
}
function newGateway(t) {
    for (var e = 0; e < t.length; e += 5) {
        var i = "gw" + (256 * t[e + 2] + t[e + 1])
          , s = htmlspecialchars(escapeHTML(g.townname[t[e]])) + (t[e + 3] ? "<br>(" + _t("require_key", null, "gtw") + ")" : "")
          , a = {
            min: 65535 & parseInt(t[e + 4]),
            max: parseInt(t[e + 4]) >> 16 & 65535
        }
          , r = !0;
        0 != t[e + 4] && (a.min != a.max ? (s += "<br>" + _t("gateway_availavle", null, "gtw") + (0 != a.min ? _t("from_lvl %lvl%", {
            "%lvl%": a.min
        }, "gtw") : "") + (a.max >= 1e3 ? "" : _t("to_lvl %lvl%", {
            "%lvl%": a.max
        }, "gtw")) + _t("lvl_lvl", null, "gtw"),
        (0 != a.min && a.min > hero.lvl || a.max < 1e3 && a.max < hero.lvl) && (r = !1)) : (s += "<br>" + _t("gateway_availavle_for %lvl%", {
            "%lvl%": a.max
        }, "gtw"),
        a.max != hero.lvl && (r = !1))),
        $('<div class="gw gwmap' + t[e] + '" id=' + i + " style='top:" + 32 * t[e + 2] + "px; left:" + 32 * t[e + 1] + "px' tip='" + s + "'></div>").click((function(t) {
            hero.mClick(t)
        }
        )).appendTo("#base"),
        g.gw[t[e + 1] + "." + t[e + 2]] = r,
        g.gwIds[t[e]] = t[e + 1] + "." + t[e + 2]
    }
    for (var n in isset(g.gw[hero.x + "." + hero.y]) && (hero.autoWalkLock = !0),
    g.gw) {
        var o = n.split(".");
        for (var n in questTrack.removePlaceholder([1, o[0], o[1]]),
        g.gwIds)
            questTrack.checkGwAndHighlight(n)
    }
}
function loadImg(t, e, i) {
    var s = new Image;
    t.indexOf("/") && (t = g.opath + t),
    $(s).on("load", i).on("error", (function() {
        log($(this).attr("src"), 2)
    }
    )).attr({
        dest: e,
        src: t
    })
}
function preNewNpc(t) {
    for (var e in t)
        if (isset(g.npc[e]) && isset(t[e].del) && isset(g.npc[e].y) && isset(g.npc[e].y))
            map.nodes.changeCollision(g.npc[e].x, g.npc[e].y, !1);
        else if (!g.npc[e] || g.npc[e].x == t[e].x && g.npc[e].y == t[e].y || map.nodes.changeCollision(g.npc[e].x, g.npc[e].y, !1),
        4 != t[e].type && 7 != t[e].type && isset(t[e].y) && isset(t[e].y)) {
            var i = !t[e].walkover;
            map.nodes.changeCollision(t[e].x, t[e].y, i)
        }
    newNpc(t),
    null != map.nodes && map.nodes.reloadGroups()
}
function refreshTipOfNpc(t) {
    var e = g.npc[t];
    if (e && e.hasOwnProperty("elasticLevelFactor") && (e.lvl || 4 != e.type)) {
        var i = g.tips.npc(e);
        $("#npc" + t).attr("tip", i)
    }
}
function getElasticMobLevel(t) {
    var e = getElasticMobLevelAfterSubElasticLevelFactor(t);
    return Math.min(e, 300)
}
function getElasticMobLevelAfterSubElasticLevelFactor(t) {
    var e = parseInt(t.elasticLevelFactor);
    if (!g.party)
        return parseInt(hero.lvl) + e;
    var i = getMemberFromHeroMapWithTheBigestLevel();
    return i ? parseInt(i.lvl) + e : parseInt(hero.lvl) + e
}
function getMemberFromHeroMapWithTheBigestLevel() {
    var t = null
      , e = g.other
      , i = g.party;
    for (var s in i)
        e[s] && (t ? t.lvl < e[s].lvl && (t = e[s]) : e[s].lvl > hero.lvl && (t = e[s]));
    return t
}
function newNpc(t) {
    for (k in isset(g.tips.npc) || (g.tips.npc = function(t) {
        var e = "<b>" + htmlspecialchars(parseBasicBB(t.nick, !1)) + "</b>";
        if (4 != t.type) {
            t.wt > 99 ? isset(map) && isset(map.mode) && 5 == map.mode ? e += "<i>" + _t("wt_colossus", null, "npc") + "</i>" : e += "<i>" + _t("wt_titan", null, "npc") + "</i>" : t.wt > 79 ? e += "<i>" + _t("wt_hero", null, "npc") + "</i>" : t.wt > 29 ? e += "<i>" + _t("wt_elite3", null, "npc") + "</i>" : t.wt > 19 ? e += "<i>" + _t("wt_elite2") + "</i>" : t.wt > 9 && (e += "<i>" + _t("eliteI", null, "npc") + "</i>");
            var i, s = "";
            if (i = t.hasOwnProperty("elasticLevelFactor") ? getElasticMobLevel(t) : t.lvl,
            2 == t.type || 3 == t.type) {
                var a = i - hero.lvl;
                a < -13 ? s = 'style="color:#888"' : a > 10 ? s = 'style="color:#f50"' : a > 5 && (s = 'style="color:#ff0"')
            }
            var r = 0 == i ? "" : ", ";
            e += "<span " + s + ">" + (i ? i + " lvl" : "") + (t.grp ? r + "grp" : "") + "</span>"
        }
        return e
    }
    ),
    t) {
        var e = null;
        if (isset(g.npc[k]) && ($("#npc" + k + " #bubbledialog").length && (e = $("#bubbledialog").detach()),
        $("#npc" + k).remove(),
        isset(g.npc[k].x) && delete g.npccol[g.npc[k].x + 256 * g.npc[k].y],
        delete g.npc[k]),
        isset(t[k].del))
            questTrack.checkTaskNpc(k);
        else {
            "/" != t[k].icon.charAt(0) && (t[k].icon = "/" + t[k].icon),
            t[k].icon = g.opath + "npc" + t[k].icon,
            t[k].id = k,
            g.npc[k] = t[k],
            g.npc[k].imgStatus = !1;
            var i = ""
              , s = g.tips.npc(t[k]);
            (4 != t[k].type || t[k].lvl) && (i = " ctip=t_npc " + (s ? "tip='" + g.tips.npc(t[k]) + "'" : "")),
            $("#base").append('<div class="npc ' + (RegExp("^/obrazki/npc/tmp/").test(t[k].icon) ? "nodef" : "") + '" id=npc' + k + i + "></div>"),
            (t[k].actions >> 7 & 1 || t[k].actions >> 6 & 1) && ("pl" == _l() ? $("#npc" + k).append('<img src="' + CFG.epath + 'y-quest-mark.gif">') : $("#npc" + k).append('<div class="qm' + (t[k].qm % 2 == 0 ? " daily" : "") + '">' + (t[k].qm < 3 ? "?" : "!") + "</div>"));
            var a = 0
              , r = 4 == t[k].type || 7 == t[k].type;
            r && (a += parseInt(t[k].wt)),
            a = r && a < 0 ? .01 : a += t[k].y,
            $("#npc" + k).css({
                left: 32 * t[k].x,
                top: 32 * t[k].y - 16,
                zIndex: getLayerOrder(a, 10)
            }).bind("contextmenu", (function(t) {
                var e = this.id.substr(3);
                if (2 == g.npc[e].type || 3 == g.npc[e].type)
                    return t.preventDefault(),
                    _g("fight&a=attack&id=-" + e + "&ff=1")
            }
            )).click((function(t) {
                if (isset(g.talk.block) && g.talk.block)
                    return delete g.talk.block,
                    !1;
                var e = this.id.substr(3);
                if (Math.abs(g.npc[e].x - hero.x) > 1 || Math.abs(g.npc[e].y - hero.y) > 1)
                    hero.mClick(t);
                else {
                    var i = []
                      , s = !0;
                    if (4 != g.npc[e].type) {
                        if (0 != g.npc[e].type && 6 != g.npc[e].type && 7 != g.npc[e].type || (i[0] = [_t("talk", null, "menu"), '_g("talk&id=' + e + '")'],
                        s = !1),
                        2 != g.npc[e].type && 3 != g.npc[e].type || (i[0] = [_t("attack", null, "menu"), '_g("fight&a=attack&ff=1&id=-' + e + '")']),
                        2 != g.npc[e].type && 3 != g.npc[e].type || (i[1] = [_t("attack_turn", null, "menu"), '_g("fight&a=attack&id=-' + e + '")']),
                        5 == g.npc[e].type && (i[0] = [1 == g.npc[e].wt ? _t("run", null, "menu") : _t("lookat", null, "menu"), '_g("talk&id=' + e + '")'],
                        s = !1),
                        isset(g.npc[e].e2jmp) && 1 == g.npc[e].e2jmp && (i.push([_t("e2jump_over", null, "menu"), '_g("e2jmp&x=' + g.npc[e].x + "&y=" + g.npc[e].y + '")']),
                        s = !1),
                        s)
                            return hero.lvl < 25 && !g.party && 0 == g.npc[e].grp ? _g("fight&a=attack&id=-" + e + "&ff=1") : _g("fight&a=attack&id=-" + e);
                        g.talk.id || showMenu(t, i)
                    }
                }
            }
            )).mousedown((function(t) {
                return !1
            }
            )),
            4 != g.npc[k].type || "" != g.npc[k].tip && isset(g.npc[k].tip) || "" != g.npc[k].nick && isset(g.npc[k].nick) || $("#npc" + k).mouseenter((function() {
                _areaRegStorage.registerArea($(this).attr("id").substr(3))
            }
            )),
            4 != t[k].type && 7 != t[k].type && (t[k].walkover || (g.npccol[t[k].x + 256 * t[k].y] = !0,
            hero.checkNPCRoadCollision(t[k].x, t[k].y))),
            g.npc[k].imgload = function() {
                var t = checkActionExist(this.icon);
                this.imgStatus = !0,
                this.fw = this.img.width / t,
                this.fh = this.img.height;
                var i = 32 * this.x + 16 - Math.round(this.fw / 2) + (this.type > 3 && !(this.fw % 64) ? -16 : 0)
                  , s = Math.round(this.x) + 256 * Math.round(this.y)
                  , a = 0;
                isset(map) && isset(map.water[s]) && (a = map.water[s] / 4),
                $("#npc" + this.id).css({
                    backgroundImage: "url(" + this.img.src + ")",
                    left: i,
                    top: 32 * this.y + 32 - this.fh + 0,
                    width: i + this.fw > 32 * map.x ? 32 * map.x - i : this.fw,
                    height: this.fh - (a > 8 ? 4 * (a - 8) : 0)
                }).removeClass("nodef"),
                4 == this.type && $("#npc" + this.id).css({
                    "pointer-events": "none",
                    top: 32 * this.y + 32 - this.fh,
                    height: this.fh
                }),
                delete this.img,
                isset(g.checklist["npc" + this.id]) && g.checklist["npc" + this.id](this),
                g.talk.insideDialogSynchroId == this.id && initiateNpcInsideDialog(this.id),
                g.talk.dialogCloud == this.id && createDialogCloud(this.id),
                e && $("#npc" + this.id).append(e),
                this.id.match(/23085|21933|22310|21952|22172|17176/) && !__tutorials.val && (Highlighter.startH.synchroStart("npc"),
                Highlighter.startH.npcId = this.id)
            }
            ,
            g.npc[k].img = new Image,
            $(g.npc[k].img).on("load", $.proxy(g.npc[k], "imgload")).on("error", (function() {
                log($(this).attr("src"), 2)
            }
            )).attr({
                src: g.npc[k].icon
            }),
            questTrack.checkTaskNpc(k)
        }
    }
}
function checkActionExist(t) {
    var e = new RegExp(/_s_(.*?)_e_/g).exec(t);
    if (!e)
        return 1;
    if (e.length > 2)
        return console.warn("multiple declaration", t),
        1;
    for (var i = e[1], s = 0; s < i.length; s++) {
        var a = i[s]
          , r = parseInt(a);
        if (!Number.isInteger(r))
            return console.warn("argument is not integer"),
            1
    }
    return 5
}
var _areaRegStorage = new function() {
    this.activeAreas = [],
    this.registerArea = function(t) {
        this.activeAreas.indexOf(t) >= 0 || isset(g.npc[t]) && (this.activeAreas.push(t),
        this.fadeObject(t))
    }
    ,
    this.unregisterArea = function(t) {
        this.activeAreas.splice(this.activeAreas.indexOf(t), 1),
        $("#npc" + t).css("pointer-events", "auto"),
        $("#npc" + t).stop(!0).animate({
            opacity: 1
        }, 200)
    }
    ,
    this.fadeObject = function(t) {
        $("#npc" + t).css("pointer-events", "none"),
        $("#npc" + t).stop(!0).animate({
            opacity: .5
        }, 200)
    }
    ,
    this.checkAreas = function(t) {
        for (var e = [], i = 0; i < this.activeAreas.length; i++)
            this.isMouseInArea(t, this.activeAreas[i]) || e.push(this.activeAreas[i]);
        for (i = 0; i < e.length; i++)
            this.unregisterArea(e[i])
    }
    ,
    this.isMouseInArea = function(t, e) {
        var i = $("#npc" + e).offset()
          , s = g.npc[e];
        return !(t.clientX < i.left || t.clientX > i.left + s.fw || t.clientY < i.top || t.clientY > i.top + s.fh)
    }
}
;
function deleteFromEqItems(t) {
    var e;
    t.cl > 0 && t.cl < 4 && (e = "weapon"),
    t.cl > 5 && t.cl < 8 && (e = "magic"),
    null == e && (e = t.cl);
    var i = g.eqItems[e];
    i && i == t && delete g.eqItems[e]
}
function getHItems() {
    return g.hItems
}
function deleteFromHItems(t) {
    delete g.hItems[t.id]
}
function newItem(t) {
    var e = !1;
    for (var i in t) {
        var s = null;
        if ("v" != t[i].loc || !adventCallendar.checkItem(t[i], i)) {
            if (isset(g.item[i])) {
                var a = "a" === t[i].loc && "g" === g.item[i].loc
                  , r = $("#item" + i).attr("tpos");
                if (!isNaN(r))
                    (p = "true" == $("#item" + i).attr("mine")) ? (g.trade.myval -= g.item[i].pr,
                    $("#mytr_value").html(round(g.trade.myval)),
                    g.trade.myitems &= ~(1 << r)) : (g.trade.val -= g.item[i].pr,
                    $("#tr2_value").html(round(g.trade.val)),
                    g.trade.items &= ~(1 << r));
                if (isset(t[i].del) && isset(g.item[i]) && "x" == g.item[i].loc && waitItemManage.remove(i),
                a ? $("#bag #item" + i).remove() : $('[id="item' + i + '"]').remove(),
                0 != g.item[i].st || "g" != g.item[i].loc || isset(g.item[i].returned) || g.bags[Math.floor(g.item[i].y / 6)][1]--,
                s = isset(g.item[i].initLvl) ? g.item[i].initLvl : null,
                isset(g.item[i].returned) && delete g.item[i].returned,
                ("d" == g.item[i].loc || "c" == g.item[i].loc) && isset(g.depo.tmpDropMatrix[g.item[i].x]) && isset(g.depo.tmpDropMatrix[g.item[i].x][g.item[i].y]) && delete g.depo.tmpDropMatrix[g.item[i].x][g.item[i].y],
                g.bagsPlaces.remove(7 * g.item[i].y + g.item[i].x),
                "g" == g.item[i].loc && (g.itemsMovedManager.removeItem(i),
                deleteFromEqItems(g.item[i]),
                deleteFromHItems(g.item[i]),
                isset(g.crafting))) {
                    var n = parseInt(i);
                    g.crafting.enhancement && (g.crafting.enhancement.selectedEnhanceItem === n && g.item[i].st !== t[i].st && g.crafting.enhancement.clearAll(n),
                    g.crafting.enhancement.enchant.selectedInventoryItems.includes(n) && g.crafting.enhancement.enchant.onReagentDelete(n)),
                    g.crafting.salvage && g.crafting.salvage.selectedInventoryItems.includes(n) && g.crafting.salvage.onReagentDelete(n)
                }
                delete g.item[i]
            }
            if (!isset(t[i].del) && (isset(t[i].name) && (t[i].name = parseItemBB(t[i].name, !0)),
            "g" != t[i].loc || t[i].own == hero.id)) {
                switch (t[i].id = i,
                t[i].readyToAction = !0,
                t[i].tip = itemTip(t[i], !0),
                g.item[i] = t[i],
                g.item[i].$item = createItem(t[i], t[i].tip),
                null !== s && (g.item[i].initLvl = s),
                t[i].loc) {
                case "r":
                    g.itemRecovery.addItem(t[i]);
                    break;
                case "q":
                    (o = createItem(t[i])).addClass("rewitem" + i),
                    $(".rew_item_" + i).append(o);
                    break;
                case "m":
                    var o = createItem(t[i]);
                    $("#base").append(o),
                    $("#item" + i).css({
                        left: 32 * t[i].x,
                        top: 32 * t[i].y,
                        zIndex: getLayerOrder(t[i].y, 1)
                    }).click((function(t) {
                        hero.mClick(t)
                    }
                    ));
                    break;
                case "g":
                    isset(g.itemRecovery) && g.itemRecovery.removeItem(i),
                    newEquip(t[i]),
                    isset(g.bonusReselectWindow) && g.bonusReselectWindow.selectedItem == i && g.bonusReselectWindow.afterUpdateSelectedItem(t[i]),
                    isset(g.crafting) && isset(g.crafting.enhancement) && g.crafting.enhancement.selectedEnhanceItem == i && g.crafting.enhancement.afterUpdateEnhanceItem(t[i]);
                    break;
                case "n":
                    break;
                case "t":
                    var l = (p = hero.id == t[i].own) ? "_g('trade&a=del&tid=" + i + "')" : "clickItem(this," + i + ")";
                    (o = createItem(t[i])).attr({
                        onClick: l,
                        "data-id": i
                    }),
                    $("#" + (p ? "mytr" : "tr2") + "_items").append(o);
                    for (var c = 0; c < 10; c++)
                        if (!((p ? g.trade.myitems : g.trade.items) & 1 << c)) {
                            var h = c % 5
                              , m = c > 4 ? 1 : 0;
                            p ? g.trade.myitems |= 1 << c : g.trade.items |= 1 << c,
                            $("#item" + i).css({
                                left: 33 * h,
                                top: 33 * m
                            }).attr("tpos", c).attr("mine", p);
                            break
                        }
                    p ? (g.trade.myval += t[i].pr,
                    $("#mytr_value").html(round(g.trade.myval, 3))) : (g.trade.val += t[i].pr,
                    $("#tr2_value").html(round(g.trade.val, 3)));
                    break;
                case "s":
                    var p;
                    l = (p = hero.id == t[i].own) ? "_g('trade&a=del&sid=" + i + "')" : "clickItem(this," + i + ")";
                    (o = createItem(t[i])).addClass("trshow_item"),
                    o.attr("onClick", l),
                    $("#" + (p ? "mytr" : "tr2") + "_sitems").append(o),
                    $("#item" + i).attr("mine", p);
                    break;
                case "b":
                    $("#mailatt" + i).html(createItem(t[i]));
                    break;
                case "$":
                    codeManager.addItem(g.item[i]),
                    e = !0;
                    break;
                case "d":
                case "c":
                    $("#depo-items").append(createItem(t[i])),
                    isset(g.depo.tmpDropMatrix[t[i].x]) || (g.depo.tmpDropMatrix[t[i].x] = {}),
                    g.depo.tmpDropMatrix[t[i].x][t[i].y] = i,
                    $("#item" + i).css({
                        left: 33 * t[i].x,
                        top: 33 * t[i].y
                    }).click((function() {
                        depoGet(this)
                    }
                    )).draggable({
                        helper: "clone",
                        cancel: ".disable-item-mark",
                        appendTo: "body",
                        cursorAt: {
                            top: 16,
                            left: 16
                        },
                        zIndex: 450,
                        containment: [0, 0, g.maxx - 32, g.maxy - 32],
                        start: function(t, e) {
                            g.depo.drag = !0,
                            g.mouseMove.enabled = !1,
                            Tip.disable(),
                            $(this).css("opacity", .7)
                        },
                        stop: function(t, e) {
                            g.mouseMove.enabled = !0,
                            g.depo.drag = !1,
                            clearTimeout(g.depo.sectionActivateTimeout),
                            Tip.enable(),
                            $(this).css("opacity", 1);
                            var i = t.clientX - g.left
                              , s = t.clientY - g.top
                              , a = this.id.substr(4);
                            if (i >= g.drops.dpx && i <= g.drops.dpx2 && s >= g.drops.dpy && s <= g.drops.dpy2) {
                                var r = Math.min(13, Math.floor((i - g.drops.dpx) / 33))
                                  , n = Math.min(7, Math.floor((s - g.drops.dpy) / 33));
                                g.depo.clan ? _g("clan&a=depo&op=item_move&id=" + a + "&x=" + (r + 14 * (g.depo.section - 1)) + "&y=" + n) : _g("depo&move=" + a + "&x=" + (r + 14 * (g.depo.section - 1)) + "&y=" + n)
                            }
                            if (i >= g.drops.bx && i <= g.drops.bx2 && s >= g.drops.by && s <= g.drops.by2) {
                                r = Math.min(6, Math.floor((i - g.drops.bx) / 33)),
                                n = Math.min(5, Math.floor((s - g.drops.by) / 33)) + 6 * g.bag;
                                g.depo.clan ? _g("clan&a=depo&op=item_get&id=" + a + "&x=" + r + "&y=" + n) : _g("depo&get=" + a + "&x=" + r + "&y=" + n)
                            }
                        }
                    });
                    break;
                case "x":
                    waitItemManage.add(i);
                    break;
                case "v":
                    adventCallendar.addItem(i, t[i].x + 6 * t[i].y);
                    break;
                case "k":
                case "l":
                    "fight" == g.loots.source ? lootItem(t[i]) : lootboxItem(t[i]);
                    break;
                case "e":
                    ingameRegistration.addItem(i);
                    break;
                case "u":
                    g.crafting.enhancement.newReceivedItem(t[i]);
                    break;
                case "a":
                    g.auctions && g.auctions.getAuctionItems().newReceivedItem(t[i]);
                    break;
                case "j":
                    g.crafting.extraction.newReceivedItem(t[i])
                }
                var d, u, f = [];
                if (addHClassesToHClass(c = g.item[i], f),
                (g.highlightedItems.indexOf(c.id) < 0 && c.initLvl > 4 && "g" == c.loc || isset(c.nn) && 1 == c.nn) && 25 != c.cl && (f.push("new"),
                g.highlightedItems.push(c.id),
                Math.floor(c.y / 6) != parseInt(g.bag) && ($("[bag=" + Math.floor(c.y / 6) + "]").find(".itemHighlighter").length || $("[bag=" + Math.floor(c.y / 6) + "]").prepend('<div class="itemHighlighter new"></div>'))),
                delete c.nn,
                isset(c.moved) && delete c.moved,
                f.length && "r" != c.loc && !(24 == c.cl && "g" == c.loc && c.st >= 20)) {
                    var v = $('<div class="itemHighlighter ' + f.join(" ") + " " + (4096 & hero.opt ? "nodisp" : "") + '"></div>');
                    $("#item" + c.id).mouseenter((function() {
                        $(this).find(".itemHighlighter.new").removeClass("new")
                    }
                    )),
                    $("#item" + c.id).prepend(v),
                    g.item[i].$item.prepend(v.clone())
                }
                if (21 == t[i].cl)
                    if (null !== (k = t[i].stat.match(/ammo=([0-9]+)/))) {
                        var y = parseInt(k[1]) <= 50 ? "#780000" : null;
                        updateItemAmount($("#item" + i), k[1]),
                        null != y && "g" == t[i].loc && ($("#item" + i).css("background-color", y),
                        g.item[i].$item.css("background-color", y))
                    }
                if (18 == t[i].cl && t[i].stat.match(/expires=([0-9]+)/) && "g" == t[i].loc) {
                    var k = t[i].stat.match(/expires=([0-9]+)/);
                    parseInt(k[1]) - unix_time() < 259200 && ($("#item" + i).css("background-color", "#780000"),
                    g.item[i].$item.css("background-color", "#780000"))
                }
                if (t[i].stat.match(/timelimit=([0-9]+)/) && $("#item" + i).mouseover((function() {
                    var t = $(this).attr("id").substr(4);
                    $("#item" + t).attr("tip", itemTip(g.item[t])),
                    g.item[i].$item.attr("tip", itemTip(g.item[t]))
                }
                )),
                t[i].stat.match(/expires=([0-9]+)/))
                    $("#item" + i).mouseenter((function() {
                        var t = $(this).attr("id").substr(4);
                        $("#item" + t).attr("tip", itemTip(g.item[t])),
                        d = setInterval((function() {
                            $("#item" + t).attr("tip", itemTip(g.item[t]))
                        }
                        ), 1e3)
                    }
                    )),
                    $("#item" + i).mouseleave((function() {
                        clearInterval(d)
                    }
                    ));
                if ("m" != t[i].loc && t[i].tip.indexOf("noammo") > 0 && $("#item" + i).css("backgroundColor", "#a00"),
                (u = t[i].stat.match(/amount=([0-9]+)/)) && u[1] > 0 && 10 != t[i].st && updateItemAmount($("#item" + i), u[1]),
                /cursed/.test(t[i].stat))
                    (!(u = t[i].stat.match(/amount=([0-9]+)/)) || u && parseInt(u[1]) <= 0) && ($("#item" + i).css("backgroundColor", "#a00"),
                    g.item[i].$item.css("backgroundColor", "#a00"));
                if (24 == t[i].cl && "g" == t[i].loc && t[i].st >= 20) {
                    var b = t[i].stat.match(/bag=([0-9]+)/);
                    b = parseInt(b[1]),
                    g.bags[t[i].st - 20][0] = b,
                    updateItemAmount($("#item" + i), b - g.bags[t[i].st - 20][1], {
                        id: "bs" + (t[i].st - 20)
                    }),
                    updateItemAmount(g.item[i].$item, b - g.bags[t[i].st - 20][1], {
                        id: "bs" + (t[i].st - 20)
                    })
                } else
                    0 == t[i].st && "g" == t[i].loc && g.bags[Math.floor(t[i].y / 6)][1]++;
                $("#item" + i + ", .rewitem" + i).append('<img src="img/def-item.gif?v='.concat(_CLIENTVER, '" class="imhdefolder" />')),
                g.item[i].$item.append('<img src="img/def-item.gif?v='.concat(_CLIENTVER, '" class="imhdefolder" />')),
                loadImg("itemy/" + t[i].icon, i, (function() {
                    var t = $(this).attr("dest");
                    $("#item" + t + " .imhdefolder, .rewitem" + t + " .imhdefolder").remove(),
                    $("#item" + t + ", .rewitem" + t).append(this),
                    g.item[t].$item.find(".imhdefolder").remove(),
                    g.item[t].$item.append($(this).clone())
                }
                )),
                isset(g.ah.synchroItems[i]) && delete g.ah.synchroItems[i]
            }
        }
    }
    updateBags(),
    e && codeManager.updateItems(),
    g.bagsPlaces.onItemsUpdated()
}
function clickItem(t, e) {
    showMenuItem(g.item[e], $(t))
}
function updateItemAmount(t, e, i) {
    var s = t.find("small");
    if (!s.length) {
        if (s = $("<small></small>").css("opacity", .5),
        isset(i))
            for (var a in i)
                s.attr(a, i[a]);
        t.append(s)
    }
    e = "string" == typeof e && e.includes(":") ? "" : roundShorten(e),
    s.html(e)
}
function setItemType(t, e, i) {
    t.itemTypeSort = i,
    t.itemTypeName = e
}
function addHClassesToHClass(t, e) {
    var i = {
        heroic: ["t_her", 2],
        upgraded: ["t_upg", 3],
        elite: ["t_uni", 1],
        unique: ["t_uni", 1],
        legendary: ["t_leg", 4],
        artefact: ["t_art", 5],
        common: ["t_norm", 0]
    }
      , s = parseItemStat(t.stat);
    if (isset(s.rarity)) {
        var a = s.rarity
          , r = _slicedToArray(i[a], 2)
          , n = r[0]
          , o = r[1];
        e.push(n),
        setItemType(t, a, o)
    } else
        for (var l in setItemType(t, "common", 0),
        i)
            if (isset(s[l])) {
                var c = _slicedToArray(i[l], 2)
                  , g = c[0]
                  , h = c[1];
                e.push(g),
                setItemType(t, l, h);
                break
            }
}
function updateBags() {
    for (var t = 0, e = 0; e < g.bags.length; e++)
        if (g.bags[e] && g.bags[e][0]) {
            var i = g.bags[e][0] - g.bags[e][1]
              , s = i < 0 ? 0 : i;
            e !== g.bags.length - 1 && (t += s),
            $("#bs" + e).html(s)
        }
    g.freeSlots = t,
    g.loots && lootsUpdateFreeBagSlots()
}
function callSuperMarket() {
    $.ajax({
        url: "https://www.margonem.pl/ajax/shopapi.php?tids=&prof=" + hero.prof + "&lvl=" + hero.lvl,
        type: "POST",
        dataType: "json",
        xhrFields: {
            withCredentials: !0
        },
        crossDomain: !0,
        success: function(t) {
            if (null != t) {
                if (t.alsoBuyList,
                t.hotList,
                t.suggestedList)
                    for (var e = 0, i = $("#shop_sell"), s = t.suggestedList, a = 0; a < s.length; a++) {
                        var r = s[a];
                        if (isset(g.superMarketItems[r])) {
                            if (e > 8)
                                return;
                            newSuperMargetItems(i, g.superMarketItems[r], e),
                            e++
                        }
                    }
            } else
                $("#for-you-plug-disabled").css("display", "block")
        }
    })
}
function isSuperMarketEqItem(t) {
    var e = t.cl;
    return e < 15 || 21 == e || 22 == e || 24 == e
}
function newSuperMargetItems(t, e, i) {
    var s = Math.floor(i / 3)
      , a = i - 3 * s
      , r = $("#item" + e.id).clone();
    r.attr("id", "#for-you-item" + e.id),
    r.css({
        display: "block",
        left: 14 + 51 * a + a,
        top: 53 * s - 23 + s
    }).appendTo(t),
    r.find("img").attr("src", CFG.ipath + e.icon),
    r.click((function() {
        shop_buy($("#item" + e.id))
    }
    ))
}
function eqItemsTable(t) {
    var e;
    0 == t.st || t.cl > 14 && 25 != t.cl && 21 != t.cl || (t.cl > 0 && t.cl < 4 && (e = "weapon"),
    t.cl > 5 && t.cl < 8 && (e = "magic"),
    null == e && (e = t.cl),
    g.eqItems[e] = t)
}
function hItemsTable(t) {
    g.hItems[t.id] = t
}
function getItemBySlotCords(t, e) {
    for (var i in g.hItems) {
        var s = g.hItems[i];
        if (!(s.st > 0) && (s.x == t && s.y == e))
            return s
    }
    return !1
}
function checkBonusReselect(t, e, i, s) {
    var a = parseItemStat(t.stat)
      , r = parseItemStat(e.stat);
    return !(!isset(a.bonus_reselect) || !isset(r.bonus)) && (movedOnItemConfirm(_t("bonus_reselect_confirm", {
        "%val%": e.name
    }), t.id, i, s),
    !0)
}
function checkEnhancementAdd(t, e, i, s) {
    var a = parseItemStat(t.stat);
    return !!((isset(a.enhancement_add) || isset(a.enhancement_add_point)) && e.cl >= 1 && e.cl <= 14) && (this.movedOnItemConfirm(_t("enhancement_add_confirm"), t.id, i, s),
    !0)
}
function movedOnItemConfirm(t, e, i, s) {
    mAlert(t, 2, [function() {
        return moveItemSafe(e, "st=0&x=" + i + "&y=" + s),
        !0
    }
    , function() {
        return !0
    }
    ])
}
function newEquip(t) {
    eqItemsTable(t),
    hItemsTable(t),
    t.st && t.st < 11 ? ($("#panel").append(createItem(t)),
    $("#item" + t.id).css({
        left: eq.wx[t.st - 1] + 18,
        top: eq.wy[t.st - 1] + 111
    })) : t.st > 19 ? ($("#panel").append(createItem(t)),
    $("#item" + t.id).css({
        left: 25 + 33 * (t.st - 20),
        top: 469
    }).attr("bag", t.st - 20).click((function(t) {
        $(this).find(".itemHighlighter").removeClass("new"),
        g.bag = $(this).attr("bag"),
        $("#hlbag").css({
            left: 25 + 33 * g.bag
        }),
        $("#bag").css({
            top: -198 * g.bag
        })
    }
    ))) : ($("#bag").append(createItem(t)),
    g.bagsPlaces.add(7 * t.y + t.x),
    $("#item" + t.id).css({
        left: 33 * t.x,
        top: 33 * t.y
    }).click((function(t) {
        itemIsDisabled($(this)) || (shop_sell(this),
        trade_sell(this),
        mailAtt(this),
        setAuctionOffItem($(this)),
        deposit(this),
        setBarterItem($(this)),
        setSalvageItem($(this)) || setEnhanceItem($(this)) || setExtractionItem($(this)) || setBonusReselectItem($(this)) || itemMenu("item", this, t))
    }
    )));
    var e = $("#item" + t.id);
    g.disableItemsManager.manageItemDisable(t, e),
    e.draggable({
        helper: "clone",
        appendTo: "body",
        distance: 10,
        cancel: ".disable-item-mark",
        cursorAt: {
            top: 16,
            left: 16
        },
        scroll: !1,
        zIndex: 450,
        containment: [0, 0, g.maxx - 32, g.maxy - 32],
        start: function(e, i) {
            if (isItemInSell(t.id))
                return !1;
            Tip.disable(),
            $(this).css("opacity", .7),
            g.mouseMove.enabled = !1
        },
        drag: function() {
            if (isItemInSell(t.id))
                return !1
        },
        stop: function(t, e) {
            g.mouseMove.enabled = !0,
            clearTimeout(g.depo.sectionActivateTimeout),
            Tip.enable(),
            $(this).css("opacity", 1);
            var i = t.clientX - g.left
              , s = t.clientY - g.top
              , a = this.id.substr(4);
            if (i >= g.drops.bx && i <= g.drops.bx2 && s >= g.drops.by && s <= g.drops.by2) {
                var r = Math.min(6, Math.floor((i - g.drops.bx) / 33))
                  , n = Math.min(5, Math.floor((s - g.drops.by) / 33)) + 6 * g.bag;
                if (g.item[a].stat.match(/amount|ammo/) && t.shiftKey) {
                    var o = parseItemStat(g.item[a].stat)
                      , l = 21 == g.item[a].cl ? o.ammo : o.amount;
                    if (l > 1)
                        return isset(o.capacity) || 21 == g.item[a].cl ? (g.split = [a, r, n, l],
                        void mAlert(_t("item_split %max%", {
                            "%max%": l - 1
                        }, "item"), 3, [function() {
                            if (isset(g.split)) {
                                var t = parseInt($('input[name="mAlertInput"]').val());
                                if (isNaN(t) || t >= g.split[3])
                                    return void setTimeout((function() {
                                        mAlert(_t("split_bad_value", null, "item"), 0)
                                    }
                                    ), 300);
                                t < 1 || moveItemSafe(g.split[0], "st=0&x=" + g.split[1] + "&y=" + g.split[2] + "&split=" + t)
                            }
                            delete g.split
                        }
                        , function() {
                            delete g.split
                        }
                        ])) : mAlert(_t("this_item_cant_split", null, "item"), 0)
                }
                if (0 != g.item[a].st || g.item[a].x != r || g.item[a].y != n) {
                    var c = getItemBySlotCords(r, n);
                    if (isItemInSell(c.id))
                        return;
                    if (c && "g" === g.item[a].loc && "g" === c.loc) {
                        if (checkBonusReselect(g.item[a], c, r, n))
                            return;
                        if (checkEnhancementAdd(g.item[a], c, r, n))
                            return
                    }
                    moveItemSafe(a, "st=0&x=" + r + "&y=" + n)
                }
            }
            if (i >= g.drops.ex && i <= g.drops.ex2 && s >= g.drops.ey && s <= g.drops.ey2) {
                var r = i - g.drops.ex;
                n = s - g.drops.ey;
                r < eq.wx[8] + 33 && n >= eq.wy[8] ? moveItemSafe(a, "st=9") : checkItemGoldLimitReach(a) || (g.item[a].cl < 15 || 16 == g.item[a].cl || 17 == g.item[a].cl || 18 == g.item[a].cl && /teleport=/.test(g.item[a].stat) || 21 == g.item[a].cl || 22 == g.item[a].cl || 23 == g.item[a].cl || 25 == g.item[a].cl ? moveItemSafe(a, "st=1") : mAlert(_t("cant_wera_this", null, "item")))
            }
            i >= g.drops.gx && i <= g.drops.gx2 && s >= g.drops.gy && s <= g.drops.gy2 && (((r = Math.min(6, Math.floor((i - g.drops.gx) / 33))) < 3 || 6 == r) && (g.item[a].stat.match(/bag=/) && (g.item[a].st < 20 || g.item[a].st > 26) && !g.item[a].stat.match(/soulbound/) ? mAlert(_t("bag_drop_infotxt", null, "item"), 2, [function() {
                moveItemSafe(a, "st=" + (20 + r) + "&put=1")
            }
            , function() {
                moveItemSafe(a, "st=" + (20 + r) + "&put=2")
            }
            ]) : moveItemSafe(a, "st=" + (20 + r))));
            if (i < 512 && g.trade.id)
                _g("trade&a=add&sid=" + a);
            else if (g.depo.vis && i >= g.drops.dpx && i <= g.drops.dpx2 && s >= g.drops.dpy && s <= g.drops.dpy2) {
                r = Math.min(13, Math.floor((i - g.drops.dpx) / 33)),
                n = Math.min(7, Math.floor((s - g.drops.dpy) / 33));
                g.depo.clan ? _g("clan&a=depo&op=item_put&id=" + a + "&x=" + (r + 14 * (g.depo.section - 1)) + "&y=" + n) : _g("depo&put=" + a + "&x=" + (r + 14 * (g.depo.section - 1)) + "&y=" + n)
            } else if (g.crafting.salvage)
                ;
            else if (g.crafting.enhancement)
                ;
            else if (g.crafting.extraction)
                ;
            else if (i < 512 && !g.lock.check())
                if ("ÅnieÅ¼ka" == g.item[a].name) {
                    var h = i + $("#base").scrollLeft() >> 5
                      , m = s + $("#base").scrollTop() >> 5;
                    for (var p in g.other)
                        g.other[p].x == h && g.other[p].y == m && _g("emo&a=snowball&id=" + p + "&iid=" + a)
                } else if (/emo=.*?/.test(g.item[a].stat)) {
                    var d = parseItemStat(g.item[a].stat);
                    h = i + $("#base").scrollLeft() >> 5,
                    m = s + $("#base").scrollTop() >> 5;
                    for (var p in g.other)
                        g.other[p].x == h && g.other[p].y == m && _g("emo&a=" + d.emo + "&id=" + p + "&iid=" + a)
                } else
                    /.*notakeoff.*/.test(g.item[a].stat) && 25 == g.item[a].cl && 10 == parseInt(g.item[a].st) ? mAlert(_t("cant_drop_spell", null, "item")) : 25 == g.item[a].cl && 10 == parseInt(g.item[a].st) ? mAlert(_t("drop_bless_question", null, "item"), 1, [function() {
                        moveItemSafe(a, "st=-2")
                    }
                    ]) : ("en" == _l() && $("#_t5, #_t8").css("display", "none"),
                    $("#dropmenu H3").html(g.item[a].name),
                    $("#dropmenu").attr("iid", a).absCenter().fadeIn())
        }
    }).dblclick((function(t) {
        if (!itemIsDisabled($(this)) && "block" != $("#trade").css("display") && "block" != $("#shop").css("display") && "block" != $("#mails").css("display") && "block" != $("#auctions").css("display")) {
            var e = this.id.substr(4);
            checkItemGoldLimitReach(e) || (16 == g.item[e].cl || 27 == g.item[e].cl || 23 == g.item[e].cl || 25 == g.item[e].cl && 0 == g.item[e].st) && moveItemSafe(e, "st=1")
        }
    }
    ))
}
function itemMenu(t, e, i) {
    var s;
    switch (t) {
    case "item":
        s = g.item;
        break;
    case "tplo":
        s = g.tplsManager.getItems().o;
        break;
    default:
        return void console.warn("bad item menu kind :" + t)
    }
    var a = "item" === t ? "item" : "tpl"
      , r = $(e).attr("id").replace(a, "")
      , n = "item" === t ? s[r].tpl : r;
    if (isset(s[r])) {
        var o = parseItemStat(s[r].stat);
        if (isset(o.play)) {
            var l = null
              , c = "";
            if ("object" == _typeof(soundManager.getSoundById("dialogSound" + r)))
                c = _t("turn_off", null, "item"),
                l = 'soundManager.destroySound("dialogSound' + r + '")';
            else {
                var h = o.play.split(",");
                c = isset(h[1]) ? h[1] : _t("use_it", null, "item"),
                l = 'soundManager.destroySound("dialogSound' + r + '"); soundManager.createSound({id:"dialogSound' + r + '",url: "' + h[0] + '",autoPlay: true})'
            }
            showMenu(i, [[c, l, !0]])
        }
        if (isset(o.furniture) && showMenu(i, [[_t("use_furniture", null, "item"), "_fc.init(" + r + ")", !0]]),
        isset(o.canpreview)) {
            l = '_g("moveitem&st=2&tpl=' + n + '"); g.tplsManager.deleteMessItemsByLoc("p"); g.tplsManager.deleteMessItemsByLoc("s");';
            var m = 'moveItemSafe("' + r + '" , "st=1");'
              , p = [];
            "item" == t && p.push([_t("use_it", null, "item"), m, !0]),
            p.push([_t("show", null, "item"), l, !0]),
            showMenu(i, p)
        }
        if (isset(o.bonus_not_selected)) {
            l = '_g("moveitem&st=2&id='.concat(r, '")');
            showMenu(i, [[_t("select_bonus", null, "item"), l, !0]])
        }
    }
}
showMenuItem = function(t, e) {
    if (isset(parseItemStat(t.stat).canpreview)) {
        var i = '_g("moveitem&st=2&id=' + t.id + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
        showMenu({
            target: e
        }, [[_t("show", null, "item"), i, !0]])
    }
}
;
var _fc = new function() {
    var t = ["/img/meble_test/m-dywan.gif", 0, null]
      , e = null
      , i = null
      , s = [null, null]
      , a = [0, 0]
      , r = this;
    this.init = function(e) {
        i && (i.remove(),
        i = null);
        var s = new Image;
        s.src = t[0],
        $("#centerbox").append($("<div class=furnitureArea></div>").css({
            width: 512,
            height: $("#base").scrollTop() > 0 ? 544 : 512,
            top: $("#base").scrollTop() > 0 ? -16 : 0
        })),
        s.onload = function() {
            a = [this.width, this.height],
            (i = $('<div class="furnitureIcon init"></div>').css({
                "background-image": "url(" + t[0] + ")",
                width: a[0],
                height: a[1],
                top: 224,
                left: 224
            })).appendTo("#centerbox .furnitureArea"),
            r.config(),
            g.lock.add("furniture")
        }
    }
    ,
    this.config = function() {
        if (e = {},
        t[2])
            for (var s = t[2].split(","), n = 0; n < s.length; n++)
                e[s[n]] = 1;
        else {
            var o = a[0] / 32 * (a[1] / 32);
            for (n = 0; n < o; n++)
                e[n % (a[0] / 32) + "x" + Math.floor(n / (a[0] / 32))] = 1
        }
        i.draggable({
            grid: [32, 32],
            containment: "parent",
            start: function() {
                i.removeClass("init")
            },
            drag: function() {
                r.checkCol()
            },
            stop: function() {
                r.accept(),
                r.reset()
            }
        });
        var l = $(".furnitureArea").width() / 32
          , c = $(".furnitureArea").height() / 32
          , h = new Array(l * c)
          , m = map.col;
        for (var n in g.npc)
            h[g.npc[n].x - map.offset[0] + (g.npc[n].y - map.offset[1]) * l] = 1;
        for (var p = 0; p < c; p++)
            for (var d = 0; d < l; d++)
                "1" != m.charAt((p + map.offset[1]) * map.x + d + map.offset[0]) && 1 !== h[d + p * l] || $(".furnitureArea").append($('<div id="fCol_' + d + "x" + p + '" class=blocker></div>').css({
                    top: 32 * p,
                    left: 32 * d
                }))
    }
    ,
    this.checkCol = function() {
        for (var t in s = [parseInt(i.css("left")) / 32, parseInt(i.css("top")) / 32],
        $(".furnitureArea .blocker").removeClass("active"),
        !1,
        e) {
            var a = t.split("x")
              , r = "#fCol_" + (parseInt(a[0]) + s[0]) + "x" + (parseInt(a[1]) + s[1]);
            $(r).length && (!0,
            $(r).addClass("active"))
        }
    }
    ,
    this.accept = function() {}
    ,
    this.reset = function() {
        $("#centerbox .furnitureArea").remove(),
        g.lock.remove("furniture")
    }
}
;
function Pet(t, e) {
    this.domElement = $(document.createElement("div")).addClass("pet").appendTo("#base").attr("ctip", "t_npc"),
    this.master = e,
    this.fw = 32,
    this.fh = 48,
    this.step = 0,
    this.moving = !1,
    this.stepIteration = 0,
    this.dir = 0,
    this.pos = 0,
    this.stop = !1,
    this.actionInterval = null;
    var i = this;
    this.doAction = __doAction,
    this.frameActions = [],
    this.stopAction = function(t) {
        clearInterval(this.actionInterval),
        this.actionInterval = null,
        this.stop = void 0 === t || !t
    }
    ,
    this.update = function(t, e) {
        if (isset(t)) {
            var s = !0;
            isset(this.outfit) && this.outfit != t.outfit && (s = !1);
            var a = !1;
            for (var r in t)
                "outfit" != r || isset(this.outfit) && this.outfit == t[r] || (a = !0),
                this[r] = t[r];
            if (isset(t.outfit) && a) {
                this.stopAction(!0);
                var n = new Image
                  , o = new RegExp("-([0-9]+)(a?).gif").exec(this.outfit);
                o || (o = [0, 0, ""]),
                this.auxFrames = isNaN(parseInt(o[1])) ? 0 : parseInt(o[1]),
                this.anim = "a" == o[2];
                var l = "/" != this.outfit.substr(0, 1) ? "/" + this.outfit : this.outfit;
                n.src = CFG.ppath + l,
                n.onload = function() {
                    i.fw = this.width / (4 + i.auxFrames + (i.anim ? 1 : 0)),
                    i.fh = this.height / 4,
                    i.domElement.css({
                        width: i.fw,
                        height: i.fh,
                        "background-image": "url(" + CFG.ppath + l + ")"
                    })
                }
            }
            if (isset(t.name)) {
                this.stopAction(!0);
                var c = "<b>" + t.name + "</b>";
                if (isset(t.elite) && t.elite) {
                    var g = null;
                    switch (parseInt(t.elite)) {
                    case 1:
                        g = _t("elite", null, "pet");
                        break;
                    case 2:
                        g = _t("elite_her", null, "pet");
                        break;
                    case 3:
                        g = _t("elite_leg", null, "pet")
                    }
                    null !== g && (c += '<i class="elite cls_' + t.elite + '">' + g + "</i>")
                }
                c += '<span style="color:#888">' + _t("owner %name%", {
                    "%name%": this.master.nick
                }, "pet") + "</span>",
                this.domElement.attr("tip", c)
            }
            if (isset(t.actions)) {
                var h = t.actions.split("|");
                for (var m in this.frameActions = [],
                h) {
                    var p = h[m].split("#");
                    this.frameActions.push({
                        name: p[0],
                        special: isset(p[1]) ? parseInt(p[1]) : 3
                    })
                }
            }
            if (isset(t.action)) {
                isset(t.actions) || (this.frameActions = []);
                var d = getHalfByte(t.action, 0);
                !isset(e) && this.pos == d && s && this.doAction(),
                this.pos = d,
                this.move()
            }
        }
        this.calculatePosition(isset(e) && e)
    }
    ,
    this.calculatePosition = function(t) {
        if (null != this.master) {
            var e = this.x
              , i = this.y
              , s = {
                1: [0, -1],
                2: [1, 0],
                3: [0, 1],
                4: [-1, 0]
            }
              , a = this.master;
            if (t || !t && Math.abs(a.x - this.x) + Math.abs(a.y - this.y) > 1 || this.pos) {
                var r = a.x + (1 == a.dir || 2 == a.dir ? 1 * (2 == a.dir ? -1 : 1) : 0)
                  , n = a.y + (0 == a.dir || 3 == a.dir ? 1 * (0 == a.dir ? -1 : 1) : 0);
                this.pos && isset(s[this.pos]) && (r = a.x + s[this.pos][0],
                n = a.y + s[this.pos][1]),
                (!map.loaded || !(r >= 0 && n >= 0 && r < map.x && n < map.y) || isset(g.npccol[r + 256 * n]) || "0" != map.col.charAt(r + n * map.x) && "" != map.col.charAt(r + n * map.x)) && (r = a.x,
                n = a.y),
                this.x = r,
                this.y = n,
                t && (this.rx = r,
                this.ry = n),
                (e != this.x || this.y != i && !t) && this.stopAction(!0)
            }
        }
    }
    ,
    this.remove = function() {
        this.domElement.remove()
    }
    ,
    this.domElement.click((function(t) {
        if (i.own) {
            var e = new Array;
            isset(i.quest) && i.quest ? e.push([_t("menu_hide", null, "pet"), "hideMyPet(true)"]) : e.push([_t("menu_hide", null, "pet"), "hideMyPet()"]);
            for (var s = 0; s < i.frameActions.length; s++) {
                var a = 1 + s << 4 | i.frameActions[s].special << 8;
                e.push([i.frameActions[s].name, '_g("pet&a=' + a + '")'])
            }
            for (s = 1; s <= 5; s++)
                if (s != i.pos && (5 != s || 0 != i.pos)) {
                    var r = "";
                    switch (s) {
                    case 5:
                        r = _t("menu_comeafter", null, "pet");
                        break;
                    case 1:
                        r = _t("menu_standbehind", null, "pet");
                        break;
                    case 2:
                        r = _t("menu_standright", null, "pet");
                        break;
                    case 3:
                        r = _t("menu_standfront", null, "pet");
                        break;
                    case 4:
                        r = _t("menu_standleft", null, "pet")
                    }
                    e.push([r, '_g("pet&a=' + s + '")'])
                }
            showMenu(t, e)
        }
    }
    )),
    this.run = function() {
        var t = this.rx
          , e = this.ry;
        if (this.x > this.rx && (this.rx += .25,
        this.dir = 2),
        this.x < this.rx && (this.rx -= .25,
        this.dir = 1),
        this.y > this.ry && (this.ry += .25,
        this.dir = 0),
        this.y < this.ry && (this.ry -= .25,
        this.dir = 3),
        this.x - this.rx > 2 && (this.rx = this.x - 2),
        this.y - this.ry > 2 && (this.ry = this.y - 2),
        this.x - this.rx < -2 && (this.rx = this.x + 2),
        this.y - this.ry < -2 && (this.ry = this.y + 2),
        t != this.rx || e != this.ry) {
            var i = 0;
            this.x != this.rx ? (i = Math.abs(this.x - this.rx),
            i -= parseInt(i)) : this.y != this.ry && (i = Math.abs(this.y - this.ry),
            i -= parseInt(i)),
            this.moving = !0,
            this.step = Math.floor(4 * this.stepIteration),
            this.stepIteration += .125,
            this.stepIteration >= 1 && (this.stepIteration = 0)
        } else
            this.step = 0,
            this.moving = !1
    }
    ,
    this.move = function() {
        if (!this.stop) {
            this.run();
            var t = Math.round(this.rx) + 256 * Math.round(this.ry)
              , e = 0;
            isset(map) && isset(map.water[t]) && (e = map.water[t]);
            var s = 32 * map.x
              , a = 32 * i.rx + 16 + (i.fw >> 1);
            this.domElement.css({
                left: 32 * i.rx + 16 - (i.fw >> 1),
                top: 32 * i.ry + 32 - i.fh + (e / 4 > 8 ? 0 : e),
                zIndex: getLayerOrder(i.y, 9),
                width: a > s ? i.fw + (s - a) : i.fw,
                backgroundPosition: -(i.step + (i.anim && i.moving ? 1 : 0)) * i.fw + "px " + -i.dir * i.fh + "px",
                height: i.fh - (e / 4 > 8 ? e - 32 : e)
            })
        }
    }
}
function PetStore(t) {
    this.domElement = $(document.createElement("div")).addClass("pet").attr("tip", _t("click_to_show_special_actions", null, "pet")),
    this.stop = !1,
    this.actionInterval = null,
    this.demoInterval = null,
    this.actionsList = [],
    this.outfit = 0,
    this.wait = 0,
    this.actionFrame = 0;
    var e = this;
    this.doAction = __doAction,
    this.specialAction = function(t, e) {
        this.action = t << 4 | (isset(e) && e ? e << 8 : 0),
        this.doAction(),
        this.wait = 5
    }
    ,
    this.stopAction = function() {
        clearInterval(this.actionInterval),
        this.actionInterval = null,
        this.stop = !1
    }
    ,
    this.startDemo = function() {
        this.demoInterval = setInterval((function() {
            if (null === e.actionInterval)
                if (e.wait > 0)
                    e.wait--;
                else {
                    0 == e.wait && (e.outfit = 0,
                    e.wait = -1),
                    e.outfit = e.outfit + 1 & 15;
                    var t = (3 & e.outfit) * e.fw
                      , i = e.outfit >> 2;
                    2 == i ? i = 3 : 3 == i && (i = 2),
                    i *= e.fh,
                    e.domElement.css({
                        backgroundPosition: "-" + (t + (e.anim ? 1 : 0 * e.fw)) + "px -" + i + "px"
                    })
                }
        }
        ), 200)
    }
    ,
    this.init = function(t) {
        this.idx = t.idx;
        var i = t.stat.split(",")
          , s = i.pop().split("|");
        if (s.length)
            for (var a = 0; a < s.length; a++) {
                var r = {
                    action: a,
                    name: s[a].replace(/#.*/, ""),
                    special: 3
                }
                  , n = s[a].match(/#([0-9]*)/);
                n && isset(n[1]) && (r.special = parseInt(n[1])),
                e.actionsList.push(r)
            }
        var o = new Image
          , l = new RegExp("-([0-9]+)(a?).gif").exec(i[1]);
        this.anim = "a" == l[2],
        e.img = i[1],
        o.src = CFG.ppath + e.img,
        o.onload = function() {
            e.fw = this.width / (4 + e.actionsList.length + (e.anim ? 1 : 0)),
            e.fh = this.height / 4;
            var i = 58 * t.idx - (t.idx - 1)
              , s = 37.5 - e.fh / 2 + 3
              , a = 24 - e.fw / 2 + i;
            e.domElement.css({
                width: e.fw,
                height: e.fh,
                top: s,
                left: a,
                overflow: "hidden",
                "background-image": "url(" + CFG.ppath + e.img + ")"
            }),
            e.domElement.appendTo("#shop_sell");
            for (var r = [], n = 0; n < e.actionsList.length; n++) {
                var o = 1 + n
                  , l = e.actionsList[n].special;
                r.push([e.actionsList[n].name, "__doPreviewAction(" + t.idx + ", " + o + "," + l + "); return false;"])
            }
            if (r.length) {
                var c = $('<div class="petActionBox idx' + t.idx + '"></div>').css({
                    left: 58 * t.idx - (t.idx - 1)
                });
                for (n = 0; n < r.length; n++)
                    c.append('<div class="petActionButton" tip="' + r[n][0] + '" onclick="' + r[n][1] + '">' + (n + 1) + "</div>");
                $("#shop_sell").append(c)
            }
        }
        ,
        this.startDemo()
    }
    ,
    this.remove = function() {
        this.stopAction(!0),
        clearInterval(this.demoInterval),
        this.demoInterval = null,
        $("#shop_sell .petActionBox.idx" + this.idx).remove(),
        this.domElement.remove()
    }
    ,
    this.init(t)
}
function hideMyPet(t) {
    isset(t) ? mAlert(_t("are_u_sure", null, "pet"), 2, [function() {
        _g("pet&a=0")
    }
    ]) : _g("pet&a=0")
}
function __doPreviewAction(t, e, i) {
    g.shop.preview[t].object.specialAction(e, i)
}
function __doAction() {
    var t = this;
    if (this.stopAction(),
    isset(this.action) && !(!this.action >> 4)) {
        var e = getHalfByte(this.action, 1)
          , i = getHalfByte(this.action, 2)
          , s = !1
          , a = 0
          , r = 100;
        if (i > 13 && i <= 15)
            switch (i) {
            case 13:
                r = 150;
                break;
            case 14:
                r = 200;
                break;
            case 15:
                r = 300
            }
        if (i >= 0 && i <= 9)
            ;
        else if (i >= 10 && i <= 12) {
            switch (s = !0,
            i) {
            case 11:
                a = 50;
                break;
            case 12:
                a = 200
            }
            i = 0
        } else
            i = 3;
        var n = 0 == i ? 1 : i;
        this.stop = !0,
        this.actionFrame = 0,
        this.actionCounter = 0,
        setTimeout((function() {
            t.actionInterval = setInterval((function() {
                if (4 == t.actionFrame && a)
                    a--;
                else {
                    t.dir = 0;
                    var o = -(3 + (t.anim ? 1 : 0) + e) * t.fw
                      , l = t.actionFrame;
                    s && t.actionFrame >= 3 && (l = 3 - (t.actionFrame > 3 && t.actionFrame % 3 == 0 ? 3 : t.actionFrame % 3));
                    var c = -l * t.fh;
                    t.domElement.css({
                        backgroundPosition: o + "px " + c + "px"
                    }),
                    t.actionFrame++,
                    (4 == t.actionFrame && !s || s && 7 == t.actionFrame) && (t.actionFrame = 0,
                    t.actionCounter++,
                    t.actionCounter == n && (100 != r ? setTimeout((function() {
                        t.stopAction(0 != i)
                    }
                    ), r) : t.stopAction(0 != i)),
                    0 == i && (t.stop = !0))
                }
            }
            ), r)
        }
        ), 100)
    }
}
function newOther(t) {
    for (k in t)
        if (isset(t[k].del))
            isset(g.other[k]) && isset(g.other[k].pet) && (g.other[k].pet.remove(),
            delete g.other[k].pet),
            delete g.other[k],
            $("#other" + k).remove(),
            $("#otherWanted" + k).remove();
        else {
            var e = isset(t[k].pet) ? t[k].pet : null;
            if (isset(t[k].pet) && delete t[k].pet,
            isset(g.other[k]))
                for (var i in t[k])
                    g.other[k][i] = t[k][i];
            else {
                g.other[k] = t[k],
                g.other[k].id = k,
                g.other[k].fw = 32,
                g.other[k].fh = 48,
                g.other[k].rx = t[k].x,
                g.other[k].ry = t[k].y,
                g.other[k].step = 0;
                var s = "t_other";
                "" != t[k].relation && (s += " t_" + t[k].relation),
                $("#base").append("<div class=other id=other" + k + ' ctip="' + s + '"></div>'),
                isset(t[k].wanted) && 1 == parseInt(t[k].wanted) && $("#base").append("<div class=otherWanted id=otherWanted" + k + "></div>"),
                $("#other" + k).click((function(t) {
                    var e = this.id.substr(5);
                    if (Math.abs(g.other[e].x - hero.x) > 1 || Math.abs(g.other[e].y - hero.y) > 1)
                        hero.mClick(t);
                    else {
                        var i = [];
                        if (hero.x == g.other[e].x && hero.y == g.other[e].y) {
                            var s = getGroundItem();
                            if (s)
                                for (var a = 0; a < s.length; a++)
                                    i.push([_t("take", null, "menu") + " " + s[a].name, '_g("takeitem&id=' + s[a].id + '")']);
                            var r = getRenewableNpc();
                            if (r)
                                for (a = 0; a < r.length; a++)
                                    i.push([_t("take", null, "menu") + " " + r[a].name, '_g("talk&id=' + r[a].id + '")']);
                            isset(g.gw[hero.x + "." + hero.y]) && i.push([_t("go", null, "menu"), '_g("walk")'])
                        }
                        var n = g.worldConfig.getPvp() ? 7 : 5;
                        if (Math.abs(hero.x - g.other[e].x) < n && Math.abs(hero.y - g.other[e].y) < n && (i[3] = [_t("attack", null, "menu"), '_g("fight&a=attack&id=' + e + '")']),
                        Math.abs(hero.x - g.other[e].x) < 2 && Math.abs(hero.y - g.other[e].y) < 2) {
                            i[4] = [_t("trade", null, "menu"), "trade_start(" + e + ")"],
                            hero.lvl > 29 && (i[5] = [_t("kiss", null, "menu"), '_g("emo&a=kiss&id=' + e + '")']),
                            isset(hero.vip) && (i[6] = [_t("crimson_bless", null, "menu"), '_g("emo&a=bless&id=' + e + '")']);
                            var o = g.other[e].relation
                              , l = "wph".search(hero.prof) >= 0 ? "wph" : "mtb";
                            g.worldConfig.getPvp() && !(g.worldConfig.getPvp() && l.search(g.other[e].prof) >= 0) || 4 & g.other[e].attr && "fr" != o && "cl" != o && "cl-fr" != o && "fr-fr" != o || g.party && !g.party[hero.id].r || (i[7] = [_t("team_invite", null, "menu"), '_g("party&a=inv&id=' + e + '")'])
                        }
                        i.length > 0 && showMenu(t, i)
                    }
                }
                ))
            }
            if (isset(t[k].lvl) && !isset(t[k].ble) && isset(g.other[k].ble) && delete g.other[k].ble,
            e ? isset(g.other[k].pet) ? g.other[k].pet.update(e) : (g.other[k].pet = new Pet(e,g.other[k]),
            g.other[k].pet.update(e, !0)) : isset(t[k].nick) && isset(g.other[k].pet) && (g.other[k].pet.remove(),
            delete g.other[k].pet),
            isset(g.tips.other) || (g.tips.other = function(t) {
                var e = "<b" + (isset(t.vip) ? ' style="color:#f63"' : "") + ">" + t.nick + "</b>";
                if (e += isset(t.guest) && t.guest ? '<i style="color:#f1f1f1">' + _t("deputy") + "</i>" : "",
                isset(t.wanted) && 1 == parseInt(t.wanted) && (e += "<b class=wanted>" + _t("wanted_info", null, "pklist") + "</b>"),
                isset(t.is_blessed) && t.is_blessed && (e += '<b class="bless">' + _t("bless_singular") + "</b>"),
                isset(t.clan) && (e += "[" + escapeHTML(t.clan.name) + "]<br>"),
                t.lvl && (e += "Lvl: " + t.lvl + t.prof),
                t.rights) {
                    var i = -1;
                    i = 1 & t.rights ? 0 : 16 & t.rights ? 1 : 2 & t.rights ? 2 : 4 & t.rights ? 4 : 3,
                    e += "<i>" + g.names.ranks[i] + "</i>"
                }
                return 1 & t.attr && (e += "<br><img src=img/mute.gif>"),
                2 & t.attr && (e += " <img src=img/warning.gif>"),
                e
            }
            ),
            isset(t[k].lvl) && $("#other" + k).attr("tip", g.tips.other(g.other[k])),
            isset(t[k].icon) && ("/" != t[k].icon.charAt(0) && (t[k].icon = "/" + t[k].icon),
            loadImg("postacie" + t[k].icon, k, (function() {
                k = $(this).attr("dest"),
                isset(k) && isset(g.other[k]) && (g.other[k].fw = this.width / 4,
                g.other[k].fh = this.height / 4,
                $("#other" + k).css({
                    backgroundImage: "url(" + $(this).attr("src") + ")",
                    width: g.other[k].fw
                }),
                moveOther(k),
                isset(g.checklist["other" + k]) && g.checklist["other" + k](g.other[k]))
            }
            ))),
            isset(t[k].stasis))
                t[k].stasis > 0 ? emotion("stasis", k, !1) : removeEmotionBySourceIdAndEmoType("stasis", k);
            if (isset(t[k].stasis_incoming_seconds))
                t[k].stasis_incoming_seconds > 0 ? emotion("away", k, !1) : removeEmotionBySourceIdAndEmoType("away", k);
            g.other[k].x - g.other[k].rx > 2 && (g.other[k].rx = g.other[k].x - 2),
            g.other[k].y - g.other[k].ry > 2 && (g.other[k].ry = g.other[k].y - 2),
            g.other[k].x - g.other[k].rx < -2 && (g.other[k].rx = g.other[k].x + 2),
            g.other[k].y - g.other[k].ry < -2 && (g.other[k].ry = g.other[k].y + 2),
            moveOther(k)
        }
}
var stasisOverlayInfo = new function() {
    $("#stasis-overlay .stasis-overlay__title").text(_t("stasis")),
    $("#stasis-overlay .stasis-overlay__text-inner").html(_t("stasis_overlay_text"))
}
;
function moveOther(t) {
    var e = Math.round(g.other[t].rx) + 256 * Math.round(g.other[t].ry)
      , i = 0;
    isset(map) && isset(map.water[e]) && (i = map.water[e]),
    $("#other" + t).css({
        left: 32 * g.other[t].rx + 16 - (g.other[t].fw >> 1),
        top: 32 * g.other[t].ry + 32 - g.other[t].fh + (i / 4 > 8 ? 0 : i),
        height: g.other[t].fh - (i / 4 > 8 ? i - 32 : i),
        zIndex: getLayerOrder(g.other[t].ry, 10),
        backgroundPosition: g.other[t].step * g.other[t].fw + "px " + -g.other[t].dir * g.other[t].fh + "px"
    }),
    $("#otherWanted" + t).css({
        left: 32 * g.other[t].rx - 10,
        top: 32 * g.other[t].ry + 32 - 16,
        display: "block"
    })
}
function runOther(t) {
    var e = g.other[t].rx
      , i = g.other[t].ry;
    if (g.other[t].x > g.other[t].rx && (g.other[t].rx += .25),
    g.other[t].x < g.other[t].rx && (g.other[t].rx -= .25),
    g.other[t].y > g.other[t].ry && (g.other[t].ry += .25),
    g.other[t].y < g.other[t].ry && (g.other[t].ry -= .25),
    e != g.other[t].rx || i != g.other[t].ry) {
        var s = 0;
        g.other[t].x != g.other[t].rx ? (s = Math.abs(g.other[t].x - g.other[t].rx),
        s -= parseInt(s)) : g.other[t].y != g.other[t].ry && (s = Math.abs(g.other[t].y - g.other[t].ry),
        s -= parseInt(s)),
        g.other[t].step = g.other[t].x == g.other[t].rx && g.other[t].y == g.other[t].ry ? 0 : 4 * s,
        moveOther(t)
    }
    null != g.other[t].pet && (g.other[t].pet.update(),
    g.other[t].pet.move())
}
function newRip(t) {
    for (var e = unix_time(), i = 0; i + 7 < t.length; i += 8) {
        var s = 300 + 1 * t[i + 5] - e;
        if (!(s < 0)) {
            var a = "<b>" + _t("rip_prefix") + " " + htmlspecialchars(t[i]) + "</b>Lvl: " + t[i + 1] + t[i + 2] + "<i>" + htmlspecialchars(t[i + 6]) + "</i><i>" + htmlspecialchars(t[i + 7]) + "</i>"
              , r = Math.round(1e5 * Math.random());
            $("#base").append("<div class=rip id=rip" + r + " ctip=t_rip tip='" + a + "'></div>"),
            $("#rip" + r).css({
                left: 32 * t[i + 3],
                top: 32 * t[i + 4],
                zIndex: getLayerOrder(t[i + 4], 0)
            }).click((function(t) {
                hero.mClick(t)
            }
            )),
            "wpb".indexOf(t[i + 2]) >= 0 && $("#rip" + r).css("backgroundImage", "url(img/rip2.gif)"),
            setTimeout('$("#rip' + r + '").fadeOut(2000,function(){$("#rip' + r + '").remove()})', 1e3 * s)
        }
    }
}
function getLayerOrder(t, e) {
    return 2 * t + e
}
var KIND_LINKED_ITEM = {
    ITEM: "ITEM",
    TPL: "TPL"
}
  , createShortLinkedItemSpan = function(e, t, n) {
    var a = $("<span>");
    return n = escapeHTML(n, !0),
    a.html("[".concat(n, "]")),
    a.addClass("linked-chat-item"),
    a
}
  , parseReceiveMessageWithLinkedItem = function(e, t, n) {
    var a = getKindLinkedItem(e, t);
    if (null != a) {
        var r = getPrepareDataToCreateElementsArray(e, a, t, n);
        return getArrayWith$spanTextAnd$linkedItems(a, r.htmlString, r.itemsData, n)
    }
}
  , getKindLinkedItem = function(e, t) {
    var n = checkIsItemLinkedItem(e, t)
      , a = checkIsTplLinkedItem(e, t);
    return n ? KIND_LINKED_ITEM.ITEM : a ? KIND_LINKED_ITEM.TPL : (console.error("ChatLinkedItemsManager", "getKindLinkedItem", "not find KindLinkedItem in string!", e),
    null)
}
  , getPrepareDataToCreateElementsArray = function(e, t, n, a) {
    for (var r, i = getReceiveMessagePattern(t, n), c = e.length, I = 0, s = 0, u = [], m = []; null !== (r = i.exec(e)); ) {
        var d = r.index;
        if (s < d) {
            var g = e.substr(s, d - s);
            u.push(createTxtSpanString(g, a)),
            m.push(getItemData(e, t, d, r, n)),
            u.push(createItemSpanString(I, a))
        } else
            m.push(getItemData(e, t, d, r, n)),
            u.push(createItemSpanString(I, a));
        I++,
        s = r.index + r[0].length
    }
    if (s != c) {
        var p = e.substr(s, c - 1);
        u.push(createTxtSpanString(p, a))
    }
    return {
        htmlString: u,
        itemsData: m
    }
}
  , getArrayWith$spanTextAnd$linkedItems = function(e, t, n) {
    var a = $("<div>").html(t)
      , r = [];
    for (var i in n) {
        var c = n[i]
          , I = createShortLinkedItemSpan(e, c.hid, c.name);
        a.find(".item-" + i).replaceWith(I)
    }
    return a.children().each((function() {
        r.push($(this))
    }
    )),
    r
}
  , createTxtSpanString = function(e, t) {
    return t ? '<span class="text">'.concat(e, "</span>") : $("<span>").text(e)
}
  , createItemSpanString = function(e, t) {
    return t ? '<span class="item-'.concat(e, '"></span>') : $("<span>").addClass("item-".concat(e))
}
  , getItemData = function(e, t, n, a, r) {
    var i = a[0].split(":")
      , c = i[0].replace(t + "#", "")
      , I = r ? "&quot;" : '"';
    return {
        name: i[1].replaceAll(I, ""),
        hid: c
    }
}
  , checkReceiveMessageHaveLinkedItem = function(e, t) {
    var n = checkIsItemLinkedItem(e, t)
      , a = checkIsTplLinkedItem(e, t);
    return n || a
}
  , checkIsItemLinkedItem = function(e, t) {
    return checkLinkedItemByKind(KIND_LINKED_ITEM.ITEM, e, t)
}
  , checkIsTplLinkedItem = function(e, t) {
    return checkLinkedItemByKind(KIND_LINKED_ITEM.TPL, e, t)
}
  , checkLinkedItemByKind = function(e, t, n) {
    return !!getReceiveMessagePattern(e, n).exec(t)
}
  , isTplLinkedItem = function(e, t) {
    return !!getReceiveMessagePattern(KIND_LINKED_ITEM.TPL, t).exec(e)
}
  , getReceiveMessagePattern = function(e, t) {
    var n;
    switch (e) {
    case KIND_LINKED_ITEM.ITEM:
        n = t ? new RegExp(e + "#([0-9a-z]{64}|[0-9]{7,11}):(&quot;.*?&quot;)","g") : new RegExp(e + '#([0-9a-z]{64}|[0-9]{7,11}):(".*?")',"g");
        break;
    case KIND_LINKED_ITEM.TPL:
        n = t ? new RegExp(e + "#([0-9]+):(&quot;.*?&quot;)","g") : new RegExp(e + '#([0-9]+):(".*?")',"g")
    }
    return n
};
function setupChat() {
    $("#chat S").click(pushChatButton),
    $("#chb0").addClass("choosen"),
    showChat(g.chat.state),
    $("#inpchat").val(""),
    $("#inpchat").blur((function(t) {
        g.chat.write && ($("#inpchat").fadeOut("fast"),
        $("#lastmsg").fadeIn("fast"),
        g.chat.write = !1)
    }
    )).focus((function(t) {
        $("#lastmsg").fadeOut("fast"),
        $("#inpchat").fadeIn("fast")
    }
    )),
    $("#bottxt").click(startChatWrite),
    $("#chathorror INPUT").keypress((function(t) {
        13 == t.which && chatHorrorCheck()
    }
    )),
    addScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar", !0),
    chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar"),
    $("#chattabs").click((function() {
        chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar")
    }
    )),
    $("body").click((function(t) {
        "INPUT" != t.target.nodeName && "lastmsg" != t.target.id && $("#inpchat").blur()
    }
    )),
    $("body").bind("contextmenu", (function(t) {
        if ("INPUT" != t.target.nodeName && "lastmsg" != t.target.id) {
            var a = $(t.target);
            if (!isset(a.attr("c_nick")))
                return;
            var e = a.attr("c_nick");
            if (e == hero.nick)
                return;
            var o = hero.uprawnienia;
            if (0 == o)
                return;
            t.preventDefault(),
            g.mCAddon.update(e),
            4 != o && 16 != o || g.sMCAddon.update(e)
        }
    }
    )),
    $("#bottombar").click((function() {
        $("#inpchat").show(1, (function() {
            $(this).focus()
        }
        ))
    }
    ))
}
function chatScroll(t) {
    $("#chattxt").scrollTop($("#chattxt").prop("scrollHeight"))
}
function chatSendMsg(t) {
    "/cls" == (t = $.trim(t)) ? _g("chat&tab=" + g.chat.tab, {
        c: "/cls"
    }) : "" != t && (t == g.chat.lastwrite && "/" != t.charAt(0) ? mAlert(_t("dont_repeat_msg", null, "chat")) : ts() - g.chat.lastmyts < 1500 ? mAlert(_t("dont_write_so_fast", null, "chat")) : chatSend(t),
    g.chat.lastwrite = t,
    g.chat.lastmyts = ts()),
    $("#lastmsg").remove(),
    $("#inpchat").blur(),
    setTimeout((function() {
        $("#inpchat").val("")
    }
    ), 500)
}
function startChatWrite() {
    tutorialStart(14),
    g.chat.write = !0;
    var t = "";
    switch (g.chat.tab) {
    case 1:
        t = "pl" == _l() ? "/k " : "/g";
        break;
    case 2:
        t = "pl" == _l() ? "/g " : "/p";
        break;
    case 3:
        t = "" != g.chat.lastnick ? "@" + g.chat.lastnick.split(" ").join("_") + " " : "@"
    }
    var a = $("#inpchat");
    "" == a.val() ? a.val(t).show(1, (function() {
        $(this).focus()
    }
    )) : a.show(1, (function() {
        $(this).focus()
    }
    )),
    chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar")
}
function toggleChat() {
    g.chat.state++,
    g.chat.state >= 4 && (g.chat.state = 0),
    showChat(g.chat.state)
}
function showChat(t) {
    if (newChatMode && g.chatController && g.chatController.getChatWindow().setChatState(g.chat.state),
    3 == t && $(window).width() < 1068)
        return showChat(0);
    switch (parseInt(t)) {
    case 1:
        $("#chat").height(90).show(),
        window.opera && $("#chattxt").height(68),
        $("#youtube").height(425),
        chatScroll(-1),
        $("#mailnotifier").fadeTo(100, .5),
        $("#chatMoveHandler").css({
            display: "block"
        }),
        $("#pvpStatMainBox").css({
            top: 416
        });
        break;
    case 2:
        $("#chat").height(160).show(),
        window.opera && $("#chattxt").height(138),
        $("#youtube").height(355),
        chatScroll(-1),
        $("#mailnotifier").fadeTo(100, .5),
        $("#chatMoveHandler").css({
            display: "block"
        }),
        $("#pvpStatMainBox").css({
            top: 346
        }),
        "big" == getCookie("battleLogSize") && toggleBattleLog();
        break;
    case 3:
        makeChatLeft(),
        $("#mailnotifier").fadeTo(100, 1),
        $("#youtube").height(512),
        $("#pvpStatMainBox").css({
            top: 503
        });
        break;
    case 0:
        makeChatRight(),
        $("#chat").hide(),
        $("#mailnotifier").fadeTo(100, 1),
        $("#pvpStatMainBox").css({
            top: 503
        }),
        $("#youtube").height(512)
    }
    g.chat.state = t,
    setCookie("cy", t),
    map.resizeView(),
    reCenter()
}
function pushChatButton(t) {
    isset(t.n) ? n = t.n : n = parseInt($(t.target).attr("id").substr(3)),
    $("#chb" + g.chat.tab).removeClass("choosen"),
    $("#chat S:eq(" + n + ")").addClass("choosen").removeClass("newmsg");
    var a = $("#chattxt");
    for (var e in a.empty(),
    g.chat.tabs[n])
        a.append(g.chat.tabs[n][e].clone(!0, !0));
    g.chat.tab = n,
    $("#inpchat").val(""),
    chatScroll(-1)
}
function chatSend(t) {
    parseChatCommand(t) || _g("chat", {
        c: t
    })
}
function parseChatCommand(t) {
    if ("/" != t.substr(0, 1))
        return !1;
    var a = t.split(" ");
    if (a.length > 1 && "/ban" === a[0]) {
        if (!(4 & hero.uprawnienia))
            return !0;
        var e = [1, 3, 7, 14, 30]
          , o = t.substr(5)
          , n = '<div style="font-weight:bold">' + _t("bandays_amount for %name%", {
            "%name%": o
        }) + "</div>";
        n += '<div style="margin:10px 0px; text-align:center">';
        for (var i = 0; i < e.length; i++)
            n += '<div class="banday_row"><div class="radio_check" id="banday_' + e[i] + '"></div> <label for="banday_' + e[i] + '">' + e[i] + "</label></div>";
        return n += '<div class="banday_row"><div class="radio_check" id="banday_custom"></div> <label for="banday_custom"><input id="custom_banday_value" style="width:30px;" /></label></div>',
        n += "</div>",
        n += '<div style="text-align:center; margin-bottom:10px;"><label for="banday_reason">' + _t("banday_reason_label") + '</label><br /><input style="width:350px;" id="banday_reason" /></div>',
        mAlert(n, 1, [function() {
            var t = $(".radio_check.active").length ? $(".radio_check.active").attr("id").substr(7) : null
              , a = "custom" == t ? $("#custom_banday_value").val() : t;
            !isNaN(parseInt(a)) && $("#banday_reason").val().length >= 10 ? _g("gm&a=ban&nick=" + o + "&days=" + a + "&reason=" + $("#banday_reason").val()) : setTimeout((function() {
                mAlert(_t("banday_wrong_values_error"))
            }
            ), 200)
        }
        ], "question"),
        $(".banday_row").click((function() {
            $(".radio_check").removeClass("active"),
            $(this).find(".radio_check").addClass("active"),
            $(this).find("input").focus()
        }
        )),
        !0
    }
    return !1
}
function chatHorrorCheck() {
    if (g.chat.cor == $("#chathorror INPUT").val()) {
        $("#chathorror").fadeOut();
        var t = g.chat.cor.split(" ")
          , a = g.chat.mis.split(" ")
          , e = g.chat.bad;
        for (var o in a) {
            var n = new RegExp("([ ,.-])" + a[o] + "([ .,-])","gi");
            e = e.replace(n, "$1" + t[o] + "$2")
        }
        ts() - g.chat.lastmyts < 1500 ? mAlert(_t("dont_write_so_fast", null, "chat")) : (g.chat.lastmyts = ts(),
        _g("chat", {
            c: esc($.trim(e))
        }))
    } else
        mAlert("PrÃ³buj ponownie. PamiÄtaj, Å¼e trzeba uÅ¼ywaÄ polskich znakÃ³w,<br>miÄdzy wyrazami muszÄ byÄ wyÅÄcznie spacje,<br>a kolejnoÅÄ wyrazÃ³w musi byÄ taka jak wymieniona."),
        $ch.find("INPUT").val("").focus()
}
function chatSendBad() {
    ts() - g.chat.lastmyts < 1500 ? mAlert(_t("dont_write_so_fast", null, "chat")) : (g.chat.lastmyts = ts(),
    _g("chat", {
        c: esc($.trim(g.chat.bad))
    }),
    $("#chathorror").fadeOut())
}
function goToUrl(t) {
    var a = escapeHTML(t);
    new RegExp("^http://([a-z1-9.]*?)(margonem.pl)[^/\\?=a-z]?");
    mAlert(_t("url_chat_warning %url%", {
        "%url%": '<span class="link">' + a + "</span>"
    }), 2, [function() {
        window.open(t).opener = null
    }
    , function() {}
    ])
}
function showMovie(t, a) {
    var e = "http://www.youtube.com/v/" + t.split("v=")[1].split("&")[0];
    $("#youtube CENTER").html('<object width="480" height="385"><param name="movie" value="' + e + '&autoplay=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="' + e + "&autoplay=" + (isset(a) ? "0" : "1") + '" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="480" height="385"></embed></object>'),
    $("#youtube").css({
        left: 0
    }),
    isset(a) ? $("#youtube").css({
        left: -512
    }).show() : $("#youtube").fadeIn(),
    setCookie("ytm", encodeURIComponent(t))
}
function hideMovie() {
    $("#youtube").fadeOut((function() {
        $("#youtube CENTER").empty()
    }
    )),
    deleteCookie("ytm")
}
function minimizeMovie() {
    $("#youtube").animate({
        left: -512
    }, 500),
    $("#bm_movie").fadeIn()
}
function maximizeMovie() {
    $("#youtube").animate({
        left: 0
    }, 500),
    $("#bm_movie").fadeOut()
}
function chatTextWithHeroNick(t, a) {
    var e = new RegExp("^" + hero.nick + " | " + hero.nick + " | " + hero.nick + "$|^" + hero.nick + "$","ig")
      , o = a.split(e)
      , n = [];
    for (var i in o) {
        var c = o[i];
        n.push(createTextNodeOrSpanLinkedItem(c))
    }
    for (var s = $("<b>").addClass("yourname").text(hero.nick), r = 0; r < n.length; r++) {
        appendTextToColorChatMsg(t, n[r]),
        r == n.length - 1 ? t.append(n[n.length - 1]) : (t.append(document.createTextNode(" ")),
        t.append(s.clone()),
        t.append(document.createTextNode(" ")))
    }
}
function appendTextToColorChatMsg(t, a) {
    if (Array.isArray(a))
        for (var e in a)
            t.append(a[e]);
    else
        t.append(a)
}
function createChatURL(t) {
    var a = t.toObject("https")
      , e = $("<u>");
    return e.addClass("link"),
    e.click((function() {
        goToUrl(a.href)
    }
    )),
    e.text(a.href),
    e
}
function checkCorrectlyURL(t) {
    return /^(?:(https?:\/\/)|(www\.))/i.test(t)
}
function parseChatText(t) {
    var a = $("<span>");
    a.addClass("chatmsg");
    var e = "entertown" == t.s;
    if ("sys_info" == t.s || "sys_red" == t.s) {
        var o = parseChatBB(t.t);
        if (!e && -1 == t.t.indexOf("url")) {
            var n = new RegExp("^" + hero.nick + " | " + hero.nick + " | " + hero.nick + "$|^" + hero.nick + "$","ig");
            o = o.replace(n, ' <b class="yourname">' + hero.nick + "</b> ")
        }
        checkReceiveMessageHaveLinkedItem(o, !0) ? a.append(createTextNodeOrSpanLinkedItem(o, !0, !0)) : a.append(o)
    } else if (isset(window.linkify)) {
        var i = linkify.tokenize(t.t);
        for (var c in i) {
            var s = i[c];
            r = s.toString();
            "url" == s.type && checkCorrectlyURL(r) ? a.append(createChatURL(s)) : e ? a.append(document.createTextNode(r)) : chatTextWithHeroNick(a, r)
        }
    } else {
        var r = t.t;
        e ? a.append(document.createTextNode(r)) : chatTextWithHeroNick(a, r)
    }
    return a
}
function createTextNodeOrSpanLinkedItem(t, a, e) {
    return checkReceiveMessageHaveLinkedItem(t, a) ? parseReceiveMessageWithLinkedItem(t, a, e) : document.createTextNode(t)
}
function updateChatLastMsg() {
    if (null !== g.chat.lastMsg && !g.chat.write) {
        var t = ["", _t("[K]", null, "chat"), _t("[G]", null, "chat"), _t("[P]", null, "chat")]
          , a = $("<div>");
        a.attr("id", "lastmsg");
        var e = document.createTextNode(t[g.chat.lastMsg.kind]);
        a.append(e),
        a.append(g.chat.lastMsg.$el.children().clone()),
        $("#bottxt").empty().append(a),
        g.chat.write || $("#lastmsg").fadeIn()
    }
}
function getChatStyleMsg(t) {
    if ("" != t.n && 3 == t.k && t.n != hero.nick && "System" != t.n)
        return "priv2";
    if ("" == t.s) {
        if (1 == t.k)
            return "clant";
        if (2 == t.k)
            return "team";
        if (3 == t.k)
            return "priv"
    }
    return t.s
}
function getChatInfoMsg(t) {
    return "" != t.n ? 3 == t.k ? "Â«" + t.n + " -> " + t.nd + "Â» " : t.n2 = "Â«" + t.n + "Â» " : ""
}
function testHaxDomain(t) {
    var a = ["margcnem.pl", "margonem.tl.pl", "marg0nem.pl", "margonem.esy.es", "margonem.eeu.pl", "margoncm.pl", "margonem.hol.es"];
    for (var e in a)
        if (t.search(a[e]) >= 0)
            return !0;
    return !1
}
function displayChatMsg(t, a) {
    g.chat.tabs[a.k].push(t),
    0 != a.k && g.chat.tabs[0].push(t.clone(!0, !0)),
    a.ts > g.chat.ts && (g.chat.ts = a.ts),
    a.k != g.chat.tab && 0 != g.chat.tab || $("#chattxt").append(t.clone(!0, !0))
}
function oneChatMsg(t) {
    var a = $("<div>")
      , e = $("<span>")
      , o = parseChatText(t)
      , n = getChatStyleMsg(t)
      , i = getChatInfoMsg(t);
    if (a.append(e),
    a.append(o),
    a.addClass(n),
    e.text(i),
    0 == g.chat.tab && isset(t.fr) && 1 == t.fr && e.addClass("fr"),
    "" != t.n && "System" != t.n) {
        var c = t.n;
        c == hero.nick && isset(t.nd) && (c = t.nd),
        e.addClass("chnick"),
        e.attr("tip", ut_time(t.ts)),
        e.attr("c_nick", c)
    }
    return displayChatMsg(a, t),
    a
}
function updateChatNewMsg(t) {
    if (g.chat.init)
        for (var a in t)
            g.chat.tab != a && $("#chb" + a).addClass("newmsg");
    else
        g.chat.init = 1
}
function hasIgnoreChatMsg(t) {
    for (var a in g.chat.parsers)
        if (g.chat.parsers[a](t))
            return !0;
    return !!testHaxDomain(t.t)
}
function newChatMsg2(t) {
    var a = 3 == g.chat.state ? 255 : 500
      , e = [];
    for (var o in t)
        e[parseInt(o)] = t[o];
    if (g.ch = e,
    e[0].ts > g.chat.ts) {
        for (var n = [], i = e[e.length - 1].n == hero.nick, c = e.length - 1; c >= 0; c--) {
            var s = e[c];
            hasIgnoreChatMsg(s) || (g.chat.lastMsg = {
                kind: s.k,
                $el: oneChatMsg(s)
            },
            3 == s.k && s.n != hero.nick && "System" != s.n && (g.chat.lastnick = s.n),
            i || (n[s.k] = !0))
        }
        chatScroll(-1),
        updateChatLastMsg(),
        updateChatNewMsg(n)
    }
    chatScrollbar("chattxt", a, "chatscrollbar")
}
function removeScrollbar(t, a) {
    $("#" + a).remove(),
    $("#" + t).unbind("mousewheel")
}
function addScrollbar(t, a, e, o) {
    $("#" + e).length && ($("#" + e).remove(),
    $("#" + t).unbind("mousewheel"));
    var n = $("#" + t).css({
        overflow: "hidden"
    })
      , i = n.prop("scrollHeight")
      , c = Math.max(15, parseInt(n.height() * n.height() / parseFloat(i)));
    $("<div></div>").css({
        position: "absolute",
        top: n.position().top + "px",
        left: a + "px",
        width: "10px",
        height: c + "px"
    }).draggable({
        axis: "y",
        appendTo: "body",
        drag: function() {
            var e = (n = $("#" + t)).prop("scrollHeight");
            if (e <= n.height())
                return $(this).css({
                    height: n.height() + "px",
                    visibility: "hidden"
                }),
                void $(this).draggable("option", "containment", [a, n.offset().top, a, n.offset().top]);
            var o = Math.max(15, parseInt(n.height() * n.height() / parseFloat(e)));
            $(this).css({
                height: o + "px"
            }),
            n.height() - o != 0 && (n.scrollTop((e - n.height()) * parseFloat(parseFloat($(this).position().top - n.position().top) / parseFloat(n.height() - o))),
            $(this).draggable("option", "containment", [a, n.offset().top, a, n.offset().top + n.height() - o]),
            $(this).position().top - n.position().top == n.height() - o ? $(this).attr("on_bottom", "1") : $(this).attr("on_bottom", "0"))
        }
    }).attr("id", e).attr("on_bottom", o ? "1" : "0").appendTo("chatscrollbar" == e && 3 == g.chat.state ? n.parent().parent() : n.parent()),
    $("#" + t).bind("mousewheel", (function(o, n) {
        var i = $("#" + t);
        i.prop("scrollHeight") <= i.height() || ($("#" + e).css("top", $("#" + e).position().top - 10 * n),
        n > 0 && $("#" + e).attr("on_bottom", "0"),
        chatScrollbar(t, a, e))
    }
    ))
}
function chatScrollbar(t, a, e) {
    var o = $("#" + t)
      , n = $("#" + e);
    if (null != o.position()) {
        var i = o.prop("scrollHeight");
        if (i <= Math.round(o.outerHeight()))
            return n.css({
                height: o.height(),
                top: o.position().top
            }),
            isset(n.data("uiDraggable")) && n.draggable("option", "containment", [a, o.offset().top, a, o.offset().top]),
            n.css({
                top: o.position().top,
                visibility: "hidden"
            }),
            void o.scrollTop(o.offset().top);
        n.css({
            visibility: "visible"
        });
        var c = Math.max(15, parseInt(o.height() * o.height() / parseFloat(i)));
        n.css({
            height: c
        }),
        "1" == n.attr("on_bottom") && n.css({
            top: o.height() - c + o.position().top
        }),
        o.position().top > n.position().top && n.css("top", o.position().top),
        o.height() - c != 0 && (o.scrollTop((i - o.height()) * parseFloat(parseFloat(n.position().top - o.position().top) / parseFloat(o.height() - c))),
        n.draggable("option", "containment", [a, o.offset().top, a, o.offset().top + o.height() - c]),
        n.position().top - o.position().top >= $("#" + t).height() - c && n.attr("on_bottom", "1"))
    }
}
function makeChatLeft() {
    $("#chat").detach().appendTo("body").css({
        width: "",
        height: "",
        display: "block",
        top: $("#centerbox").offset().top,
        left: $("#centerbox").offset().left - 276
    }).addClass("left");
    var t = $(document.createElement("div")).css({
        padding: "4px 20px 3px 5px"
    }).attr("id", "chatTxtContainer");
    $("#chattxt").detach().appendTo(t).css({
        height: 503
    }),
    $("#chat").append(t),
    $("#chatscrollbar").css({
        left: 256
    }),
    chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar"),
    chatScroll(-1)
}
function makeChatRight() {
    $("#chat").detach().appendTo("#centerbox").css({
        width: 512,
        bottom: 25,
        left: 0,
        top: "auto"
    }).removeClass("left"),
    $("#chattxt").detach().appendTo("#chat"),
    $("#chatTxtContainer").remove(),
    $("#chattxt").css({
        padding: "",
        height: ""
    }),
    $("#chatscrollbar").css({
        left: 500
    }),
    chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar"),
    chatScroll(-1)
}
function chatTo(t, a) {
    var e = ""
      , o = -1;
    if (isset(a) && a) {
        var n = []
          , i = $("#inpchat").val();
        o = "" != i ? $("#inpchat").caret().begin + t.length + 1 : -1,
        "" != i ? (n.push(i.slice(0, $("#inpchat").caret().begin)),
        n.push(t + " "),
        n.push(i.slice($("#inpchat").caret().end))) : n.push(t + " "),
        e = n.join("")
    } else {
        e = "@" + t.replace(/ /g, "_") + " "
    }
    $("#inpchat").val(e),
    setTimeout("$('#inpchat').focus().caret(" + o + ")", 20)
}
newChatMsg = newChatMsg2,
$(document).on("click", "[c_nick]", (function(t) {
    chatTo($(this).attr("c_nick"), t.ctrlKey)
}
));
function questLog() {
    var t = this;
    this.init = function() {
        t.initWindow(),
        t.attachDraggable(),
        t.initClose()
    }
    ,
    this.initWindow = function() {
        t.$wnd = $("#quest-log-window");
        var e = t.getStateOfVisibleFromStorage();
        null !== e ? e ? t.showPanel() : t.hidePanel() : t.hidePanelWithSaveInStorage()
    }
    ,
    this.initClose = function() {
        t.$wnd.find(".quest-log-close-but").click(t.hidePanelWithSaveInStorage)
    }
    ,
    this.attachDraggable = function() {
        t.$wnd.draggable({
            handle: ".quest-log-header",
            scroll: !1,
            drag: function(e, i) {
                var n = window.innerWidth
                  , o = window.innerHeight;
                i.position.left < 0 && (i.position.left = 0),
                i.position.top < 0 && (i.position.top = 0),
                i.position.left + $(this).outerWidth() > n && (i.position.left = n - $(this).outerWidth()),
                i.position.top + $(this).outerHeight() > o && (i.position.top = o - $(this).outerHeight()),
                t.setPosInStorage([i.position.left, i.position.top])
            }
        })
    }
    ,
    this.saveInStorageVisible = function(t) {
        margoStorage.set("quest-log-visible", t)
    }
    ,
    this.getStateOfVisibleFromStorage = function() {
        return margoStorage.get("quest-log-visible")
    }
    ,
    this.getPosFromStorage = function() {
        return margoStorage.get("quest-log-pos")
    }
    ,
    this.setPosInStorage = function(t) {
        margoStorage.set("quest-log-pos", t)
    }
    ,
    this.getCenterPos = function() {
        var e = window.innerWidth
          , i = window.innerHeight;
        return [e / 2 - t.$wnd.width() / 2, i / 2 - t.$wnd.height() / 2]
    }
    ,
    this.checkPosIsCorrect = function(e) {
        var i = e[0] + t.$wnd.width() - 5 < window.innerWidth
          , n = e[1] + t.$wnd.height() - 5 < window.innerHeight;
        return i && n
    }
    ,
    this.showPanel = function() {
        var e = t.getPosFromStorage();
        null != e && t.checkPosIsCorrect(e) || (e = t.getCenterPos(),
        t.setPosInStorage(e)),
        t.$wnd.css({
            left: e[0],
            top: e[1]
        }),
        t.$wnd.fadeIn("fast")
    }
    ,
    this.showPanelWithSaveInStorage = function() {
        t.showPanel(),
        t.saveInStorageVisible(!0)
    }
    ,
    this.hidePanel = function() {
        $("#quest-log-window").fadeOut("fast")
    }
    ,
    this.hidePanelWithSaveInStorage = function() {
        t.hidePanel(),
        t.saveInStorageVisible(!1)
    }
    ,
    this.isVisible = function() {
        return !0 === this.getStateOfVisibleFromStorage()
    }
    ,
    this.manageVisibility = function() {
        t.isVisible() ? t.hidePanelWithSaveInStorage() : t.showPanelWithSaveInStorage()
    }
    ,
    this.update = function(t) {
        var e = this;
        isset(t.data) && this.updateQuests(t.data),
        isset(t.del) && t.del.map((function(t) {
            e.deleteQuest(t)
        }
        ))
    }
    ,
    this.prepareTypMonsterData = function(t) {
        return t.replace(" Common (", " " + _t("normal-monster", null, "npcs_kind") + " (").replace(" Elite (", " " + _t("elita1", null, "npcs_kind") + " (").replace(" Elite2 (", " " + _t("elita2", null, "npcs_kind") + " (").replace(" Hero (", " " + _t("heros", null, "npcs_kind") + " (").replace(" Titan (", " " + _t("tytan", null, "npcs_kind") + "/" + _t("colossus", null, "npcs_kind") + " (")
    }
    ,
    this.updateQuests = function(e) {
        var i = t.prepareTypMonsterData(e);
        i = TextModifyByTag.sexModify(i),
        $(i).each((function() {
            var e = $(this)
              , i = "quest-log-id-" + e.attr("data-quest-id")
              , n = t.$wnd.find("." + i)
              , o = e.find(".q_title")
              , s = e.find(".q_doit");
            e.addClass(i),
            o.html(escapeHTML(o.html())),
            s.length > 0 && s.html(parseContentBB(s.html(), !1)),
            n.length > 0 ? n.replaceWith(e) : t.$wnd.find(".quest-log-scroll").append(e)
        }
        ))
    }
    ,
    this.deleteQuest = function(e) {
        var i = "quest-log-id-" + e;
        t.$wnd.find("." + i).remove()
    }
}
function _slicedToArray(e, a) {
    return _arrayWithHoles(e) || _iterableToArrayLimit(e, a) || _unsupportedIterableToArray(e, a) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(e, a) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, a);
        var t = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === t && e.constructor && (t = e.constructor.name),
        "Map" === t || "Set" === t ? Array.from(e) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(e, a) : void 0
    }
}
function _arrayLikeToArray(e, a) {
    (null == a || a > e.length) && (a = e.length);
    for (var t = 0, r = new Array(a); t < a; t++)
        r[t] = e[t];
    return r
}
function _iterableToArrayLimit(e, a) {
    var t = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (null != t) {
        var r, l, s = [], n = !0, i = !1;
        try {
            for (t = t.call(e); !(n = (r = t.next()).done) && (s.push(r.value),
            !a || s.length !== a); n = !0)
                ;
        } catch (e) {
            i = !0,
            l = e
        } finally {
            try {
                n || null == t.return || t.return()
            } finally {
                if (i)
                    throw l
            }
        }
        return s
    }
}
function _arrayWithHoles(e) {
    if (Array.isArray(e))
        return e
}
var tmpForumLog = [];
function fight(e, a) {
    var t = !1;
    if (isset(e.init)) {
        isset(a.loot) && isset(a.loot.init) || !(g.init > 4) || closeLootWindow(!0),
        attach_battle_log(),
        isset(e.close) || $("#battle").fadeIn(),
        $("#battlelog").empty(),
        $("#battle .troop, #battle BIG").remove(),
        g.battle = {
            f: [],
            wRatio: 1.5,
            log: [],
            logBuffer: [],
            forumLog: [],
            intervalMove: null,
            line: [[], [], [], [], [], []],
            move: -1,
            auto: parseInt(e.auto),
            myteam: e.myteam,
            disabledSkills: null,
            skills: [],
            heroMana: null,
            heroEnergy: null,
            endBattle: !1
        },
        tmpForumLog = [],
        "big" == getCookie("battleLogSize") && 2 != g.chat.state && ($("#battlelog,#battlepanelback,#battlepanel,#battle .border-b").addClass("big"),
        map.resizeView()),
        g.lock.add("battle");
        var r = []
          , l = [];
        for (var s in e.w)
            2 != e.w[s].team ? r.push(e.w[s].name + "(" + e.w[s].lvl + e.w[s].prof + ")") : l.push(e.w[s].name + "(" + e.w[s].lvl + e.w[s].prof + ")");
        $("#battlelog").append(battleMsg("0;0;txt=" + _t("battle_starts_between %grp1% %grp2%", {
            "%grp1%": r.join(", "),
            "%grp2%": l.join(", ")
        }))),
        $("#battlepanel SMALL").html(ut_fulltime(unix_time()));
        var n = $("#battle");
        if (!$(".lines", n).length)
            for (var i = 0; i < 7; i++) {
                var o = i ? _t("first_plan_buttons") : _t("first_plan_default");
                $('<div tip="' + o + '" class=lines>' + (i || "*") + "</div>").css({
                    top: 170 + 30 * i,
                    opacity: .1
                }).click((function(e) {
                    showTroops($(this).html())
                }
                )).hover((function(e) {
                    $("#battle .lines").css("opacity", "mouseenter" == e.type ? .5 : .1)
                }
                )).appendTo(n)
            }
    } else
        isset(e.close) || (0 == g.battle.f.length && window.location.reload(),
        "block" != $("#battle").css("display") && $("#battle").css("display", "block"));
    if (isset(e.close) && (t = !0),
    e.skills_disabled && setSkillsDisabled(e.skills_disabled),
    isset(e.skills)) {
        g.battle.skills = [];
        10;
        for (i = 0; i < e.skills.length; i += 10)
            g.battle.skills[parseInt(e.skills[i])] = {
                name: e.skills[i + 1],
                attr: e.skills[i + 2],
                cost: self.getFormCost(e.skills[i + 8]),
                require: getRequire(e.skills[i + 1], e.skills[i + 6])
            }
    }
    if (isset(e.skills_combo_max) && (g.battle.skills_combo_max = [],
    g.battle.skills_combo_max = e.skills_combo_max),
    isset(e.w) && newTroops(e.w),
    updateBuffs(),
    updateCurrent(e.current),
    isset(e.m) && checkMsgOrder(e)) {
        for (var s in g.battle.logBuffer)
            g.battle.log.push(g.battle.logBuffer[s].m),
            $("#battlelog").append(battleMsg(g.battle.logBuffer[s].m, isset(e.init))),
            $("#battlelog").scrollTop(99999);
        g.battle.logBuffer = []
    }
    isset(e.move) && (e.move < 0 ? updateMoveTime(-1) : setIntervalMove(e.move)),
    isset(e.endBattle) && e.endBattle && setEndBattle(),
    e.battleground && map.setBack(e.battleground),
    t && (clearIntervalMove(),
    closeBattle())
}
function getFormCost(e) {
    if ("" == e)
        return "";
    var a = e.split(";")
      , t = {};
    for (var r in a) {
        var l = a[r].split("=");
        t[l[0]] = l[1]
    }
    return isset(t.energy) ? t.energy + "e" : isset(t.mana) ? t.mana.replace(/\*c?plvl/, "") + "m" : ""
}
function setSkillsDisabled(e) {
    g.battle.disabledSkills = e
}
function checkDisabled(e) {
    return g.battle.disabledSkills.includes(parseInt(e))
}
function getRequire(e, a) {
    if ("" == a)
        return a;
    var t, r = a.split(";");
    for (var l in r) {
        var s = r[l].split("=");
        if ("reqw" == s[0]) {
            t = s[1];
            break
        }
    }
    return t || ""
}
function clearIntervalMove() {
    null != g.battle.intervalMove && clearInterval(g.battle.intervalMove)
}
function setIntervalMove(e) {
    var a = e;
    clearIntervalMove(),
    updateMoveTime(a),
    g.battle.intervalMove = setInterval((function() {
        -1 !== --a ? updateMoveTime(a) : clearIntervalMove()
    }
    ), 1e3)
}
function updateMoveTime(e) {
    g.battle.move = e;
    var a = _t("someoneelse_move", null, "battle")
      , t = !0
      , r = !(!isset(g.battle.f[hero.id]) || isset(g.battle.f[hero.id]) && isset(g.battle.f[hero.id].fast) && g.battle.f[hero.id].fast);
    e > 0 ? a = _t("your_move %sec%", {
        "%sec%": e
    }, "battle") : e < 0 && (clearCurrentPlayer(),
    t = !1,
    r = !1,
    a = _t("battle_ended", null, "battle"),
    clearIntervalMove()),
    $("#battletimer").html(a),
    t && 1 != g.worldConfig.getHardcore() ? $("#surrenderBattleButton").css("display", "block") : "block" == $("#surrenderBattleButton").css("display") && $("#surrenderBattleButton").fadeOut(),
    r ? isset(g.battle.nobut) || g.battle.auto || ($("#autobattleButton").css("display", "block"),
    tutorialStart(19)) : "block" == $("#autobattleButton").css("display") && $("#autobattleButton").fadeOut()
}
function bB() {
    map.cmpMCLCOC(),
    map.getBC() > 20 && (stopEngine(),
    log(String.fromCharCode(66) + map.o() + String.fromCharCode(116), 1))
}
function setEndBattle() {
    g.battle.endBattle = !0
}
function closeBattle() {
    $("#battle").fadeOut(),
    g.battle = !1,
    g.lock.remove("battle"),
    Tip.hide(),
    0 == g.party && bB()
}
function checkMsgOrder(e) {
    for (var a in e.mi)
        g.battle.logBuffer.push({
            m: e.m[a],
            mi: e.mi[a]
        });
    for (var a in g.battle.logBuffer.sort((function(e, a) {
        return e.mi - a.mi
    }
    )),
    g.battle.logBuffer)
        if (isset(g.battle.logBuffer[a + 1]) && g.battle.logBuffer[parseInt(a)].mi + 1 != g.battle.logBuffer[parseInt(a) + 1].mi)
            return !1;
    return !isset(g.battle.logBuffer[0]) || parseInt(g.battle.logBuffer[0].mi) == g.battle.log.length
}
function showTroops(e) {
    for (var a in "*" !== e && (e = 6 - parseInt(e)),
    g.battle.f) {
        var t = g.battle.f[a].y
          , r = t === e ? 11 : 10 - t;
        r = g.battle.line[t].some((function(e) {
            return e < 0
        }
        )) && g.battle.f[a].id > 0 ? ++r : r,
        $("#troop".concat(a)).css("z-index", r)
    }
}
function troopLeftPos(e) {
    for (var a = g.battle.f[e], t = a.y, r = g.battle.line[t], l = 1 & t ? 248 : 264, s = 0; s < 6; s++)
        for (var n in g.battle.line[s])
            if (g.battle.line[s][n] == e) {
                if (s == t)
                    return;
                delete g.battle.line[s][n]
            }
    var i = -1;
    for (var s in r)
        if (!isset(r[s])) {
            r[s] = e,
            i = s;
            break
        }
    -1 == i && (i = r.push(e) - 1);
    var o = (i + 1 >> 1) * (1 & i ? 1 : -1);
    a.rx = l + o * (1 * a.fw) - 1 * a.fw,
    a.ry = 380 - 30 * t - a.fh,
    g.battle.auto ? $("#troop" + e).css({
        left: a.rx,
        top: a.ry,
        zIndex: 10 - t
    }) : $("#troop" + e).animate({
        left: a.rx,
        top: a.ry
    }, 500).css({
        zIndex: 10 - t
    })
}
function setDisabledSkills(e) {
    var a = g.battle.f[hero.id]
      , t = !(e.y - a.y < 2)
      , r = 1;
    if (e == a ? r = 0 : e.team != a.team && (r = 2),
    $("#hmenu").find(".battle-skill").addClass("disabled"),
    $("#hmenu").find(".battle-skill").parent().addClass("disabled"),
    0 == e.hpp)
        return $("#hmenu").find(".battle-skill").addClass("die");
    var l = g.battle.skills;
    for (var s in checkAtackAndMoveDisabled(t, r, e.id),
    l)
        if (-1 != s && -2 != s) {
            var n = l[s]
              , i = !1
              , o = !1
              , b = l[s].cost
              , m = getSkillObjFromMenu(s);
            checkManaOrEnergy(m, b) && (o = !0),
            checkDisabledAndAddClass(m, s) && (o = !0),
            8 & n.attr && !r && (i = !0),
            16 & n.attr && 1 == r && (i = !0),
            24 & n.attr || 2 != r || (i = !0),
            checkTooFar(m, n.attr, t) && (o = !0),
            i || m.addClass("bad-target"),
            o || i && (m.removeClass("disabled"),
            m.parent().removeClass("disabled"))
        }
}
function checkDisabled(e) {
    return g.battle.disabledSkills.includes(parseInt(e))
}
function getSkillObjFromMenu(e) {
    return $("#hmenu").find(".skill-icon-id-" + e)
}
function checkDisabledAndAddClass(e, a) {
    return !!checkDisabled(a) && (e.addClass("require"),
    !0)
}
function checkManaOrEnergy(e, a) {
    if (!a)
        return !1;
    var t = parseInt(a)
      , r = a[a.length - 1]
      , l = g.battle.heroMana
      , s = g.battle.heroEnergy;
    return e.addClass(r),
    !!("m" == r && l < t || "e" == r && s < t) && (e.addClass("not-enough-" + r),
    !0)
}
function checkTooFar(e, a, t) {
    return !!(2 & a && t) && (e.addClass("too-far"),
    !0)
}
function checkAtackAndMoveDisabled(e, a, t) {
    var r = hero.id
      , l = r == t
      , s = 1 == a
      , n = hero.prof
      , i = "t" == n || "h" == n
      , o = "m" == n
      , b = getSkillObjFromMenu(-1)
      , m = getSkillObjFromMenu(-2)
      , _ = !l && !s
      , c = huntersCanAtack(i, e)
      , d = mageCanAtack(o, e);
    return !e && _ || (c || d) && _ ? (b.removeClass("disabled"),
    b.parent().removeClass("disabled")) : l || s ? b.addClass("bad-target") : e && b.addClass("too-far"),
    mageCanOneStep(o, e) ? huntersCanOneStep(i, e) ? 4 == g.battle.f[r.toString()].y ? m.addClass("last-line") : (m.removeClass("disabled"),
    void m.parent().removeClass("disabled")) : m.addClass("hunter-can-not-one-step") : m.addClass("mage-held-wand")
}
function huntersCanAtack(e, a) {
    if (e) {
        var t = isset(g.eqItems[4])
          , r = isset(g.eqItems[21]);
        return !(!t || !r) || !a
    }
}
function mageCanAtack(e, a) {
    if (e)
        return !!isset(g.eqItems.magic) || !a
}
function huntersCanOneStep(e) {
    if (!e)
        return !0;
    var a = isset(g.eqItems[4])
      , t = isset(g.eqItems[21]);
    return !(a && t)
}
function mageCanOneStep(e) {
    return !e || !isset(g.eqItems.magic)
}
function canUseSkillOrMessageWhyCanNot(e) {
    var a = getSkillObjFromMenu(e);
    if (a.hasClass("disabled")) {
        if (a.hasClass("die") && message(_t("bad-target", null, "battle")),
        a.hasClass("not-enough-e") && message(_t("needE", null, "battle")),
        a.hasClass("not-enough-m") && message(_t("needM", null, "battle")),
        a.hasClass("too-far") && message(_t("too-far", null, "battle")),
        a.hasClass("bad-target") && message(_t("bad-target", null, "battle")),
        a.hasClass("mage-held-wand") && message(_t("mage-held-wand", null, "battle")),
        a.hasClass("last-line") && message(_t("last-line", null, "battle")),
        a.hasClass("hunter-can-not-one-step") && message(_t("hunter-without-arrow %prof%", {
            "%prof%": getAllProfName(hero.prof)
        }, "battle")),
        a.hasClass("require"))
            for (var t = g.battle.skills[e].require.split(","), r = 0; r < t.length; r++) {
                var l = t[r];
                isset(CFG.weapons[l]) ? message(CFG.weapons[l]) : message(l)
            }
        return !1
    }
    return !0
}
function newTroops(e) {
    var a = {};
    for (var t in e) {
        if (isset(e[t].name)) {
            e[t].init = !0,
            isset(g.battle.f[t]) || ($("#battle").append("<div class=troop id=troop" + t + ' tip="-" ctip=t_troop' + (t > 0 ? "1" : "2") + "></div>"),
            e[t].id = t),
            isset(e[t].icon) && ("/" != e[t].icon.charAt(0) && (e[t].icon = "/" + e[t].icon),
            e[t].icon = g.opath + (e[t].npc ? "npc" : "postacie") + e[t].icon);
            e[t].fw = 32,
            e[t].fh = 48,
            g.battle.f[t] = e[t],
            g.battle.f[t].resize = function() {
                this.imgLoaded = !0;
                var e = this.npc ? checkActionExist(this.icon) : 4
                  , a = this.npc ? 1 : 4;
                this.img.src.indexOf("/rip") > -1 && (e = 1,
                a = 1),
                this.fw = this.img.width / e,
                this.fh = this.img.height / a,
                $("#troop" + this.id).stop(1, 1).css({
                    backgroundImage: "url(".concat(this.img.src, "?v=").concat(_CLIENTVER, ")"),
                    backgroundPosition: "0 " + (this.team != g.battle.myteam ? 0 : this.fh) + "px",
                    width: this.fw,
                    height: this.fh,
                    zIndex: 10 - this.y
                }),
                delete this.img,
                repositionTroopsInLine(this.y)
            }
            ,
            $("#troop" + t).click((function(e) {
                var a = parseInt(this.id.substr(5))
                  , t = []
                  , r = hero.id;
                isset(g.battle.f[-r]) && !g.battle.f[-r].npc && (r = -r);
                var l = 1
                  , s = !0;
                if (g.battle.f[a].y - g.battle.f[r].y < 2 && (s = !1),
                a == r) {
                    var n = '<div class="battle-skill skill-icon-id--2">' + _t("move_forward", null, "battle") + "</div>"
                      , i = 'if (canUseSkillOrMessageWhyCanNot(-2)) _g("fight&a=move")';
                    t[0] = [n, i],
                    l = 0
                } else if (g.battle.f[r].team != g.battle.f[a].team) {
                    n = '<div class="battle-skill skill-icon-id--1">' + _t("attack", null, "battle") + "</div>",
                    i = 'if (canUseSkillOrMessageWhyCanNot(-1)) _g("fight&a=strike&id=' + a + '")';
                    t[0] = [n, i],
                    l = 2
                }
                for (var o in g.battle.skills)
                    if (-1 != o && -2 != o && 0 != o) {
                        var b = g.battle.skills[o]
                          , m = !1;
                        if (8 & b.attr && !l && (m = !0),
                        16 & b.attr && 1 == l && (m = !0),
                        24 & b.attr || 2 != l || (m = !0),
                        2 & b.attr && s && (m = !1),
                        m) {
                            n = '<div class="battle-skill skill-icon-id-' + o + '">' + b.name + "(" + b.cost + ")</div>",
                            i = "if (canUseSkillOrMessageWhyCanNot(" + o + ')) _g("fight&a=spell&s=' + o + "&id=" + a + '")';
                            t.push([n, i])
                        }
                    }
                if (t.length > 0) {
                    $("#battle").offset();
                    if (showMenu(e, t, !0),
                    isset(g.battle.f[r].doublecastcost))
                        if (0 != (l = g.battle.f[r].doublecastcost).length) {
                            var _ = g.battle.skills[l[0]].name + "(" + l[1] + ")";
                            $(".skill-icon-id-" + l[0]).html(_)
                        }
                    if (isset(g.battle.f[r].cooldowns)) {
                        var c = g.battle.f[r].cooldowns;
                        for (o = 0; o < c.length; o++) {
                            var d = (l = c[o])[1];
                            if (0 != d) {
                                var v = $(".skill-icon-id-" + l[0]);
                                v.parent().addClass("cooldown-disabled");
                                _ = v.html();
                                v.html(_ + '<div class="cooldown-left">' + d + "t</div>")
                            }
                        }
                    }
                    isset(g.battle.f[r].combo) && updatecomboSkilsMax(g.battle.f[r].combo),
                    setDisabledSkills(g.battle.f[a])
                }
            }
            )).rightClick((function(e) {
                var a = parseInt(this.id.substr(5));
                hero.id == a ? _g("fight&a=move") : g.battle.f[a].team != g.battle.myteam && _g("fight&a=strike&id=" + a)
            }
            )).disableContextMenu()
        }
        isset(e[t].hpp) && 0 == e[t].hpp && (g.battle.f[t].dead = !0,
        e[t].icon = "/img/rip" + (t > 0 ? "1" : "2") + ".gif",
        isset(g.battle.activeEnemy) && t == g.battle.activeEnemy.id && ($("#troop" + g.battle.activeEnemy.id).removeClass("selected").css("z-index", g.battle.activeEnemy.oldZIndex),
        delete g.battle.activeEnemy)),
        isset(e[t].cooldowns) && (g.battle.f[t].cooldowns = e[t].cooldowns),
        isset(e[t].doublecastcost) && (g.battle.f[t].doublecastcost = e[t].doublecastcost),
        isset(e[t].combo) && (g.battle.f[t].combo = e[t].combo),
        isset(e[t].hpp) && (g.battle.f[t].hpp = e[t].hpp),
        isset(e[t].buffs) && (g.battle.f[t].buffs = e[t].buffs),
        isset(e[t].energy) && (g.battle.f[t].energy = e[t].energy,
        g.battle.f[t].mana = e[t].mana,
        t == hero.id && ($("#battlemana").html(e[t].mana),
        $("#battleenergy").html(e[t].energy),
        g.battle.heroMana = e[t].mana,
        g.battle.heroEnergy = e[t].energy)),
        isset(e[t].y) && (1 != g.battle.myteam && (e[t].y = 5 - e[t].y),
        updateLine(t, e[t].y),
        a[e[t].y] = !0),
        isset(e[t].icon) && (g.battle.f[t].icon = e[t].icon,
        g.battle.f[t].img = new Image,
        $(g.battle.f[t].img).on("load", $.proxy(g.battle.f[t], "resize")).on("error", (function() {
            log($(this).attr("src"), 2)
        }
        )).attr({
            src: e[t].icon
        })),
        $("#troop" + t).attr("tip", "<b>" + parseContentBB(g.battle.f[t].name, !1) + "</b>Lvl: " + g.battle.f[t].lvl + g.battle.f[t].prof + "<br><br><i>" + _t("life_percent %val%", {
            "%val%": g.battle.f[t].hpp
        }, "battle") + (isset(g.battle.f[t].energy) ? "<br>" + _t("energy_amount %val%", {
            "%val%": g.battle.f[t].energy + "/" + g.battle.f[t].energy0
        }, "battle") + "<br>" + _t("mana_amount %val%", {
            "%val%": g.battle.f[t].mana + "/" + g.battle.f[t].mana0
        }, "battle") : "") + "</i>")
    }
    for (var r in a)
        repositionTroopsInLine(r)
}
function updatecomboSkilsMax(e) {
    for (var a = g.battle.skills_combo_max, t = 0; t < a.length; t++) {
        for (var r = a[t], l = $("<div>").addClass("combo-wrapper"), s = r[1], n = 0; n < s; n++) {
            var i = $("<div>").addClass("combo-point");
            n < e && i.addClass("active"),
            l.append(i)
        }
        $(".skill-icon-id-" + r).append(l)
    }
}
function updateLine(e, a) {
    var t = g.battle.f[e].y;
    g.battle.f[e].y = a;
    for (var r = !1, l = 0; l < g.battle.line[a].length; l++)
        if (g.battle.line[a][l] == e) {
            r = !0;
            break
        }
    if (r || g.battle.line[a].push(e),
    t != a)
        for (l = 0; l < g.battle.line[t].length; l++)
            if (g.battle.line[t][l] == e) {
                delete g.battle.line[t][l];
                break
            }
}
function repositionTroopsInLine(e) {
    if (g.battle) {
        var a, t = calculateLineWidth(e), r = 0, l = 256 - Math.round(t / 2), s = g.battle.line[e].some((function(e) {
            return e < 0
        }
        ));
        for (var n in g.battle.line[e])
            if ((a = g.battle.f[g.battle.line[e][n]]).imgLoaded) {
                a.ry = 380 - 30 * e - a.fh,
                a.rx = l + r + (1 & e ? 16 : -16);
                var i = 10 - e;
                i = s && g.battle.line[e][n] > 0 ? i + 1 : i,
                g.battle.auto || a.init || 0 == a.hpp ? ($("#troop" + a.id).css({
                    left: a.rx,
                    top: a.ry,
                    zIndex: i
                }),
                a.init && (a.init = !1)) : $("#troop" + a.id).stop(!0).animate({
                    left: a.rx,
                    top: a.ry
                }, 500).css({
                    zIndex: i
                }),
                r += Math.round(a.fw / g.battle.wRatio) < 32 ? 32 : Math.round(a.fw / g.battle.wRatio)
            }
    }
}
function calculateLineWidth(e) {
    var a = 0;
    for (var t in g.battle.line[e])
        t == g.battle.line[e].length ? a += g.battle.f[g.battle.line[e][t]].fw : a += Math.round(g.battle.f[g.battle.line[e][t]].fw / g.battle.wRatio) < 32 ? 32 : Math.round(g.battle.f[g.battle.line[e][t]].fw / g.battle.wRatio);
    return a
}
function battleMsg(e, a) {
    var t = e;
    e = e.split(";"),
    isset(a) || (a = !1);
    var r = 0
      , l = 0
      , s = !1;
    if (e[0].indexOf("=") > 0) {
        var n = e[0].split("=");
        r = parseInt(n[0]),
        isset(g.battle.f[r]) && (g.battle.f[r].hpp = parseInt(n[1])),
        s = !0
    } else
        r = parseInt(e[0]);
    if (e[1].indexOf("=") > 0) {
        n = e[1].split("=");
        l = parseInt(n[0]),
        isset(g.battle.f[l]) && (g.battle.f[l].hpp = parseInt(n[1]))
    } else
        l = parseInt(e[1]);
    var i = r ? g.battle.f[r] : {
        name: "BÅÄD#1!"
    }
      , o = "(a)"
      , b = l ? g.battle.f[l] : {
        name: "BÅÄD#2!"
    }
      , m = "(a)";
    isset(i) && "x" != i.gender && (o = "k" == i.gender ? "a" : ""),
    isset(b) && "x" != b.gender && (m = "k" == b.gender ? "a" : ""),
    e.splice(0, 2);
    var _ = ["", "", ""]
      , c = ""
      , d = ""
      , v = ""
      , u = 0 != r && 0 == l && s
      , f = "";
    for (var p in e) {
        p == e.length - 1 && u && (f = i.name,
        i.name += "(" + i.hpp + "%)");
        var h = e[p].split("=");
        switch (h[0]) {
        case "winner":
            if ("?" == h[1])
                _[1] += _t("battle_no_winner", null, "battle");
            else if (h[1].indexOf(",") < 0) {
                o = "";
                for (var k in g.battle.f)
                    g.battle.f[k].name == h[1] && "k" == g.battle.f[k].gender ? o = "a" : g.battle.f[k].name == h[1] && "x" == g.battle.f[k].gender && (o = "(a)");
                _[1] += _t("winner_is %name% %posfix%", {
                    "%posfix%": o,
                    "%name%": h[1]
                }, "battle")
            } else
                _[1] += _t("winner_team_is %name% %posfix%", {
                    "%name%": h[1]
                }, "battle");
            c = "win";
            break;
        case "loser":
            if (h[1].indexOf(",") < 0) {
                o = "";
                for (var k in g.battle.f)
                    g.battle.f[k].name == h[1] && "k" == g.battle.f[k].gender ? o = "a" : g.battle.f[k].name == h[1] && "x" == g.battle.f[k].gender && (o = "(a)");
                _[1] += _t("loser_is %name% %posfix%", {
                    "%posfix%": o,
                    "%name%": h[1]
                }, "battle")
            } else
                _[1] += _t("loser_team_is %name% %posfix%", {
                    "%name%": h[1]
                }, "battle");
            c = "win";
            break;
        case "flee":
            var w = _slicedToArray(t.split(";")[0].split("="), 2)
              , y = (w[0],
            w[1]);
            _[1] += _t("msg_flee %name% %hp%", {
                "%name%": f,
                "%hp%": y + "%"
            }),
            c = "txt";
            break;
        case "txt":
            _[1] += h[1],
            c = "txt";
            break;
        case "loot":
            _[1] += _t("msg_loot %name% %g1% %m1%", {
                "%name%": i.name,
                "%g1%": o,
                "%m1%": h[1]
            }),
            c = "loot";
            break;
        case "dloot":
            _[1] += _t("msg_dloot %name% %g1% %m1%", {
                "%name%": i.name,
                "%g1%": o,
                "%m1%": h[1]
            }),
            c = "loot";
            break;
        case "step":
            _[1] += _t("msg_step %name% %g1%", {
                "%name%": i.name,
                "%g1%": o
            }),
            c = "neu";
            break;
        case "afterheal":
            _[1] += _t("msg_afterheal %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "reusearrows":
            1 == h[1] ? _[1] += _t("msg_reusearrows_one") : h[1] < 5 ? _[1] += _t("msg_reusearrows %val% %arrows%", {
                "%val%": h[1],
                "%arrows%": _t("part_arrows_plural1")
            }) : _[1] += _t("msg_reusearrows %val% %arrows%", {
                "%val%": h[1],
                "%arrows%": _t("part_arrows_plural2")
            }),
            _[1] += " " + i.name + ".<br>",
            c = "neu";
            break;
        case "wound":
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_wound %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_wound_multi %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>",
            c = "neu";
            break;
        case "+woundfrost":
            _[1] += _t("msg_woundfrost %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "+woundpoison":
            _[1] += _t("msg_woundpoison %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "+of_woundpoison":
            _[1] += _t("msg_of_woundpoison %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "+woundmagic":
            _[1] += _t("msg_woundmagic %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "+of_woundmagic":
            _[1] += _t("msg_of_woundmagic %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "critwound":
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_critwound %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_critwound %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>",
            c = "neu";
            break;
        case "injure":
            _[1] += _t("msg_injure %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "poison":
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_poison %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_poison %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>",
            c = "neu",
            c = "neu";
            break;
        case "heal":
            var C = h[1].split(",");
            C.length > 1 ? _[1] += _t("msg_heal %gain_lost% %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": C[0],
                "%val1%": C[1],
                "%gain_lost%": C[0] >= 0 ? _t("part_gained") : _t("part_lost")
            }) + "<br>" : _[1] += _t("msg_heal %gain_lost% %name% %val%", {
                "%name%": i.name,
                "%val%": C[0],
                "%gain_lost%": C[0] >= 0 ? _t("part_gained") : _t("part_lost")
            }) + "<br>",
            c = "neu";
            break;
        case "heal_target":
            1 == (M = h[1].split(",")).length ? _[1] += _t("msg_heal_target %target% %val%", {
                "%target%": b.name,
                "%val%": M[0]
            }) + "<br>" : _[1] += _t("msg_heal_target-multi %target% %val% %val2%", {
                "%target%": b.name,
                "%val%": M[0],
                "%val2%": M[1]
            }) + "<br>";
            break;
        case "fire":
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_fire %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_fire %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>",
            c = "neu";
            break;
        case "light":
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_light %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_light %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>",
            c = "neu";
            break;
        case "frost":
            var x;
            1 == (x = h[1].split(",")).length ? _[1] += _t("msg_frost %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>" : _[1] += _t("msg_frost %name% %val0% %val1%", {
                "%name%": i.name,
                "%val0%": x[0],
                "%val1%": x[1]
            }) + "<br>";
            break;
        case "shout":
            _[1] += _t("msg_shout %name%", {
                "%name%": i.name,
                "%name2%": h[1]
            }) + "<br>",
            c = "neu";
            break;
        case "en-regen":
            _[1] += _t("msg_en-regen %gain_lost% %name% %val%", {
                "%name%": i.name,
                "%val%": h[1],
                "%gain_lost%": h[1] > 0 ? _t("part_gained") : _t("part_lost")
            }) + "<br>",
            c = "neu";
            break;
        case "achpp_per":
            _[1] += _t("achpp_per", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "allslow":
            _[1] += _t("msg_allslow") + "<br>";
            break;
        case "arrowrain":
            _[1] += _t("msg_arrowrain") + "<br>";
            break;
        case "aura-ac":
            _[1] += _t("msg_aura-ac %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "aura-resall":
            _[1] += _t("msg_aura-resall %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "aura-sa":
            _[1] += _t("msg_aura-sa %val%", {
                "%val%": mp(h[1] / 100)
            }) + "<br>";
            break;
        case "bandage":
            1 == (M = h[1].split(",")).length ? _[1] += _t("msg_aura-bandage %val%", {
                "%val%": M[0],
                "%name%": i.name
            }) + "<br>" : _[1] += _t("msg_aura-bandage-multi %val% %val2%", {
                "%name%": i.name,
                "%val%": M[0],
                "%val2%": M[1]
            }) + "<br>";
            break;
        case "blizzard":
            _[1] += _t("msg_blizzard") + "<br>";
            break;
        case "cover":
            _[1] += _t("msg_cover") + "<br>";
            break;
        case "disturb":
            _[1] += _t("msg_disturb") + "<br>";
            break;
        case "doubleshoot":
            _[1] += _t("msg_doubleshoot %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "energy":
            _[1] += _t("msg_energy %name% %gain_loss% %val%", {
                "%name%": i.name,
                "%gain_loss%": h[1] > 0 ? _t("part_loss_en") : _t("part_gain_en"),
                "%val%": Math.abs(h[1])
            }) + "<br>";
            break;
        case "en-regen-cast":
            _[1] += _t("msg_en-regen-cast %name% %target%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "firewall":
        case "reddest_per0":
        case "-reddest_per0":
        case "chainlightning":
        case "+rotatingblade":
        case "daggerthrow":
        case "balloflight":
            break;
        case "thunder":
            _[1] += _t("msg_thunder %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "storm":
            _[1] += _t("msg_storm %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "fireshield":
            _[1] += _t("msg_fireshield %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "lightshield":
            _[1] += _t("msg_lightshield %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "frostshield":
            _[1] += _t("msg_frostshield %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "sunshield_per":
        case "sunshield":
            _[1] += _t("msg_sunshield %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "sunreduction":
            _[1] += _t("msg_sunreduction %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "footshoot":
            _[1] += _t("msg_footshoot %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "healall":
            _[1] += _t("msg_healall %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "manatransfer":
            _[1] += _t("msg_manatransfer %name% %val% %name2%", {
                "%name2%": b.name,
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "soullink":
            _[1] += _t("msg_soullink %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "stinkbomb":
            _[1] += _t("msg_stinkbomb %name% %name2%", {
                "%name%": i.name,
                "%name2%": b.name
            }) + "<br>";
            break;
        case "managain":
            _[1] += _t("msg_managain %name% %val%", {
                "%name%": i.name,
                "%val%": mp(h[1])
            }) + "<br>";
            break;
        case "insult":
            _[1] += _t("msg_insult %name% %name2% %val%", {
                "%name%": i.name,
                "%val%": h[1],
                "%name2%": b.name
            }) + "<br>";
            break;
        case "prepare":
            _[1] += _t("msg_prepare %name%", {
                "%name%": i.name,
                "%name2%": h[1]
            }) + "<br>",
            c = "auto";
            break;
        case "tspell":
            _[1] += _t("msg_tspell %name%", {
                "%name%": i.name,
                "%name2%": h[1]
            }) + "<br>",
            c = "auto";
            break;
        case "legbon_lastheal":
            var I = h[1].split(",");
            _[1] += _t("msg_legbon_lastheal %val%", {
                "%val%": I[1],
                "%val2%": I[0]
            }) + "<br>";
            break;
        case "combo-max":
            _[1] += _t("msg_combo-max", {
                "%val%": h[1]
            });
            break;
        case "poisonspread":
            _[1] += _t("msg_poisonspread") + h[1] + "<br>";
            break;
        case "poisonspread_failkey":
            _[1] += _t("msg_poisonspread_failkey") + "<br>";
            break;
        case "removeslow-allies":
            _[1] += _t("msg_removeslow-allies") + "<br>";
            break;
        case "removestun-allies":
            _[1] += _t("msg_removestun-allies") + "<br>";
            break;
        case "of-woundstart":
            _[1] += _t("msg_of-woundstart") + "<br>";
            break;
        case "lowheal_per-enemies":
            _[1] += _t("msg_lowheal_per-enemies val", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+superspell-dispel":
            _[1] += _t("msg_+dispel") + "<br>";
            break;
        case "-tenacity":
            _[1] += _t("msg_-tenacity") + "<br>";
            break;
        case "+oth_dmg":
            I = h[1].split(",");
            _[1] += "<b class=dmg" + I[1] + ">" + _t("msg_+oth_dmg %val% %name%", {
                "%val%": I[0],
                "%name%": I[2]
            }) + "<br>",
            c = "auto";
            break;
        case "+oth_cover":
            I = h[1].split(",");
            _[1] += _t("msg_+oth_cover %val% %name%", {
                "%val%": I[0],
                "%name%": I[2]
            }) + "<br>";
            break;
        case "+exp":
            _[1] += _t("msg_+exp %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "win";
            break;
        case "+ph":
            _[1] += _t("msg_+ph %val%", {
                "%val%": h[1]
            }) + "<br>",
            c = "win";
            break;
        case "+of_dmg":
            d += "<b class=dmgo>+" + h[1] + "</b>";
            break;
        case "+thirdatt":
            _[1] += _t("+third_strike") + "<br>",
            d += "<b class=third>+" + h[1] + "</b>";
            break;
        case "+crit":
            _[1] += _t("msg_+crit") + "<br>";
            break;
        case "+verycrit":
            _[1] += _t("msg_+verycrit") + "<br>";
            break;
        case "+of_crit":
            _[1] += _t("msg_+of_crit") + "<br>";
            break;
        case "+wound":
            _[1] += _t("msg_+wound") + "<br>";
            break;
        case "+of_wound":
            _[1] += _t("msg_+of_wound") + "<br>";
            break;
        case "+critwound":
            _[1] += _t("msg_+critwound") + "<br>";
            break;
        case "+critslow":
            _[1] += _t("msg_+hithurt %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+critsa":
            _[1] += _t("msg_+critsa %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+pierce":
            _[1] += _t("msg_+pierce") + "<br>";
            break;
        case "+acdmg":
            _[1] += _t("msg_+acdmg %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+acdmg_destroyed":
            _[1] += _t("msg_+acdmg_destroyed") + "<br>";
            break;
        case "+resdmg":
            _[1] += _t("msg_+resdmg %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+stun":
            _[1] += _t("msg_+stun") + "<br>";
            break;
        case "+stun2":
            _[1] += _t("msg_+stun2") + "<br>";
            break;
        case "+stun2-f":
            _[1] += _t("msg_+stun2-f") + "<br>";
            break;
        case "+stun2-l":
            _[1] += _t("msg_+stun2-l") + "<br>";
            break;
        case "+stun2-c":
            _[1] += _t("msg_+stun2-c") + "<br>";
            break;
        case "+stun2-d":
            _[1] += _t("msg_+stun2-d") + "<br>";
            break;
        case "+freeze":
            _[1] += _t("msg_+freeze") + "<br>";
            break;
        case "+distract":
            _[1] += _t("msg_+distract") + "<br>";
            break;
        case "+fastarrow":
            _[1] += _t("msg_+fastarrow") + "<br>";
            break;
        case "-redmanadest":
            _[1] += _t("msg_-redmanadest %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-redendest":
            _[1] += _t("msg_-redendest %val%", {
                "%val%": h[1]
            }) + "<br> ";
            break;
        case "+lowheal2turns":
            _[1] += _t("msg_+lowheal2turns %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-lowcritallval":
            _[1] += _t("msg_-lowcritallval %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "surpass_bonus_total":
            _[1] += _t("surpass_bonus_total %val% %name%", {
                "%val%": h[1],
                "%name%": i.name.replace(new RegExp("\\(.+?\\)"), "")
            }) + "<br>";
            break;
        case "+engback":
            _[1] += _t("msg_+engback %val%", {
                "%val%": mp(h[1])
            }) + "<br>";
            break;
        case "+swing":
            _[1] += _t("msg_+swing") + "<br>";
            break;
        case "+injure":
            _[1] += _t("msg_+injure %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+firearrow":
            _[1] += _t("msg_+firearrow") + "<br>";
            break;
        case "+manadest":
        case "-manadest":
        case "+endest":
        case "-endest":
            1 == (M = h[1].split(",")).length ? _[1] += _t("msg_".concat(h[0], " %val%"), {
                "%val%": M[0]
            }) + "<br>" : _[1] += _t("msg_".concat(h[0], "_multi %val%"), {
                "%val%": M[0],
                "%val2%": M[1]
            }) + "<br>";
            break;
        case "+abdest":
            _[1] += _t("msg_+abdest %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+actdmg":
            _[1] += _t("msg_+actdmg %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+resdmgf":
            _[1] += _t("msg_+resdmgf %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+resdmgc":
            _[1] += _t("msg_+resdmgc %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+resdmgl":
            _[1] += _t("msg_+resdmgl %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+legbon_verycrit":
            _[1] += _t("msg_+legbon_verycrit") + "<br>";
            break;
        case "-legbon_cleanse":
            _[2] += _t("msg_-legbon_cleanse") + "<br>";
            break;
        case "-legbon_glare":
            _[2] += _t("msg_-legbon_glare") + "<br>";
            break;
        case "+superspell-prevented":
            _[2] += _t("msg_+superspell-prevented") + "<br>";
            break;
        case "+legbon_curse":
            _[1] += _t("msg_+legbon_curse") + "<br>";
            break;
        case "+legbon_pushback":
            _[1] += _t("msg_+legbon_pushback") + "<br>";
            break;
        case "+legbon_holytouch":
            _[1] += _t("msg_+legbon_holytouch %val%") + "<br>";
            break;
        case "legbon_holytouch_heal":
            _[1] += _t("msg_legbon_holytouch_heal %val%", {
                "%val%": h[1],
                "%name%": i.name
            }) + "<br>",
            c = "neu";
            break;
        case "-legbon_dmgred":
            _[1] += _t("msg_-legbon_dmgred %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-blok":
            _[2] += _t("msg_-blok %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-evade":
            _[2] += _t("msg_-evade") + "<br>";
            break;
        case "-parry":
            _[2] += _t("msg_-parry") + "<br>";
            break;
        case "-pierceb":
            _[2] += _t("msg_-pierceb") + "<br>";
            break;
        case "-contra":
            _[2] += _t("msg_-contra") + "<br>";
            break;
        case "+rage":
            _[2] += _t("msg_+rage %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-rage":
            _[2] += _t("msg_-rage") + "<br>";
            break;
        case "-absorb":
            _[2] += _t("msg_-absorb %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-absorbm":
            _[2] += _t("msg_-absorbm %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-arrowblock":
            _[2] += _t("msg_-arrowblock") + "<br>";
            break;
        case "-reddest_per":
            _[2] += _t("msg_-reddest_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-thirdatt":
            v += "<b class=third>-" + h[1] + "</b>";
            break;
        case "-legbon_critred":
            _[2] += _t("msg_-legbon_critred") + "<br>";
            break;
        case "-legbon_resgain":
            _[2] += _t("msg_-legbon_resgain") + "<br>";
            break;
        case "ansgame":
            _[1] += _t("msg_ansgame", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "-redabdest_per":
            _[1] += _t("msg_redabdest_per %m1%", {
                "%m1%": h[1]
            }) + "<br>";
            break;
        case "aura-ac_per":
            _[1] += _t("msg_aura-ac_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "aura-sa_per":
            _[1] += _t("msg_aura-sa_per %val%", {
                "%val%": mp(h[1])
            }) + "<br>";
            break;
        case "+energy":
            _[1] += _t("msg_+energy %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "energyout":
            _[1] += _t("msg_energyout %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "mlightshiled":
            _[1] += _t("msg_mlightshiled %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "lightshield2":
            _[1] += _t("msg_lightshield2 %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "antidote":
            _[1] += _t("msg_antidote %val%", {
                "%val%": h[1],
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "stealmana":
            _[1] += _t("msg_stealmana %name%", {
                "%val%": h[1],
                "%target%": b.name
            }) + "<br>";
            break;
        case "rime_per":
            I = h[1].split(",");
            _[1] += _t("msg_rime_per %val% %name%", {
                "%val%": I[0],
                "%name%": i.name
            }) + "<br>";
            break;
        case "trickyknife":
            _[1] += _t("msg_trickyknife %name% %target%", {
                "%name%": i.name,
                "%target%": b.name
            }) + "<br>";
            break;
        case "healall_per":
            1 == (M = h[1].split(",")).length ? _[1] += _t("msg_healall_per %name% %val%", {
                "%name%": i.name,
                "%val%": M[0]
            }) + "<br>" : _[1] += _t("msg_healall_per_multi %name% %val% %val2%", {
                "%name%": i.name,
                "%val%": M[0],
                "%val2%": M[1]
            }) + "<br>";
            break;
        case "+critslow_per":
            _[1] += _t("msg_+critslow_per= %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+critsa_per":
            _[1] += _t("msg_+critsa_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+immobilize":
            _[1] += _t("msg_+immobilize") + "<br>";
            break;
        case "+mcurse":
            _[1] += _t("msg_+mcurse") + "<br>";
            break;
        case "+absorb":
            _[2] += _t("msg_+absorb %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+absorbm":
            _[2] += _t("msg_+absorbm %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "+vulture":
            _[2] += _t("msg_+vulture= %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-redacdmg":
            _[2] += _t("msg_-redacdmg %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-redacdmg_per":
            _[2] += _t("msg_-redacdmg_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-redmanadest_per":
            _[2] += _t("msg_-redmanadest_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-redendest_per":
            _[2] += _t("msg_-redendest_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-resmanaendest":
            I = h[1].split(",");
            _[2] += _t("msg_-resmanaendest %val%", {
                "%val1%": I[0],
                "%val2%": I[1]
            }) + "<br>";
            break;
        case "+critpoison_per":
            _[2] += _t("msg_+critpoison_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "alllowdmg":
            I = h[1].split(",");
            _[1] += _t("msg_alllowdmg %val% %name%", {
                "%val%": I[0],
                "%name%": I[2]
            }) + "<br>";
            break;
        case "allslow_per":
            I = h[1].split(",");
            _[1] += _t("msg_allslow_per %val% %name%", {
                "%val%": I[0],
                "%name%": i.name
            }) + "<br>";
            break;
        case "blackout":
            _[1] += _t("msg_blackout") + "<br>";
            break;
        case "aura-adddmg2_per-meele":
            _[1] += _t("msg_blesswords_perw %val% %name%", {
                "%val%": h[1],
                "%name%": i.name
            }) + "<br>";
            break;
        case "chainlightning_perw":
            _[1] += _t("msg_chainlightning_perw %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "critstagnation":
            _[1] += _t("msg_critstagnation") + "<br>";
            break;
        case "distractshoot":
            _[1] += _t("msg_distractshoot") + "<br>";
            break;
        case "disturbshoot":
            _[1] += _t("msg_disturbshoot") + "<br>";
            break;
        case "vamp":
            _[1] += _t("msg_vamp %val%", {
                "%name%": i.name,
                "%target%": b.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "woundextend":
            _[1] += _t("msg_woundextend %name% %target%", {
                "%name%": i.name,
                "%target%": b.name
            }) + "<br>";
            break;
        case "heal_per":
            _[1] += _t("msg_heal_per %name%", {
                "%name%": i.name,
                "%target%": r == l ? _t("part_himself") : b.name
            }) + "<br>";
            break;
        case "physical":
            _[1] += _t("msg_physical %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "poison_lowdmg_per-enemies":
            _[1] += _t("msg_poison_lowdmg_per-enemies %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "-poison_lowdmg_per":
            _[1] += _t("msg_-poison_lowdmg_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "dmg_hpp":
            _[1] += _t("msg_-dmg_hpp") + "<br>";
            break;
        case "+crush":
        case "vamp_time":
        case "+taken_dmg":
        case "+critpierce":
        case "critval-enemies":
        case "critmval-enemies":
        case "critval-allies":
        case "critmval-allies":
            var M;
            if ("vamp_time" != h[0])
                _[1] += _t("eng_game_only_val_" + h[0] + " %val%", {
                    "%val%": h[1]
                }) + "<br>";
            else
                1 == (M = h[1].split(",")).length ? _[1] += _t("eng_game_only_val_vamp_time %val%", {
                    "%val%": M[0]
                }) + "<br>" : _[1] += _t("eng_game_only_val_vamp_time %val% %val2%", {
                    "%val%": M[0],
                    "%val2%": M[1]
                }) + "<br>";
            break;
        case "+spell-vamp_time":
        case "distortion":
            _[1] += _t("eng_game_only_nick_" + h[0] + " %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "heal_per-enemies":
            _[1] += _t("eng_game_nick_and_value_" + h[0] + " %name% %val%", {
                "%name%": i.name,
                "%val%": Math.abs(h[1])
            }) + "<br>";
            break;
        case "heal_per-allies":
        case "hp_per-allies":
        case "hp_per-enemies":
            _[1] += _t("eng_game_nick_and_value_" + h[0] + " %name% %val%", {
                "%name%": i.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "dmg-target_physical":
            _[1] += _t("eng_game_opponent_nick_and_value_" + h[0] + " %target% %val%", {
                "%target%": b.name,
                "%val%": h[1]
            }) + "<br>";
            break;
        case "spell-taken_dmg":
        case "-spell-distortion":
            _[1] += _t("eng_game_nick_and_opponent_" + h[0] + " %name% %target%", {
                "%name%": i.name,
                "%target%": b.name
            }) + "<br>";
            break;
        case "-spell-immunity_to_dmg":
            _[1] += _t("eng_game_nick_and_friendnick_" + h[0] + " %name%", {
                "%name%": i.name
            }) + "<br>";
            break;
        case "-immunity_to_dmg":
            _[1] += _t("end-game-without-percent" + h[0]) + "<br>";
            break;
        case "resfire_per":
            _[1] += _t("msg_resfire_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "reslight_per":
            _[1] += _t("msg_reslight_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "resfrost_per":
            _[1] += _t("msg_resfrost_per %val%", {
                "%val%": h[1]
            }) + "<br>";
            break;
        case "mana":
            h[1] > 0 ? console.warn("mana error") : _[1] += _t("msg_receivemana %name% %val%", {
                "%name%": i.name,
                "%val%": Math.abs(h[1])
            }) + "<br>";
            break;
        case "tcustom":
            _[1] += _t("msg_tcustom_target %target% %val%", {
                "%target%": b.name,
                "%val%": h[1]
            }) + "<br>",
            c = "txt";
            break;
        case "removedot":
        case "removedot-allies":
        case "removestun":
            _[1] += _t("skill_" + h[0], null, "new_skills") + "<br/>";
            break;
        default:
            "dmg" == h[0].substr(1, 3) ? "+" == h[0].charAt(0) ? d += "<b class=" + h[0].substr(1) + ">+" + h[1] + "</b>" : v += "<b class=" + h[0].substr(1) + ">-" + h[1] + "</b>" : _[2] += _t("msg_unknown_prameter %val%", {
                "%val%": e[p]
            }) + "</b><br>"
        }
    }
    if ("" != f && (i.name = f),
    "auto" == c && (c = g.battle.f[r].team < 2 ? "attack" : "attack2"),
    "" != d && (c = g.battle.f[r].team < 2 ? "attack" : "attack2",
    _[0] = _t("msg_dmgdone %name1% %hpp% %val%", {
        "%name1%": i.name,
        "%hpp%": i.hpp,
        "%val%": d
    }) + "<br>",
    _[2] += _t("msg_dmgtaken %name1% %hpp% %val%", {
        "%name1%": b.name,
        "%hpp%": b.hpp,
        "%val%": v
    }) + "<br>",
    !g.battle.auto)) {
        l = "big" + Math.round(1e3 * Math.random());
        $("#battle").append($("<big id=" + l + ">" + v + "</big>").rightClick((function(e) {
            e.preventDefault()
        }
        ))),
        $("#" + l).css({
            left: b.rx + b.fw / 2 - $("#" + l).width() / 2,
            top: b.ry - 16
        }).animate({
            opacity: 0,
            top: b.ry - 48
        }, 1500),
        setTimeout((function() {
            $("#" + l).remove()
        }
        ), 1500)
    }
    "" != c && (c = " class=" + c);
    var B = "";
    switch (c.split("=")[1]) {
    case "attack2":
        B = "i";
        break;
    case "attack":
        B = "";
        break;
    default:
        B = "neu" == c ? "u" : "b"
    }
    var S = _.join("");
    "pl" == _l() && (S = S.replace(/#/g, o).replace(/\$/g, m));
    var L = strip_tags(S.replace(/<br>/gim, "\n"), !1);
    g.battle.forumLog.push("" == B ? L : "[" + B + "]" + L + "[/" + B + "]"),
    tmpForumLog.push("" == B ? L : "[" + B + "]" + L + "[/" + B + "]");
    var A = _.join("");
    return A = parseContentBB(A, !1),
    "pl" == _l() && (A = A.replace(/#/g, o).replace(/\$/g, m)),
    "<div" + c + ">" + A + "</div>"
}
function attach_battle_log() {
    $("#battlelog").click((function() {
        var e = $("#battle_for_forum");
        0 == e.length && (e = $('<textarea id="battle_for_forum" style="position:relative;top:10px;left:10px;z-index:350;width:345px;height:370px;font-size:11px"></textarea>').click((function() {
            $(this).focus(),
            $(this).select()
        }
        ))),
        showDialog(_t("copy_battle_log"), '<div class="scroll400 questlist"></div>');
        var a = g.battle.forumLog ? g.battle.forumLog : tmpForumLog;
        e.val(a.join("\n")),
        $(e).appendTo("#dlgwin .w1 .w2 .scroll400")
    }
    ))
}
function toggleBattleLog() {
    if ("big" === getCookie("battleLogSize"))
        $("#battlelog,#battlepanelback,#battlepanel,#battle .border-b").removeClass("big"),
        setCookie("battleLogSize", "small");
    else
        $("#battlelog,#battlepanelback,#battlepanel,#battle .border-b").addClass("big"),
        2 == g.chat.state && showChat(1),
        setCookie("battleLogSize", "big");
    map.resizeView()
}
function selectNextEnemy(e) {
    this.activated = !1,
    this.findNext = function(e) {
        var a = null
          , t = [];
        for (var r in g.battle.f)
            g.battle.f[r].hpp > 0 && t.push(r);
        e && (t = t.reverse());
        for (r = 0; r < t.length; r++) {
            if (!isset(g.battle.activeEnemy)) {
                a = t[r];
                break
            }
            if (g.battle.activeEnemy.id == t[r] && isset(t[r + 1])) {
                a = t[r + 1];
                break
            }
        }
        null == a ? isset(g.battle.activeEnemy) && ($("#troop" + g.battle.activeEnemy.id).removeClass("selected").css("z-index", g.battle.activeEnemy.oldZIndex),
        delete g.battle.activeEnemy) : this.activate(a)
    }
    ,
    this.activate = function(e) {
        isset(g.battle.activeEnemy) && $("#troop" + g.battle.activeEnemy.id).css("z-index", g.battle.activeEnemy.oldZIndex),
        $(".troop").removeClass("selected"),
        this.activated = !0,
        g.battle.activeEnemy = {
            id: e,
            oldZIndex: $("#troop" + e).css("z-index")
        },
        $("#troop" + e).addClass("selected").css("z-index", 200)
    }
    ,
    this.findNext(e)
}
$("#battle").on("wheel", (function(e) {
    "battle" == e.target.id && selectNextEnemy(null == e.wheelDelta ? e.detail < 0 : e.wheelDelta < 0)
}
));
var updateCurrent = function(e) {
    isset(e) && (clearCurrentPlayer(),
    $("#troop" + e).append($("<div>").addClass("current-player")))
}
  , clearCurrentPlayer = function() {
    $(".current-player").remove()
}
  , updateBuffs = function() {
    var e = [_t("deep_wound", null, "buff"), _t("wound", null, "buff"), _t("critical_deep_wound", null, "buff"), _t("poisoned", null, "buff"), _t("fire", null, "buff"), _t("swow_down", null, "buff"), _t("speed_up", null, "buff"), _t("frostbite", null, "buff"), _t("shock", null, "buff")];
    for (var a in g.battle.f) {
        var t = $("#troop" + a);
        if (t.find(".buff").remove(),
        g.battle.f[a].buffs && g.battle.f[a].hpp > 0) {
            for (var r = g.battle.f[a].buffs, l = 0; r; )
                l += 1 & r,
                r >>= 1;
            for (var s = 0, n = 0; n < e.length; n++)
                if (g.battle.f[a].buffs >> n & 1) {
                    var i = Math.ceil((l - s) / 2) - 1
                      , o = l - 2 * i >= 2 ? 2 : 1;
                    t.append($('<div tip="' + e[n] + '" style="background-position:' + (16 * -n - 1.5) + 'px -2px" class="buff ' + (1 == g.battle.f[a].team ? "l" : "r") + '"></div>').css({
                        left: t.width() / 2 - 15 * o / 2 + s % 2 * 15,
                        bottom: 15 * i
                    }).click((function() {}
                    ))),
                    s++
                }
        }
    }
};
function battle_surrender() {
    _g("fight&a=surrender")
}
function canLeave() {
    var e = g.battle;
    self.checkWT() && isset(e.f[hero.id].dead) && !e.endBattle ? mAlert(_t("leave_alert", null, "battle"), 2, [function() {
        leaveBattle()
    }
    , function() {}
    ]) : leaveBattle()
}
function checkWT() {
    var e = g.battle.f;
    if (e)
        for (var a in e) {
            var t = e[a].wt;
            if (isset(t) && (t >= 80 && t < 90 || t >= 100))
                return !0
        }
    return !1
}
function hideTroopsIfNotPositioned() {
    var e = $("#battle .troop");
    "0px" === e.css("left") && "0px" === e.css("top") && e.hide()
}
function leaveBattle() {
    _g("fight&a=exit")
}
var __tutorials = {
    active: null,
    activeStep: null,
    queue: [],
    content: $("#tutorials .bubble"),
    val: null,
    areas: [],
    blinker: null,
    start: function(t) {
        if (null !== this.val && isset(this.list[t]) && null === this.active) {
            if (this.val < 0 || 0 != (this.val & Math.pow(2, t)))
                return this.stop();
            var l = this;
            this.active = t,
            this.activeStep = 0,
            this.print(),
            $("#tutorials").fadeIn(),
            this.blinker = setInterval((function() {
                for (var t = 0; t < l.areas.length; t++)
                    "none" != l.areas[t].css("display") && (1 == l.areas[t].css("opacity") ? l.areas[t].css("opacity", .3) : l.areas[t].css("opacity", 1))
            }
            ), 500),
            this.skipSelected(this.active)
        } else
            this.addToQueue(t)
    },
    addToQueue: function(t) {
        isset(this.list[t]) && this.queue.indexOf(t) < 0 && this.queue.push(t)
    },
    runQueue: function() {
        this.queue.length && this.start(this.queue.splice(0, 1))
    },
    next: function() {
        this.activeStep++,
        this.print()
    },
    print: function() {
        g.lock.remove("tutorials"),
        this.clearAreas(),
        Highlighter.hide();
        var t = this
          , l = this.list[this.active][this.activeStep];
        $("#tutorials .bubble").find(".container").html(l.t),
        $("#tutorials .bubble").find(".interface").remove(),
        isset(l.callback) && "function" == typeof l.callback && l.callback(),
        isset(l.a) ? $("#tutorials").attr("class", l.a) : $("#tutorials").attr("class", null),
        isset(l.stop) && l.stop && g.lock.add("tutorials");
        var s = $(document.createElement("div")).addClass("interface");
        s.append($(document.createElement("a")).addClass("end").click((function() {
            t.skipAll()
        }
        )).text(_t("turn_off", null, "tutorials")).attr("tip", _t("turn_off_nfo", null, "tutorials"))),
        this.activeStep == this.list[this.active].length - 1 ? s.append($(document.createElement("a")).text(_t("finish", null, "tutorials")).click((function() {
            t.skip()
        }
        ))) : (s.append($(document.createElement("a")).text(_t("next", null, "tutorials")).click((function() {
            t.next()
        }
        ))),
        s.append($(document.createElement("a")).text(_t("skip", null, "tutorials")).click((function() {
            t.skip()
        }
        )))),
        $("#tutorials .bubble").append(s);
        var i = {
            hs: isset(l.hs) ? l.hs : null,
            ha: isset(l.ha) ? l.ha : null,
            fs: isset(l.fs) ? l.fs : null,
            fa: isset(l.fa) ? l.fa : null,
            nolight: isset(l.nolight) && l.nolight
        };
        this.highlightArea(i),
        this.onresize()
    },
    skip: function() {
        this.skipSelected(this.active),
        this.stop(),
        Highlighter.hide()
    },
    skipSelected: function(t) {},
    stop: function() {
        if (this.active = null,
        this.activeStep = null,
        clearInterval(this.blinker),
        g.lock.remove("tutorials"),
        Highlighter.hide(),
        this.clearAreas(),
        $("#tutorials").hide(),
        this.queue.length) {
            var t = this.queue.splice(0, 1);
            setTimeout("tutorialStart(" + t[0] + ")", 100)
        }
    },
    onresize: function() {
        if (null !== this.activeStep) {
            var t = "center";
            switch (isset(this.list[this.active][this.activeStep].a) && (t = this.list[this.active][this.activeStep].a),
            t) {
            case "center":
                $("#tutorials").css({
                    right: "auto",
                    bottom: "auto",
                    top: "auto",
                    left: "auto"
                }).absCenter();
                break;
            case "bottom":
                $("#tutorials").css({
                    bottom: 10,
                    top: "auto",
                    right: "auto",
                    left: $(window).width() / 2 - $("#tutorials").width() / 2
                });
                break;
            case "top":
                $("#tutorials").css({
                    top: 10,
                    right: "auto",
                    bottom: "auto",
                    left: $(window).width() / 2 - $("#tutorials").width() / 2
                });
                break;
            case "l":
                if (null === Highlighter.coords)
                    break;
                $("#tutorials").css({
                    top: $("#centerbox").offset().top + Highlighter.coords[1] + Highlighter.coords[3] / 2 - $("#tutorials").height() / 2,
                    right: $(window).width() - ($("#centerbox").offset().left + Highlighter.coords[0]) + 10,
                    bottom: "auto",
                    left: "auto"
                });
                break;
            case "r":
                if (null === Highlighter.coords)
                    break;
                $("#tutorials").css({
                    top: $("#centerbox").offset().top + Highlighter.coords[1] + Highlighter.coords[3] / 2 - $("#tutorials").height() / 2,
                    left: $("#centerbox").offset().left + Highlighter.coords[0] + Highlighter.coords[2] + 10,
                    bottom: "auto",
                    right: "auto"
                });
                break;
            case "t":
                if (null === Highlighter.coords)
                    break;
                $("#tutorials").css({
                    bottom: $(window).height() - Highlighter.coords[1] - $("#centerbox").offset().top + 10,
                    left: $("#centerbox").offset().left + Highlighter.coords[0] + Highlighter.coords[2] / 2 - $("#tutorials").width() / 2,
                    top: "auto",
                    right: "auto"
                });
                break;
            case "b":
                if (null === Highlighter.coords)
                    break;
                $("#tutorials").css({
                    top: $("#centerbox").offset().top + Highlighter.coords[1] + Highlighter.coords[3] + 10,
                    left: $("#centerbox").offset().left + Highlighter.coords[0] + Highlighter.coords[2] / 2 - $("#tutorials").width() / 2,
                    bottom: "auto",
                    right: "auto"
                })
            }
        }
    },
    clearAreas: function() {
        for (; this.areas.length > 0; ) {
            this.areas.pop().remove()
        }
    },
    highlightArea: function(t) {
        var l = $("#centerbox2").offset();
        if (t.hs) {
            var s = $(t.hs);
            if (".gw" == t.hs)
                ;
            else {
                var i = s.offset();
                Highlighter.lightArea(i.left - l.left, i.top - l.top, s.width(), s.height())
            }
        }
        if (t.ha && Highlighter.lightArea(t.ha[0], t.ha[1], t.ha[2], t.ha[3]),
        t.fs)
            for (var e = $(t.fs), a = 0; a < e.length; a++) {
                s = $(e[a]),
                i = {};
                var o = $(document.createElement("div"));
                i = ".gw" == t.fs ? {
                    top: parseInt(s.css("top")),
                    left: parseInt(s.css("left"))
                } : s.offset(),
                o.css({
                    top: i.top - (".gw" == t.fs ? 0 : l.top) - 2,
                    left: i.left - (".gw" == t.fs ? 0 : l.left) - 2,
                    width: s.width(),
                    height: s.height()
                }).addClass("tut_area"),
                $(".gw" == t.fs ? "#base" : "#centerbox2").append(o),
                this.areas.push(o)
            }
        if (t.fa) {
            var r = t.fa;
            for (a = 0; a < r.length; a++) {
                var u = r[a]
                  , h = $(document.createElement("div"));
                h.css({
                    top: u[1],
                    left: u[0],
                    width: u[2],
                    height: u[3]
                }).addClass("tut_area").mouseover((function() {
                    $(this).css("display", "none")
                }
                )),
                $("#centerbox2").append(h),
                this.areas.push(h)
            }
        }
    },
    skipAll: function() {
        _g("tutorial&opt=-" + (this.val | Math.pow(2, this.active))),
        this.stop()
    },
    list: {
        0: [{
            t: _t("t_0.0", null, "tutorials"),
            stop: !0
        }, {
            t: _t("t_0.1", null, "tutorials"),
            stop: !0,
            a: "t",
            callback: function() {
                Highlighter.startH.synchroStart("tutorial")
            }
        }, {
            t: _t("t_0.2", null, "tutorials"),
            fs: "#helpbut",
            a: "l",
            stop: !0
        }],
        1: [{
            t: _t("t_1.0", null, "tutorials")
        }],
        2: [{
            t: _t("t_2.0", null, "tutorials")
        }, {
            t: _t("t_2.1", null, "tutorials")
        }, {
            t: _t("t_2.2", null, "tutorials"),
            a: "l",
            hs: "#b_map",
            fs: "#b_map",
            nolight: !0
        }],
        3: [{
            t: _t("t_3.0", null, "tutorials"),
            a: "bottom"
        }, {
            t: _t("t_3.1", null, "tutorials"),
            a: "bottom"
        }],
        4: [{
            t: _t("t_4.0", null, "tutorials"),
            a: "l",
            hs: "#base3"
        }],
        5: [{
            t: _t("t_5.0", null, "tutorials"),
            a: "l",
            hs: "#life1",
            fs: "#life1",
            nolight: !0
        }],
        6: [{
            t: _t("t_6.0", null, "tutorials"),
            a: "l",
            hs: "#life1",
            fs: "#life1",
            nolight: !0
        }],
        7: [{
            t: _t("t_7.0", null, "tutorials"),
            a: "l",
            hs: "#gold",
            fs: "#gold"
        }, {
            t: _t("t_7.1", null, "tutorials")
        }, {
            t: _t("t_7.2", null, "tutorials"),
            ha: [524, 105, 115, 147]
        }, {
            t: _t("t_7.3", null, "tutorials"),
            a: "l",
            hs: "#stats"
        }],
        8: [{
            t: _t("t_8.0", null, "tutorials"),
            a: "l",
            fs: "#b_quests",
            hs: "#b_quests"
        }],
        9: [{
            t: _t("t_9.0", null, "tutorials")
        }],
        10: [{
            t: _t("t_10.0", null, "tutorials")
        }, {
            t: _t("t_10.1", null, "tutorials")
        }],
        11: [{
            t: _t("t_11.0", null, "tutorials")
        }],
        12: [{
            t: _t("t_12.0", null, "tutorials")
        }, {
            t: _t("t_12.1", null, "tutorials")
        }],
        13: [{
            t: _t("t_13.0", null, "tutorials")
        }],
        14: [{
            t: _t("t_14.0", null, "tutorials")
        }, {
            t: _t("t_14.1", null, "tutorials")
        }, {
            t: _t("t_14.2", null, "tutorials")
        }, {
            t: _t("t_14.3", null, "tutorials")
        }],
        15: [{
            t: _t("t_15.0", null, "tutorials"),
            a: "t",
            hs: "#pvpmode",
            fs: "#pvpmode"
        }, {
            t: _t("t_15.1", null, "tutorials"),
            a: "t",
            hs: "#b_pvp",
            fs: "#b_pvp"
        }, {
            t: _t("t_15.2", null, "tutorials")
        }, {
            t: _t("t_15.3", null, "tutorials")
        }],
        16: [{
            t: _t("t_16.0", null, "tutorials"),
            a: "l",
            hs: "#base3"
        }, {
            t: _t("t_16.1", null, "tutorials"),
            a: "l",
            hs: "#b_skills",
            fs: "#b_skills"
        }, {
            t: _t("t_16.2", null, "tutorials")
        }, {
            t: _t("t_16.3", null, "tutorials")
        }],
        17: [{
            t: _t("t_17.0", null, "tutorials")
        }],
        18: [{
            t: _t("t_18.0", null, "tutorials"),
            hs: ".gw",
            callback: function() {
                Highlighter.startG.synchroStart("tutorial")
            }
        }],
        19: [{
            t: _t("t_19.0", null, "tutorials"),
            a: "l",
            hs: "#autobattleButton",
            fs: "#autobattleButton"
        }],
        20: [{
            t: _t("t_20.0", null, "tutorials"),
            a: "r",
            hs: "#shop_store"
        }, {
            t: _t("t_20.1", null, "tutorials"),
            a: "b",
            hs: "#shop_buy"
        }, {
            t: _t("t_20.2", null, "tutorials"),
            a: "t",
            hs: "#shop_sell"
        }, {
            t: _t("t_20.3", null, "tutorials"),
            a: "l",
            hs: "#bagc"
        }],
        21: [{
            t: _t("t_21.0", null, "tutorials")
        }, {
            t: _t("t_21.1", null, "tutorials")
        }]
    }
};
var __skins = {
    skinsQueue: [],
    loadBlocks: 0,
    def: {
        halloween: {
            dir: "img/skins/halloween",
            name: "Halloween 2012",
            css: "#corners .lt-hor{}#corners .lt-ver{top:4px}#corners .ld-hor{top:507px}#corners .ld-ver{top:477px}#corners .rt-hor{left:475px}#corners .rt-ver{left: 492px; top: 5px;}#corners .rd-ver{left: 491px; top: 477px}#corners .rd-hor{left: 475px; top: 507px;}#panel{background:url(img/skins/halloween/panel.png?v=" + _CLIENTVER + ");}#stats{background-image:url(img/skins/halloween/stats.png?v=" + _CLIENTVER + ");}#buttons DIV {background-image:url(img/skins/halloween/if-buttons.png?v=" + _CLIENTVER + ")}#bottombar {background:url(img/skins/halloween/bottom-bar.png?v=" + _CLIENTVER + ");}#bchat{background:url(img/skins/halloween/if-buttons.png?v=" + _CLIENTVER + ") no-repeat -136px -44px;}#pvpmode {background-image:url(img/skins/halloween/pvpmode.png?v=" + _CLIENTVER + ");}#logoutbut{background:url(img/skins/halloween/if-buttons.png?v=" + _CLIENTVER + ") no-repeat -68px -44px;}#helpbut {background:url(img/skins/halloween/if-buttons.png?v=" + _CLIENTVER + ") no-repeat 0 -44px;}#inpchat {background:url(img/skins/halloween/bottom-bar.png?v=" + _CLIENTVER + ") no-repeat -50px -10px;}#skillSwitch.first{background: url(img/skins/halloween/um_set.gif?v=" + _CLIENTVER + ") 0px -32px;}#skillSwitch.second{background: url(img/skins/halloween/um_set.gif?v=" + _CLIENTVER + ") 0px 0px;}#nick{color: black;text-shadow: 0px 0px 5px orange, 0px 0px 10px red, 0px 0px 5px orange;}#lagmeter{background:url(img/skins/halloween/lagometer.png?v=" + _CLIENTVER + ");}#volumeSlider .marker{background-image:url(/img/skins/halloween/music_interface.png?v=" + _CLIENTVER + ")}#startbutton, #shufflebutton, #hdbutton{background-image:url(/img/skins/halloween/music_interface.png?v=" + _CLIENTVER + ")}#chat, #chattabs S{background-image:url(img/skins/halloween/chat.png?v=" + _CLIENTVER + ")}#leorn1, #leorn2{display:none}#chat.left {background-color:#444;background-image:url(img/skins/halloween/chat-left.png?v=" + _CLIENTVER + ")}#chat.left #chattabs s {background-image:url(img/skins/halloween/chat-left.png?v=" + _CLIENTVER + ")}#ver{left:545px;}#life1, #life2, #exp1, #exp2{left:535px}"
        },
        default: {
            dir: "img",
            name: "Default margonem skin"
        }
    },
    load: function(e) {
        if (this.loadBlocks)
            return this.skinsQueue.push(e);
        if (!isset(this.def[e]))
            throw 'Skin "' + e + '" is not defined';
        $("#__loaded_skin").remove(),
        $('<style id="__loaded_skin">' + this.def[e].css + "</style>").appendTo("head");
        for (var n = $("#corners img"), o = 0; o < n.length; o++)
            this.loadBlocks++,
            this.imgObj(this.def[e].dir, $(n.get(o)))
    },
    runQueue: function() {
        this.skinsQueue.length && !this.loadBlocks && this.load(this.skinsQueue.splice(0, 1)[0])
    },
    imgObj: function(e, n) {
        return new function(e, n) {
            var o = n.attr("src").split("/");
            if (o.length) {
                var s = new Image;
                s.src = e + "/" + o[o.length - 1],
                s.onload = function() {
                    n.attr("src", e + "/" + o[o.length - 1]),
                    __skins.loadBlocks--,
                    __skins.runQueue()
                }
                ,
                s.onerror = function() {
                    __skins.loadBlocks--,
                    __skins.runQueue()
                }
            }
        }
        (e,n)
    }
};
function skills() {
    var e = this
      , a = {
        sw: ["weapon"],
        "1h": [1],
        "2h": [2],
        bs: [3],
        dis: [4],
        fire: ["fire"],
        light: ["light"],
        frost: ["frost"],
        sh: [14],
        orb: [2],
        h: [5],
        poison: ["poison"],
        phydis: ["phydis"],
        wound: ["wound"]
    };
    this.isInit = !1,
    this.skills = [];
    var s = []
      , l = [];
    this.init = function() {
        e.isInit = !0;
        var a = drawSIButton(_t("edit"));
        $("#skills_footer").find(".bm-edit-button").append(a),
        $("#skills_footer").find(".info-bm-icon").tip("Funkcja pozwalajÄca na ustalanie kolejnoÅci uÅ¼ywanych umiejÄtnoÅci w walce automatycznej"),
        a.click((function() {
            g.bmEditor.toggleShow()
        }
        ))
    }
    ,
    this.getElement = function(e) {
        return l[e]
    }
    ,
    this.changeSet = function() {
        hero.cur_skill_set++,
        hero.cur_skill_set > 3 && (hero.cur_skill_set = 1),
        _g("skills&set=" + hero.cur_skill_set, (function() {
            $("#skills").is(":visible") && e.show()
        }
        ))
    }
    ,
    this.show = function() {
        s = [],
        e.skills = [],
        l = [],
        _g("skillshop"),
        $("#skills_body").empty(),
        $("#skills_title").find(".resetSkillPoints").remove(),
        e.createResetButton()
    }
    ,
    this.createResetButton = function() {
        var e = drawSIButton(_t("reset_btn", null, "skills"));
        e.addClass("resetSkillPoints"),
        $("#skills_title").append(e),
        e.click((function() {
            _g("skills&reset=1")
        }
        ))
    }
    ,
    this.hide = function() {
        g.bmEditor.visible && g.bmEditor.hidePanel(),
        $("#skills").fadeOut("fast"),
        $("#skills_title .skillLearnInfo").fadeOut("fast"),
        $("#skills_body").empty(),
        e.skills = [],
        g.lock.remove("skills")
    }
    ,
    this.parseStat = function(e) {
        var a = {}
          , s = [];
        isset(e) && e.length > 0 && (s = e.split(";"));
        for (var l = 0; l < s.length; l++) {
            var t = s[l].split("=");
            a[t[0]] = t[1]
        }
        return a
    }
    ,
    this.updateSelectedSkills = function(a) {
        e.selectedSkills = [],
        $("#skills").find(".set-active-state").removeClass("active");
        for (var s = 0, l = 0; l < a.length; l++) {
            var t = a[l];
            parseInt(a[l]) > 0 && s++,
            e.selectedSkills.push(a[l]),
            $(".skill-icon-" + t).parent().parent().parent().find(".set-active-state").addClass("active")
        }
        $("#skillInBattleCount").html("(" + s + "/14)").attr("tip", _t("use_battle_skill"))
    }
    ,
    this.updateFreeSkills = function(a) {
        var s = $("#skills").find(".freeSkillsLabel");
        if (a < 1)
            return s.css("display", "none");
        s.css("display", "block");
        var l = a - unix_time();
        s.html(goldTxt(_t("free_skills") + e.getSecondLeft(l, !0))),
        e.timeInterval && e.clearTimeInterval(),
        e.timeInterval = setInterval((function() {
            s.html(goldTxt(_t("free_skills") + e.getSecondLeft(l, !0))),
            l < 1 && e.timeInterval && (e.clearTimeInterval(),
            s.css("display", "none"),
            _g("skillshop")),
            l--
        }
        ), 1e3)
    }
    ,
    this.getSecondLeft = function(e, a) {
        var s = Math.floor(e / 60)
          , l = Math.floor(s / 60)
          , t = Math.floor(l / 24)
          , r = e - 60 * s
          , c = s - 60 * l
          , i = l - 24 * t;
        return a ? 0 == t && 0 == l ? c + "m : " + r + "s" : 0 == t ? i + "h : " + c + "m" : t + "d : " + i + "h" : t + "d : " + i + "h : " + c + "m : " + r + "s"
    }
    ,
    this.clearTimeInterval = function() {
        clearInterval(e.timeInterval),
        e.timeInterval = null
    }
    ,
    this.new_skill = function(a, l) {
        var t = a[l + 2]
          , r = a[l + 7].split("/")
          , c = a[l + 9].split("|")
          , i = {
            id: a[l],
            name: a[l + 1],
            attr: t,
            grp: a[l + 3],
            xy: a[l + 4],
            desc: a[l + 5],
            req: e.parseStat(a[l + 6]),
            stats: e.parseStat(a[l + 8]),
            next_req: e.parseStat(c[0]),
            next_stat: e.parseStat(c[1]),
            clvl: parseInt(r[0]),
            mlvl: parseInt(r[1]),
            type: 1 & t,
            changed: !1,
            correct: !0,
            ns: [a[l + 6], a[l + 8], c[0], c[1]]
        };
        if (isset(e.skills[i.id])) {
            var n = e.skills[i.id];
            n.ns[0] == i.ns[0] && n.ns[1] == i.ns[1] && n.ns[2] == i.ns[2] && n.ns[3] == i.ns[3] || (i.changed = !0)
        } else
            i.changed = !0;
        e.skills[i.id] = i,
        isset(s[i.grp]) || (s[i.grp] = {
            el: null,
            head: null,
            list: []
        });
        var o = !isset(i.req.reqp) || -1 != i.req.reqp.indexOf(hero.prof);
        -1 == s[i.grp].list.indexOf(i.id) && o && s[i.grp].list.push(i.id)
    }
    ,
    this.skillTip = function(a) {
        var s = "";
        s += "<b>" + a.name + "</b><br>",
        s += "<div class='skill_section'>",
        s += "<div class='skill_sec_header'>" + _t("lower_requirements", null, "skills") + "</div>";
        var l = e.statToText($.extend(a.req, a.next_req));
        (l.length > 0 ? s += l : s += _t("none"),
        s += "</div>",
        s += "<div class='skill_desc skill_section'>" + a.desc + "</div>",
        (l = e.statToText(a.stats)).length > 0) && (s += "<div class='skill_section'>",
        s += "<div class='skill_sec_header'>" + _t("stats_stats", null, "skills") + "</div>",
        s += l,
        s += "</div>");
        if ((l = e.statToText(a.next_stat)).length > 0) {
            s += "<div class='skill_next skill_section'>",
            s += "<div class='skill_sec_header'>" + _t("stats_next_stats", null, "skills") + "</div>",
            s += l,
            s += "</div>",
            s += "<div class='skill_sec_cost" + (e.freeSkills > 0 ? " freeskills" : "") + "'>";
            var t = round(Math.floor(Math.pow(hero.lvl, 1.9)), 1);
            s += _t("cost_lvl %cost%", {
                "%cost%": t
            }, "skills"),
            s += "</div>"
        }
        return s
    }
    ,
    this.parseStatsToItemTip = function(a) {
        var s = a.replace(/\+/g, ";").replace(/:/g, "=")
          , l = this.parseStat(s);
        return e.statToText(l)
    }
    ,
    this.getRoundLang = function(e) {
        return e > 4 ? _t("five_round") : e > 1 ? _t("two_round") : _t("one_round")
    }
    ,
    this.statToText = function(s) {
        var l = [];
        for (var t in s) {
            var r = ""
              , c = t
              , i = s[t]
              , n = i.indexOf("@")
              , o = null;
            if (-1 != n && n < i.length) {
                var d = i.substr(n + 1);
                i = i.substr(0, n),
                o = ("en-regen" != c ? _t("on") : _t("by")) + d + e.getRoundLang(d)
            }
            -1 != (n = i.indexOf("*plvl")) && n < i.length && (i = i.substr(0, n),
            null == o && (o = ""),
            o += _t("value_increase_per_player")),
            -1 != (n = i.indexOf("*cplvl")) && n < i.length && (i = i.substr(0, n),
            null == o && (o = ""),
            o += _t("value_increase_per_player_max"));
            var _ = "default"
              , p = i
              , v = ""
              , h = "normal";
            switch (c) {
            case "step":
            case "norm-atack":
                r += "<span class=" + h + ">" + _t("skill_" + c);
                break;
            case "redacdmg_per":
            case "acshield_per":
            case "perdmg":
            case "ac_per":
            case "pdmg":
            case "ac":
                r += "<span class=" + h + ">" + _t("item_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "decevade_per":
            case "active_decevade_per":
                r += "<span class=" + h + ">" + _t("skills_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v,
                    "%val3%": p < 2 ? _t("percentPoints1") : p > 4 ? _t("percentPoints3") : _t("percentPoints2")
                }, _);
                break;
            case "decevade":
                var u = p > 4 ? "" : "2";
                r += "<span class=" + h + ">" + _t("skills_" + u + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "agi":
            case "firebon":
            case "lightbon":
            case "frostbon":
                r += "<span class=" + h + ">" + _t("skills_" + c + " %val%", {
                    "%val%": mp(Math.floor(100 * parseFloat(p))),
                    "%val2%": mp(Math.floor(100 * parseFloat(v)))
                }, _);
                break;
            case "critslow_per":
            case "critslow":
            case "critsa_per":
            case "critsa":
            case "immobilize":
            case "lastcrit":
            case "redslow":
            case "woundred":
            case "healpower":
            case "engback":
            case "sa-clothes":
            case "red-sa":
            case "footshoot":
            case "critwound":
            case "swing":
            case "distract":
            case "injure":
            case "reusearrows":
            case "pcontra":
            case "fastarrow":
            case "bandage_per":
            case "bandage":
            case "set":
            case "resfrost_per":
            case "resfire_per":
            case "longfireshield":
            case "longfrostshield":
            case "longlightshield":
            case "soullink":
            case "poisonbon":
            case "of-thirdatt":
            case "woundchance":
            case "wounddmgbon_perw":
            case "wounddmgbon":
            case "arrowrain":
            case "insult":
            case "frostpunch":
            case "redstun":
            case "active_redstun":
            case "lightmindmg":
            case "actdmg":
            case "hpsa":
            case "mresdmg":
            case "dmg_evade_hpp-target":
            case "dmg_evade_hpp-target_light":
            case "lightshield2_per":
            case "lightshield_per":
            case "lightshield":
                r += "<span class=" + h + ">" + _t("skills_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "disturbshoot":
                r += "<span class=" + h + ">" + _t("skill_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": 2 * p
                }, _);
                break;
            case "str":
            case "stepslow_per":
            case "poisonbon_poison-perw":
            case "arrowrain_all-perw":
            case "manarestore_per":
            case "rime_per":
            case "firepunch_fire-perw":
            case "heal1_per":
            case "pdmg_physical-perw":
            case "energyrestore_per":
            case "allcritval":
            case "vamp":
            case "reddest_per":
            case "poisonstab_perw":
            case "woundextend":
            case "energyout":
            case "adrenalin_per":
            case "adrenalin_sa_per":
            case "adrenalin_sa_threshold_per":
            case "adrenalin_evade_per":
            case "adrenalin_evade_threshold_per":
            case "critpoison_per":
            case "slowfreeze_per":
            case "absorb_per":
            case "absorbm_per":
            case "heal_per":
            case "distractshoot":
            case "blind_per":
            case "alllowdmg":
            case "aura-adddmg2_per-meele":
            case "firedmg_fire-perw":
            case "chainlightning_perw":
            case "absagain_per":
            case "stealmana_per":
            case "allcritmval":
            case "reslight_per":
            case "mcurse":
            case "weakness_per":
            case "antidote":
            case "lowtension":
            case "vulture_perw":
            case "of-wounddmgbon_perw":
            case "act":
            case "rage_3turns":
            case "critrage_perw":
            case "resfire":
            case "reslight":
            case "resfrost":
            case "adddmg_physical-perw":
            case "active_acdmg_physical-perw":
            case "adddmg_fire-perw":
            case "active_acdmg_per":
            case "doublecastcost_per":
            case "combo-crit":
            case "combo-block":
            case "combo-evade":
            case "combo-wound":
            case "combo-pierce":
            case "combo-skill":
            case "combo-max":
            case "combo_perdmg":
            case "combo_resfire_per":
            case "combo_resfrost_per":
            case "combo_reslight_per":
            case "combo_dmg_hpp-target":
            case "dmg_hpp-target":
            case "combo_dmg_hpp-target_fire":
            case "dmg_hpp-target_fire":
            case "combo_dmg_hpp-target_frost":
            case "dmg_hpp-target_frost":
            case "combo_dmg_hpp-target_light":
            case "dmg_hpp-target_light":
            case "combo_heal_per":
            case "combo_energyrestore_per":
            case "combo_manarestore_per":
            case "combo_lowdmg_enemy":
            case "dmg_hpp-row_fire":
            case "dmg_hpp-row_frost":
            case "dmg_hpp-row_light":
            case "lowheal_per-enemies":
            case "achpp_per":
            case "adrenalin_reddest_threshold_per":
            case "adrenalin_reddest_per_sum":
            case "poisonspread":
                r += "<span class=" + h + ">" + _t("skill_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "trickyknife":
            case "blackout":
            case "reqp":
            case "lvl":
            case "unav":
            case "rotatingblade":
            case "daggerthrow":
            case "chainlightning":
            case "firewall":
            case "balloflight":
                break;
            case "str1h":
            case "str2h":
            case "of-str":
                r += "<span class=" + h + ">" + _t("skill_" + c + " %val%", {
                    "%val%": mp(Math.floor(100 * parseFloat(p))),
                    "%val2%": mp(Math.floor(100 * parseFloat(v)))
                }, _);
                break;
            case "runes":
            case "goldpack":
            case "perheal":
            case "crit":
            case "active_crit":
            case "of-crit":
            case "critval":
            case "of-critval":
            case "critmval":
            case "critmval_f":
            case "critmval_c":
            case "critmval_l":
            case "heal":
            case "pierce":
            case "pierceb":
            case "contra":
            case "parry":
            case "fire":
            case "light":
            case "adest":
            case "absorb":
            case "absorbm":
            case "hpbon":
            case "acdmg_per":
            case "acdmg_physical-perw":
            case "acdmg":
            case "active_acdmg":
            case "resdmg":
            case "en-regen":
            case "manastr":
            case "manarestore":
            case "manatransfer":
            case "stun":
            case "freeze":
            case "hpcost":
            case "cover":
            case "allslow":
            case "allslow_per":
            case "dmg_evade-target_fire-perw":
            case "dmg-target_fire-perw":
            case "firewall_perw":
            case "thunder":
            case "storm":
            case "lowdmg":
            case "lowdmg_self":
            case "lowdmg_enemy":
            case "blizzard":
            case "sunshield_per":
            case "sunreduction":
            case "healall_per":
            case "healall":
            case "heal1":
            case "absorbd":
            case "abdest":
            case "endest":
            case "manadest":
            case "lowevade":
            case "lowcrit":
            case "arrowblock":
            case "redabdest_per":
                r += "<span class=" + h + ">" + _t("bonus_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "evade_per":
                r += "<span class=" + h + ">" + _t("bonus_" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v,
                    "%val3%": p < 2 ? _t("percentPoints1") : p > 4 ? _t("percentPoints3") : _t("percentPoints2")
                }, _);
                break;
            case "hp":
            case "sa_per":
            case "sa2_per":
            case "ds":
            case "dz":
            case "di":
            case "da":
            case "gold":
            case "blok_per":
            case "blok":
            case "evade":
            case "energybon":
            case "energygain":
            case "manabon":
            case "managain":
            case "aura-resall":
                r += "<span class=" + h + ">" + _t("bonus_" + c + " %val%", {
                    "%val%": mp(p),
                    "%val2%": mp(v)
                }, _);
                break;
            case "cooldown":
                r += "<span class=" + h + ">" + _t("skill_" + c, {
                    "%val%": p,
                    "%val2%": v
                }, _),
                r += 1 == p ? _t("turn") : p > 4 ? _t("turn5") : _t("turns");
                break;
            case "reqarrows":
                u = p > 4 ? "5arrow" : p > 1 ? "2arrow" : "arrow";
                r += p + " " + _t(u);
                break;
            case "rage":
                r += "<span class=" + h + ">" + _t("skills_rage %val% %turn%", {
                    "%val%": p,
                    "%turn%": parseInt(p) > 1 ? parseInt(p) > 4 ? _t("five_round") : _t("two_round") : " " + _t("turn"),
                    "%val2%": v
                }, _);
                break;
            case "doubleshoot":
                r += "<span class=" + h + ">" + _t("skill_doubleshoot");
                break;
            case "disturb":
                r += "<span class=" + h + ">" + _t("skills_disturb %val%", {
                    "%val%": p,
                    "%val2%": 2 * parseInt(p),
                    "%val3%": v,
                    "%val4%": 2 * parseInt(v)
                }, _);
                break;
            case "shout":
                r += "<span class=" + h + ">" + _t("skills_shout %val%", {
                    "%val%": p > 1 ? _t("enemies %amount%", {
                        "%amount%": p,
                        "%val2%": v
                    }, _) : p + " " + _t("oneenemy")
                });
                break;
            case "sa1":
                r += "<span class=" + h + ">" + _t("bonus_sa1 %val%", {
                    "%val%": p / 100,
                    "%val2%": 0
                }, _);
                break;
            case "leczy":
                r += p > 0 ? "<span class=" + h + ">" + _t("bonus_leczy %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _) : "<span class=" + h + ">" + _t("bonus_truje %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "fullheal":
                r += "<span class=" + h + ">" + _t("bonus_fullheal %val%", {
                    "%val%": round(p, 2),
                    "%val2%": round(v, 2)
                }, _);
                break;
            case "creditsbon":
                r += "<span class=" + h + ">" + _t("bonus_creditsbon");
                break;
            case "revive":
                r += "<span class=" + h + ">" + _t("revive %amount%", {
                    "%amount%": p,
                    "%val2%": v
                }, _);
                break;
            case "frost":
                b = p.split(","),
                r += "<span class=" + h + ">" + _t("bonus_frost %val% %slow%", {
                    "%val%": b[1],
                    "%slow%": b[0] / 100
                }, _);
                break;
            case "poison":
                b = p.split(","),
                r += "<span class=" + h + ">" + _t("bonus_poison %val% %slow%", {
                    "%val%": b[1],
                    "%slow%": b[0] / 100
                }, _);
                break;
            case "slow":
                r += "<span class=" + h + ">" + _t("bonus_slow %val%", {
                    "%val%": p / 100,
                    "%val2%": 0
                }, _);
                break;
            case "wound":
                b = p.split(","),
                r += "<span class=" + h + ">" + _t("bonus_wound %val% %dmg%", {
                    "%val%": b[0],
                    "%dmg%": b[1]
                }, _);
                break;
            case "energy":
                r += p > 0 ? "<span class=" + h + ">" + _t("bonus_energy1 %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _) : "<span class=" + h + ">" + _t("bonus_energy2 %val%", {
                    "%val%": Math.abs(p),
                    "%val2%": Math.abs(v)
                }, _);
                break;
            case "energyp":
                r += p > 0 ? "<span class=" + h + ">" + _t("bonus_energyp1 %val%", {
                    "%val%": mp(p),
                    "%val2%": mp(v)
                }, _) : "<span class=" + h + ">" + _t("bonus_energyp2 %val%", {
                    "%val%": Math.abs(p),
                    "%val2%": Math.abs(v)
                }, _);
                break;
            case "mana":
                r += p > 0 ? "<span class=" + h + ">" + _t("bonus_mana1 %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _) : "<span class=" + h + ">" + _t("bonus_mana2 %val%", {
                    "%val%": Math.abs(p),
                    "%val2%": Math.abs(v)
                }, _);
                break;
            case "firearrow":
            case "firepunch":
            case "firebolt":
                r += "<span class=" + h + ">" + _t("bonus_firebolt %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "sunshield":
                r += "<span class=" + h + ">" + _t("bonus_sunshield %val%", {
                    "%val%": p,
                    "%val2%": p / 2
                }, _);
                break;
            case "aura-ac_per":
            case "aura-ac":
                r += "<span class=" + h + ">" + _t("bonus_aura-ac %val%", {
                    "%val%": mp(p),
                    "%val2%": mp(v)
                }, _);
                break;
            case "aura-sa_per":
                r += "<span class=" + h + ">" + _t("bonus_aura-sa_per %val%", {
                    "%val%": mp(p),
                    "%val2%": mp(v)
                }, _);
                break;
            case "removedot":
            case "removedot-allies":
            case "removestun":
                r += "<span class=" + h + ">" + _t("skill_" + c, null, "new_skills");
                break;
            case "aura-sa":
                r += "<span class=" + h + ">" + _t("bonus_aura-sa %val%", {
                    "%val%": mp(p / 100),
                    "%val2%": mp(0)
                }, _);
                break;
            case "stinkbomb":
                r += "<span class=" + h + ">" + _t("bonus_stinkbomb %val% %crit%", {
                    "%val%": 2 * parseInt(p),
                    "%crit%": p,
                    "%val2%": 2 * parseInt(v),
                    "%crit2%": v
                }, _);
                break;
            case "reqw":
                b = p.split(",");
                var m = [];
                for (var k in b) {
                    var g = a[b[k]];
                    for (var f in g) {
                        t = g[f];
                        "m" != hero.prof || 1 != t && 2 != t || (t += 5);
                        u = _t("wp_" + t, null, "si_skills_req");
                        m.push(u)
                    }
                }
                r += m.join(", ");
                break;
            case "add_attacks":
                u = p > 1 ? "add_moreAttacks %val%" : "add_attacks %val%";
                r += "<span class=" + h + ">" + _t(u, {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "dmg_to_npc_per":
            case "dmg_from_npc_per":
            case "dmg_to_player_per":
            case "dmg_from_player_per":
            case "chest_armor_per":
            case "critval-enemies":
            case "critval-allies":
            case "critmval-enemies":
            case "critmval-allies":
            case "crush_threshold_per":
            case "crush_dmg_per":
            case "vamp_time_per":
            case "dmg-swing_physical-perw":
            case "taken_dmg_per":
            case "critpierce_per":
            case "dmg-row_fire-perw":
            case "dmg-force-4_light-perw":
            case "hp_per-allies":
            case "hp_per-enemies":
            case "heal_per-allies":
                r += "<span class=" + h + ">" + _t("end-game-percent" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "heal_per-enemies":
                r += "<span class=" + h + ">" + _t("end-game-percent" + c + " %val%", {
                    "%val%": Math.abs(p),
                    "%val2%": Math.abs(v)
                }, _);
                break;
            case "acdmg":
            case "dmg-line_physical":
            case "immunity_to_dmg":
            case "dmg-target_physical":
            case "distortion":
                r += "<span class=" + h + ">" + _t("end-game-without-percent" + c + " %val%", {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "manaendest":
                r += "<span class=" + h + ">" + _t("end-game-more-val" + c + " %val% %val2% %val3% %val4%", {
                    "%val%": p,
                    "%val2%": v,
                    "%val3%": Math.round(p / 3),
                    "%val4%": Math.round(0)
                }, _);
                break;
            case "removeslow-allies":
            case "removestun-allies":
            case "of-woundstart":
            case "poison_lowdmg_per-enemies":
                r += "<span class=" + h + ">" + _t("skill_" + c, {
                    "%val%": p,
                    "%val2%": v
                }, _);
                break;
            case "cooldown":
                r += "<span class=" + h + ">" + _t("skill_" + c, {
                    "%val%": p,
                    "%val2%": v
                }, _),
                r += 1 == x ? _t("turn") : x > 4 ? _t("turn5") : _t("turns");
                break;
            default:
                "" != c && (r += "<span class=" + h + ">" + _t("unknown_stat %val%", {
                    "%val%": c
                }, _) + "</span>")
            }
            null !== o && (r += o),
            r.length > 0 && l.push("- " + r)
        }
        return l.join("<br>")
    }
    ,
    this.changeStyle = function(e, a) {
        return 0 == e.clvl ? a.border.find(".set-active-state").addClass("disabled") : a.border.find(".set-active-state").removeClass("disabled"),
        e.clvl == e.mlvl ? (a.el.removeClass("disabled"),
        a.handler.removeClass("clickable"),
        a.border.find(".learn-btn").addClass("disabled"),
        !1) : e.next_req.hasOwnProperty("unav") ? (a.handler.removeClass("clickable"),
        a.el.addClass("disabled"),
        a.border.find(".learn-btn").addClass("disabled"),
        !1) : (a.el.removeClass("disabled"),
        a.handler.addClass("clickable"),
        a.border.find(".learn-btn").removeClass("disabled"),
        !0)
    }
    ,
    this.oneSkill = function(a, s, t) {
        if (!(t > 5)) {
            var r = 0;
            a.req.lvl ? r = parseInt(a.req.lvl) : a.next_req.lvl && (r = parseInt(a.next_req.lvl));
            var c = null;
            if (isset(l[a.id]))
                c = l[a.id],
                e.changeStyle(e.skills[a.id], c);
            else {
                var i = $("<div>").addClass("skillbox_border")
                  , n = $("<div>").addClass("skillbox").appendTo(i)
                  , o = $("<div>").addClass("skillbox_icon_holder").appendTo(n)
                  , d = $("<div>").addClass("skillbox_lvl");
                c = {
                    el: n,
                    handler: o,
                    lvl: d,
                    border: i
                },
                $("<div>").addClass("skillbox_icon skill-icon-" + a.id).appendTo(o);
                var _ = a.changed ? "" : "disabled"
                  , p = $("<div>").addClass("learn-btn " + _)
                  , v = round(Math.floor(Math.pow(hero.lvl, 1.9)), 1)
                  , b = _t("learn_btn", null, "skills") + ". " + _t("cost_lvl %cost%", {
                    "%cost%": v
                }, "skills");
                if (p.attr("tip", b),
                i.append(p),
                p.click((function() {
                    var s = e.skills[a.id];
                    e.changeStyle(s, c) && (isset(s.blocked) || (s.blocked = !0,
                    _g("skills&learn=" + a.id + "&lvl=" + (s.clvl + 1), (function() {
                        s.blocked = !1
                    }
                    ))))
                }
                )),
                a.type) {
                    $("<div>").addClass("skillbox_active").appendTo(n),
                    $("<div>").addClass("add_to_bm").appendTo(n).click((function() {
                        g.bmEditor.addAndSave(a.id)
                    }
                    ));
                    var h = $("<div>").addClass("set-active-state");
                    i.append(h),
                    e.selectedSkills.indexOf(parseInt(a.id)) > -1 && h.addClass("active"),
                    h.attr("tip", "WÅÄcz/wyÅÄcz umiejÄtnoÅÄ w walce"),
                    h.click((function() {
                        e.changeSelectedSkills(a.id) && _g("skills&selectedskills=" + e.selectedSkills)
                    }
                    ))
                }
                e.changeStyle(e.skills[a.id], c),
                d.appendTo(n),
                l[a.id] = c,
                0 == t ? $("<div>").addClass("skillbox_shadow mini2").appendTo(s) : $("<div>").addClass("skillbox_shadow").appendTo(s),
                i.appendTo(s),
                5 == t && $("<div>").addClass("skillbox_shadow mini").appendTo(s)
            }
            if (a.changed) {
                var u = e.skillTip(a);
                c.el.attr("tip", u);
                var m = "";
                if (a.clvl == a.mlvl)
                    m = "learned-skill cl-6";
                else if (a.clvl > 0) {
                    var k = a.clvl / a.mlvl;
                    m = "learned-skill cl-" + Math.ceil(5 * k)
                }
                if (c.lvl.hasClass(m) || c.lvl.removeClass().addClass("skillbox_lvl " + m),
                c.lvl.text(a.clvl + "/" + a.mlvl),
                106 == a.id) {
                    var f = c.el.find(".skillbox_bm");
                    a.clvl > 0 ? f.show() : f.hide()
                }
            }
            return r
        }
    }
    ,
    this.changeSelectedSkills = function(a) {
        var s = e.selectedSkills.indexOf(parseInt(a));
        if (s > -1)
            return e.selectedSkills[s] = 0,
            !0;
        for (var l = 0; l < this.selectedSkills.length; l++)
            if (0 == this.selectedSkills[l])
                return this.selectedSkills[l] = a,
                !0;
        return this.selectedSkills.length < 17 && (this.selectedSkills.push(a),
        !0)
    }
    ,
    this.show_tab = function(a) {
        if (null === a.el) {
            a.el = $("<div>").addClass("skills_tab").appendTo("#skills_body");
            var s = $("<div>").addClass("skills_tab_header").appendTo(a.el);
            a.head = $("<div>").addClass("skills_tab_text").appendTo(s)
        }
        var l = 25;
        for (var t in a.list) {
            var r = a.list[t]
              , c = e.oneSkill(e.skills[r], a.el, t);
            c > l && (l = c)
        }
        var i = l - 25
          , n = _t("skill_req_desc", null, "skills");
        i > 1 && (n = _t("skill_req_desc %lvl% %points%", {
            "%lvl%": l,
            "%points%": i
        }, "skills")),
        a.head.text(n)
    }
    ,
    this.refresh = function(a) {
        for (var l in s)
            e.show_tab(s[l]);
        Tip.resize && Tip.resize()
    }
    ,
    this.updateBmAvailability = function() {
        var e = $("#skills_footer").find(".bm-edit-button>.SI-button")
          , a = $("#bm-label1");
        hero.lvl < 25 ? (a.css("display", "block"),
        e.addClass("black")) : (a.css("display", "none"),
        e.removeClass("black"))
    }
    ,
    this.load = function(a, s) {
        e.freeSkills = s,
        $("#skillcount").empty().attr("tip", _t("use_skill_points")),
        g.lock.add("skills");
        for (var l = 0; l < a.length; l += 10)
            e.new_skill(a, l);
        e.refresh(),
        e.updateBmAvailability(),
        "block" != $("#skills").css("display") && ($("#skills DIV.skills").hide(),
        $("#skills").fadeIn("fast", (function() {}
        )))
    }
}
function bmEditor() {
    var s = this;
    this.handler = $("#bm_edit_panel_container"),
    this.activeSkills = [],
    this.skillsLimit = 0,
    this.repeat = !1,
    this.isInit = !1,
    this.visible = !1,
    this.cost = null,
    this.current = null,
    this.clearList = function() {
        this.activeSkills = [],
        _g("skills&battleaction=set&battleskills=" + this.getSkillList() + "&rpt=" + (s.repeat ? 1 : -1))
    }
    ,
    this.sendChangedList = function() {
        _g("skills&battleaction=set&battleskills=" + this.getSkillList() + "&rpt=" + (s.repeat ? 1 : -1))
    }
    ,
    this.turnOffMBSkillsMode = function() {
        $("#skills_footer").css("display", "block"),
        $("#skills").find(".add_to_bm").css("display", "none"),
        $("#skills").find(".set-active-state").css("display", "block"),
        $("#skills").find(".skillbox:not(:has(>.skillbox_active):has(>.learned-skill))").parent().css("display", "inline-block"),
        $("#skills").find(".skillbox_shadow").css("display", "inline-block"),
        $("#skills").find(".learn-btn:not(.disabled)").css("display", "block"),
        $("#skills").find(".skills_tab").removeClass("center")
    }
    ,
    this.turnOnMBSkillsMode = function() {
        $("#skills_footer").css("display", "none"),
        $("#skills").find(".add_to_bm").css("display", "block"),
        $("#skills").find(".set-active-state").css("display", "none"),
        $("#skills").find(".skillbox:not(:has(>.skillbox_active):has(>.learned-skill))").parent().css("display", "none"),
        $("#skills").find(".skillbox_shadow").css("display", "none"),
        $("#skills").find(".learn-btn:not(.disabled)").css("display", "none"),
        $("#skills").find(".skills_tab").addClass("center")
    }
    ,
    this.toggleShow = function() {
        s.visible ? this.hidePanel() : this.showPanel()
    }
    ,
    this.hidePanel = function() {
        s.turnOffMBSkillsMode(),
        s.handler.css("display", "none"),
        s.visible = !1,
        g.skills.refresh(),
        $(".bm_handlerIcon").remove(),
        $("#battleskills_scroll").remove()
    }
    ,
    this.showPanel = function() {
        _g("skills&battleaction=show", (function() {
            s.visible = !0,
            s.turnOnMBSkillsMode(),
            s.handler.css("display", "block"),
            g.skills.refresh()
        }
        ))
    }
    ,
    this.getSkillList = function() {
        return this.activeSkills.length > 0 ? this.activeSkills.join(",") : 0
    }
    ,
    this.addAndSave = function(t) {
        this.activeSkills.length < this.skillsLimit ? (this.activeSkills.push(t),
        _g("skills&battleaction=set&battleskills=" + this.getSkillList() + "&rpt=" + (s.repeat ? 1 : -1))) : mAlert(_t("bm_limit_reached", null, "skills"))
    }
    ,
    this.init = function() {
        s.isInit || (s.isInit = !0,
        this.initButtons())
    }
    ,
    this.update = function(s) {
        this.skillsLimit = s.max,
        this.activeSkills = s.list,
        this.cost = s.cost,
        this.current = s.cur,
        this.cost = s.cost,
        this.repeat = !!parseInt(s.rpt),
        this.setRepeatCheckbox(),
        this.refreshSkillList()
    }
    ,
    this.setRepeatCheckbox = function() {
        var t = $("#bm_rpt_switch");
        s.repeat ? t.addClass("active") : t.removeClass("active")
    }
    ,
    this.refreshSkillList = function() {
        $("#bm_skill_table").empty();
        for (var t = 0; t < 20; t++)
            t + 1 > s.current ? s.createUnBuySkillTr(t) : s.createBoughtSkillTr(t)
    }
    ,
    this.getSkillNameOrEmpty = function(t) {
        var i = s.activeSkills[t];
        return t + 1 > s.activeSkills.length ? _t("empty") : -1 == i ? _t("bm_normal_attack", null, "skills") : -2 == i ? _t("step", null, "skills") : g.skills.skills[i].name
    }
    ,
    this.createButtonsToChangePos = function(t, i) {
        t.append(s.drawSkillActionMBBut("delete", i)),
        t.append(s.drawSkillActionMBBut("up", i)),
        t.append(s.drawSkillActionMBBut("down", i))
    }
    ,
    this.drawSkillActionMBBut = function(t, i) {
        var l = $("<div>");
        switch (t) {
        case "up":
            l.addClass("frup"),
            l.bind("click", (function() {
                var t = s.activeSkills[i - 1]
                  , l = s.activeSkills[i];
                s.activeSkills[i - 1] = l,
                s.activeSkills[i] = t,
                s.sendChangedList()
            }
            ));
            break;
        case "down":
            l.addClass("frdn"),
            l.bind("click", (function() {
                var t = s.activeSkills[i]
                  , l = s.activeSkills[i + 1];
                s.activeSkills[i] = l,
                s.activeSkills[i + 1] = t,
                s.sendChangedList()
            }
            ));
            break;
        case "delete":
            l.addClass("delen"),
            l.bind("click", (function() {
                s.activeSkills[i] = 0,
                s.sendChangedList()
            }
            ));
            break;
        default:
            console.warn("bad type")
        }
        return l
    }
    ,
    this.createBoughtSkillTr = function(t) {
        var i = $("<span>").addClass("td-label").html(s.getSkillNameOrEmpty(t))
          , l = $("<div>").addClass("action_buttons")
          , e = $("<td>").addClass("lp").html(t + 1 + ".")
          , n = $("<td>").addClass("buy-td").append(i).append(l);
        s.createButtonsToChangePos(l, t),
        s.showAndHideChangePosButton(l, t),
        this.appendToTr(e, n)
    }
    ,
    this.showAndHideChangePosButton = function(t, i) {
        var l = t.find(".frup")
          , e = t.find(".frdn")
          , n = s.activeSkills.length;
        i + 1 > n ? t.css("display", "none") : (0 == i && l.css("display", "none"),
        i + 1 == n && e.css("display", "none"),
        1 == n && (e.css("display", "none"),
        l.css("display", "none")))
    }
    ,
    this.createUnBuySkillTr = function(t) {
        var i = drawSIButton(round(s.cost.gold[t])).addClass("gold-cost")
          , l = drawSIButton(s.cost.credits[t] + "SÅ").addClass("sl-cost")
          , e = $("<span>").addClass("td-label").html(_t("buy_skill_place"))
          , n = $("<div>").addClass("buy-wrapper").append(i).append(l)
          , a = $("<td>").addClass("lp").html(t + 1 + ".")
          , d = $("<td>").addClass("buy-td").append(e).append(n);
        i.bind("click", (function() {
            s.buyAlert(0)
        }
        )),
        l.bind("click", (function() {
            s.buyAlert(1)
        }
        )),
        s.appendToTr(a, d)
    }
    ,
    this.buyAlert = function(s) {
        var t;
        switch (s) {
        case 0:
            t = _t("confirm_upgrade_MBATLEforGold");
            break;
        case 1:
            t = _t("confirm_upgrade_MBATLEforCredits");
            break;
        default:
            return void console.warn("bad type of currency :" + s)
        }
        mAlert(t, 1, [function() {
            _g("skills&battleaction=learn&credits=" + s)
        }
        , function() {}
        ])
    }
    ,
    this.appendToTr = function(s, t) {
        var i = $("<tr>").addClass("one-bm-skill").append(s).append(t);
        $("#bm_skill_table").append(i)
    }
    ,
    this.initButtons = function() {
        $("#save-and-close-bm").parent().click((function() {
            g.bmEditor.toggleShow()
        }
        )),
        $("#clear-bm-list").parent().click((function() {
            g.bmEditor.clearList()
        }
        )),
        $("#add-normal-attack").parent().click((function() {
            g.bmEditor.addAndSave(-1)
        }
        )),
        $("#add-move-bm").parent().click((function() {
            g.bmEditor.addAndSave(-2)
        }
        )),
        $("#bm_rpt_switch_wrapper").click((function() {
            g.bmEditor.switchRepeat()
        }
        ))
    }
    ,
    this.switchRepeat = function() {
        s.repeat = !s.repeat,
        s.setRepeatCheckbox(),
        _g("skills&battleaction=set&battleskills=" + this.getSkillList() + "&rpt=" + (this.repeat ? 1 : -1))
    }
}
function _slicedToArray(t, e) {
    return _arrayWithHoles(t) || _iterableToArrayLimit(t, e) || _unsupportedIterableToArray(t, e) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _iterableToArrayLimit(t, e) {
    var r = null == t ? null : "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (null != r) {
        var n, o, a = [], i = !0, l = !1;
        try {
            for (r = r.call(t); !(i = (n = r.next()).done) && (a.push(n.value),
            !e || a.length !== e); i = !0)
                ;
        } catch (t) {
            l = !0,
            o = t
        } finally {
            try {
                i || null == r.return || r.return()
            } finally {
                if (l)
                    throw o
            }
        }
        return a
    }
}
function _arrayWithHoles(t) {
    if (Array.isArray(t))
        return t
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
function _createForOfIteratorHelper(t, e) {
    var r = "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (!r) {
        if (Array.isArray(t) || (r = _unsupportedIterableToArray(t)) || e && t && "number" == typeof t.length) {
            r && (t = r);
            var n = 0
              , o = function() {};
            return {
                s: o,
                n: function() {
                    return n >= t.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: t[n++]
                    }
                },
                e: function(t) {
                    throw t
                },
                f: o
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var a, i = !0, l = !1;
    return {
        s: function() {
            r = r.call(t)
        },
        n: function() {
            var t = r.next();
            return i = t.done,
            t
        },
        e: function(t) {
            l = !0,
            a = t
        },
        f: function() {
            try {
                i || null == r.return || r.return()
            } finally {
                if (l)
                    throw a
            }
        }
    }
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var r = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === r && t.constructor && (r = t.constructor.name),
        "Map" === r || "Set" === r ? Array.from(t) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var r = 0, n = new Array(e); r < e; r++)
        n[r] = t[r];
    return n
}
function _classCallCheck(t, e) {
    if (!(t instanceof e))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(t, e) {
    for (var r = 0; r < e.length; r++) {
        var n = e[r];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(t, n.key, n)
    }
}
function _createClass(t, e, r) {
    return e && _defineProperties(t.prototype, e),
    r && _defineProperties(t, r),
    Object.defineProperty(t, "prototype", {
        writable: !1
    }),
    t
}
var ItemGrabber = function() {
    "use strict";
    function t(e) {
        _classCallCheck(this, t),
        this.setFilters(e)
    }
    return _createClass(t, [{
        key: "setFilters",
        value: function(t) {
            this.options = t
        }
    }, {
        key: "grab",
        value: function(t) {
            --t;
            var e = []
              , r = g.hItems
              , n = 6 * t
              , o = n + 6;
            for (var a in r) {
                var i = r[a];
                this.checkBag(i, n, o) && (this.checkCl(i) && this.checkStats(i) && e.push(i))
            }
            return e
        }
    }, {
        key: "checkBag",
        value: function(t, e, r) {
            return 0 === t.st && t.y >= e && t.y < r
        }
    }, {
        key: "checkCl",
        value: function(t) {
            var e = !0;
            return isset(this.options.allow.cls) && (this.options.allow.cls.length > 0 && this.options.allow.cls.includes(t.cl) || (e = !1)),
            isset(this.options.deny.cls) && this.options.deny.cls.includes(t.cl) && (e = !1),
            e
        }
    }, {
        key: "checkStats",
        value: function(t) {
            var e = !0
              , r = this.options.allow.stats
              , n = this.options.deny.stats;
            if (isset(r)) {
                var o, a = _createForOfIteratorHelper(r);
                try {
                    for (a.s(); !(o = a.n()).done; ) {
                        var i = o.value;
                        this.checkOneStat(t, i) || (e = !1)
                    }
                } catch (t) {
                    a.e(t)
                } finally {
                    a.f()
                }
            }
            if (isset(n)) {
                var l, c = _createForOfIteratorHelper(n);
                try {
                    for (c.s(); !(l = c.n()).done; ) {
                        var s = l.value;
                        this.checkOneStat(t, s) && (e = !1)
                    }
                } catch (t) {
                    c.e(t)
                } finally {
                    c.f()
                }
            }
            return e
        }
    }, {
        key: "checkOneStat",
        value: function(t, e) {
            if ("object" === _typeof(e)) {
                var r = e.name
                  , n = e.params;
                if (!checkItemStat(t, r))
                    return !1;
                var o = _slicedToArray(n, 2)
                  , a = o[0]
                  , i = o[1]
                  , l = parseItemStat(t.stat)[r];
                if (count(a, l, i))
                    return !0
            } else if (checkItemStat(t, e))
                return !0;
            return !1
        }
    }]),
    t
}();
function _createForOfIteratorHelper(t, e) {
    var r = "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (!r) {
        if (Array.isArray(t) || (r = _unsupportedIterableToArray(t)) || e && t && "number" == typeof t.length) {
            r && (t = r);
            var n = 0
              , a = function() {};
            return {
                s: a,
                n: function() {
                    return n >= t.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: t[n++]
                    }
                },
                e: function(t) {
                    throw t
                },
                f: a
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var i, o = !0, s = !1;
    return {
        s: function() {
            r = r.call(t)
        },
        n: function() {
            var t = r.next();
            return o = t.done,
            t
        },
        e: function(t) {
            s = !0,
            i = t
        },
        f: function() {
            try {
                o || null == r.return || r.return()
            } finally {
                if (s)
                    throw i
            }
        }
    }
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var r = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === r && t.constructor && (r = t.constructor.name),
        "Map" === r || "Set" === r ? Array.from(t) : "Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var r = 0, n = new Array(e); r < e; r++)
        n[r] = t[r];
    return n
}
function _classCallCheck(t, e) {
    if (!(t instanceof e))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(t, e) {
    for (var r = 0; r < e.length; r++) {
        var n = e[r];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(t, n.key, n)
    }
}
function _createClass(t, e, r) {
    return e && _defineProperties(t.prototype, e),
    r && _defineProperties(t, r),
    Object.defineProperty(t, "prototype", {
        writable: !1
    }),
    t
}
var defaultOptions = {
    btnTip: function(t) {
        return _t("great_merchamp_info %val%", {
            "%val%": t
        }, "shop")
    }
}
  , Autofiller = function() {
    "use strict";
    function t(e) {
        var r = this;
        _classCallCheck(this, t),
        this.bagsAmount = 3,
        this.el = this.getAutofillerTpl()[0],
        this.options = Object.assign(Object.assign({}, defaultOptions), e),
        this.autofillerConfig = new AutofillerConfig(this.options.configWindow,this.getData(),(function(t) {
            return r.saveData(t)
        }
        )),
        this.itemGrabber = new ItemGrabber(this.options.itemGrabberOptions),
        this.afterDataSave(this.getData()),
        this.setContent()
    }
    return _createClass(t, [{
        key: "setContent",
        value: function() {
            this.setButtons()
        }
    }, {
        key: "setButtons",
        value: function() {
            var t, e = _createForOfIteratorHelper(this.prepareButtonOptions());
            try {
                for (e.s(); !(t = e.n()).done; ) {
                    var r = t.value
                      , n = new Button(r).getButton();
                    this.el.appendChild(n)
                }
            } catch (t) {
                e.e(t)
            } finally {
                e.f()
            }
        }
    }, {
        key: "prepareButtonOptions",
        value: function() {
            for (var t = this, e = [], r = {
                text: configIcon(),
                classes: ["autofiller-config-btn"],
                action: function() {
                    return t.autofillerConfig.windowToggle()
                },
                tip: _t("config_tip", null, "buttons"),
                disabled: !1
            }, n = function(r) {
                e.push({
                    text: r.toString(),
                    classes: ["small", "green"],
                    action: function() {
                        return t.autofillFrom(r)
                    },
                    tip: t.options.btnTip(r),
                    disabled: !1
                })
            }, a = 1; a <= this.bagsAmount; a++)
                n(a);
            return e.push(r),
            e
        }
    }, {
        key: "autofillFrom",
        value: function(t) {
            var e = this.itemGrabber.grab(t);
            this.options.btnFn(e)
        }
    }, {
        key: "afterDataSave",
        value: function(t) {
            var e = this.parseData(t);
            this.applyDataToItemGrabber(e)
        }
    }, {
        key: "parseData",
        value: function(t) {
            var e = {};
            return Object.keys(t).forEach((function(r, n) {
                e[r] = t[r].filter((function(t) {
                    return t.checked
                }
                )).map((function(t) {
                    return t.key
                }
                ))
            }
            )),
            e
        }
    }, {
        key: "applyDataToItemGrabber",
        value: function(t) {
            for (var e in t)
                switch (e) {
                case "cl":
                    this.options.itemGrabberOptions.allow.cls = t.cl;
                    break;
                case "rarity":
                    var r = this.options.itemGrabberOptions.allow.stats.find((function(t) {
                        return "rarity" === t.name
                    }
                    ));
                    r && (r.params = ["includes", t.rarity]);
                    break;
                default:
                    errorReport("Autofiller.js", "applyDataToItemGrabber", "No filter type ".concat(e))
                }
            this.itemGrabber.setFilters(this.options.itemGrabberOptions)
        }
    }, {
        key: "getData",
        value: function() {
            var t = margoStorage.get(this.options.storageName);
            return t || Object.assign({}, this.options.filters)
        }
    }, {
        key: "saveData",
        value: function(t) {
            margoStorage.set(this.options.storageName, t),
            this.autofillerConfig.filtersUpdate(t),
            this.afterDataSave(t)
        }
    }, {
        key: "enabled",
        value: function() {
            this.el.classList.remove("disabled")
        }
    }, {
        key: "disabled",
        value: function() {
            this.el.classList.add("disabled")
        }
    }, {
        key: "reset",
        value: function() {
            this.autofillerConfig.windowRemove()
        }
    }, {
        key: "getContent",
        value: function() {
            return this.el
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }, {
        key: "getAutofillerTpl",
        value: function() {
            return $("<div class='autofiller'></div>")
        }
    }]),
    t
}();
function _createForOfIteratorHelper(e, t) {
    var n = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (!n) {
        if (Array.isArray(e) || (n = _unsupportedIterableToArray(e)) || t && e && "number" == typeof e.length) {
            n && (e = n);
            var i = 0
              , r = function() {};
            return {
                s: r,
                n: function() {
                    return i >= e.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: e[i++]
                    }
                },
                e: function(e) {
                    throw e
                },
                f: r
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var o, a = !0, l = !1;
    return {
        s: function() {
            n = n.call(e)
        },
        n: function() {
            var e = n.next();
            return a = e.done,
            e
        },
        e: function(e) {
            l = !0,
            o = e
        },
        f: function() {
            try {
                a || null == n.return || n.return()
            } finally {
                if (l)
                    throw o
            }
        }
    }
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var n = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === n && e.constructor && (n = e.constructor.name),
        "Map" === n || "Set" === n ? Array.from(e) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var n = 0, i = new Array(t); n < t; n++)
        i[n] = e[n];
    return i
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var i = t[n];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var defaultOptions = {}
  , AutofillerConfig = function() {
    "use strict";
    function e(t, n, i) {
        _classCallCheck(this, e),
        this.data = n,
        this.saveCallback = i,
        this.isOpen = !1,
        this.options = Object.assign(Object.assign({}, defaultOptions), t),
        this.setInitialData(),
        this.windowInit(),
        this.setContent()
    }
    return _createClass(e, [{
        key: "setContent",
        value: function() {
            this.setHeading(),
            this.createGroups(),
            this.setButtons()
        }
    }, {
        key: "setHeading",
        value: function() {
            this.wndEl.querySelector(".autofiller-config__heading").textContent = this.options.heading
        }
    }, {
        key: "setButtons",
        value: function() {
            var e = this
              , t = this.wndEl.querySelector(".autofiller-config__buttons");
            t.innerHTML = "";
            for (var n = 0, i = [{
                text: _t("save", null, "buttons"),
                classes: ["small", "green"],
                action: function() {
                    return e.onClickSave()
                }
            }, {
                text: _t("cancel", null, "buttons"),
                classes: ["small", "green"],
                action: function() {
                    return e.windowClose()
                }
            }]; n < i.length; n++) {
                var r = new Button(i[n]).getButton();
                t.appendChild(r)
            }
        }
    }, {
        key: "onClickSave",
        value: function() {
            this.saveCallback(this.tempData),
            this.windowClose()
        }
    }, {
        key: "filtersUpdate",
        value: function(e) {
            this.data = JSON.parse(JSON.stringify(e)),
            this.setInitialData()
        }
    }, {
        key: "createGroups",
        value: function() {
            if (isset(this.options.groups)) {
                var e = this.wndEl.querySelector(".autofiller-config__groups");
                e.innerHTML = "";
                var t, n = _createForOfIteratorHelper(this.options.groups);
                try {
                    for (n.s(); !(t = n.n()).done; ) {
                        var i = t.value
                          , r = i.id
                          , o = i.title
                          , a = this.getAutofillerConfigGroupTpl()[0];
                        a.querySelector(".autofiller-config__title").textContent = o,
                        a.classList.add("group-".concat(r)),
                        e.appendChild(a)
                    }
                } catch (e) {
                    n.e(e)
                } finally {
                    n.f()
                }
            } else
                errorReport("Autofiller.js", "createGroups", "No groups defined")
        }
    }, {
        key: "setCheckboxes",
        value: function() {
            var e = this
              , t = function(t) {
                var n, i = _createForOfIteratorHelper(e.tempData[t]);
                try {
                    var r = function() {
                        var i = n.value
                          , r = i.key
                          , o = i.checked
                          , a = i.groupId
                          , l = e.wndEl.querySelector(".group-".concat(a, " .autofiller-config__checkboxes"))
                          , s = e.getLabel(t, r)
                          , c = new Checkbox({
                            name: "".concat(t, "_").concat(r),
                            label: s,
                            value: r,
                            i: r,
                            checked: o,
                            attrs: {
                                "data-type": "cl"
                            }
                        },(function(n) {
                            return e.onSelected(n, t, r)
                        }
                        )).getCheckbox();
                        l.appendChild(c)
                    };
                    for (i.s(); !(n = i.n()).done; )
                        r()
                } catch (e) {
                    i.e(e)
                } finally {
                    i.f()
                }
            };
            for (var n in this.tempData)
                t(n)
        }
    }, {
        key: "clearCheckboxes",
        value: function() {
            this.wndEl.querySelectorAll(".autofiller-config__checkboxes").forEach((function(e) {
                return e.innerHTML = ""
            }
            ))
        }
    }, {
        key: "onSelected",
        value: function(e, t, n) {
            var i = e.target.checked;
            this.tempData[t].find((function(e) {
                return e.key === n
            }
            )).checked = i
        }
    }, {
        key: "getLabel",
        value: function(e, t) {
            var n;
            switch (e) {
            case "cl":
                n = _t("au_cat".concat(t), null, "auction");
                break;
            case "rarity":
                n = _t("rarity_".concat(t), null, "item");
                break;
            default:
                errorReport("Autofiller.js", "getLabel", "No filter type ".concat(e))
            }
            return n
        }
    }, {
        key: "windowInit",
        value: function() {
            this.wndEl = $("#autofiller-config")[0],
            this.wndEl.querySelector(".close-but").addEventListener("click", this.close.bind(this));
            var e = goldTxt(this.options.title, !0);
            this.wndEl.querySelector(".autofiller-config__header").innerHTML = e
        }
    }, {
        key: "windowToggle",
        value: function() {
            this.isOpen ? this.windowClose() : this.windowOpen()
        }
    }, {
        key: "setInitialData",
        value: function() {
            this.tempData = JSON.parse(JSON.stringify(this.data))
        }
    }, {
        key: "windowOpen",
        value: function() {
            this.setInitialData(),
            this.setCheckboxes(),
            this.wndEl.style.display = "block",
            this.isOpen = !0,
            this.wndEl.style.top = "31px",
            this.wndEl.style.left = "56px"
        }
    }, {
        key: "windowClose",
        value: function() {
            this.wndEl.style.display = "none",
            this.isOpen = !1,
            this.clearCheckboxes(),
            this.tempData = {}
        }
    }, {
        key: "windowRemove",
        value: function() {
            this.windowClose()
        }
    }, {
        key: "close",
        value: function() {
            this.windowClose()
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }, {
        key: "getAutofillerConfigTpl",
        value: function() {
            return $("\n      <div class='autofiller-config'>\n        <div class='autofiller-config__heading'></div>\n        <div class='autofiller-config__groups'></div>\n        <div class='autofiller-config__buttons btns-spacing'></div>\n      </div>\n    ")
        }
    }, {
        key: "getAutofillerConfigGroupTpl",
        value: function() {
            return $("\n      <div class='autofiller-config__group'>\n        <div class='autofiller-config__title'></div>\n        <div class='autofiller-config__checkboxes'></div>\n      </div>\n    ")
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var i = t[n];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var BonusSelectorWindow = function() {
    "use strict";
    function e(t) {
        var n = t.bonuses
          , i = t.itemId
          , o = t.fromReselect
          , s = void 0 !== o && o;
        _classCallCheck(this, e),
        this.initWindow(),
        this.itemId = i,
        this.fromReselect = s,
        this.wndEl.querySelector(".enhance__info").innerHTML = _t("info4", null, "enhancement"),
        this.bonusSelectorEl = this.wndEl.querySelector(".enhance__bonus"),
        this.bonusSelectorEl.innerHTML = "",
        this.bonusSelector = new BonusSelector(this.bonusSelectorEl,{
            itemId: i,
            onSubmitClb: this.onSubmit.bind(this)
        }),
        this.bonusSelector.createBonusChoose(n),
        this.getEngine().lock.add("bonus-selector"),
        this.windowOpen()
    }
    return _createClass(e, [{
        key: "initWindow",
        value: function() {
            this.wndEl = $("#bonus-selector-wnd")[0],
            this.wndEl.querySelector(".close-but").addEventListener("click", this.close.bind(this)),
            this.setTitle()
        }
    }, {
        key: "setTitle",
        value: function() {
            var e = goldTxt(_t("select_bonus", null, "item"), !0);
            this.wndEl.querySelector(".bonus-selector-wnd__title").innerHTML = e
        }
    }, {
        key: "onSubmit",
        value: function(e, t) {
            if (e) {
                var n = this.fromReselect ? "bonus_reselect&action=select&item=".concat(this.itemId, "&bonusIdx=").concat(t) : "moveitem&st=2&id=".concat(this.itemId, "&bonusIdx=").concat(t);
                _g(n)
            }
            this.close()
        }
    }, {
        key: "windowOpen",
        value: function() {
            this.wndEl.style.display = "block",
            this.opened = !0,
            this.wndEl.style.top = "120px",
            this.wndEl.style.left = "86px"
        }
    }, {
        key: "windowClose",
        value: function() {
            this.wndEl.style.display = "none",
            this.opened = !1
        }
    }, {
        key: "close",
        value: function() {
            this.windowClose(),
            this.getEngine().lock.remove("bonus-selector"),
            this.getEngine().bonusSelectorWindow = !1
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement";
            return _t(e, null, t)
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var i = t[n];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var BonusReselectWindow = function() {
    "use strict";
    function e() {
        _classCallCheck(this, e),
        this.selectedItem = null,
        this.requestBlock = !1,
        this.receivedTpls = {},
        this.getEngine().lock.add("bonus-reselect"),
        this.initWindow(),
        this.createContent(),
        this.createConfirmButton(),
        this.getEngine().tplsManager.fetch("w", this.newReceivedItem.bind(this)),
        this.getEngine().disableItemsManager.startSpecificItemKindDisable("bonus-reselect"),
        this.windowOpen()
    }
    return _createClass(e, [{
        key: "getWindowTpl",
        value: function() {
            return $('\n      <div class="bonus-reselect-wnd__content">\n        <div class="enhance__info enhance__info--1">\n          <div class="info-icon"></div>\n          <div class="enhance__info--top">'.concat(_t("bonus-reselect-info", null, "enhancement"), '</div>\n        </div>\n        <div class="bonus-reselect-wnd__item"></div>\n        <div class="bonus-reselect-wnd__finalize">\n          <div class="enhance__info">').concat(_t("bonus-reselect-info2", null, "enhancement"), '</div>\n          <div class="bonus-reselect-wnd__require"></div>\n          <div class="bonus-reselect-wnd__buttons"></div>\n        </div>\n      </div>\n    '))[0]
        }
    }, {
        key: "initWindow",
        value: function() {
            this.contentEl = this.getWindowTpl(),
            this.wndEl = $("#bonus-reselect-wnd")[0],
            this.contentWrapperEl = this.wndEl.querySelector(".bonus-reselect-wnd__content"),
            this.contentWrapperEl.innerHTML = "",
            this.contentWrapperEl.appendChild(this.contentEl),
            this.wndEl.querySelector(".close-but").addEventListener("click", this.close.bind(this)),
            this.setTitle()
        }
    }, {
        key: "setTitle",
        value: function() {
            var e = goldTxt(this.tLang("bonus-reselect-title"), !0);
            this.wndEl.querySelector(".bonus-reselect-wnd__title").innerHTML = e
        }
    }, {
        key: "createContent",
        value: function() {
            this.selectedItemSlotEl = this.contentEl.querySelector(".bonus-reselect-wnd__item"),
            this.requireItemSlotEl = this.contentEl.querySelector(".bonus-reselect-wnd__require"),
            this.buttonsContainerEl = this.contentEl.querySelector(".bonus-reselect-wnd__buttons")
        }
    }, {
        key: "newReceivedItem",
        value: function(e) {
            var t = isset(e.$) ? e.$[0] : createItem(e)[0];
            this.updateAmount(e, t),
            this.requireItemSlotEl.appendChild(t)
        }
    }, {
        key: "updateAmount",
        value: function(e, t) {
            var n = this.receivedTpls[e.id];
            n > 0 && this.getEngine().tplsManager.changeItemAmount(e, $(t), n)
        }
    }, {
        key: "onClickInventoryItem",
        value: function(e) {
            if (!this.requestBlock) {
                var t = parseInt(e.id);
                this.selectedItem !== t ? this.selectedItem ? e.st : this.sendPreviewRequest(t) : this.clearAll()
            }
        }
    }, {
        key: "sendPreviewRequest",
        value: function(e) {
            this.requestBlock = !0,
            _g("bonus_reselect&action=status&item=".concat(e))
        }
    }, {
        key: "sendReselectRequest",
        value: function() {
            var e = this;
            _g("bonus_reselect&action=apply&item=".concat(this.selectedItem), (function(t) {
                isset(t.message) || e.close()
            }
            ))
        }
    }, {
        key: "afterUpdateSelectedItem",
        value: function(e) {
            this.addItemToExtract()
        }
    }, {
        key: "addItemToExtract",
        value: function() {
            var e = this
              , t = this.getEngine().item[this.selectedItem]
              , n = $("#item" + t.id).clone(!1)[0];
            n.style.top = null,
            n.style.left = null,
            n.addEventListener("click", (function() {
                e.onClickInventoryItem(t)
            }
            )),
            this.getEngine().itemsMovedManager.addItem(t, "bonus-reselect", (function() {
                e.onClickInventoryItem(t)
            }
            )),
            this.dimRestart(),
            this.selectedItemSlotEl.innerHTML = "",
            this.selectedItemSlotEl.appendChild(n)
        }
    }, {
        key: "removeSelectedItem",
        value: function() {
            this.selectedItemSlotEl.innerHTML = ""
        }
    }, {
        key: "removeRequireItems",
        value: function() {
            this.requireItemSlotEl.innerHTML = ""
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var e = {
                text: this.tLang("bonus-reselect-submit"),
                classes: ["small", "green"],
                action: this.confirmOnClick.bind(this),
                disabled: !0
            };
            this.submitBtn = new Button(e),
            this.buttonsContainerEl.appendChild(this.submitBtn.getButton())
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var e = this
              , t = this.tLang("confirm-prompt");
            mAlert(t, 1, [function() {
                return e.sendReselectRequest()
            }
            , function() {}
            ])
        }
    }, {
        key: "setStateConfirmButton",
        value: function(e) {
            this.checkRequiresItemsAmount(e) ? this.submitBtn.setState(!1) : this.submitBtn.setState(!0)
        }
    }, {
        key: "checkRequiresItemsAmount",
        value: function(e) {
            var t = e.ingredientItemQuantity
              , n = e.ingredientItemTplId;
            return checkItemsAmount(n) >= t
        }
    }, {
        key: "update",
        value: function(e) {
            if (isset(e.status)) {
                this.requestBlock = !1;
                var t = e.status
                  , n = t.ingredientItemQuantity
                  , i = t.ingredientItemTplId
                  , s = t.itemId;
                this.selectedItem = s,
                this.addItemToExtract(),
                this.receivedTpls[i] = n,
                this.setStateConfirmButton(e.status)
            }
        }
    }, {
        key: "dimRestart",
        value: function() {
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("bonus-reselect"),
            this.getEngine().disableItemsManager.startSpecificItemKindDisable("bonus-reselect")
        }
    }, {
        key: "windowOpen",
        value: function() {
            this.wndEl.style.display = "block",
            this.opened = !0,
            this.wndEl.style.top = "90px",
            this.wndEl.style.left = "86px"
        }
    }, {
        key: "windowClose",
        value: function() {
            this.wndEl.style.display = "none",
            this.opened = !1
        }
    }, {
        key: "close",
        value: function() {
            this.windowClose(),
            this.clearAll(),
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("bonus-reselect"),
            this.getEngine().tplsManager.fetch("w", this.newReceivedItem.bind(this)),
            this.getEngine().bonusReselectWindow = !1,
            this.getEngine().lock.remove("bonus-reselect")
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement";
            return _t(e, null, t)
        }
    }, {
        key: "clearAll",
        value: function() {
            this.selectedItem = null,
            this.removeSelectedItem(),
            this.removeRequireItems(),
            this.getEngine().tplsManager.deleteMessItemsByLoc("w"),
            this.getEngine().itemsMovedManager.removeItemsByTarget("bonus-reselect"),
            this.submitBtn.setState(!0)
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _slicedToArray(e, t) {
    return _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _unsupportedIterableToArray(e, t) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _iterableToArrayLimit(e, t) {
    var i = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (null != i) {
        var n, r, a = [], s = !0, l = !1;
        try {
            for (i = i.call(e); !(s = (n = i.next()).done) && (a.push(n.value),
            !t || a.length !== t); s = !0)
                ;
        } catch (e) {
            l = !0,
            r = e
        } finally {
            try {
                s || null == i.return || i.return()
            } finally {
                if (l)
                    throw r
            }
        }
        return a
    }
}
function _arrayWithHoles(e) {
    if (Array.isArray(e))
        return e
}
function _createForOfIteratorHelper(e, t) {
    var i = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (!i) {
        if (Array.isArray(e) || (i = _unsupportedIterableToArray(e)) || t && e && "number" == typeof e.length) {
            i && (e = i);
            var n = 0
              , r = function() {};
            return {
                s: r,
                n: function() {
                    return n >= e.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: e[n++]
                    }
                },
                e: function(e) {
                    throw e
                },
                f: r
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var a, s = !0, l = !1;
    return {
        s: function() {
            i = i.call(e)
        },
        n: function() {
            var e = i.next();
            return s = e.done,
            e
        },
        e: function(e) {
            l = !0,
            a = e
        },
        f: function() {
            try {
                s || null == i.return || i.return()
            } finally {
                if (l)
                    throw a
            }
        }
    }
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var i = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === i && e.constructor && (i = e.constructor.name),
        "Map" === i || "Set" === i ? Array.from(e) : "Arguments" === i || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var i = 0, n = new Array(t); i < t; i++)
        n[i] = e[i];
    return n
}
function Recipes(e) {
    var t = this;
    this.wnd = {},
    this.wndEl = e;
    var i = this
      , n = null
      , r = {};
    this.recipes = [],
    this.items = {};
    this.init = function() {
        this.wnd.$ = this.getRecipesTpl(),
        this.initLabels(),
        this.initSelect(),
        this.initSearch(),
        this.initStartLvl(),
        this.initStopLvl(),
        this.createCloseBut();
        var e = this.wndEl.querySelector(".recipes-content");
        e.innerHTML = "",
        e.appendChild(this.wnd.$[0]),
        g.tplsManager.fetch("c", this.newRecipeItem.bind(this))
    }
    ,
    this.getRecipesTpl = function() {
        return $('\n\t\t<div id="recipes" class="recipes">\n\t\t\t<div class="recipes-inner">\n\t\t\t\t<div class="recipe-list-label"></div>\n\t\t\t\t<div class="recipe-reagent-label"></div>\n\t\t\t\t<div class="recipe-list-search">\n\t\t\t\t\t<input class="search" placeholder="Szukaj">\n\t\t\t\t\t<div class="recipe-lvl">Lvl</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="recipe-header"></div>\n\t\t\t\t<div class="recipe-list"></div>\n\t\t\t\t<div class="choose-recipe">\n\t\t\t\t\t<div class="reagent-list-label"></div>\n\t\t\t\t\t<div class="recipe-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t\t<input class="start-lvl" val=""/>\n\t\t\t\t<input class="stop-lvl" val=""/>\n\t\t\t\t<select class="choose-item-type"></select>\n\t\t\t\t<select class="choose-prof"></select>\n\t\t\t</div>\n\t\t</div>\n\t')
    }
    ,
    this.initLabels = function() {
        t.wnd.$.find(".recipe-list-label").html(goldTxt(_t("exchange_list", null, "item_changer"), !0)),
        t.wnd.$.find(".recipe-reagent-label").html(goldTxt(_t("reagents_recipe", null, "recipes"), !0)),
        t.wnd.$.find(".recipe-lvl").html("Lvl")
    }
    ,
    this.initSelect = function() {
        var e = this.wnd.$
          , t = {
            all: _t("prof_all", null, "eq_prof"),
            m: _t("prof_mag", null, "eq_prof"),
            w: _t("prof_warrior", null, "eq_prof"),
            p: _t("prof_paladyn", null, "eq_prof"),
            t: _t("prof_tracker", null, "eq_prof"),
            h: _t("prof_hunter", null, "eq_prof"),
            b: _t("prof_bladedancer", null, "eq_prof")
        }
          , n = e.find(".choose-prof");
        for (var r in t) {
            var a = $("<option>").attr("val", r).html(t[r]);
            n.append(a)
        }
        var s = {
            all: _t("type_all", null, "auction"),
            unique: _t("type_unique", null, "auction"),
            heroic: _t("type_heroic", null, "auction"),
            legendary: _t("type_legendary", null, "auction")
        }
          , l = e.find(".choose-item-type");
        for (var r in s)
            l.append($("<option>").attr("val", r).html(s[r]));
        n.change((function() {
            i.startFilter()
        }
        )),
        l.change((function() {
            i.startFilter()
        }
        )),
        e.find(".start-lvl").attr("placeholder", _t("start")),
        e.find(".stop-lvl").attr("placeholder", _t("stop"))
    }
    ,
    this.getValueFromItemType = function() {
        var e = this.wnd.$.find(".choose-item-type option:selected").attr("val");
        "all" != e && i.wnd.$.find(".one-recipe-on-list").each((function() {
            if ("none" != $(this).css("display")) {
                var t, i = $(this).attr("typeitem");
                switch (e) {
                case "unique":
                    t = "unique" == i || "heroic" == i || "legendary" == i ? "block" : "none";
                    break;
                case "heroic":
                    t = "heroic" == i || "legendary" == i ? "block" : "none";
                    break;
                case "legendary":
                    t = "legendary" == i ? "block" : "none"
                }
                $(this).css("display", t)
            }
        }
        ))
    }
    ,
    this.getValueFromProf = function() {
        var e = this.wnd.$.find(".choose-prof option:selected").attr("val");
        "all" != e && i.wnd.$.find(".one-recipe-on-list").each((function() {
            if ("none" != $(this).css("display")) {
                var t = $(this).attr("reqp").indexOf(e) > -1 ? "block" : "none";
                $(this).css("display", t)
            }
        }
        ))
    }
    ,
    this.createRecipesList = function(e, t, n, r) {
        var a = e.enabled ? "enabled" : "disabled"
          , s = i.getOneRecipeOnList().addClass("recipe-in-list " + a);
        s.addClass("recipe-id-".concat(t)),
        s.find(".name").html(e.name),
        i.appendRecipeToGroup(s, e.itemTpl, n, r, e.enabled),
        this.recipeClick(s, t)
    }
    ,
    this.appendRecipeToGroup = function(e, t, i, n, r) {
        var a = g.tplsManager.getTplByIdAndLoc(t, "c")
          , s = "all"
          , l = "all"
          , c = a.cl
          , o = parseItemStat(a.stat);
        isset(o.lvl) && e.attr("lvl", o.lvl),
        isset(o.reqp) && (s = o.reqp);
        for (var d = 0, p = ["unique", "heroic", "legendary"]; d < p.length; d++) {
            var u = p[d];
            a.itemTypeName === u && (l = u)
        }
        e.attr("typeItem", l),
        e.attr("reqp", s),
        isset(n[c]) || (n[c] = {
            enabled: [],
            disabled: []
        }),
        r ? n[c].enabled.push(e) : n[c].disabled.push(e)
    }
    ,
    this.recipeGroupHtml = function() {
        return $('\n\t\t<div class="recipe-group">\n\t\t\t<div class="group-header">\n\t\t\t\t<div class="card-graphic"></div>\n\t\t\t\t<div class="label"></div>\n\t\t\t\t<div class="direction"></div>\n\t\t\t</div>\n\t\t\t<div class="group-list"></div>\n\t\t</div>\n\t\t')
    }
    ,
    this.createGroupElement = function(e, t) {
        var n, r = i.wnd.$.find(".group-" + e);
        r.length < 1 && (n = (r = i.recipeGroupHtml()).find(".group-header"),
        r.addClass("group-" + e),
        r.find(".label").html(_t("au_cat" + e, null, "auction")),
        i.wnd.$.find(".recipe-list").append(r),
        n.click((function() {
            r.toggleClass("active")
        }
        ))),
        r.find(".group-list").append(t)
    }
    ,
    this.createRecipe = function(e, t) {
        var n = i.getRecipeDescriptionHeader()
          , a = i.getRecipeDescriptionReagents()
          , s = i.getRecipeDescriptionButton();
        this.createResultItem(n, e.itemTpl),
        this.useRecipeBtn(s, e.enabled),
        this.createReagents(a, e),
        n.find(".recipe-name").html(e.name),
        r[t] && delete r[t],
        r[t] = {
            header: n,
            reagents: a,
            button: s
        }
    }
    ,
    this.createResultItem = function(e, t) {
        var i = this.getRecipeIcon(t);
        e.find(".result-item").append(i)
    }
    ,
    this.createReagents = function(e, t) {
        var n, r = this, a = t.ingredients, s = t.missing, l = _createForOfIteratorHelper(a);
        try {
            var c = function() {
                var t = _slicedToArray(n.value, 2)
                  , a = t[0]
                  , l = t[1]
                  , c = r.items[a]
                  , o = void 0
                  , d = i.getRecipeReagent()
                  , p = d.find(".item-slot")
                  , u = s && s.find((function(e) {
                    return e[0] === a
                }
                ));
                if (u) {
                    var h = _slicedToArray(u, 2)
                      , f = (h[0],
                    h[1]);
                    d.find(".amount-items").addClass("disabled"),
                    o = l - f
                } else
                    o = l;
                d.find(".have").html(o),
                d.find(".need").html(l),
                d.find(".item-name").html(c.name),
                e.find(".reagents-list").append(d);
                var v = r.getRecipeIcon(a);
                p.append(v)
            };
            for (l.s(); !(n = l.n()).done; )
                c()
        } catch (e) {
            l.e(e)
        } finally {
            l.f()
        }
    }
    ,
    this.cleanList = function() {
        var e = this.wnd.$;
        e.find(".recipe-description").remove(),
        e.find(".recipe-in-list").remove(),
        e.find(".empty").css("display", "block")
    }
    ,
    this.useRecipeBtn = function(e, t) {
        var i = $("<button>").addClass("small");
        i.html(_t("use_recipe", null, "recipes")),
        t || i.attr("disabled", "disabled"),
        e.find(".use-recipe-btn").append(i)
    }
    ,
    this.confirmUseRecipe = function(e) {
        _g("craft&a=use&id=" + e)
    }
    ,
    this.recipeClick = function(e, t) {
        e.click((function(e) {
            e.stopPropagation();
            var n = "active-recipe";
            i.wnd.$.find(".one-recipe-on-list").removeClass(n),
            $(this).addClass(n),
            i.showRecipe(t)
        }
        ))
    }
    ,
    this.showRecipe = function(e) {
        var t = i.wnd.$
          , a = r[e];
        n = e,
        t.find(".mark-offer").removeClass("mark-offer"),
        t.find(".recipe-id-" + e).addClass("mark-offer"),
        t.find(".reagent-list-label").html(_t("reagent_list")),
        t.find(".choose-recipe").css("display", "block"),
        t.find(".recipe-header .recipe-description-header").detach(),
        t.find(".recipe-header").html(a.header),
        t.find(".recipe-wrapper .recipe-description-reagents").detach(),
        t.find(".recipe-wrapper").html(a.reagents),
        t.find(".recipe-wrapper").append(a.button);
        var s = i.wnd.$.find(".use-recipe-btn>button");
        s.attr("disabled") || s.click((function() {
            i.confirmUseRecipe(e)
        }
        ))
    }
    ,
    this.startFilter = function() {
        i.wnd.$.find(".one-recipe-on-list").css("display", "block"),
        i.searchKeyUp(),
        i.lvlKeyUp(),
        i.getValueFromProf(),
        i.getValueFromItemType()
    }
    ,
    this.initSearch = function() {
        var e = this.wnd.$.find(".search");
        e.keyup((function() {
            i.startFilter()
        }
        )),
        e.attr("placeholder", _t("search"))
    }
    ,
    this.searchKeyUp = function() {
        var e = i.wnd.$.find(".search").val()
          , t = i.wnd.$.find(".one-recipe-on-list");
        "" == e || t.each((function() {
            var t = $(this).find(".name").html().toLowerCase().search(e.toLowerCase()) > -1 ? "block" : "none";
            $(this).css("display", t)
        }
        ))
    }
    ,
    this.lvlKeyUp = function() {
        var e = this.wnd.$.find(".start-lvl").val()
          , t = this.wnd.$.find(".stop-lvl").val()
          , n = i.wnd.$.find(".one-recipe-on-list");
        "" == e && "" == t || ("" == e && (e = 0),
        "" == t && (t = 1e3),
        n.each((function() {
            if ("none" != $(this).css("display")) {
                var i = $(this).attr("lvl")
                  , n = i >= parseInt(e) && i <= parseInt(t) ? "block" : "none";
                $(this).css("display", n)
            }
        }
        )))
    }
    ,
    this.initStartLvl = function() {
        this.wnd.$.find(".start-lvl").keyup((function() {
            i.startFilter()
        }
        ))
    }
    ,
    this.initStopLvl = function() {
        this.wnd.$.find(".stop-lvl").keyup((function() {
            i.startFilter()
        }
        ))
    }
    ,
    this.getRecipeIcon = function(e) {
        var t = g.tplsManager.getClone(e, "c");
        return t.find("small").remove(),
        t
    }
    ,
    this.newRecipeItem = function(e, t) {
        this.items[e.id] = e,
        t && this.createAllRecipes()
    }
    ,
    this.showMenuItem = function(e, t, i) {
        if (isset(parseItemStat(t.stat).canpreview)) {
            var n = '_g("moveitem&st=2&tpl=' + t.id + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
            showMenu({
                target: i
            }, [[_t("show", null, "item"), n, !0]])
        }
    }
    ,
    this.update = function(e) {
        this.recipes = e
    }
    ,
    this.createAllRecipes = function() {
        this.wnd.$.css("display", "block");
        var e = {}
          , t = {};
        for (var r in this.cleanList(),
        this.recipes) {
            var a = this.recipes[r];
            this.createRecipesList(a, r, e, t),
            this.createRecipe(a, r)
        }
        for (var s in t) {
            var l = t[s];
            for (var c in l.enabled.sort((function(e, t) {
                var i = $(e).find(".name").html()
                  , n = $(t).find(".name").html();
                return i < n ? -1 : i > n ? 1 : 0
            }
            )),
            l.disabled.sort((function(e, t) {
                var i = $(e).find(".name").html()
                  , n = $(t).find(".name").html();
                return i < n ? -1 : i > n ? 1 : 0
            }
            )),
            l.enabled)
                i.createGroupElement(s, l.enabled[c]);
            for (var o in l.disabled)
                i.createGroupElement(s, l.disabled[o])
        }
        null !== n && i.showRecipe(n)
    }
    ,
    this.deleteRecipes = function() {
        for (var e in r) {
            var t = r[e];
            delete r[e],
            t.header.remove(),
            t.reagents.remove(),
            t.button.remove()
        }
    }
    ,
    this.createCloseBut = function() {
        i.wnd.$.find(".close-but").click(this.close)
    }
    ,
    this.tLang = function(e) {
        return _t(e, null, "recipes")
    }
    ,
    this.getOneRecipeOnList = function() {
        return $('<div class="one-recipe-on-list"><div class="result-item item-slot"></div><div class="name-wrapper"><div class="name"></div></div></div>')
    }
    ,
    this.getRecipeReagent = function() {
        return $('<div class="recipe-reagent"><div class="reagent-wrapper"><div class="item-reagent-wrapper"><div class="item-reagent item-slot"></div></div><div class="reagent-info"><div class="item-name"></div><div class="amount-items"><span class="have"></span>/<span class="need"></span></div></div></div></div>')
    }
    ,
    this.getRecipeDescriptionHeader = function() {
        return $('<div class="recipe-description-header"><div class="item-name-wrapper"><div class="result-item item-slot"></div><div class="recipe-name"></div></div></div>')
    }
    ,
    this.getRecipeDescriptionReagents = function() {
        return $('<div class="recipe-description-reagents"><div class="reagents-list"></div></div>')
    }
    ,
    this.getRecipeDescriptionButton = function() {
        return $('<div class="recipe-description-button"><div class="use-recipe-btn"></div></div>')
    }
    ,
    this.close = function() {
        t.recipes = [],
        t.items = {},
        g.tplsManager.removeCallback("c")
    }
}
function _slicedToArray(e, t) {
    return _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _unsupportedIterableToArray(e, t) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _iterableToArrayLimit(e, t) {
    var n = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (null != n) {
        var r, i, a = [], s = !0, l = !1;
        try {
            for (n = n.call(e); !(s = (r = n.next()).done) && (a.push(r.value),
            !t || a.length !== t); s = !0)
                ;
        } catch (e) {
            l = !0,
            i = e
        } finally {
            try {
                s || null == n.return || n.return()
            } finally {
                if (l)
                    throw i
            }
        }
        return a
    }
}
function _arrayWithHoles(e) {
    if (Array.isArray(e))
        return e
}
function _createForOfIteratorHelper(e, t) {
    var n = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (!n) {
        if (Array.isArray(e) || (n = _unsupportedIterableToArray(e)) || t && e && "number" == typeof e.length) {
            n && (e = n);
            var r = 0
              , i = function() {};
            return {
                s: i,
                n: function() {
                    return r >= e.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: e[r++]
                    }
                },
                e: function(e) {
                    throw e
                },
                f: i
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var a, s = !0, l = !1;
    return {
        s: function() {
            n = n.call(e)
        },
        n: function() {
            var e = n.next();
            return s = e.done,
            e
        },
        e: function(e) {
            l = !0,
            a = e
        },
        f: function() {
            try {
                s || null == n.return || n.return()
            } finally {
                if (l)
                    throw a
            }
        }
    }
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var n = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === n && e.constructor && (n = e.constructor.name),
        "Map" === n || "Set" === n ? Array.from(e) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var n = 0, r = new Array(t); n < t; n++)
        r[n] = e[n];
    return r
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var r = t[n];
        r.enumerable = r.enumerable || !1,
        r.configurable = !0,
        "value"in r && (r.writable = !0),
        Object.defineProperty(e, r.key, r)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
function _defineProperty(e, t, n) {
    return t in e ? Object.defineProperty(e, t, {
        value: n,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : e[t] = n,
    e
}
var Salvage = function() {
    "use strict";
    function e(t) {
        var n = this;
        _classCallCheck(this, e),
        _defineProperty(this, "deboucedReagentDelete", debounce((function(e) {
            n.reagentDelete(e)
        }
        ), 100)),
        this.wndEl = t,
        this.reagentsGridSize = {
            x: 5,
            y: 2
        },
        this.maxReagentsLimit = this.reagentsGridSize.y * this.reagentsGridSize.x,
        this.selectedInventoryItems = [],
        this.reagentSlotsOld = {},
        this.reagentSlots = {},
        this.receivedItems = {},
        this.requestBlock = !1,
        this.createContent(),
        this.droppableInit(),
        this.getEngine().tplsManager.fetch("h", this.newReceivedItem.bind(this)),
        this.getEngine().disableItemsManager.startSpecificItemKindDisable("salvage")
    }
    return _createClass(e, [{
        key: "getSalvageTpl",
        value: function() {
            return $('\n\t\t<div class="salvage">\n            <div class="salvage__content">\n                <div class="salvage__info">'.concat(_t("info", null, "salvager"), '</div>\n                <div class="salvage__reagents items-grid">\n                    <div class="salvage__label">').concat(_t("selected", null, "salvager"), '</div>\n                </div>\n                <div class="salvage__receives">\n                    <div class="salvage__label">').concat(_t("result", null, "salvager"), '</div>\n                </div>\n                <div class="salvage__submit"></div>\n            </div>\n        </div>\n\t'))
        }
    }, {
        key: "newReceivedItem",
        value: function(e, t) {
            if (isset(this.receivedItems[e.id])) {
                var n = e.$[0];
                this.updateAmount(e, n),
                this.receivedItems[e.id].icon = n,
                this.receivedItems[e.id].itemTypeSort = e.itemTypeSort,
                t && this.appendReceivedItems()
            }
        }
    }, {
        key: "appendReceivedItems",
        value: function() {
            for (var e = this.sortTpls(this.receivedItems), t = 0; t < e.length; t++)
                this.setReceivedItemSlot(e[t].icon, t),
                this.receivesGridEl.appendChild(e[t].icon)
        }
    }, {
        key: "sortTpls",
        value: function(e) {
            return Object.values(e).sort((function(e, t) {
                return e.itemTypeSort - t.itemTypeSort
            }
            ))
        }
    }, {
        key: "setReceivedItemSlot",
        value: function(e, t) {
            var n = Math.floor(t / 8)
              , r = t - 8 * n;
            e.style.left = 32 * r + r + 1 + "px",
            e.style.top = 32 * n + n + 1 + "px"
        }
    }, {
        key: "updateAmount",
        value: function(e, t) {
            var n = this.receivedItems[e.id].amount;
            this.getEngine().tplsManager.changeItemAmount(e, $(t), n)
        }
    }, {
        key: "createContent",
        value: function() {
            var e = this.getSalvageTpl()[0];
            this.contentEl = this.wndEl.querySelector(".salvage-content"),
            this.contentEl.innerHTML = "",
            this.contentEl.appendChild(e),
            this.createConfirmButton(),
            this.reagentsGridEl = this.contentEl.querySelector(".salvage__reagents"),
            this.receivesGridEl = this.contentEl.querySelector(".salvage__receives")
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var e = drawSIButton(_t("submit", null, "salvager"))[0]
              , t = this.contentEl.querySelector(".salvage__submit");
            e.classList.add("disable"),
            e.addEventListener("click", this.confirmOnClick.bind(this)),
            t.appendChild(e)
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var e = this
              , t = _t("confirm-prompt", null, "salvager");
            mAlert(t, 1, [function() {
                return e.doSalvage()
            }
            , function() {}
            ])
        }
    }, {
        key: "doSalvage",
        value: function() {
            if (this.selectedInventoryItems.length > 0) {
                var e = this.selectedInventoryItems.join(",");
                _g("salvager&action=salvage&selectedItems=".concat(e), (function() {}
                ))
            }
        }
    }, {
        key: "setConfirmButton",
        value: function() {
            var e = this.contentEl.querySelector(".salvage__submit .SI-button");
            Object.keys(this.reagentSlots).length > 0 ? e.classList.remove("disable") : e.classList.add("disable")
        }
    }, {
        key: "sendRequest",
        value: function() {
            if (this.selectedInventoryItems.length > 0) {
                var e = this.selectedInventoryItems.join(",");
                this.requestBlock = !0,
                _g("salvager&action=preview&selectedItems=".concat(e), this.afterRequest.bind(this))
            }
        }
    }, {
        key: "afterRequest",
        value: function(e) {
            !isset(e.item_tpl && isset(e.msg)) && this.selectedInventoryItems.length > 0 && this.selectedInventoryItems.pop(),
            this.requestBlock = !1
        }
    }, {
        key: "droppableInit",
        value: function() {}
    }, {
        key: "onClickInventoryItem",
        value: function(e) {
            if (!this.requestBlock) {
                var t = parseInt(e.id);
                if (this.selectedInventoryItems.includes(t))
                    this.reagentDelete(t);
                else {
                    if (!this.canSelectNextItem())
                        return;
                    this.selectedInventoryItems.push(t),
                    this.sendRequest()
                }
            }
        }
    }, {
        key: "canSelectNextItem",
        value: function() {
            return this.selectedInventoryItems.length < this.maxReagentsLimit
        }
    }, {
        key: "addReagentItem",
        value: function(e) {
            for (var t = this, n = null, r = 0; r < this.reagentsGridSize.y; r++) {
                for (var i = 0; i < this.reagentsGridSize.x; i++)
                    if (!isset(this.reagentSlots[i + "," + r])) {
                        n = [i, r];
                        break
                    }
                if (n)
                    break
            }
            if (null !== n) {
                this.reagentSlots[n[0] + "," + n[1]] = e.id;
                var a = $("#item" + e.id).clone(!1)[0];
                a.style.top = 32 * n[1] + n[1] + 1 + "px",
                a.style.left = 32 * n[0] + n[0] + 1 + "px",
                this.reagentsGridEl.appendChild(a),
                a.addEventListener("click", (function() {
                    t.onClickInventoryItem(e),
                    Tip.hide()
                }
                )),
                this.getEngine().itemsMovedManager.addItem(e, "salvage", (function() {
                    t.onClickInventoryItem(e)
                }
                ))
            }
            this.setConfirmButton()
        }
    }, {
        key: "onReagentDelete",
        value: function(e) {
            removeFromArray(this.selectedInventoryItems, e),
            this.deboucedReagentDelete(e)
        }
    }, {
        key: "reagentDelete",
        value: function(e) {
            removeFromArray(this.selectedInventoryItems, e),
            this.selectedInventoryItems.length > 0 ? this.sendRequest() : this.clearAll()
        }
    }, {
        key: "removeReagentItem",
        value: function(e) {
            removeFromArray(this.selectedInventoryItems, e),
            this.removeReagentItemIconIfExist(e),
            this.getEngine().itemsMovedManager.removeItem(e),
            this.setConfirmButton()
        }
    }, {
        key: "removeReagentItemIconIfExist",
        value: function(e) {
            var t = this.reagentsGridEl.querySelector("#item".concat(e));
            t && t.parentNode.removeChild(t)
        }
    }, {
        key: "removeAllReagentItems",
        value: function() {
            var e, t = _createForOfIteratorHelper(this.reagentsGridEl.querySelectorAll(".item"));
            try {
                for (t.s(); !(e = t.n()).done; ) {
                    var n = e.value;
                    n.parentNode.removeChild(n)
                }
            } catch (e) {
                t.e(e)
            } finally {
                t.f()
            }
        }
    }, {
        key: "update",
        value: function(e) {
            this.removeAllReceivedItems(),
            this.reagentSlotsOld = this.reagentSlots,
            this.reagentSlots = {};
            var t, n = _createForOfIteratorHelper(arrayEquals(e.item, this.selectedInventoryItems) ? this.selectedInventoryItems : e.item);
            try {
                for (n.s(); !(t = n.n()).done; ) {
                    var r = t.value;
                    this.removeReagentItemIconIfExist(r);
                    var i = this.getEngine().item[r];
                    this.addReagentItem(i)
                }
            } catch (e) {
                n.e(e)
            } finally {
                n.f()
            }
            var a, s = _createForOfIteratorHelper(e.recived);
            try {
                for (s.s(); !(a = s.n()).done; ) {
                    var l = _slicedToArray(a.value, 2)
                      , o = l[0]
                      , c = l[1];
                    this.receivedItems[o] = {
                        id: o,
                        amount: c,
                        icon: null,
                        itemTypeSort: null
                    }
                }
            } catch (e) {
                s.e(e)
            } finally {
                s.f()
            }
            this.removeOldReagentItems()
        }
    }, {
        key: "removeOldReagentItems",
        value: function() {
            var e = Object.values(this.reagentSlotsOld)
              , t = Object.values(this.reagentSlots);
            if (e.length > t.length) {
                var n, r = _createForOfIteratorHelper(e.filter((function(e) {
                    return !t.includes(e)
                }
                )));
                try {
                    for (r.s(); !(n = r.n()).done; ) {
                        var i = n.value;
                        this.removeReagentItem(i)
                    }
                } catch (e) {
                    r.e(e)
                } finally {
                    r.f()
                }
            }
        }
    }, {
        key: "removeAllReceivedItems",
        value: function() {
            this.receivedItems = {},
            this.getEngine().tplsManager.deleteMessItemsByLoc("h");
            var e, t = _createForOfIteratorHelper(this.receivesGridEl.querySelectorAll(".item"));
            try {
                for (t.s(); !(e = t.n()).done; ) {
                    var n = e.value;
                    n.parentNode.removeChild(n)
                }
            } catch (e) {
                t.e(e)
            } finally {
                t.f()
            }
        }
    }, {
        key: "clearAll",
        value: function() {
            this.reagentSlots = {},
            this.selectedInventoryItems = [],
            this.removeAllReagentItems(),
            this.getEngine().itemsMovedManager.removeItemsByTarget("salvage"),
            this.removeAllReceivedItems(),
            this.setConfirmButton()
        }
    }, {
        key: "close",
        value: function() {
            this.clearAll(),
            this.getEngine().tplsManager.removeCallback("h", this.newReceivedItem.bind(this)),
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("salvage"),
            this.getEngine().crafting.salvage = !1
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _slicedToArray(t, e) {
    return _arrayWithHoles(t) || _iterableToArrayLimit(t, e) || _unsupportedIterableToArray(t, e) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _iterableToArrayLimit(t, e) {
    var n = null == t ? null : "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (null != n) {
        var r, i, a = [], o = !0, s = !1;
        try {
            for (n = n.call(t); !(o = (r = n.next()).done) && (a.push(r.value),
            !e || a.length !== e); o = !0)
                ;
        } catch (t) {
            s = !0,
            i = t
        } finally {
            try {
                o || null == n.return || n.return()
            } finally {
                if (s)
                    throw i
            }
        }
        return a
    }
}
function _arrayWithHoles(t) {
    if (Array.isArray(t))
        return t
}
function _createForOfIteratorHelper(t, e) {
    var n = "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
    if (!n) {
        if (Array.isArray(t) || (n = _unsupportedIterableToArray(t)) || e && t && "number" == typeof t.length) {
            n && (t = n);
            var r = 0
              , i = function() {};
            return {
                s: i,
                n: function() {
                    return r >= t.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: t[r++]
                    }
                },
                e: function(t) {
                    throw t
                },
                f: i
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var a, o = !0, s = !1;
    return {
        s: function() {
            n = n.call(t)
        },
        n: function() {
            var t = n.next();
            return o = t.done,
            t
        },
        e: function(t) {
            s = !0,
            a = t
        },
        f: function() {
            try {
                o || null == n.return || n.return()
            } finally {
                if (s)
                    throw a
            }
        }
    }
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var n = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === n && t.constructor && (n = t.constructor.name),
        "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var n = 0, r = new Array(e); n < e; n++)
        r[n] = t[n];
    return r
}
function _classCallCheck(t, e) {
    if (!(t instanceof e))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(t, e) {
    for (var n = 0; n < e.length; n++) {
        var r = e[n];
        r.enumerable = r.enumerable || !1,
        r.configurable = !0,
        "value"in r && (r.writable = !0),
        Object.defineProperty(t, r.key, r)
    }
}
function _createClass(t, e, n) {
    return e && _defineProperties(t.prototype, e),
    n && _defineProperties(t, n),
    Object.defineProperty(t, "prototype", {
        writable: !1
    }),
    t
}
var BonusSelector = function() {
    "use strict";
    function t(e, n) {
        _classCallCheck(this, t),
        this.wrapperEl = e,
        this.selected = null,
        this.defaultOptions = {
            onSelectedClb: !1,
            ownSubmitBtn: !1,
            itemId: !1,
            onSubmitClb: !1
        },
        this.options = Object.assign(Object.assign({}, this.defaultOptions), n),
        this.createContent()
    }
    return _createClass(t, [{
        key: "createContent",
        value: function() {
            this.el = this.getBonusSelectorTpl(),
            this.bonusesEl = this.el.querySelector(".bonus-selector__bonuses"),
            this.buttonsContainerEl = this.el.querySelector(".bonus-selector__submit")
        }
    }, {
        key: "createBonusChoose",
        value: function(t) {
            var e = 0;
            this.bonusesEl.innerHTML = "";
            var n, r = _createForOfIteratorHelper(t);
            try {
                for (r.s(); !(n = r.n()).done; ) {
                    var i = n.value
                      , a = this.getRadioTpl()
                      , o = _slicedToArray(i, 2)
                      , s = o[0]
                      , l = o[1]
                      , u = a.querySelector("input")
                      , c = a.querySelector("label");
                    setAttributes(u, {
                        id: s,
                        name: "enhance-bonus",
                        value: e
                    }),
                    c.setAttribute("for", s),
                    c.innerHTML = this.bonusStatsParser(s, l),
                    this.bonusesEl.appendChild(a),
                    u.addEventListener("change", this.onSelected.bind(this)),
                    e++
                }
            } catch (t) {
                r.e(t)
            } finally {
                r.f()
            }
            this.options.ownSubmitBtn || this.createButtons(),
            this.wrapperEl.appendChild(this.el)
        }
    }, {
        key: "onSelected",
        value: function(t) {
            this.selected = parseInt(t.target.value),
            this.options.ownSubmitBtn || this.setStateSubmitButton(),
            this.options.onSelectedClb && "function" == typeof this.options.onSelectedClb && this.options.onSelectedClb(this.selected)
        }
    }, {
        key: "createButtons",
        value: function() {
            this.buttonsContainerEl.innerHTML = "",
            this.createConfirmButton(),
            this.createCancelButton()
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var t = {
                txt: this.tLang("accept", "buttons"),
                onClick: this.confirmOnClick.bind(this)
            };
            this.submitBtnEl = drawSIButton(t.txt)[0],
            this.submitBtnEl.classList.add("disable"),
            this.submitBtnEl.addEventListener("click", t.onClick),
            this.buttonsContainerEl.appendChild(this.submitBtnEl)
        }
    }, {
        key: "createCancelButton",
        value: function() {
            var t = {
                txt: this.tLang("cancel", "buttons"),
                onClick: this.cancelOnClick.bind(this)
            };
            this.cancelBtnEl = drawSIButton(t.txt)[0],
            this.cancelBtnEl.addEventListener("click", t.onClick),
            this.buttonsContainerEl.appendChild(this.cancelBtnEl)
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var t = this
              , e = this.tLang("confirm-prompt");
            mAlert(e, 1, [function() {
                return t.submit()
            }
            , function() {}
            ])
        }
    }, {
        key: "cancelOnClick",
        value: function() {
            this.options.onSubmitClb && "function" == typeof this.options.onSubmitClb && this.options.onSubmitClb(!1)
        }
    }, {
        key: "setStateSubmitButton",
        value: function() {
            null !== this.selected ? this.enableSubmitButton() : this.disableSubmitButton()
        }
    }, {
        key: "enableSubmitButton",
        value: function() {
            this.submitBtnEl.classList.remove("disable")
        }
    }, {
        key: "disableSubmitButton",
        value: function() {
            this.submitBtnEl.classList.add("disable")
        }
    }, {
        key: "submit",
        value: function() {
            "function" == typeof this.options.onSubmitClb && null != this.selected && this.options.onSubmitClb(!0, this.selected)
        }
    }, {
        key: "bonusStatsParser",
        value: function(t, e) {
            var n, r = "(+", i = ")", a = "";
            switch (t) {
            case "critmval":
                a = "%",
                n = _t("bonus_of-".concat(t, " %val%"), createTransVal(e, a, r, i), "newOrder");
                break;
            case "sa":
                n = _t("no_percent_bonus_sa %val%", createTransVal(e / 100, a, r, i));
                break;
            case "ac":
                n = _t("item_".concat(t, " %val%"), createTransVal(e, a, r, i));
                break;
            case "act":
            case "resfire":
            case "reslight":
            case "resfrost":
                a = "%",
                n = _t("item_".concat(t, " %val%"), createTransVal(e, a, r, i), "newOrder");
                break;
            case "crit":
            case "critval":
            case "resdmg":
                a = "%",
                n = _t("bonus_".concat(t, " %val%"), createTransVal(e, a, r, i), "newOrder");
                break;
            case "slow":
                n = _t("bonus_".concat(t, " %val%"), createTransVal(e / 100, a, r, i));
                break;
            default:
                n = _t("bonus_".concat(t, " %val%"), createTransVal(e, a, r, i))
            }
            return n
        }
    }, {
        key: "getBonusSelectorTpl",
        value: function() {
            return $('\n        <div class="bonus-selector">\n            <div class="bonus-selector__bonuses"></div>\n            <div class="bonus-selector__submit"></div>\n        </div>')[0]
        }
    }, {
        key: "getRadioTpl",
        value: function() {
            return $('\n        <div class="radio-custom">\n            <input type="radio" id="xxx" name="xxx">\n            <label for="xxx"></label>\n        </div>')[0]
        }
    }, {
        key: "tLang",
        value: function(t) {
            var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement"
              , n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(t, n, e) : ""
        }
    }]),
    t
}();
function _createForOfIteratorHelper(e, t) {
    var n = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (!n) {
        if (Array.isArray(e) || (n = _unsupportedIterableToArray(e)) || t && e && "number" == typeof e.length) {
            n && (e = n);
            var a = 0
              , r = function() {};
            return {
                s: r,
                n: function() {
                    return a >= e.length ? {
                        done: !0
                    } : {
                        done: !1,
                        value: e[a++]
                    }
                },
                e: function(e) {
                    throw e
                },
                f: r
            }
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var i, s = !0, o = !1;
    return {
        s: function() {
            n = n.call(e)
        },
        n: function() {
            var e = n.next();
            return s = e.done,
            e
        },
        e: function(e) {
            o = !0,
            i = e
        },
        f: function() {
            try {
                s || null == n.return || n.return()
            } finally {
                if (o)
                    throw i
            }
        }
    }
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var n = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === n && e.constructor && (n = e.constructor.name),
        "Map" === n || "Set" === n ? Array.from(e) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var n = 0, a = new Array(t); n < t; n++)
        a[n] = e[n];
    return a
}
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var a = t[n];
        a.enumerable = a.enumerable || !1,
        a.configurable = !0,
        "value"in a && (a.writable = !0),
        Object.defineProperty(e, a.key, a)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
function _defineProperty(e, t, n) {
    return t in e ? Object.defineProperty(e, t, {
        value: n,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : e[t] = n,
    e
}
var Enchant = function() {
    "use strict";
    function e(t) {
        var n = this;
        _classCallCheck(this, e),
        _defineProperty(this, "deboucedReagentDelete", debounce((function(e) {
            n.reagentDelete(e)
        }
        ), 10)),
        this.el = t,
        this.reagentsGridSize = {
            x: 5,
            y: 2
        },
        this.maxReagentsLimit = this.reagentsGridSize.y * this.reagentsGridSize.x,
        this.reagentSlots = {},
        this.addReagentsBlock = !0,
        this.selectedInventoryItems = [],
        this.createContent(),
        this.droppableInit()
    }
    return _createClass(e, [{
        key: "createContent",
        value: function() {
            this.createAutofiller(),
            this.createConfirmButton(),
            this.reagentsGridEl = this.el.querySelector(".enhance__reagents")
        }
    }, {
        key: "createAutofiller",
        value: function() {
            var e = this;
            this.autofillerEl = this.el.querySelector(".enhance__autofiller");
            var t = {
                btnTip: function(e) {
                    return _t("advanced_craftsman_choose_bag %val%", {
                        "%val%": e
                    })
                },
                btnFn: function(t) {
                    return e.autofillFrom(t)
                },
                storageName: "ENCHANT_AUTOFILLER",
                filters: {
                    cl: [{
                        key: 1,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 2,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 3,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 4,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 5,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 6,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 7,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 8,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 9,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 10,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 11,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 12,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 13,
                        checked: !0,
                        groupId: 1
                    }, {
                        key: 14,
                        checked: !0,
                        groupId: 1
                    }]
                },
                configWindow: {
                    title: _t("advanced_craftsman"),
                    heading: this.tLang("info6"),
                    cssClass: "",
                    groups: [{
                        id: 1,
                        title: _t("itemKinds", null, "autofiller")
                    }]
                },
                itemGrabberOptions: {
                    allow: {
                        cls: [],
                        stats: [{
                            name: "rarity",
                            params: ["===", "common"]
                        }, {
                            name: "lvl",
                            params: [">=", 20]
                        }]
                    },
                    deny: {
                        stats: ["artisan_worthless"]
                    }
                }
            };
            this.autofiller = new Autofiller(t),
            this.autofiller.disabled(),
            this.autofillerEl.appendChild(this.autofiller.getContent())
        }
    }, {
        key: "autofillFrom",
        value: function(e) {
            this.addManyReagentItems(e)
        }
    }, {
        key: "droppableInit",
        value: function() {
            var e = this;
            $(this.reagentsGridEl).droppable({
                accept: ".inventory-item",
                drop: function(t, n) {
                    n.draggable.css("opacity", ""),
                    e.onClickReagent(n.draggable.data("item"))
                }
            })
        }
    }, {
        key: "onClickReagent",
        value: function(e) {
            if (!this.addReagentsBlock && !this.getEnhancement().requestBlock) {
                var t = e.id;
                if (this.selectedInventoryItems.includes(t))
                    this.reagentDelete(t, !0);
                else {
                    if (!this.canSelectNextItem())
                        return;
                    this.selectedInventoryItems.push(t),
                    this.sendReagentsRequest(e)
                }
            }
        }
    }, {
        key: "isCorrectReagent",
        value: function(e) {
            var t = this.getEngine().item[this.getEnhancement().selectedEnhanceItem];
            if (t.id === e.id)
                return !1;
            var n = checkItemStat(e, "target_rarity")
              , a = parseItemStat(e.stat);
            return !n || n && a.target_rarity === t.itemTypeName
        }
    }, {
        key: "onReagentDelete",
        value: function(e) {
            removeFromArray(this.selectedInventoryItems, e),
            this.deboucedReagentDelete(e)
        }
    }, {
        key: "reagentDelete",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
              , n = g.item[e];
            removeFromArray(this.selectedInventoryItems, e),
            this.selectedInventoryItems.length > 0 ? this.sendReagentsRequest(n, !1) : (this.removeReagentItem(e),
            t && this.onEmptyReagents())
        }
    }, {
        key: "onEmptyReagents",
        value: function() {
            this.getEnhancement().onEmptyReagents()
        }
    }, {
        key: "sendReagentsRequest",
        value: function(e) {
            var t = this
              , n = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1];
            this.getEnhancement().sendRequest(this.getEnhancement().RT.CHECK_PROGRESS, this.selectedInventoryItems, (function() {
                n ? t.addReagentItem(e) : isset(e) && t.removeReagentItem(e.id)
            }
            ))
        }
    }, {
        key: "addManyReagentItems",
        value: function(e) {
            var t, n = 0, a = _createForOfIteratorHelper(e);
            try {
                for (a.s(); !(t = a.n()).done; ) {
                    var r = t.value;
                    this.isCorrectReagent(r) && !this.isReagentItemIsSelectedAlready(r.id) && this.canSelectNextItem() && (n++,
                    this.selectedInventoryItems.push(r.id),
                    this.addReagentItem(r))
                }
            } catch (e) {
                a.e(e)
            } finally {
                a.f()
            }
            n > 0 && this.getEnhancement().sendRequest(this.getEnhancement().RT.CHECK_PROGRESS, this.selectedInventoryItems)
        }
    }, {
        key: "isReagentItemIsSelectedAlready",
        value: function(e) {
            return this.selectedInventoryItems.includes(e)
        }
    }, {
        key: "addReagentItem",
        value: function(e) {
            for (var t = this, n = null, a = 0; a < this.reagentsGridSize.y; a++) {
                for (var r = 0; r < this.reagentsGridSize.x; r++)
                    if (!isset(this.reagentSlots[r + "," + a])) {
                        n = [r, a];
                        break
                    }
                if (n)
                    break
            }
            if (null !== n) {
                this.reagentSlots[n[0] + "," + n[1]] = e.id;
                var i = $("#bagc #item" + e.id).clone(!1)[0];
                i.dataset.item = e,
                i.style.top = 32 * n[1] + n[1] + 1 + "px",
                i.style.left = 32 * n[0] + n[0] + 1 + "px",
                this.reagentsGridEl.appendChild(i),
                i.addEventListener("click", (function() {
                    t.onClickReagent(e)
                }
                )),
                this.getEngine().itemsMovedManager.addItem(e, "enhance", (function() {
                    t.onClickReagent(e)
                }
                ))
            }
            this.setEnchantConfirmButton()
        }
    }, {
        key: "removeReagentItem",
        value: function(e) {
            for (var t in this.reagentSlots)
                this.reagentSlots[t] == e && delete this.reagentSlots[t];
            removeFromArray(this.selectedInventoryItems, e),
            this.removeReagentItemIconIfExist(e),
            this.getEngine().itemsMovedManager.removeItem(e),
            this.setEnchantConfirmButton()
        }
    }, {
        key: "removeReagentItemIconIfExist",
        value: function(e) {
            var t = this.reagentsGridEl.querySelector("#item".concat(e));
            t && t.parentNode.removeChild(t)
        }
    }, {
        key: "canSelectNextItem",
        value: function() {
            return this.selectedInventoryItems.length < this.maxReagentsLimit
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var e = {
                selector: ".enhance__submit",
                txt: this.tLang("submit_btn"),
                onClick: this.confirmOnClick.bind(this)
            }
              , t = drawSIButton(e.txt)[0]
              , n = this.el.querySelector(e.selector);
            t.classList.add("disable"),
            t.addEventListener("click", e.onClick),
            n.appendChild(t)
        }
    }, {
        key: "setEnchantConfirmButton",
        value: function() {
            var e = this.el.querySelector(".enhance__submit .SI-button");
            Object.keys(this.reagentSlots).length > 0 ? e.classList.remove("disable") : e.classList.add("disable")
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var e = this
              , t = this.tLang("confirm-prompt");
            mAlert(t, 1, [function() {
                return e.getEnhancement().sendRequest(e.getEnhancement().RT.ENCHANT, e.selectedInventoryItems, e.afterEnchant.bind(e))
            }
            , function() {}
            ])
        }
    }, {
        key: "afterEnchant",
        value: function(e) {}
    }, {
        key: "setEnchantDisableState",
        value: function() {
            var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0];
            e ? (this.el.classList.add("disabled"),
            this.addReagentsBlock = !0,
            this.setReagentsDisableState(!0)) : (this.el.classList.remove("disabled"),
            this.addReagentsBlock = !1,
            this.setReagentsDisableState(!1)),
            this.setEnchantConfirmButton()
        }
    }, {
        key: "setReagentsDisableState",
        value: function() {
            var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0];
            e ? (this.reagentsGridEl.classList.add("disabled"),
            this.autofiller.disabled(),
            this.addReagentsBlock = !0) : (this.reagentsGridEl.classList.remove("disabled"),
            this.autofiller.enabled(),
            this.addReagentsBlock = !1),
            this.setEnchantConfirmButton()
        }
    }, {
        key: "update",
        value: function(e) {
            e.data;
            var t = e.disable;
            void 0 !== t && this.setEnchantDisableState(t)
        }
    }, {
        key: "clearReagents",
        value: function() {
            this.selectedInventoryItems = [],
            this.reagentSlots = {};
            var e, t = _createForOfIteratorHelper(this.reagentsGridEl.querySelectorAll(".item"));
            try {
                for (t.s(); !(e = t.n()).done; ) {
                    var n = e.value;
                    n.parentNode.removeChild(n)
                }
            } catch (e) {
                t.e(e)
            } finally {
                t.f()
            }
            var a = this.getEnhancement().selectedEnhanceItem ? [this.getEnhancement().selectedEnhanceItem] : [];
            this.getEngine().itemsMovedManager.removeItemsByTarget("enhance", a),
            this.setEnchantConfirmButton()
        }
    }, {
        key: "reset",
        value: function() {
            this.setEnchantDisableState(!1),
            this.setReagentsDisableState(!0),
            this.setEnchantConfirmButton(),
            this.clearReagents()
        }
    }, {
        key: "destroy",
        value: function() {
            this.autofiller.reset()
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement";
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(e, null, t) : ""
        }
    }, {
        key: "getEnhancement",
        value: function() {
            return this.getEngine().crafting.enhancement
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var i = t[n];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Upgrade = function() {
    "use strict";
    function e(t) {
        _classCallCheck(this, e),
        this.el = t,
        this.disable = !0,
        this.lastData = null,
        this.upgradeLvl = null,
        this.selectedBonus = null,
        this.requireItem = {},
        this.createContent(),
        this.bonusSelector = new BonusSelector(this.bonusChooseEl,{
            onSelectedClb: this.onBonusSelected.bind(this),
            ownSubmitBtn: !0
        }),
        this.setDisableState(!0),
        this.resetGold(),
        this.getEngine().tplsManager.fetch("u", this.newRequireItem.bind(this))
    }
    return _createClass(e, [{
        key: "newRequireItem",
        value: function(e, t) {
            var n = e.$[0];
            this.updateAmount(e, n),
            this.requireItemSlotEl.appendChild(n)
        }
    }, {
        key: "updateAmount",
        value: function(e, t) {
            if (isset(this.requireItem)) {
                var n = this.requireItem.amount;
                this.getEngine().tplsManager.changeItemAmount(e, $(t), n)
            }
        }
    }, {
        key: "setDisableState",
        value: function(e) {
            this.disable = e,
            this.disable ? this.el.classList.add("disabled", "hidden") : this.el.classList.remove("disabled", "hidden")
        }
    }, {
        key: "createContent",
        value: function() {
            this.createConfirmButton(),
            this.bonusChooseEl = this.el.querySelector(".enhance__bonus"),
            this.goldAmountEl = this.el.querySelector(".enhance__r-gold-amount"),
            this.requireItemSlotEl = this.el.querySelector(".enhance__r-item")
        }
    }, {
        key: "onBonusSelected",
        value: function(e) {
            this.selectedBonus = e,
            this.lastData ? this.setStateConfirmButton(this.lastData) : this.enableConfirmButton()
        }
    }, {
        key: "clearBonus",
        value: function() {
            this.bonusChooseEl.innerHTML = ""
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var e = {
                selector: ".enhance__submit2",
                txt: this.tLang("submit_btn2"),
                onClick: this.confirmOnClick.bind(this)
            }
              , t = this.el.querySelector(e.selector);
            this.confirmBtnEl = drawSIButton(e.txt)[0],
            this.confirmBtnEl.classList.add("disable"),
            this.confirmBtnEl.addEventListener("click", e.onClick),
            t.appendChild(this.confirmBtnEl)
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var e = this
              , t = this.lastData ? {
                "%val%": formNumberToNumbersGroup(this.lastData.goldPrice)
            } : null
              , n = this.tLang("upgrade_cost %val%", "enhancement", t)
              , i = this.tLang("confirm-prompt");
            mAlert(t ? n + i : i, 1, [function() {
                return e.doUpgrade()
            }
            , function() {}
            ])
        }
    }, {
        key: "doUpgrade",
        value: function() {
            var e = this
              , t = 4 === this.upgradeLvl ? "&bonusIdx=".concat(this.selectedBonus) : "";
            _g("enhancement&action=upgrade&item=".concat(this.getEnhancement().selectedEnhanceItem).concat(t), (function(t) {
                isset(t.enhancement.progressing) && e.reset()
            }
            ))
        }
    }, {
        key: "enableConfirmButton",
        value: function() {
            this.confirmBtnEl.classList.remove("disable")
        }
    }, {
        key: "disableConfirmButton",
        value: function() {
            this.confirmBtnEl.classList.add("disable")
        }
    }, {
        key: "update",
        value: function(e) {
            var t = e.data
              , n = e.disable;
            if (void 0 !== t) {
                this.lastData = t;
                var i = t.bonuses
                  , s = t.goldPrice
                  , r = t.ingredientPrice
                  , o = t.ingredientTplId
                  , a = t.upgradeLevel;
                this.upgradeLvl = a,
                this.setGoldAmount({
                    goldPrice: s
                }),
                this.setRequireItem({
                    ingredientPrice: r,
                    ingredientTplId: o
                }),
                i.length > 0 && this.bonusSelector.createBonusChoose(i),
                this.setStateConfirmButton(t)
            }
            void 0 !== n && this.setDisableState(n)
        }
    }, {
        key: "setStateConfirmButton",
        value: function(e) {
            e.bonuses.length > 0 && null === this.selectedBonus ? this.disableConfirmButton() : this.checkRequires(e) ? this.enableConfirmButton() : this.disableConfirmButton()
        }
    }, {
        key: "checkRequires",
        value: function(e) {
            var t = e.goldPrice
              , n = e.ingredientPrice
              , i = e.ingredientTplId;
            return t <= hero.gold && this.checkRequiresItemsAmount(i, n)
        }
    }, {
        key: "checkRequiresItemsAmount",
        value: function(e, t) {
            var n = this.getEngine().hItems
              , i = 0;
            for (var s in n) {
                var r = n[s];
                r.st > 0 || r.tpl == e && (i += parseInt(parseItemStat(r.stat).amount))
            }
            return i >= t
        }
    }, {
        key: "setRequireItem",
        value: function(e) {
            var t = e.ingredientPrice
              , n = e.ingredientTplId;
            this.requireItem = {
                id: n,
                amount: t
            }
        }
    }, {
        key: "setGoldAmount",
        value: function(e) {
            var t = e.goldPrice
              , n = round(t, 2);
            this.goldAmountEl.innerHTML = n
        }
    }, {
        key: "resetGold",
        value: function() {
            this.setGoldAmount({
                goldPrice: 0
            })
        }
    }, {
        key: "removeRequireItem",
        value: function() {
            this.requireItem = {},
            this.getEngine().tplsManager.deleteMessItemsByLoc("u");
            var e = this.requireItemSlotEl.querySelector(".item");
            e && e.parentNode.removeChild(e)
        }
    }, {
        key: "reset",
        value: function() {
            this.requireItemsFromEQ = [],
            this.upgradeLvl = null,
            this.lastData = null,
            this.selectedBonus = null,
            this.removeRequireItem(),
            this.setDisableState(!0),
            this.disableConfirmButton(),
            this.resetGold(),
            this.clearBonus()
        }
    }, {
        key: "destroy",
        value: function() {
            this.removeRequireItem(),
            this.getEngine().tplsManager.removeCallback("u", this.newRequireItem.bind(this))
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement"
              , n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(e, n, t) : ""
        }
    }, {
        key: "getEnhancement",
        value: function() {
            return this.getEngine().crafting.enhancement
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var r = 0; r < t.length; r++) {
        var s = t[r];
        s.enumerable = s.enumerable || !1,
        s.configurable = !0,
        "value"in s && (s.writable = !0),
        Object.defineProperty(e, s.key, s)
    }
}
function _createClass(e, t, r) {
    return t && _defineProperties(e.prototype, t),
    r && _defineProperties(e, r),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Progressbar = function() {
    "use strict";
    function e(t) {
        _classCallCheck(this, e),
        this.el = t,
        this.lastMax = 0,
        this.lastCurrent = 0,
        this.lastPreview = 0,
        this.lastUpgradeLevel = 0,
        this.currentProgressEl = t.querySelector(".enhance__progress--current"),
        this.previewProgressEl = t.querySelector(".enhance__progress--preview"),
        this.currentProgressTextEl = t.querySelector(".enhance__progress-text--current"),
        this.previewProgressTextEl = t.querySelector(".enhance__progress-text--preview")
    }
    return _createClass(e, [{
        key: "update",
        value: function(e) {
            var t = e.current
              , r = e.gained
              , s = e.max
              , i = e.upgradeLevel
              , n = s ? t / s * 100 : 0;
            if (void 0 !== r)
                this.setPreview(r, t, s, i);
            else {
                this.lastCurrent = t <= s ? t : s,
                this.lastMax = s,
                this.lastUpgradeLevel = i;
                var a = t || s ? "".concat(t, " / ").concat(s) : " ";
                this.setProgress(n, 0, a, 0)
            }
        }
    }, {
        key: "setPreview",
        value: function(e, t, r, s) {
            var i, n, a = this.lastCurrent, l = a;
            s === this.lastUpgradeLevel ? (t -= this.lastCurrent,
            n = r ? a / r * 100 : 0) : (n = 0,
            l = 0),
            i = r ? (l + t) / r * 100 : 0,
            this.lastPreview = t = e;
            var o = "".concat(this.lastCurrent, " / ").concat(r);
            this.setProgress(n, i, o, t)
        }
    }, {
        key: "setProgress",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0
              , r = arguments.length > 2 ? arguments[2] : void 0
              , s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
            this.currentProgressEl.style.width = e + "%",
            this.currentProgressTextEl.innerText = r,
            this.previewProgressEl.style.width = (t <= 100 ? t : 100) + "%",
            this.previewProgressTextEl.innerText = "+".concat(s),
            s ? this.previewTextShow() : this.previewTextHide()
        }
    }, {
        key: "previewTextShow",
        value: function() {
            this.previewProgressTextEl.style.display = "block"
        }
    }, {
        key: "previewTextHide",
        value: function() {
            this.previewProgressTextEl.style.display = "none",
            this.previewProgressTextEl.innerHTML = ""
        }
    }, {
        key: "isFull",
        value: function() {
            return this.lastCurrent === this.lastMax && 0 !== this.lastCurrent
        }
    }, {
        key: "completed",
        value: function() {
            return this.setProgress(100, 0, this.tLang("completed"), 0),
            !0
        }
    }, {
        key: "reset",
        value: function() {
            this.update({
                current: 0,
                max: 0,
                upgradeLevel: 0
            })
        }
    }, {
        key: "tLang",
        value: function(e) {
            return g.crafting.enhancement.tLang(e)
        }
    }]),
    e
}();
function _classCallCheck(e, n) {
    if (!(e instanceof n))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, n) {
    for (var t = 0; t < n.length; t++) {
        var i = n[t];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, n, t) {
    return n && _defineProperties(e.prototype, n),
    t && _defineProperties(e, t),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Enhancement = function() {
    "use strict";
    function e(n) {
        _classCallCheck(this, e),
        this.wndEl = n,
        this.selectedEnhanceItem = null,
        this.requestBlock = !1,
        this.RT = {
            SET_ENHANCE_ITEM: "SET_ENHANCE_ITEM",
            CHECK_PROGRESS: "CHECK_PROGRESS",
            ENCHANT: "ENCHANT",
            UPGRADE: "UPGRADE"
        },
        this.createContent(),
        this.dimStartDefault()
    }
    return _createClass(e, [{
        key: "getEnhancementTpl",
        value: function() {
            return $('\n      <div class="enhance">\n          <div class="enhance__content">\n              <div class="crafting__bg"></div>\n              <div class="enhance__info enhance__info--top">\n                  <div class="enhance__info--1">\n                      <div class="info-icon" data-trans="data-tip#info_tip#enhancement"></div>\n                      <div class="enhance__info--top">'.concat(_t("info", null, "enhancement"), '</div>\n                  </div>\n                  <div class="enhance__info--3">\n                      <div class="enhance__info--top">').concat(_t("info3", null, "enhancement"), '</div>\n                  </div>\n              </div>\n              <div class="enhance__top">\n                  <div class="enhance__item enhance__item--current">\n                      <div class="slot"></div>\n                      <div class="lvl"></div>\n                  </div>\n                  <div class="enhance__progressbar">\n                      <div class="enhance__progress-bg"></div>\n                      <div class="enhance__progress enhance__progress--current"></div>\n                      <div class="enhance__progress enhance__progress--preview"></div>\n                      <div class="enhance__progress-text enhance__progress-text--current"></div>\n                      <div class="enhance__progress-text enhance__progress-text--preview"></div>\n                  </div>\n                  <div class="enhance__item enhance__item--receive">\n                      <div class="slot"></div>\n                      <div class="lvl"></div>\n                  </div>\n              </div> \n              \n              <div class="enhance__enchant">\n                  <div class="enhance__info enhance__info--top">').concat(_t("info5", null, "enhancement"), '</div>\n                  <div class="enhance__autofiller"></div>\n                  <div class="enhance__reagents items-grid disabled">\n                      <div class="enhance__label">').concat(_t("selected", null, "enhancement"), '</div>\n                  </div>\n                <div class="enhance__submit"></div> \n              </div>\n              \n              <div class="enhance__enhance">\n                      <div class="enhance__bonus"></div>\n                      <div class="enhance__requires">\n                          <div class="enhance__r-gold">\n                              <div class="enhance__r-gold-icon"></div>\n                              <div class="enhance__r-gold-amount"></div>\n                          </div>\n                          <div class="enhance__r-item"></div>\n                      </div>\n                      <div class="enhance__submit2"></div> \n                  </div>\n          </div>\n      </div>'))
        }
    }, {
        key: "createContent",
        value: function() {
            var e = this.getEnhancementTpl()[0];
            this.contentEl = this.wndEl.querySelector(".enhancement-content"),
            this.contentEl.innerHTML = "",
            this.contentEl.appendChild(e),
            this.topInfoEl = this.contentEl.querySelector(".enhance__info--top"),
            this.enhanceItemSlotCurrent = this.contentEl.querySelector(".enhance__item--current .slot"),
            this.enhanceItemSlotCurrentLvl = this.contentEl.querySelector(".enhance__item--current .lvl"),
            this.enhanceItemSlotReceive = this.contentEl.querySelector(".enhance__item--receive .slot"),
            this.enhanceItemSlotReceiveLvl = this.contentEl.querySelector(".enhance__item--receive .lvl");
            var n = this.contentEl.querySelector(".enhance__enchant");
            this.enchant = new Enchant(n);
            var t = this.contentEl.querySelector(".enhance__progressbar");
            this.progressbar = new Progressbar(t);
            var i = this.contentEl.querySelector(".enhance__enhance");
            this.upgrade = new Upgrade(i)
        }
    }, {
        key: "newReceivedItem",
        value: function(e) {
            var n = createItem(e)[0];
            this.enhanceItemSlotReceive.appendChild(n),
            this.receivedItemAfterUpdate(e)
        }
    }, {
        key: "receivedItemAfterUpdate",
        value: function(e) {
            this.setUpgradeLvl(!0, e)
        }
    }, {
        key: "setUpgradeLvl",
        value: function() {
            var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0]
              , n = arguments.length > 1 ? arguments[1] : void 0
              , t = e ? this.enhanceItemSlotReceiveLvl : this.enhanceItemSlotCurrentLvl
              , i = parseInt(isset(n) && isset(parseItemStat(n.stat).enhancement_upgrade_lvl) ? parseItemStat(n.stat).enhancement_upgrade_lvl : 0)
              , s = parseInt(t.getAttribute("data-lvl"));
            i !== s && (t.setAttribute("data-lvl", i),
            t.innerHTML = i || "")
        }
    }, {
        key: "sendRequest",
        value: function(e) {
            var n = this
              , t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : []
              , i = arguments.length > 2 ? arguments[2] : void 0;
            if (this.selectedEnhanceItem) {
                var s = t.join(",");
                switch (e) {
                case this.RT.SET_ENHANCE_ITEM:
                    this.requestBlock = !0,
                    _g("enhancement&action=status&item=".concat(this.selectedEnhanceItem), this.afterRequest.bind(this));
                    break;
                case this.RT.CHECK_PROGRESS:
                    this.requestBlock = !1,
                    _g("enhancement&action=progress_preview&item=".concat(this.selectedEnhanceItem, "&ingredients=").concat(s), (function() {
                        i && i(),
                        n.requestBlock = !1
                    }
                    ));
                    break;
                case this.RT.ENCHANT:
                    _g("enhancement&action=progress&item=".concat(this.selectedEnhanceItem, "&ingredients=").concat(s), i)
                }
            }
        }
    }, {
        key: "afterRequest",
        value: function(e) {
            var n = e.enhancement;
            this.requestBlock = !1,
            isset(n) && isset(n.upgradable || n.progressing || n.completed) && this.addItemToEnchant()
        }
    }, {
        key: "afterUpdateEnhanceItem",
        value: function(e) {
            this.addItemToEnchant()
        }
    }, {
        key: "addItemToEnchant",
        value: function() {
            var e = this
              , n = this.getEngine().item[this.selectedEnhanceItem]
              , t = $("#item" + n.id).clone(!1)[0];
            t.style.top = null,
            t.style.left = null,
            t.addEventListener("click", (function() {
                e.onClickInventoryItem(n)
            }
            )),
            this.getEngine().itemsMovedManager.addItem(n, "enhance", (function() {
                e.onClickInventoryItem(n)
            }
            )),
            this.enhanceItemSlotCurrent.innerHTML = "",
            this.enhanceItemSlotCurrent.appendChild(t),
            this.setUpgradeLvl(!1, n),
            this.dimStartIngredients()
        }
    }, {
        key: "onEmptyReagents",
        value: function() {
            this.sendRequest(this.RT.SET_ENHANCE_ITEM)
        }
    }, {
        key: "onClickInventoryItem",
        value: function(e) {
            if (!this.requestBlock) {
                var n = parseInt(e.id);
                if (!this.selectedEnhanceItem)
                    return this.selectedEnhanceItem = n,
                    void this.sendRequest(this.RT.SET_ENHANCE_ITEM);
                this.selectedEnhanceItem !== n ? 0 === e.st && this.enchant.onClickReagent(e) : this.clearAll()
            }
        }
    }, {
        key: "update",
        value: function(e) {
            this.requestBlock = !1,
            this.enchant.setReagentsDisableState(!1),
            this.enchant.setEnchantConfirmButton(),
            isset(e.progressing) && (this.progressbar.update({
                current: e.progressing.current,
                max: e.progressing.max,
                upgradeLevel: e.progressing.upgradeLevel
            }),
            this.enchant.clearReagents()),
            isset(e.progress_preview) && this.progressbar.update({
                gained: e.progress_preview.gained,
                current: e.progress_preview.current,
                max: e.progress_preview.max,
                upgradeLevel: e.progress_preview.upgradeLevel
            }),
            isset(e.upgradable) && (this.enchant.reset(),
            this.progressbar.update({
                current: e.upgradable.current,
                max: e.upgradable.max,
                upgradeLevel: e.upgradable.upgradeLevel
            }),
            this.upgrade.update({
                data: e.upgradable,
                disable: !1
            }),
            this.enchant.setReagentsDisableState(!0),
            this.enchant.setEnchantDisableState(!0),
            this.setTopInfo(!0)),
            isset(e.completed) && this.onCompleted()
        }
    }, {
        key: "setTopInfo",
        value: function() {
            var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
            e ? this.topInfoEl.classList.add("is-bonus") : this.topInfoEl.classList.remove("is-bonus")
        }
    }, {
        key: "onCompleted",
        value: function() {
            this.enchant.update({
                disable: !0
            }),
            this.upgrade.update({
                disable: !0
            }),
            this.progressbar.completed(),
            this.removeEnhancementReceiveItem(),
            this.upgradeLvlReset()
        }
    }, {
        key: "dimStartDefault",
        value: function() {
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("enhance-ingr"),
            this.getEngine().disableItemsManager.startSpecificItemKindDisable("enhance")
        }
    }, {
        key: "dimStartIngredients",
        value: function() {
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("enhance"),
            this.getEngine().disableItemsManager.startSpecificItemKindDisable("enhance-ingr")
        }
    }, {
        key: "removeEnhancementItem",
        value: function() {
            this.enhanceItemSlotCurrent.innerHTML = ""
        }
    }, {
        key: "removeEnhancementReceiveItem",
        value: function() {
            this.enhanceItemSlotReceive.innerHTML = ""
        }
    }, {
        key: "upgradeLvlReset",
        value: function() {
            this.setUpgradeLvl(!0),
            this.setUpgradeLvl(!1)
        }
    }, {
        key: "clearAll",
        value: function() {
            this.selectedEnhanceItem = null,
            this.progressbar.reset(),
            this.upgrade.reset(),
            this.enchant.reset(),
            this.setTopInfo(),
            this.removeEnhancementItem(),
            this.removeEnhancementReceiveItem(),
            this.getEngine().itemsMovedManager.removeItemsByTarget("enhance"),
            this.getEngine().itemsMovedManager.removeItemsByTarget("enhance-ingr"),
            this.upgradeLvlReset(),
            this.dimStartDefault()
        }
    }, {
        key: "close",
        value: function() {
            this.clearAll(),
            this.upgrade.destroy(),
            this.enchant.destroy(),
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("enhance"),
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("enhance-ingr"),
            this.getEngine().crafting.enhancement = !1
        }
    }, {
        key: "tLang",
        value: function(e) {
            var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "enhancement";
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(e, null, n) : ""
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _classCallCheck(t, e) {
    if (!(t instanceof e))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(t, e) {
    for (var i = 0; i < e.length; i++) {
        var n = e[i];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(t, n.key, n)
    }
}
function _createClass(t, e, i) {
    return e && _defineProperties(t.prototype, e),
    i && _defineProperties(t, i),
    Object.defineProperty(t, "prototype", {
        writable: !1
    }),
    t
}
var Finalize = function() {
    "use strict";
    function t(e) {
        _classCallCheck(this, t),
        this.el = e,
        this.radioList = {
            radios: [{
                id: 1,
                name: "extraction-payment",
                value: "z",
                label: "",
                selected: !1
            }, {
                id: 2,
                name: "extraction-payment",
                value: "s",
                label: "",
                selected: !1
            }],
            onSelected: this.onSelected.bind(this)
        },
        this.CURRENCY = {
            GOLD: "gold",
            CREDITS: "credits"
        },
        this.disable = !0,
        this.payments = null,
        this.selected = null,
        this.paymentEl = this.el.querySelector(".extraction__payment"),
        this.buttonsContainerEl = this.el.querySelector(".extraction__submit"),
        this.setDisableState(!0),
        this.createConfirmButton()
    }
    return _createClass(t, [{
        key: "createChoosePayment",
        value: function() {
            if (this.payments) {
                var t = this.payments
                  , e = t.gold
                  , i = t.credits;
                this.clearPayment(),
                this.radioList.radios[0].label = this.createPaymentOption(this.CURRENCY.GOLD, e.toString()),
                this.radioList.radios[1].label = this.createPaymentOption(this.CURRENCY.CREDITS, i.toString());
                var n = new RadioList(this.radioList,{
                    isInline: !0
                }).getList();
                this.paymentEl.appendChild(n)
            }
        }
    }, {
        key: "createPaymentOption",
        value: function(t, e) {
            var i = this.getExtractionPaymentOptionTpl();
            return i.classList.add("extraction__currency--".concat(t)),
            i.querySelector(".amount").innerHTML = round(e, 2),
            i
        }
    }, {
        key: "getExtractionPaymentOptionTpl",
        value: function() {
            return $("\n        <div class='extraction__currency'>\n            <div class='icon'></div>\n            <div class='amount'></div>\n        </div>\n    ")[0]
        }
    }, {
        key: "onSelected",
        value: function(t) {
            this.selected = t.target.value,
            this.setStateConfirmButton()
        }
    }, {
        key: "setStateConfirmButton",
        value: function() {
            null !== this.selected && this.checkRequires() ? this.enableConfirmButton() : this.disableConfirmButton()
        }
    }, {
        key: "enableConfirmButton",
        value: function() {
            this.submitBtnEl.classList.remove("disable")
        }
    }, {
        key: "disableConfirmButton",
        value: function() {
            this.submitBtnEl.classList.add("disable")
        }
    }, {
        key: "checkRequires",
        value: function() {
            if (!this.payments)
                return !1;
            var t = this.payments
              , e = t.gold
              , i = t.credits;
            return e <= hero.gold && "z" === this.selected || i <= hero.credits && "s" === this.selected
        }
    }, {
        key: "createConfirmButton",
        value: function() {
            var t = {
                txt: this.tLang("submit_btn"),
                classes: "disable",
                onClick: this.confirmOnClick.bind(this)
            };
            this.submitBtnEl = createButton(t.txt, t.classes, t.onClick),
            this.buttonsContainerEl.appendChild(this.submitBtnEl)
        }
    }, {
        key: "confirmOnClick",
        value: function() {
            var t, e, i = this, n = "z" === this.selected ? {
                "%val%": formNumberToNumbersGroup(null === (t = this.payments) || void 0 === t ? void 0 : t.gold),
                "%val2%": _t("cost_gold")
            } : {
                "%val%": formNumberToNumbersGroup(null === (e = this.payments) || void 0 === e ? void 0 : e.credits),
                "%val2%": _t("cost_credits")
            }, s = this.tLang("extract_cost %val%", "extraction", n), a = this.tLang("confirm-prompt");
            mAlert(s + a, 1, [function() {
                return i.sendExtractRequest()
            }
            , function() {}
            ])
        }
    }, {
        key: "sendExtractRequest",
        value: function() {
            var t = this
              , e = this.getExtraction().selectedExtractItem;
            _g("extractor&action=extract&currency=".concat(this.selected, "&item=").concat(e), (function(e) {
                isset(e.message) || setTimeout((function() {
                    return t.getExtraction().clearAll()
                }
                ), 100)
            }
            ))
        }
    }, {
        key: "update",
        value: function(t) {
            this.payments = t,
            this.createChoosePayment(),
            this.setDisableState(!1)
        }
    }, {
        key: "setDisableState",
        value: function(t) {
            this.disable = t,
            this.disable ? this.el.classList.add("disabled") : this.el.classList.remove("disabled")
        }
    }, {
        key: "clearPayment",
        value: function() {
            this.paymentEl.innerHTML = ""
        }
    }, {
        key: "reset",
        value: function() {
            this.selected = null,
            this.payments = null,
            this.disableConfirmButton(),
            this.clearPayment(),
            this.setDisableState(!0)
        }
    }, {
        key: "destroy",
        value: function() {}
    }, {
        key: "tLang",
        value: function(t) {
            var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "extraction"
              , i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(t, i, e) : ""
        }
    }, {
        key: "getExtraction",
        value: function() {
            return this.getEngine().crafting.extraction
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    t
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var i = 0; i < t.length; i++) {
        var n = t[i];
        n.enumerable = n.enumerable || !1,
        n.configurable = !0,
        "value"in n && (n.writable = !0),
        Object.defineProperty(e, n.key, n)
    }
}
function _createClass(e, t, i) {
    return t && _defineProperties(e.prototype, t),
    i && _defineProperties(e, i),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Extraction = function() {
    "use strict";
    function e(t) {
        _classCallCheck(this, e),
        this.wndEl = t,
        this.receivedCounter = 0,
        this.receivedTpls = {},
        this.selectedExtractItem = null,
        this.requestBlock = !1,
        this.createContent(),
        this.droppableInit(),
        this.getEngine().tplsManager.fetch("j", this.newReceivedItem.bind(this)),
        this.getEngine().disableItemsManager.startSpecificItemKindDisable("extraction")
    }
    return _createClass(e, [{
        key: "getEnhancementTpl",
        value: function() {
            return $("\n        <div class='extraction'>\n            <div class='extraction__content'>\n                <div class='scroll-wrapper classic-bar'>\n                    <div class='crafting__bg'></div>\n                    <div class='scroll-pane'>\n                        <div class='extraction__content-inner'>\n                            <div class='extraction__info'>".concat(_t("info", null, "extraction"), "</div>\n                            <div class='extraction__item items-grid'></div>\n                            <div class='extraction__receives'>\n                            <div class='extraction__label'>").concat(_t("result", null, "extraction"), "</div>\n                            </div>\n                            <div class='extraction__finalize'>\n                                <div class='extraction__info'>").concat(_t("info2", null, "extraction"), "</div>\n                                <div class='extraction__payment'></div>\n                                <div class='extraction__submit'></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    "))[0]
        }
    }, {
        key: "createContent",
        value: function() {
            var e = this.getEnhancementTpl();
            this.contentEl = this.wndEl.querySelector(".extraction-content"),
            this.contentEl.innerHTML = "",
            this.contentEl.appendChild(e),
            this.extractItemSlot = this.contentEl.querySelector(".extraction__item"),
            this.extractItemSlotReceive = this.contentEl.querySelector(".extraction__receives");
            var t = this.contentEl.querySelector(".extraction__finalize");
            this.finalize = new Finalize(t)
        }
    }, {
        key: "droppableInit",
        value: function() {
            var e = this;
            $(this.extractItemSlot).droppable({
                accept: ".inventory-item",
                drop: function(t, i) {
                    i.draggable.css("opacity", ""),
                    e.onClickInventoryItem(i.draggable.data("item"))
                }
            })
        }
    }, {
        key: "newReceivedItem",
        value: function(e) {
            var t = isset(e.$) ? e.$[0] : createItem(e)[0];
            this.setReceivedItemSlot(t, this.receivedCounter),
            isset(e.tpl) || this.updateAmount(e, t),
            this.extractItemSlotReceive.appendChild(t),
            this.receivedCounter++
        }
    }, {
        key: "updateAmount",
        value: function(e, t) {
            var i = this.receivedTpls[e.id];
            i > 0 && this.getEngine().tplsManager.changeItemAmount(e, $(t), i)
        }
    }, {
        key: "setReceivedItemSlot",
        value: function(e, t) {
            var i = Math.floor(t / 8)
              , n = t - 8 * i;
            e.style.left = 32 * n + n + 1 + "px",
            e.style.top = 32 * i + i + 1 + "px"
        }
    }, {
        key: "sendPreviewRequest",
        value: function() {
            this.selectedExtractItem && (this.requestBlock = !0,
            _g("extractor&action=preview&item=".concat(this.selectedExtractItem), this.afterPreviewRequest.bind(this)))
        }
    }, {
        key: "afterPreviewRequest",
        value: function(e) {
            var t = e.extractor;
            this.requestBlock = !1,
            isset(t) && isset(t.preview) ? this.addItemToExtract() : this.selectedExtractItem = null
        }
    }, {
        key: "addItemToExtract",
        value: function() {
            var e = this
              , t = this.getEngine().item[this.selectedExtractItem]
              , i = $("#item" + t.id).clone(!1)[0];
            i.style.top = null,
            i.style.left = null,
            i.addEventListener("click", (function() {
                e.onClickInventoryItem(t)
            }
            )),
            this.getEngine().itemsMovedManager.addItem(t, "extraction", (function() {
                e.onClickInventoryItem(t)
            }
            )),
            this.extractItemSlot.innerHTML = "",
            this.extractItemSlot.appendChild(i),
            this.extractItemAfterUpdate(t.id)
        }
    }, {
        key: "extractItemAfterUpdate",
        value: function(e) {}
    }, {
        key: "onClickInventoryItem",
        value: function(e) {
            if (!this.requestBlock) {
                var t = parseInt(e.id);
                if (!this.selectedExtractItem)
                    return this.selectedExtractItem = t,
                    void this.sendPreviewRequest();
                this.selectedExtractItem !== t ? e.st : this.clearAll()
            }
        }
    }, {
        key: "update",
        value: function(e) {
            if (this.requestBlock = !1,
            isset(e.preview)) {
                var t = e.preview
                  , i = t.ingredientItemTplId
                  , n = t.ingredientItemAmount
                  , a = t.progressItemTplId
                  , r = t.progressItemAmount
                  , s = t.prices;
                i && (this.receivedTpls[i] = n),
                this.receivedTpls[a] = r,
                this.finalize.update(s)
            }
        }
    }, {
        key: "dimRestart",
        value: function() {
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("extraction"),
            this.getEngine().disableItemsManager.startSpecificItemKindDisable("extraction")
        }
    }, {
        key: "removeExtractItem",
        value: function() {
            this.extractItemSlot.innerHTML = ""
        }
    }, {
        key: "removeExtractReceiveItems",
        value: function() {
            this.extractItemSlotReceive.innerHTML = ""
        }
    }, {
        key: "clearAll",
        value: function() {
            this.selectedExtractItem = null,
            this.finalize.reset(),
            this.getEngine().tplsManager.deleteMessItemsByLoc("j"),
            this.removeExtractItem(),
            this.removeExtractReceiveItems(),
            this.getEngine().itemsMovedManager.removeItemsByTarget("extraction"),
            this.dimRestart(),
            this.receivedCounter = 0
        }
    }, {
        key: "close",
        value: function() {
            this.clearAll(),
            this.finalize.destroy(),
            this.getEngine().disableItemsManager.endSpecificItemKindDisable("extraction"),
            this.getEngine().crafting.extraction = !1
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "extraction";
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(e, null, t) : ""
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }]),
    e
}();
function _classCallCheck(e, t) {
    if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function")
}
function _defineProperties(e, t) {
    for (var n = 0; n < t.length; n++) {
        var i = t[n];
        i.enumerable = i.enumerable || !1,
        i.configurable = !0,
        "value"in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i)
    }
}
function _createClass(e, t, n) {
    return t && _defineProperties(e.prototype, t),
    n && _defineProperties(e, n),
    Object.defineProperty(e, "prototype", {
        writable: !1
    }),
    e
}
var Crafting = function() {
    "use strict";
    function e() {
        _classCallCheck(this, e),
        this.wnd = {},
        this.opened = !1,
        this.content = "",
        this.cards = {
            enhancement: {
                name: this.tLang("enhancement", "enhancement")
            },
            salvage: {
                name: this.tLang("salvage", "salvager")
            },
            extraction: {
                name: this.tLang("extraction", "extraction")
            },
            recipes: {
                name: this.tLang("recipe"),
                initAction: function() {
                    _g("craft&a=list")
                }
            }
        }
    }
    return _createClass(e, [{
        key: "init",
        value: function() {
            this.initWindow(),
            this.createCards()
        }
    }, {
        key: "setTitle",
        value: function() {
            var e = goldTxt(_t("crafting", null, "recipes"), !0);
            this.wndEl.querySelector(".crafting__title").innerHTML = e
        }
    }, {
        key: "open",
        value: function(e, t) {
            "default" === e && (e = "enhancement"),
            this.closeOthers(e);
            var n = this.getEngine();
            switch (e) {
            case "recipes":
                n.crafting.recipes || (n.crafting.recipes = new Recipes(this.wndEl),
                n.crafting.recipes.init()),
                n.crafting.recipes.update(t);
                break;
            case "salvage":
                n.crafting.salvage || (n.crafting.salvage = new Salvage(this.wndEl));
                break;
            case "enhancement":
                n.crafting.enhancement || (n.crafting.enhancement = new Enhancement(this.wndEl));
                break;
            case "extraction":
                n.crafting.extraction || (n.crafting.extraction = new Extraction(this.wndEl))
            }
            this.activateCard(e),
            this.currentTab = e,
            this.closeOtherWindows(),
            this.windowOpen()
        }
    }, {
        key: "closeAll",
        value: function() {
            this.getEngine().crafting.recipes && this.getEngine().crafting.recipes.close(),
            this.getEngine().crafting.salvage && this.getEngine().crafting.salvage.close(),
            this.getEngine().crafting.enhancement && this.getEngine().crafting.enhancement.close(),
            this.getEngine().crafting.extraction && this.getEngine().crafting.extraction.close()
        }
    }, {
        key: "closeOthers",
        value: function(e) {
            this.getEngine().crafting.recipes && "recipes" !== e && this.getEngine().crafting.recipes.close(),
            this.getEngine().crafting.salvage && "salvage" !== e && this.getEngine().crafting.salvage.close(),
            this.getEngine().crafting.enhancement && "enhancement" !== e && this.getEngine().crafting.enhancement.close(),
            this.getEngine().crafting.extraction && "extraction" !== e && this.getEngine().crafting.extraction.close()
        }
    }, {
        key: "createCards",
        value: function() {
            for (var e in this.cards)
                this.createOneCard(e, this.cards[e])
        }
    }, {
        key: "createOneCard",
        value: function(e, t) {
            var n = this
              , i = drawSIButton(t.name)[0]
              , a = this.wndEl.querySelector(".crafting__contents")
              , c = this.wndEl.querySelector(".crafting__tabs");
            i.classList.add("".concat(e, "-tab")),
            isset(t.disabled) && t.disabled && (i.classList.add("disabled"),
            $(i).tip(this.tLang("coming_soon", "default"))),
            c.appendChild(i);
            var s = document.createElement("div");
            s.classList.add("".concat(e, "-content")),
            a.appendChild(s),
            i.addEventListener("click", (function() {
                isset(t.disabled) && t.disabled || (t.initAction ? t.initAction() : n.open(e))
            }
            ))
        }
    }, {
        key: "activateCard",
        value: function(e) {
            var t = this.wndEl.querySelector(".crafting__tabs .".concat(e, "-tab"))
              , n = this.wndEl.querySelector(".crafting__contents .".concat(e, "-content"));
            t.classList.add("active"),
            n.classList.add("active");
            var i = siblings(t)
              , a = siblings(n);
            i.forEach((function(e) {
                return e.classList.remove("active")
            }
            )),
            a.forEach((function(e) {
                return e.classList.remove("active")
            }
            ))
        }
    }, {
        key: "manageVisible",
        value: function() {
            this.opened ? this.windowClose() : (this.closeOtherWindows(),
            this.windowOpen())
        }
    }, {
        key: "windowOpen",
        value: function() {
            this.wndEl.style.display = "block",
            this.opened = !0,
            g.lock.add("crafting")
        }
    }, {
        key: "windowClose",
        value: function() {
            this.wndEl.style.display = "none",
            this.opened = !1,
            g.lock.remove("crafting")
        }
    }, {
        key: "initWindow",
        value: function() {
            this.wndEl = $("#crafting")[0],
            this.wndEl.querySelector(".close-but").addEventListener("click", this.triggerClose.bind(this)),
            this.setTitle()
        }
    }, {
        key: "getEngine",
        value: function() {
            return g
        }
    }, {
        key: "tLang",
        value: function(e) {
            var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "recipes";
            return "undefined" == typeof RUNNING_UNIT_TEST ? _t(e, null, t) : ""
        }
    }, {
        key: "closeOtherWindows",
        value: function() {
            this.getEngine().depo.vis && depoHide()
        }
    }, {
        key: "close",
        value: function() {
            this.closeAll(),
            this.windowClose(),
            delete this.getEngine().crafting.recipes
        }
    }, {
        key: "triggerOpen",
        value: function() {
            _g("artisanship&action=open")
        }
    }, {
        key: "triggerClose",
        value: function() {
            this.close()
        }
    }]),
    e
}();
function ownKeys(t, e) {
    var a = Object.keys(t);
    if (Object.getOwnPropertySymbols) {
        var i = Object.getOwnPropertySymbols(t);
        e && (i = i.filter((function(e) {
            return Object.getOwnPropertyDescriptor(t, e).enumerable
        }
        ))),
        a.push.apply(a, i)
    }
    return a
}
function _objectSpread(t) {
    for (var e = 1; e < arguments.length; e++) {
        var a = null != arguments[e] ? arguments[e] : {};
        e % 2 ? ownKeys(Object(a), !0).forEach((function(e) {
            _defineProperty(t, e, a[e])
        }
        )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(a)) : ownKeys(Object(a)).forEach((function(e) {
            Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(a, e))
        }
        ))
    }
    return t
}
function _defineProperty(t, e, a) {
    return e in t ? Object.defineProperty(t, e, {
        value: a,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : t[e] = a,
    t
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
var newChatMode = !1, belugaComMode = !1, map, hero, road = [], newCommunicationMode = !0;
function manageHeroIdle(t) {
    t ? (g.heroIdle = !1,
    g.idleRequestCounter = 0) : (g.idleRequestCounter++,
    g.idleRequestCounter > 1 && (g.heroIdle = !0))
}
function saveLastCords(t) {
    g.mouseMove.lastCoords = {
        clientX: t.clientX,
        clientY: t.clientY
    }
}
function setDefaultInterfaceCookie() {
    var t = new Date;
    t.setTime(t.getTime() + 2592e6),
    setCookie("interface", "si", t, "/", "margonem.pl")
}
function lookForInLoadQueue(t) {
    for (var e in g.loadQueue) {
        var a = g.loadQueue[e];
        if (a.fun.name == t)
            return a.data
    }
    return null
}
function getRenewableNpc() {
    var t = [];
    for (var e in g.npc)
        7 == g.npc[e].type && g.npc[e].x == hero.x && g.npc[e].y == hero.y && t.push(g.npc[e]);
    return t.length ? t : null
}
function getGroundItem() {
    var t = [];
    for (var e in g.item)
        "m" == g.item[e].loc && g.item[e].x == hero.x && g.item[e].y == hero.y && t.push(g.item[e]);
    return t.length ? t : null
}
function getDirFromMousePosition(t) {
    if (t.clientX > $("#base").offset().left && t.clientX < $("#base").offset().left + $("#base").width() && t.clientY > $("#base").offset().top && t.clientY < $("#base").offset().top + $("#base").height()) {
        var e = Math.atan2($("#hero").offset().top + hero.fh / 2 - t.clientY, $("#hero").offset().left + hero.fw / 2 - t.clientX)
          , a = "";
        return e > 2.25 || e <= -2.25 ? a = isCollision(hero.x + 1, hero.y) ? e >= 0 ? "N" : "S" : "E" : e > .75 && e <= 2.25 ? a = isCollision(hero.x, hero.y - 1) ? e >= 1.5 ? "E" : "W" : "N" : e > -.75 && e <= .75 ? a = isCollision(hero.x - 1, hero.y) ? e >= 0 ? "N" : "S" : "W" : e > -2.25 && e <= -.75 && (a = isCollision(hero.x, hero.y + 1) ? e >= -1.5 ? "W" : "E" : "S"),
        a
    }
}
function isPermanentlyCollision(t, e) {
    return "1" == map.col.charAt(t + e * map.x)
}
function isCollision(t, e) {
    return "1" == map.col.charAt(t + e * map.x) || isset(g.npccol[t + 256 * e])
}
function reCenter() {
    g.maxx = $(window).width(),
    g.maxy = $(window).height(),
    g.top = g.maxy - 537 >> 1;
    var t = g.tutor;
    3 == g.chat.state && (t = 276),
    g.left = g.maxx - 786 + t >> 1,
    $("#centerbox, #centerbox2").css({
        top: g.top,
        left: g.left
    }),
    3 == g.chat.state && $("#chat").css({
        top: g.top,
        left: g.left - 276
    }),
    isset(Highlighter) && Highlighter.onresize(),
    __tutorials.onresize(),
    $("#en_wnd").absCenter()
}
function toggleConsole() {
    "none" == $("#console").css("display") ? ($("#console").fadeIn(300),
    $("#contxt").scrollTop(9999999),
    $("#conin").val("").focus(),
    $("#warn").hide(),
    g.lock.add("console")) : ($("#conin").blur(),
    $("#console").fadeOut(300),
    g.lock.remove("console"))
}
$(document).ready((function() {
    log(navigator.userAgent);
    var t = getCookie("interface");
    (null == t || "si" != t) && setDefaultInterfaceCookie(),
    window.cdnUrl = "https://micc.garmory-cdn.cloud",
    CFG = {
        oimg: "/img",
        opath: cdnUrl + "/obrazki/postacie/",
        npath: cdnUrl + "/obrazki/npc/",
        mpath: cdnUrl + "/obrazki/miasta/",
        ipath: cdnUrl + "/obrazki/itemy/",
        ppath: cdnUrl + "/obrazki/pets",
        epath: cdnUrl + "/obrazki/interface/emo/",
        fpath: cdnUrl + "/obrazki/interface/environmentalEffects/",
        bpath: cdnUrl + "/obrazki/battle/",
        sl_multipler: {
            en: 75,
            pl: 75
        },
        weapons: {
            sw: _t("w_bastard", null, "battle"),
            "1h": _t("w_onehanded", null, "battle"),
            "2h": _t("w_twohanded", null, "battle"),
            bs: _t("w_bastard", null, "battle"),
            dis: _t("w_distance", null, "battle"),
            h: _t("w_helper", null, "battle"),
            "icon-6": _t("w_wand", null, "battle"),
            orb: _t("w_rod", null, "battle"),
            sh: _t("w_shield", null, "battle"),
            fire: _t("w_fire", null, "battle"),
            light: _t("w_light", null, "battle"),
            frost: _t("w_frost", null, "battle"),
            poison: _t("w_poison", null, "battle"),
            phydis: _t("w_phydis", null, "battle"),
            wound: _t("w_wound", null, "battle")
        }
    };
    var e = new RequestCorrect;
    e.init(),
    g = {
        requestCorrect: e,
        tutorialVal: null,
        blockSendNextInit: null,
        gm: 0,
        battle: 0,
        dead: 0,
        party: 0,
        fredit: 0,
        clan: 0,
        mails: 0,
        ctrlKey: 0,
        skills: new skills,
        delays: {
            before: new Date,
            now: new Date,
            limit: newCommunicationMode ? 200 : 500,
            run: null
        },
        diff: {
            before: new Date,
            t: 50,
            s: 0,
            c: 0
        },
        tickSuccess: !0,
        menu: !1,
        menushowing: !1,
        stop: !0,
        requestAnimationFrameUpdateFinished: !1,
        heroIdle: !0,
        idleRequestCounter: 0,
        tmpParams: [],
        engineStopped: !1,
        initAjaxState: !0,
        gtDelay: 50,
        tutor: 0,
        pvpIndicator: null,
        gamestarted: !1,
        qlogVisible: !1,
        emoIntervals: {},
        highlightedItems: [],
        chestAnimation: !1,
        chestAnimationType: "colorized",
        ah: {
            cat: 0,
            filter: ["", "", "", 0, "", "", ""],
            page: 0,
            even: !1,
            synchroItems: {}
        },
        sl_multiplier: {
            pl: 75,
            en: 75
        },
        lastAf: 0,
        itemChanger: !1,
        barter: !1,
        itemChangerGroup: !1,
        depo: {
            gold: 0,
            expire: 0,
            clan: !1,
            vis: !1,
            section: 1,
            drag: !1,
            size: 1,
            hoverSection: null,
            sectionActivateTimeout: null,
            tmpDropMatrix: {},
            switchScroll: 0
        },
        dialog: {
            soundId: 0
        },
        battlesets: new BattleSets,
        matchmaking: new MatchManager,
        book: !1,
        addons: [],
        mExtAddons: [],
        loots: !1,
        names: {
            ranks: [_t("admin", null, "ranks"), _t("super_mg", null, "ranks"), _t("mg", null, "ranks"), _t("chat_mod", null, "ranks"), _t("super_chat_mod", null, "ranks")]
        },
        thefifthelement: '<img src="' + cdnUrl + '/obrazki/www/buka.jpg" style="margin-left:3px">',
        checklist: [],
        zero: 0,
        lock: {
            list: [],
            add: function(t) {
                this.list.indexOf(t) < 0 && this.list.push(t),
                hero.resetSteps(),
                hero.setHeroInLastServerPos()
            },
            remove: function(t) {
                this.list.indexOf(t) >= 0 && this.list.splice(this.list.indexOf(t), 1)
            },
            check: function(t) {
                return isset(t) ? this.list.indexOf(t) >= 0 : this.list.length > 0
            }
        },
        logoff: {
            start: null,
            time: null
        }
    };
    var a = getCookie("addons");
    a && (g.addons = a.split(" "));
    var i = extMgrCookieGet();
    if (null !== i)
        for (var n in i) {
            var o = parseInt(n)
              , s = "public";
            switch (i[n]) {
            case "d":
                s = "dev";
                break;
            case "v":
                s = "verified"
            }
            var l = "https://addons2.margonem.pl/get/" + Math.floor(o / 1e3) + "/" + o + s + ".js";
            g.mExtAddons.push(l)
        }
    var r = getCookie("ytm");
    r && (showMovie(decodeURIComponent(r), !0),
    $("#bm_movie").fadeIn()),
    g.worldConfig = new WorldConfig,
    g.crossStorage = new CrossStorage,
    g.crossStorage.init(),
    g.bmEditor = new bmEditor,
    g.playerCatcher = new PlayerCatcher,
    g.gameLoader = new GameLoader,
    g.crafting = new Crafting,
    g.crafting.init(),
    g.addonswait = [],
    g.mpath = CFG.mpath,
    g.opath = cdnUrl + "/obrazki/",
    g.townname = [],
    g.gw = {},
    g.gwIds = {},
    g.npc = [],
    g.lastClickedTarget = null,
    g.objectCallbacks = {
        imageLoad: {
            npc: {},
            other: {},
            hero: {}
        },
        load: {
            npc: {},
            other: {},
            hero: {}
        },
        addCallback: function(t, e, a, i) {
            isset(this[e][a]) && (isset(this[e][a][i]) || (this[e][a][i] = []),
            this[e][a][i].splice(0, 0, t))
        },
        runCallbackQueue: function(t, e, a) {
            if (isset(this[e][a][t])) {
                for (; this[e][a][t].length; )
                    this[e][a][t].pop()(t);
                delete this[e][a][t]
            }
        }
    },
    g.reconnect = {
        interval: null,
        timeout: 20,
        start: function() {
            this.interval || (log(_t("server_connection_fail", null, "reload"), 1),
            log(_t("auto_reload in", null, "reload") + '<span id="reconnectInfo">20s</span>'),
            this.interval || "block" == $("#loading").css("display") && $("#console").fadeIn(),
            this.interval = setInterval((function() {
                g.reconnect.timeout <= 0 ? window.location.reload() : (_g("_"),
                g.reconnect.timeout--,
                $("#reconnectInfo").html(g.reconnect.timeout + "s"))
            }
            ), 1e3))
        },
        stop: function() {
            this.interval && ($("#reconnectInfo").html(_t("canceled", null, "reload")).attr("id", ""),
            clearInterval(this.interval),
            this.interval = null,
            this.timeout = 20,
            $("#console").fadeOut())
        }
    },
    g.npccol = [],
    g.other = [],
    g.tplsManager = null,
    g.item = [],
    g.eqItems = {},
    g.hItems = {},
    g.bag = 0,
    g.bagupd = 0,
    g.sound = {},
    g.bags = [[42, 0], [0, 0], [0, 0], !1, !1, !1, [0, 0]],
    g.bagsPlaces = {
        doubleItemsWarning: !1,
        items: {},
        highlights: {},
        check: function(t) {
            return isset(this.items[t]) && this.items[t] > 0 ? this.items[t] : 0
        },
        add: function(t) {
            isset(this.items[t]) ? this.items[t]++ : this.items[t] = 1,
            this.check(t) > 1 && this.addHighlight(t)
        },
        remove: function(t) {
            isset(this.items[t]) && (this.items[t]--,
            this.check(t) <= 1 && this.removeHighlight(t))
        },
        addHighlight: function(t) {
            isset(this.highlights[t]) || (this.highlights[t] = $(document.createElement("div")).addClass("highlight").css({
                top: 33 * Math.floor(t / 7) + "px",
                left: t % 7 * 33 + "px"
            }).prependTo("#bag"))
        },
        removeHighlight: function(t) {
            isset(this.highlights[t]) && (this.highlights[t].remove(),
            delete this.highlights[t])
        },
        showWarning: function() {
            mAlert(_t("doubled_items"))
        },
        onItemsUpdated: function() {
            g.bagsPlaces.check(0) > 1 ? this.doubleItemsWarning || (this.showWarning(),
            this.doubleItemsWarning = !0) : this.doubleItemsWarning = !1
        }
    },
    g.freeSlots = 0;
    var c = $("#bagc").offset();
    if (g.drops = {
        bx: c.left,
        by: c.top,
        bx2: c.left + $("#bagc").width(),
        by2: c.top + $("#bagc").height(),
        ex: 530,
        ey: 111,
        ex2: 637,
        ey2: 251,
        gx: 537,
        gy: 470,
        gx2: 768,
        gy2: 503,
        dpx: 27,
        dpy: 237,
        dpx2: 489,
        dpy2: 501
    },
    g.init = 1,
    g.sync = 0,
    g.ats = 0,
    g.lag = 0,
    g.lastKey = [0, 0],
    g.mouseMove = {
        active: !1,
        lastCoords: null,
        enabled: !0,
        runInterval: 0,
        dragged: !1
    },
    g.keys = {
        chat: 99,
        console: 96,
        battleclose: 90,
        minimap: 109,
        lookplayer: 9,
        arrows: {},
        wsad: {}
    },
    g.talk = {
        id: 0,
        nick: "",
        dialogCloud: null,
        scrollCheckInterval: null
    },
    g.tip = {
        id: "",
        on: !0
    },
    g.tips = {},
    g.shop = {
        id: 0
    },
    g.superMarketItems = {},
    g.trade = {
        id: 0
    },
    g.tradeLocked = [],
    g.tmpTradeAcceptStatus = [0, 0],
    g.loadQueue = [],
    g.chat = {
        init: 0,
        tab: 0,
        write: 0,
        txt: ["", "", "", ""],
        tabs: [[], [], [], []],
        lastMsg: null,
        lastnick: "",
        ts: 0,
        lastwrite: "",
        lastmyts: 0,
        state: getCookie("cy") ? getCookie("cy") : 0,
        parsers: []
    },
    g.aid = getCookie("user_id"),
    g.lastEv = null,
    g.ev = "",
    g.browser_token = 0,
    g.msg = [],
    g.away = {
        ts: unix_time(!0),
        update: function() {
            g.away.ts = unix_time(!0)
        },
        logOut: function() {
            unix_time(!0) - g.away.ts > 900 && ($("#dazed").html(_t("no_activiti_logout_info")).fadeIn(),
            stopEngine(),
            log("Too long away: engine stopped.", 1))
        }
    },
    null != g.tutor && $(window).width() > 999)
        if (g.tutors = [],
        "pl" != _l()) {
            var d = ["06", "12", "13", "16", "17", "18", "24", "28", "32", "34"];
            for (n = 0; n < d.length; n++)
                g.tutors.push("img/bnr/en/help" + d[n] + ".png")
        } else {
            d = [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 18, 19, 20, 21, 22, 23, 24, 33, 36, 37, 38, 39, 40, 41, 42, 43, 44, 47, 49, 50];
            for (var n in d)
                g.tutors.push("img/bnr/help" + d[n].toString() + ".png")
        }
    else
        g.tutor = 0;
    (map = new ground,
    hero = new player,
    getStatusOfLocalOpt(),
    $(window).resize(reCenter),
    reCenter(),
    $("#imgload").absCenter(),
    $(document).keypress((function(t) {
        if (g.away.update(),
        isset(g.logkey) && log("press: " + t.which + " / " + t.keyCode + (g.ctrlKey ? " ctrl" : "") + (t.altKey ? " alt" : "") + (t.shiftKey ? " shift" : "")),
        102 == t.which && g.ctrlKey)
            g.ctrlKey = !1;
        else if (!(t.shiftKey || g.ctrlKey || t.altKey))
            if (27 == t.keyCode && g.loots)
                cancelLoots();
            else {
                if ((120 == t.which || 88 == t.which) && map.pvp > 0 && unix_time(!0) - g.lastAf >= 1 && "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName) {
                    var e = [];
                    if (g.party)
                        for (var a in g.party)
                            e.push(a);
                    for (var i in g.other)
                        if (Math.abs(hero.rx - g.other[i].x) <= 1 && Math.abs(hero.ry - g.other[i].y) <= 1) {
                            if (e.indexOf(i) > -1)
                                continue;
                            _g("fight&a=attack&auto=1&id=" + i),
                            g.lastAf = unix_time(!0);
                            break
                        }
                }
                if (32 == t.which && "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName && ("en" == _l() ? "block" == $("#minimap").css("display") && map.showMini(isset(map.tab) && 1 == map.tab ? 2 : 1) : g.menu ? hideMenu() : $("#hero").click()),
                13 == t.which)
                    if ("conin" == t.target.id)
                        consoleParse($("#conin").val()),
                        $("#conin").val("");
                    else if ("inpchat" == t.target.id)
                        chatSendMsg($("#inpchat").val());
                    else if ("mytr_gold" == t.target.id)
                        trade_gold();
                    else {
                        if ("TEXTAREA" == t.target.tagName)
                            return;
                        if ("BUTTON" == t.target.tagName)
                            return void ("a_ok" == t.target.id && $("#a_ok").blur());
                        if ("INPUT" == t.target.tagName)
                            return;
                        if (g.loots && checkLotsItemsExit() && "block" == $("#loots").css("display"))
                            return void sendLoots(1, !1);
                        startChatWrite()
                    }
                else
                    "inpchat" == t.target.id && 27 == t.keyCode && ($("#inpchat").val("").blur(),
                    g.chat.write = !1);
                if ("TEXTAREA" != t.target.tagName && "INPUT" != t.target.tagName && 109 == t.which && map.toggle(),
                t.which == g.keys.console && ("INPUT" != t.target.tagName || "conin" == t.target.id))
                    return toggleConsole(),
                    !1;
                "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName && (t.which > 96 && t.which < 128 && isset(g.keys.wsad[t.which - 32]) && (hero.go(g.keys.wsad[t.which - 32]),
                t.preventDefault()),
                113 != t.which && 81 != t.which || "en" != _l() || (g.qlogVisible ? $("#dlgwin .closebut").click() : _g("quests")))
            }
    }
    )),
    $(document).keydown((function(t) {
        _mPos.event(t),
        t.ctrlKey || (g.ctrlKey = !1),
        g.lastClickedTarget = null,
        g.away.update(),
        9 == t.which && 0 != g.battle && "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName && (selectNextEnemy(t.shiftKey),
        t.preventDefault()),
        t.which == g.keys.battleclose && "block" == $("#battle").css("display") && "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName && canLeave(),
        isset(g.logkey) && log("dn:" + t.which + " / " + t.keyCode + (g.ctrlKey ? " ctrl" : "") + (t.altKey ? " alt" : "") + (t.shiftKey ? " shift" : ""));
        var e = 0;
        t.altKey && t.which > 48 && t.which < 53 && (pushChatButton({
            n: t.which - 49
        }),
        e = 1),
        g.ctrlKey && 40 == t.which && g.chat.tab < 3 && (pushChatButton({
            n: g.chat.tab + 1
        }),
        e = 1,
        t.preventDefault()),
        g.ctrlKey && 38 == t.which && g.chat.tab > 0 && (pushChatButton({
            n: g.chat.tab - 1
        }),
        e = 1,
        t.preventDefault()),
        27 == t.which && t.preventDefault(),
        e ? t.preventDefault() : "INPUT" != t.target.tagName && "TEXTAREA" != t.target.tagName && (17 == t.which && (g.ctrlKey = !0),
        t.shiftKey || g.ctrlKey || t.altKey || (70 != t.which || g.battle || (hero.autoFightLock = !0),
        70 != t.which || !g.battle || isset(g.battle.f[hero.id].fast) && g.battle.f[hero.id].fast || hero.autoFightLock || ($("#autobattleButton").click(),
        hero.autoFightLock = !0),
        t.which == g.keys.lookplayer && (g.playerCatcher.next(),
        t.preventDefault()),
        (isset(g.keys.arrows[t.keyCode]) || isset(g.keys.wsad[t.which])) && (g.lastKey = [t.keyCode, t.which],
        t.preventDefault())))
    }
    )),
    $(document).keyup((function(t) {
        17 == t.which && (g.ctrlKey = !1),
        t.shiftKey || g.ctrlKey || t.altKey || ("TEXTAREA" != t.target.tagName && "INPUT" != t.target.tagName && 67 == t.which && toggleChat(),
        "TEXTAREA" != t.target.tagName && "INPUT" != t.target.tagName && 66 == t.which && toggleBattleLog(),
        t.keyCode != g.lastKey[0] && t.which != g.lastKey[1] || (g.lastKey = [0, 0]),
        70 == t.which && (hero.autoFightLock = !1))
    }
    )),
    $(document).mousedown((function(t) {
        if ($(t.target).hasClass("quest-log-header"))
            return !1;
        t.ctrlKey || (g.ctrlKey = !1),
        g.mouseMove.lastCoords = {
            clientX: t.clientX,
            clientY: t.clientY
        },
        0 == t.button && (g.mouseMove.active = !0,
        g.mouseMove.lastCoords = {
            clientX: t.clientX,
            clientY: t.clientY
        },
        g.mouseMove.runInterval = 0)
    }
    )),
    $(document).mouseup((function(t) {
        0 == t.button && (g.mouseMove.active = !1,
        g.mouseMove.dir = null),
        g.mouseMove.dragged = !1
    }
    )),
    $(document).mousemove((function(t) {
        g.mouseMove.active && (g.mouseMove.dragged ? saveLastCords(t) : g.mouseMove.dragged = Math.abs(g.mouseMove.lastCoords.clientX - t.clientX) > 10 || Math.abs(g.mouseMove.lastCoords.clientY - t.clientY) > 10),
        _areaRegStorage.checkAreas(t)
    }
    )),
    $(window).blur((function() {
        g.mouseMove.active = !1,
        g.mouseMove.dir = null,
        g.mouseMove.dragged = !1
    }
    )),
    $().ajaxError((function(t, e, a) {
        log("(Ajax) " + a.url, 2),
        g.ats = 0
    }
    )),
    $().ajaxStart((function() {}
    )).ajaxStop((function() {}
    )),
    setupChat(),
    $("#cfg_options .server-opt").click(serveroptclick),
    $("#dlgwin").draggable({
        handle: "#dlgtitle"
    }),
    log("System ready."),
    newCommunicationMode) ? initWebSocket() : (isNaN(parseInt(getCookie("__nga"))) ? 0 : parseInt(getCookie("__nga"))) ? startGame() : $.getJSON("/engine?t=getvar_addon&callback=?", {}, (function(t) {
        "" != t && loadScript(t),
        startGame()
    }
    ));
    if (g.addons.length || g.mExtAddons.length) {
        var p = []
          , h = g.addons.concat(g.mExtAddons);
        for (var u in h)
            p.indexOf(h[u]) >= 0 || (loadScript(h[u]),
            p = h[u]);
        delete p
    }
    $(document).click((function(t) {
        g.lastClickedTarget = t.target,
        isset(g) && g.away.update(),
        $(t.target).attr("tip") && Tip.hide(),
        g.menushowing ? g.menushowing = !1 : hideMenu()
    }
    )),
    setTimeout((function() {
        g.gamestarted || startGame()
    }
    ), 1e4),
    $("#loading span").css("margin-top", $(window).height() / 2 + 165),
    addScrollbar("myfriends", 242, "myfrscrollbar", !1),
    $("#myfrscrollbar").css({
        backgroundColor: "black"
    }),
    addScrollbar("myenemies", 499, "myenscrollbar", !1),
    $("#myenscrollbar").css({
        backgroundColor: "black"
    }),
    $("#inmap2 img").attr("src", cdnUrl + "/obrazki/interface/minimap-si" + ("en" == _l() ? "-en" : "") + ".png"),
    setInterval((function() {
        $(".npc .qm").toggleClass("ani")
    }
    ), 200)
}
)),
$(window).on("load", (function() {}
));
var gameStartAttempts = 0;
function startGame() {
    if (gameStartAttempts++,
    console.log("Addons Wait!", g.addonswait),
    !g.gamestarted)
        if (0 == g.addonswait.join("").length) {
            if (0 != g.addonswait.join("").length) {
                for (var t = 0; t < g.addonswait.length; t++)
                    log("Addon " + g.addonswait[t] + " not loaded", 2);
                g.addonswait = []
            }
            console.log("START!", g.addonswait),
            g.gamestarted = !0,
            log("Starting the game."),
            g.gameLoader.startStep("loc"),
            sendFirstInit(),
            newCommunicationMode || function(t) {
                function e(t, e, a) {
                    for (var i = "", n = 0; n < a; n++)
                        i += t[e + n];
                    return i
                }
                var a = function() {}
                  , i = 'Â\t\0\tÂ<\0\0\0\0ÂO\0ÂÂ·\0Â`\n\0Â\0 \0\0\tÂLÂ\0ÂA\0\tÂ@\nÂJ\0\tÂD!\0\0\08\0*\0\0\0\0\0\0\0\0\0Â0\0Â \0\08\0*\0\0\0"\0\tÂÂ¡\0ÂÂ\0\tÂ*\0\0\f\b\t\v\b*\0\0ÂÂ\0 \0\0Â\0Â\0\0"\t+\t*\0\0\0\0\0\0\0\0\tÂ3\0\0\0\0\0\0\0\0Â\0#\0\0\0$\0\0O*\0\0\0\0\0Â\0\0\0Â\0#\0\0\0$\0\0\0Â\0\0\0\0)\0\0\0\0\0\0Â\0\0Â\0#\0\0\0$\0\0\0\0\0Â\vÂ\0\0\0\0\0\0\0\0)\0\0\0\0\tÂ\0\0\0\0\0\0\0\0\0\0\tÂ1\tÂ \tÂ\'\r\tÂ1Â\v\0Â\0Â!\f\0\tÂÃµ\0\0T*\0\0\0Â#\0\tÂÂ§\0Â%\00KGTVG#GV^Q^GUT]R^]R^G *3*\0\0\0\0\0Â\'\0\tÂÂ\0\0\0\tÂ1Â\0Â \0Â)\0\tÂÃµ\0\0Â*\0\0\tÂ*\tÂ1\0\0\0\0Â+\n\0\tÂ}\0\0Â\0\0Â\0\0\0\nÂ.T*\0\0Â.\r\0\tÂÂ\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\tÂÂ\0#\0\0\0$\0\0\v\t\0*\0\0\0\0\0Â\0\0\0\0\nÂ7\0\0\0Â\0\0\tÂ5\0\0Â\0\0\0\0Â\0Â\0\0\0\0\nÂ:\b\0Â\0\0\tÂ8\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\b*\0\0\0\0\0\0\b*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\b*\0\0\0\0\0\0\b*\0\0\0"\0\0\0\0\0\0\0\0\0\0\0\0\0\v\f*\0\0ÂL\0 \0\0\0Â\0Â\0\0"\t+\t*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0ÂM\v\0\tÂ{\vÂ%\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0ÂQ\b\0\tÂ{\v\v\t\0*\0\0\0\0\0Â\0\v\t\0*\0\0\0\0\0Â\0\0Â\0\0+Â\0Â^\0\0\0+Â\0\0\0\0ÂX\r\0\tÂl\r\0\0\nÂ\\\0\0Â[\b+Â\0Â\0\0+Â\0\fÂ]Â\\\0\tÂÂ·\tÂ^Â\0\0Â\0\0\0\0\tÂU\v\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Â\0ÂcÂc\0Â\0Â\0#\0\0\0$\0\0\v\t\0*\0\0\0\0\0Â\0\0\0\0\nÂh\t\0\0\0Â\0\0\tÂf\n\0\0\b*\0\0\0\0\0Â\0\0Â\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Â\0#\0\0\0$\0\0Â\0#\0\0\0$\0\0\b\r*\0\0\0&\0\0\vÂy\0&\0\0\vÂy\v\t\0*\0\0\0\0\0\0\0\0\vÂy*\0\0\0\0\0\0\0\0\vÂy*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\b*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0#*\0\0\0\0\'\0\0\03\n*\0\0\0\0\0Â\0\0\0\0\0Â\0Â\r\b\0\0Â\b\0\0Â<\b\0\0Â<\b\0\0Â>\b\b\0\0\0Â\0Â\0\03\n*\0\0\0\0\0\0Â\0\0\0\v\b23$4\t\0*\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Â\0#\0\0\0$\0\0\b\\GZH*\0\0\\G\b\n\tZ\n\0\b\t\nI\v*\0\0\0\n\\GZ*\0\0\0\0Â\0#\0\0\0$\0\0\0Z*\0\0\0Â\0#\0\0\0$\0\0\0\b\b\n\t*\0\0\0\0\0\b\b\f*\0\0\0"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Â\f\0#\0\0\0$\0\0Â\0#\0\0\0$\0\0Z*\0\0Â\0Â\0\0\v*\0\0\0\0\0\0Â\0\0\0\0\0Â\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\b\b\n\t*\0\0\0\0\0\b\b\f*\0\0\0\0\0\v*\0\0\0\0\0\\G*\0\0Â\0Â\0\0\0\0\0Â\0\0\v\t\0*\0\0\0\0\0\0\0\rÂÂµ\t\0\0\0\0ÂÂ´\0\tÂÂ\0\0\nÂÂµÂ\0\0\tÂÂ±\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Â\0Â\v\0ÂÂº\0\tÂÃµ\0\0Â`\0Â%\0\0\0\0\0\0\0\0\0\0\0'.split("")
                  , n = window
                  , o = [null, null, null, null, null]
                  , s = [!0, !0, !0, !0]
                  , l = []
                  , r = 0;
                !function t() {
                    for (; r < i.length; ) {
                        var c = i[r].charCodeAt(0)
                          , d = i[r + 1].charCodeAt(0)
                          , p = 127 & d
                          , h = null;
                        if (128 & d) {
                            h = 0;
                            var g = e(i, r + 2, p).split("");
                            for (var u in g) {
                                var m = g[u].charCodeAt(0);
                                h <<= m > 15 ? 8 : 4,
                                h |= m
                            }
                        } else
                            h = e(i, r + 2, p);
                        switch (r += p + 2,
                        c) {
                        case 1:
                            o[0] = h;
                            break;
                        case 2:
                            o[0] = n;
                            break;
                        case 3:
                            o[h.charCodeAt(0) % o.length] = o[h.charCodeAt(1) % o.length];
                            break;
                        case 4:
                            o[0] = o[0][o[1]];
                            break;
                        case 5:
                            o[0] = o[0] + o[1];
                            break;
                        case 6:
                            o[0] = o[0] - o[1];
                            break;
                        case 7:
                            var f = o[0] % o[1];
                            o[0] = o[0] / o[1],
                            o[1] = f;
                            break;
                        case 8:
                            o[0] = o[0] * o[1];
                            break;
                        case 9:
                            r = h;
                            break;
                        case 16:
                            s[3] && (r = h);
                            break;
                        case 17:
                            s[3] || (r = h);
                            break;
                        case 18:
                            o[1] = o[0]();
                            break;
                        case 19:
                            l.push(o[0]);
                            break;
                        case 20:
                            o[0] = l.pop();
                            break;
                        case 21:
                            o[0] = o[0] ^ o[1];
                            break;
                        case 22:
                            s[0] = o[0] > o[1],
                            s[1] = o[0] < o[1],
                            s[2] = o[0] === o[1],
                            s[3] = 0 === o[0];
                            break;
                        case 23:
                            for (var v = [], _ = l.pop(), b = l.pop(), k = l.length; b > 0; b--)
                                v.push(l[k - _ - b]);
                            o[1] = o[0].apply(o[1], v);
                            break;
                        case 24:
                            o[0] = null;
                            break;
                        case 25:
                            o[0] = l[h];
                            break;
                        case 32:
                            !function() {
                                var e = o[1]
                                  , n = o[0]
                                  , s = function() {
                                    for (var a = [], n = 0; n < arguments.length; n++)
                                        a.push(arguments[n]);
                                    var o = r;
                                    l.push(o),
                                    l.push(a),
                                    r = e,
                                    o >= i.length && t()
                                };
                                o[0] = function() {
                                    s.apply(this, arguments)
                                }
                                ,
                                "function" != typeof n && (n = a),
                                o[0].toString = function() {
                                    return n.toString()
                                }
                            }();
                            break;
                        case 33:
                            r = i.length;
                            break;
                        case 34:
                            o[0][o[1]] = o[2];
                            break;
                        case 35:
                            o[0] = l.length;
                            break;
                        case 36:
                            o[0] = l[o[1]];
                            break;
                        case 37:
                            l[o[0]] = o[1];
                            break;
                        case 38:
                            o[0] = _typeof(o[0]);
                            break;
                        case 39:
                            o[0] = new o[0];
                            break;
                        case 40:
                            u = 6;
                            break;
                        case 41:
                            o[0] = String.fromCharCode(o[0]);
                            break;
                        case 10:
                            s[2] && (r = h);
                            break;
                        case 11:
                            s[2] || (r = h);
                            break;
                        case 12:
                            s[0] && (r = h);
                            break;
                        case 13:
                            (s[0] || s[2]) && (r = h);
                            break;
                        case 14:
                            s[1] && (r = h);
                            break;
                        case 15:
                            (s[1] || s[2]) && (r = h);
                            break;
                        case 26:
                            o[0] = [];
                            break;
                        case 27:
                            r = o[0];
                            break;
                        case 28:
                            i[o[0]] = o[1];
                            break;
                        case 31:
                            o[0] = r;
                            break;
                        case 42:
                            for (var u in o[0] = o[0].split(""),
                            o[0])
                                o[0][u] = n.String.fromCharCode(103 ^ o[0][u].charCodeAt(0));
                            o[0] = o[0].join("");
                            break;
                        case 43:
                            o[0] = l[l.length - h]
                        }
                    }
                }()
            }()
        } else
            setTimeout(startGame, 100)
}
function sendFirstInit(t) {
    var e = "&clientTs=" + unix_time(!0)
      , a = "";
    t && (a = t),
    setBlockSendNextInit(!1),
    _g("init&initlvl=1" + e + a + "&mucka=" + Math.random(), (function() {
        g.gameLoader.finishStep("loc")
    }
    )),
    newCommunicationMode && window.setLastRequest(),
    g.diff.before = new Date,
    g.gt = setInterval(gameThread, g.gtDelay)
}
function loadScript(t) {
    g.addonswait.push(t),
    $.ajax({
        type: "GET",
        url: t,
        success: function() {
            for (var e in log("Addon " + t + " loaded successfully."),
            g.addonswait)
                if (g.addonswait[e] == t) {
                    g.addonswait.splice(e, 1);
                    break
                }
        },
        error: function() {
            for (var e in console.log("error"),
            log("Addon " + t + " loaded fail."),
            g.addonswait)
                if (g.addonswait[e] == t) {
                    g.addonswait.splice(e, 1);
                    break
                }
        },
        dataType: "script",
        cache: !0
    })
}
var __f = !0;
function gameThread() {
    if (g.requestAnimationFrameUpdateFinished = !1,
    !(g.init < 4) && map.loaded && g.ev) {
        if (g.init < 5)
            return g.init++,
            $("#loading").fadeOut(1e3),
            log("Game started."),
            isset(g.talk.insideDialogSynchroId) || g.talk.id || g.lock.remove("npcdialog"),
            void sound.manager.synchroStart("game");
        for (var t in g.loadQueue)
            "object" == _typeof(g.loadQueue[t]) && (g.loadQueue[t].fun(g.loadQueue[t].data),
            delete g.loadQueue[t]);
        1 != g.mouseMove.active || 64 & hero.opt || g.lock.check() || "block" == $("#alert").css("display") ? (isset(g.keys.arrows[g.lastKey[0]]) && hero.go(g.keys.arrows[g.lastKey[0]]),
        isset(g.keys.wsad[g.lastKey[1]]) && hero.go(g.keys.wsad[g.lastKey[1]])) : g.mouseMove.enabled && g.mouseMove.dragged && (0 != g.mouseMove.runInterval || hero.isBlockedSearchPath() || hero.go(getDirFromMousePosition(g.mouseMove.lastCoords)),
        g.mouseMove.mouseInterval = 4 == g.mouseMove.mouseInterval ? 0 : g.mouseMove.mouseInterval + 1),
        hero.rx == hero.x && hero.ry == hero.y && road.length > 0 && hero.go("R");
        new Date;
        for (var t in hero.run(),
        g.other)
            runOther(t);
        for (var e in g.sync++,
        g.delays.now = new Date,
        g.diff.c++,
        g.diff.s += g.delays.now.getTime() - g.diff.before.getTime(),
        g.diff.c >= (__f ? 20 : 100) && (__f = !1,
        g.diff.t = Math.floor(g.diff.s / g.diff.c),
        g.diff.c = 0,
        g.diff.s = 0),
        g.delays.now.getTime() - g.delays.before.getTime() >= g.delays.limit && (g.initAjaxState || g.init >= 4) && (newCommunicationMode && checkCanSendTaskFromTaskQueue() ? sendTaskFromQueue() : _g("_")),
        "/r" == $("#inpchat").val() && "" != g.chat.lastnick && $("#inpchat").val("@" + g.chat.lastnick.split(" ").join("_") + " "),
        fadeMsg(),
        callOnUpdateGame)
            callOnUpdateGame[e]();
        g.away.logOut(),
        g.diff.before = new Date,
        g.requestAnimationFrameUpdateFinished = !0
    }
}
var callOnUpdateGame = {};
function checkLotsItemsExit() {
    return g.loots.want.length > 0 || g.loots.not.length > 0 || g.loots.must.length > 0
}
function addToUpdateEveryGameUpdate(t, e) {
    callOnUpdateGame[e] || (callOnUpdateGame[e] = t)
}
function clearUpdateEveryGameUpdate() {
    callOnUpdateGame = {}
}
function removeFromUpdateEveryGameUpdate(t) {
    callOnUpdateGame[t] && delete callOnUpdateGame[t]
}
function __g(t) {
    _g(t, (function(e) {
        console.warn("Debug call -> _g('" + t + "')"),
        console.log(e)
    }
    ))
}
function _g(t, e) {
    if (!(g.init > 4 && "walk" == t) || 2 & __tutorials.val || null === __tutorials.val) {
        if (t = "___walk" == t ? "walk" : t,
        g.sync = 0,
        g.delays.before = new Date,
        "_" != t || !g.ats) {
            hero.ml.length ? (t += "&ml=" + hero.ml.join(";"),
            t += "&mts=" + hero.mts.join(";")) : g.init > 4 && hero.remoteDir != hero.dir && (t += "&pdir=" + hero.dir,
            hero.sendDir = !0),
            g.ev && (t += "&ev=" + g.ev,
            g.ev += .01),
            g.browser_token && (t += "&browser_token=" + g.browser_token),
            g.bagupd != g.bag && (g.bagupd = g.bag,
            t += "&bag=" + g.bag),
            g.ats = ts();
            var a = {};
            arguments.length > 1 && (a = "object" == _typeof(arguments[1]) ? arguments[1] : {}),
            g.initAjaxState = !1;
            $.ajax({
                url: "/engine?t=" + t,
                type: "post",
                contentType: "application/json; charset=UTF-8",
                data: a ? JSON.stringify(a) : null,
                success: function(t, a, i) {
                    var n = !1;
                    g.engineStopped || (n = parseInput(t, e, i)),
                    g.initAjaxState = n
                },
                error: function(t) {
                    if (g.lock.check("item_block_move") && g.lock.remove("item_block_move"),
                    504 == parseInt(t.status))
                        return log(_t("Request rejected"), 1),
                        g.initAjaxState = !0,
                        void (g.ats = 0);
                    200 != parseInt(t.status) && log(t.status + " - " + t.statusText, 2)
                }
            })
        }
    } else
        _g("tutorial&opt=" + (2 | __tutorials.val), (function() {
            _g("___walk")
        }
        ))
}
var worldTime = null;
function setWorldTime(t) {
    worldTime = t
}
function getWorldTime() {
    return worldTime
}
function parseInput(d, callback, xhr) {
    if ("" == d && window.location.reload(),
    !isset(d) || !d)
        return g.reconnect.start(),
        !0;
    if (isset(d.world_time) && setWorldTime(d.world_time),
    isset(d.t))
        switch (d.t) {
        case "stop":
            if (isset(d.wait_for)) {
                var str = _t("regexp_wait_for_relog");
                if (new RegExp(str,"g").test(d.wait_for)) {
                    var waitForSec = isset(d.wait_for_sec) ? 1e3 * d.wait_for_sec : g.delays.limit;
                    return removeMessages(str),
                    message(d.wait_for),
                    setTimeout((function() {
                        _g("init&initlvl=1" + ("&clientTs=" + unix_time(!0)) + "&mucka=" + Math.random(), (function() {
                            removeMessages(str),
                            g.gameLoader.finishStep("loc")
                        }
                        ))
                    }
                    ), waitForSec),
                    !0
                }
                return message(d.wait_for),
                setTimeout((function() {
                    $("#loading").show(),
                    window.location.reload()
                }
                ), 5500),
                !0
            }
            log("Engine stopped.", 3),
            stopEngine();
            break;
        case "reload":
            null !== g.logoff.start && null !== g.logoff.time ? location.href = "http://" + location.href.split(".").splice(-2).join(".") : ($("#loading").show(),
            window.location = window.location.href)
        }
    if (isset(d.worldConfig) && g.worldConfig.update(d.worldConfig),
    isset(d.guest_time) && (0 == d.guest_time && mAlert(_t("guest_playtime_runout")),
    stopEngine()),
    isset(d.force_regcomplete) && ingameRegistration.forceDialog(),
    isset(d.tutorial) && (__tutorials.val = d.tutorial,
    __tutorials.runQueue()),
    isset(d.h) && hero._u(d.h, d),
    isset(d.progressbar) ? progressbar.update(d.progressbar) : progressbar.hide(),
    isset(d.pet) && hero.updatePet(d.pet),
    isset(d.town) && map._u(d.town),
    isset(d.townname) && (g.townname = d.townname),
    isset(d.conquer) && (map.conquer = parseInt(d.conquer),
    map.setBallTip()),
    isset(d.cl) && map.cols(d.cl),
    isset(d.gw2) && newGateway(d.gw2),
    isset(d.recovery) && (g.itemRecovery = new ItemRecovery(d.recovery)),
    isset(d.qtrack) && "pl" != _l() && questTrack.updateQtrack(d.qtrack),
    isset(d.settrack) && "pl" != _l() && questTrack.startTracking(d.settrack),
    isset(d.npc) && g.loadQueue.push({
        fun: preNewNpc,
        data: d.npc
    }),
    isset(d.game)) {
        var g_loader = new MinigameLoader;
        g_loader.initGame(d.game)
    }
    if (isset(d.advent) && adventCallendar.parseData(d.advent),
    isset(d.loot_preview) && initLootPreview(d.loot_preview),
    isset(d.recipe_preview) && initLootPreview(d.recipe_preview),
    isset(d.artisanship) && (d.artisanship.open ? g.crafting.open(d.artisanship.open) : d.artisanship.close && g.crafting.close()),
    isset(d.enhancement) && isset(g.crafting.enhancement) && g.crafting.enhancement.update(d.enhancement),
    isset(d.salvager_preview) && isset(g.crafting.salvage) && g.crafting.salvage.update(d.salvager_preview),
    isset(d.extractor) && isset(g.crafting.extraction) && g.crafting.extraction.update(d.extractor),
    isset(d.choose_bonus_selector) && (g.bonusSelectorWindow && g.bonusSelectorWindow.close(),
    g.bonusSelectorWindow = new BonusSelectorWindow(d.choose_bonus_selector)),
    isset(d.bonus_reselect)) {
        var bReselect = d.bonus_reselect;
        if (isset(bReselect.show) && (g.bonusReselectWindow || (g.bonusReselectWindow = new BonusReselectWindow)),
        isset(bReselect.status) && (g.bonusReselectWindow || (g.bonusReselectWindow = new BonusReselectWindow),
        g.bonusReselectWindow.update(bReselect)),
        isset(bReselect.select)) {
            var fromReselect = !0
              , res = _objectSpread(_objectSpread({}, bReselect.select), {}, {
                fromReselect: fromReselect
            });
            g.bonusSelectorWindow && g.bonusSelectorWindow.close(),
            g.bonusSelectorWindow = new BonusSelectorWindow(res)
        }
    }
    if (isset(d.recipes) && g.crafting.open("recipes", d.recipes),
    isset(d.shop) && shop_show(d.shop, d.item_tpl),
    isset(d.item_tpl) && g.tplsManager.updateDATA(d.item_tpl),
    isset(d.item)) {
        for (var i in d.item)
            d.item[i].initLvl = g.init;
        g.loadQueue.push({
            fun: newItem,
            data: d.item
        })
    }
    if (isset(d.other) && g.loadQueue.push({
        fun: newOther,
        data: d.other
    }),
    isset(d.registration) && ingameRegistration.parseRegisternoobInfo(d.registration),
    isset(d.codeprom) && codeManager.updateBonusWindow(d.codeprom),
    isset(d.calendar) && eventCalendar.show(d.calendar),
    isset(d.rip) && newRip(d.rip),
    isset(d.d) && npcTalk(d.d),
    isset(d.gold_pricelist) && showGoldShop(d.gold_pricelist),
    isset(d.quests) && (belugaComMode || g.questLog.update(d.quests)),
    isset(d.qlog) && qlog.init(d.qlog),
    isset(d.friends)) {
        tutorialStart(12);
        for (var fr = "", k = 0; k < d.friends.length; k += 10) {
            var x = d.friends
              , frstate = x[k + 8]
              , frcol = "#999";
            "online" == frstate ? frcol = "#6f6" : frstate.indexOf("online") > -1 ? frcol = "#09f" : frstate = _t("offline_from %time%", {
                "%time%": calculateDiff(parseInt(x[k + 9]))
            });
            var frbut = "<div class=delfr onclick='deleteFriend(\"" + x[k] + '","' + x[k + 1] + "\")'></div><div class=chatfr onclick='chatTo(\"" + x[k + 1] + "\")'></div><div class=frparty onclick='friendInviteParty(\"" + x[k] + "\")'></div>";
            g.fredit && (frbut = "",
            k > 0 && (frbut = "<div class=frup onclick='_g(\"friends&a=fup&id=" + x[k] + "\")'></div>"),
            k + 10 < d.friends.length && (frbut += "<div class=frdn onclick='_g(\"friends&a=fdown&id=" + x[k] + "\")'></div>"));
            var fr1 = '<div class=frbox><div class=frchar style="background-image:url(' + g.opath + "postacie" + x[k + 2] + ')"></div>' + frbut + "<b>" + x[k + 1] + "(" + x[k + 3] + x[k + 4] + ')</b><br><small style="color:' + frcol + '">(' + frstate + ")</small><br><nobr><span class=frloc>" + escapeHTML(x[k + 5]) + "(" + x[k + 6] + "," + x[k + 7] + ")</span></nobr></div>";
            g.fredit || frstate.indexOf("online") < 0 ? fr += fr1 : fr = fr1 + fr
        }
        $("#myfriends").html(fr),
        $("#friends").fadeIn("fast"),
        g.lock.add("friends")
    }
    if (isset(d.enemies)) {
        for (var enstate = [_t("active_sometime_ago"), _t("active_fewdays_ago"), _t("inactive_longtime")], enstcol = ["#6f6", "#888", "#000"], en = [], x = d.enemies, i = 0; i < x.length; i += 6) {
            var enbut = '<div class=delen onclick=_g("friends&a=edel&id=' + x[i] + '")></div>';
            g.fredit && (enbut = "",
            i > 0 && (enbut = "<div class=frup onclick='_g(\"friends&a=eup&id=" + x[i] + "\")'></div>"),
            i + 6 < x.length && (enbut += "<div class=frdn onclick='_g(\"friends&a=edown&id=" + x[i] + "\")'></div>")),
            en[en.length] = '<div class=frbox><div class=frchar style="background-image:url(' + g.opath + "postacie" + x[2 + i] + ')"></div>' + enbut + x[1 + i] + "(" + x[3 + i] + x[4 + i] + ')<br><small style="color:' + enstcol[parseInt(x[5 + i])] + '">(' + enstate[parseInt(x[5 + i])] + ")</small></div>"
        }
        $("#myenemies").html(en.join(""))
    }
    if ($("#friends .frbox").each((function() {
        $(this).attr("scrollHeight") > 66 && $(this).css({
            fontSize: "12px"
        })
    }
    )),
    $("#friends .frbox").css("overflow", "visible"),
    chatScrollbar("myfriends", 243, "myfrscrollbar"),
    chatScrollbar("myenemies", 499, "myenscrollbar"),
    isset(d.gm) && (g.gm = !0),
    isset(d.alert) && null === d.alert.match(/Active quests/) && (isset(d.redirect) ? mAlert(parsePopupBB(d.alert), 0, (function() {
        window.location.href = "https://" + d.redirect
    }
    )) : mAlert(parsePopupBB(d.alert))),
    isset(d.alert3) && mAlert("<h2>" + _t("achievement_list") + '</h2><div class="scrollable">' + d.alert3 + "</div>"),
    isset(d.raj) && parseJSONRajController(d.raj),
    isset(d.message) && g.messageController.updateData(d.message),
    isset(d.msg))
        for (var k in d.msg)
            "ach" == d.msg[k].substr(0, 3) ? achMessage(d.msg[k]) : (d.msg[k] == _t("quest_started") && tutorialStart(8),
            message(d.msg[k]));
    if (isset(d.ask)) {
        isset(d.ask.q) && d.ask.q.match(/Czy chcesz handlowaÄ|Czy chcesz doÅÄczyÄ|zaprasza ciÄ do swoich/) && tutorialStart(17);
        var icon = "";
        if (isset(d.ask.ip)) {
            var patch = CFG[d.ask.ik] + "" + d.ask.ip;
            patch = patch.replace(/"/g, "&quot;"),
            icon = '<div class="icon" style="background-image: url(' + patch + ')"></div>',
            isset(d.ask.it) && ("string" == typeof d.ask.it && (d.ask.it = escapeHTML(d.ask.it)),
            icon = '<div class="text">' + _t("stamina_shop_cost") + '<span class="red"> ' + d.ask.it + "</span></div>" + icon),
            icon = '<div class="icon-wrapper">' + icon + "</div>"
        }
        var html = parsePopupBB(d.ask.q) + icon;
        switch (d.ask.m) {
        case "okcancel":
            g.askre = d.ask.re,
            mAlert(html, 1, [function() {
                _g(g.askre + "1")
            }
            , function() {
                _g(g.askre + "0")
            }
            ]);
            break;
        case "yesno":
            g.askre = d.ask.re,
            mAlert(html, 2, [function() {
                _g(g.askre + "1")
            }
            , function() {
                _g(g.askre + "0")
            }
            ]);
            break;
        case "input":
            g.askre = d.ask.re,
            mAlert(html, 3, [function() {
                var t = $('#alert .a2 input[name="mAlertInput"]').val()
                  , e = null;
                e = "clan&a=create&name=" == g.askre ? esc(t) : t,
                _g(g.askre + e)
            }
            , function() {
                _g(g.askre + "null")
            }
            ])
        }
    }
    if (isset(d.alert2) && (g.askre = d.alert2.re,
    mAlert(parsePopupBB(d.alert2) + '<br /><center><span style="font-size:0.8em;color:#666;">' + _t("write_ok_to_confirm") + "</span></center>", 3, [null], "warn"),
    $("#a_cancel").css("display", "none"),
    $("#a_ok").unbind("click").click((function() {
        var t = $('#alert input[name="mAlertInput"]').val();
        "ok" != t && "OK" != t || $("#alert").fadeOut()
    }
    ))),
    isset(d.n) && log(d.n),
    isset(d.w) && log(d.w, 1),
    isset(d.e) && "ok" != d.e && log(d.e, 2),
    isset(d.ev) && (g.ev = d.ev,
    g.reconnect.stop()),
    isset(d.js_script) && eval(d.js_script),
    isset(d.browser_token) && (g.browser_token = d.browser_token),
    isset(d.emo) && g.loadQueue.push({
        fun: newEmoData,
        data: d.emo
    }),
    isset(d.minimap) && map.setCoords(d.minimap),
    isset(d.book) && bookSetup(d.book),
    isset(d.motel) && motelSetup(d.motel),
    isset(d.loot) && lootWindow(d.loot),
    isset(d.logoff_time_left) && logout_logoff(d.logoff_time_left),
    isset(d.party)) {
        var party = d.party;
        if (newChatMode && g.chatController.getChatChannelsAvailable().setAvailable(ChatData.CHANNEL.GROUP, !0),
        Object.keys(party).length) {
            for (var i in g.party || $("#bm_party").fadeIn(),
            g.party = [],
            party.members) {
                var rec = party.members[i];
                g.party[parseInt(i)] = {
                    n: rec.nick,
                    r: rec.commander ? 1 : 0,
                    s: rec.stasis ? 1 : 0
                }
            }
            var lead = !1;
            g.party[hero.id].r && (lead = !0);
            var pp = "";
            for (var k in g.party) {
                var leadertxt = "pl" == _l() ? "[D]" : "[L]"
                  , stasis = g.party[k].s ? "pm-nick--stasis" : "";
                pp = '<div class="party_member">' + (g.party[k].r ? leadertxt : pp) + '<span class="pm-nick ' + stasis + '">' + g.party[k].n + "</span>" + (lead && k != hero.id ? " <nobr><b onclick=\"_g('party&a=rm&id=" + k + '\')" tip="' + _t("throwout_group_member") + '">[X]</b> <b onclick="_g(\'party&a=give&id=' + k + '\')" tip="' + _t("give_leadership") + '">' + leadertxt + "</b></nobr>" : "") + "</div>" + (g.party[k].r ? pp : "")
            }
            var partygrpkill = "";
            if (isset(party.partygrpkill)) {
                var val = parseInt(party.partygrpkill)
                  , tip = _t("group_kill_exp_nocount")
                  , cname = "noactive";
                1 == val && (tip = _t("group_kill_exp_count"),
                cname = "active"),
                partygrpkill = " <div tip='" + tip + "' id='grpkill' class='" + cname + "'></div>"
            }
            $("#party P").html(pp + (lead ? "<b onclick=\"_g('party&a=disband')\" class=pcen>[" + _t("solve_group") + "]</b>" : "<b onclick=\"_g('party&a=rm&id=" + hero.id + "')\" class=pcen>[" + _t("leave_group") + "]</b>") + '<div style="font-size:10px; margin-top:2px;color:white; text-align:center">' + (isset(party.partyexp) ? "exp " + party.partyexp + "%" : "") + partygrpkill + "</div>");
            var po = $("#party").position();
            parseInt(po.top) < 0 && $("#party").css({
                top: -$("#party").height()
            })
        } else
            $("#bm_party").fadeOut(),
            $("#party").css({
                top: -9999
            }),
            g.party = !1,
            newChatMode && g.chatController.getChatChannelsAvailable().setAvailable(ChatData.CHANNEL.GROUP, !1)
    }
    if (isset(d.clanmap) && ($(".clan").fadeIn(),
    g.lock.add("clans"),
    g.clanController || (g.clanController = new ClanController),
    g.clanController.updateClanList(d.clanmap)),
    isset(d.members) && ($(".clan").fadeIn(),
    g.clanController || (g.clanController = new ClanController),
    g.clanController.updateMembers(d.members)),
    isset(d.myclan)) {
        if (g.lock.add("clans"),
        g.clanController || (g.clanController = new ClanController),
        g.clanController.update(d.myclan),
        $("#clanmenu>.boxhover>li.disabled").removeClass("disabled").addClass("to-disable"),
        $("#create_new_clan").css("display", "none"),
        isset(d.myclan.created))
            g.clan = d.myclan;
        else
            for (var k in d.myclan)
                g.clan[k] = d.myclan[k];
        if (isset(d.myclan.goldlog)) {
            var glog = g.clan.goldlog.split("<br>"), log2 = [], s;
            for (var i in glog)
                s = glog[i].split(";"),
                log2[i] = {
                    kind: s[0],
                    txt: s[1]
                };
            g.clan.goldlog = log2
        }
        if (isset(d.myclan.ranks)) {
            var ranks = g.clan.ranks.split(";")
              , r2 = [];
            for (var i in ranks)
                ranks[i] = ranks[i].split(","),
                r2[parseInt(ranks[i][0])] = {
                    name: ranks[i][1],
                    r: parseInt(ranks[i][2])
                };
            g.clan.ranks = r2,
            g.clan.myrank = r2[hero.clan.rank].r
        }
        if (g.clan.logoimg = "<div class=cl_logo><br>" + escapeHTML(g.clan.name) + "</div>",
        isset(d.myclan.mlist)) {
            for (var mlist = "", i = 0; i < g.clan.mlist.length; i += 2)
                mlist += '<option value="' + g.clan.mlist[i] + '">' + g.clan.mlist[i + 1] + "</option>";
            g.clan.mlist = mlist + "</select>"
        }
        !isset(d.myclan.created) && isset(g.clan.fn) && g.clan.fn(),
        "none" == $(".clan").css("display") && ($(".clan").css("display", "block"),
        clanOfficial())
    }
    if (isset(d.clan_applications) && g.clanController.updateRecruitApplications(d.clan_applications),
    isset(d.clan_invitations) && g.clanController.updateRecruitInvitations(d.clan_invitations),
    isset(d.clan_skills) && g.clanController.updateClanSkills(d.clan_skills),
    isset(d.clan_skills_blessing) && g.clanController.updateClanBless(d.clan_skills_blessing),
    isset(d.clan_quests) && g.clanController.updateClanQuests(d.clan_quests),
    isset(d.clan)) {
        var id = d.clan.id
          , cl = d.clan
          , txt = "<div class='clan-official-page'>";
        txt += "<div class=cl_logo><br>" + escapeHTML(cl.name) + "</div>",
        txt += parseClanBB(cl.official),
        id == g.clan.id && 64 & g.clan.myrank && (txt += "<br><br><button onclick=clEditMain()>",
        txt += "Edytuj oficjalnÄ stronÄ",
        txt += "</button>"),
        txt += "</div><center><table class=members><tr><th width=35>" + _t("th_lp", null, "clan") + "<th>" + _t("th_nick", null, "clan") + "<th>" + _t("th_rank", null, "clan");
        for (var memberCounter = 0, i = 0; i < cl.members.length; i += 5)
            memberCounter++,
            txt += "<tr><td>" + memberCounter + "<td>" + cl.members[i] + " (" + cl.members[i + 1] + cl.members[i + 2] + ")<td>" + cl.members[i + 3];
        var $html = $(txt + "</table></center>");
        setLogoInClan($html, d.clan.logo),
        $("#clanbox").html($html)
    }
    if (isset(d.clan_fr) && (g.clan.fr = d.clan_fr),
    isset(d.clan_en) && (g.clan.en = d.clan_en,
    clanDiplomacy()),
    isset(d.trade)) {
        g.tmpTradeAcceptStatus = [g.trade.accept, g.trade.myaccept];
        var tr = d.trade;
        isset(tr.init) && tradeInit(tr.init),
        tradeUpdate(tr)
    }
    if (isset(d.cls) && ("*" == d.cls ? g.chat.txt = ["", "", "", ""] : g.chat.txt[d.cls] = "",
    "*" != d.cls && d.cls != g.chat.tab || $("#chattxt").empty(),
    chatScrollbar("chattxt", 3 == g.chat.state ? 255 : 500, "chatscrollbar")),
    isset(d.c) && newChatMsg2(d.c),
    isset(d.businessCards) && g.businessCardManager.updateData(d.businessCards),
    isset(d.chat) && g.chatController.getChatDataUpdater().updateData(d.chat),
    isset(d.f) && fight(d.f, d),
    isset(d.matchmaking_state) && g.matchmaking.changeState(d.matchmaking_state),
    isset(d.matchmaking_search) && g.matchmaking.changeSearch(d.matchmaking_search),
    isset(d.matchmaking_confirmation) && g.matchmaking.onConfirmation(d.matchmaking_confirmation),
    isset(d.matchmaking_preparation) && g.matchmaking.onPreparation(d.matchmaking_preparation),
    isset(d.matchmaking_statistics) && g.matchmaking.onStatistics(d.matchmaking_statistics),
    isset(d.matchmaking_history) && g.matchmaking.onHistory(d.matchmaking_history),
    isset(d.matchmaking_ladder_global) && g.matchmaking.onGeneralRanking(d.matchmaking_ladder_global, "global"),
    isset(d.matchmaking_ladder_clan) && g.matchmaking.onGeneralRanking(d.matchmaking_ladder_clan, "clan"),
    isset(d.matchmaking_ladder_friends) && g.matchmaking.onGeneralRanking(d.matchmaking_ladder_friends, "friends"),
    isset(d.matchmaking_statistics_detailed) && g.matchmaking.onStatisticsDetailed(d.matchmaking_statistics_detailed),
    isset(d.match_profile) && g.matchmaking.onProgress(d.match_profile),
    isset(d.matchmaking_season_rewards) && g.matchmaking.onMatchmakingSeasonPosition(d.matchmaking_season_rewards),
    isset(d.match_season) && g.matchmaking.onSeason(d.match_season),
    isset(d.match_summary) && g.matchmakingSummary.updateSummary(d.match_summary),
    isset(d.match_main) && g.matchmaking.onMain(d.match_main),
    isset(d.rewards_calendar_active) && $("#new_event_calendar").css("display", "block"),
    isset(d.rewards_calendar) && initRewardsCalendar(d.rewards_calendar),
    isset(d.barter) && initBarter(d.barter),
    isset(d.captcha) && initCaptcha(d.captcha),
    isset(d.login) && (isset(d.promotions) || initPoll(d)),
    isset(d.choose_outfit) && initChooseOutfit(d.choose_outfit),
    isset(d.choose_teleport) && (isset(d.choose_teleport.location_data) ? g.tpScroll.showLocation(d.choose_teleport.location_data) : (g.tpScroll && g.tpScroll.close(),
    g.tpScroll = new tpScroll,
    g.tpScroll.update(d.choose_teleport))),
    isset(d.promotions) && (g.news || (g.news = new news),
    g.news.init(),
    g.news.update(d.promotions)),
    isset(d.promotion_changed) && g.news.updateChanged(d.promotion_changed),
    isset(d.notices) && (d.notices.indexOf(1) > -1 && $("#b_news").addClass("notif"),
    d.notices.indexOf(2) > -1 && $("#new_event_calendar").addClass("notif")),
    isset(d.wanted) && PK_watch.update(d.wanted),
    isset(d.dead)) {
        var sec = d.dead % 60
          , min = "";
        g.deadCounter = d.dead,
        d.dead > 59 && (min = Math.floor(d.dead / 60) + "min "),
        $("#dazeleft").html(_t("unconcious_info_txt %time%", {
            "%time%": "<b>" + min + sec + "</b>"
        })),
        g.dead || (__tutorials.skipSelected(5),
        tutorialStart(6),
        g.dead = !0,
        g.deadCounter = d.dead,
        $("#dazed").fadeIn("fast"))
    } else
        g.dead && g.deadCounter < 1 && (g.dead = !1,
        g.deadCounter = 0,
        hero.centerViewOnMe(),
        $("#dazed").fadeOut("fast"));
    if (isset(d.mails) && loadMails(d.mails),
    isset(d.mailsent) && (clearMail(),
    message(_t("message_sent"))),
    isset(d.maildel) && mailDel(d.maildel),
    isset(d.maildela) && mailDelAtt(d.maildela),
    isset(d.auctions) && (g.auctions || (g.auctions = new AuctionManager,
    g.auctions.init()),
    g.auctions.updateData(d.auctions)),
    isset(d.depo) && depoShow(d.depo),
    isset(d.clan_depo) && depoShow(d.clan_depo, !0),
    isset(d.selectedskills) && g.skills.updateSelectedSkills(d.selectedskills),
    isset(d.skill_list) && !isset(d.battleskills) && (g.skills.isInit || g.skills.init(),
    g.skills.load(d.skill_list, d.freeskills_ts)),
    isset(d.freeskills_ts) && g.skills.updateFreeSkills(d.freeskills_ts),
    isset(d.skills_learnt) && $("#skillcount").html("(" + d.skills_learnt + "/" + Math.max(0, hero.lvl - 24) + ")"),
    isset(d.battleskills) && d.battleskills.max > 0 && (g.bmEditor.init(),
    g.bmEditor.update(d.battleskills)),
    isset(d.battleskills) && g.bmEditor.refreshSkillList(d.battleskills.list),
    isset(d["conquer-stats"]) && conquerStats.show(d["conquer-stats"]),
    g.init < 4 && "ok" == d.e) {
        if (1 == g.init && g.blockSendNextInit)
            return;
        g.init++;
        var name = "";
        switch (g.init) {
        case 2:
            name = "player";
            break;
        case 3:
            name = "items";
            break;
        case 4:
            name = "npc"
        }
        g.gameLoader.startStep(name);
        var tsToSend = "&clientTs=" + unix_time(!0);
        _g("init&initlvl=" + g.init + tsToSend + "&mucka=" + Math.random(), (function() {
            g.gameLoader.finishStep(name)
        }
        ))
    }
    var lag = ts() - g.ats
      , lag2 = Math.min(Math.floor(lag / 50), 5);
    return g.ats = 0,
    g.lag != lag2 && $("#lagmeter").css({
        backgroundPosition: "0 -" + 17 * lag2 + "px"
    }),
    $("#lagmeter").attr("tip", lag + "ms"),
    g.lag = lag2,
    isset(callback) && "function" == typeof callback && callback(d),
    hero.sendDir = !1,
    !0
}
function deleteFriend(t, e) {
    var a = _t("ask_delete_friend %nick%", {
        "%nick%": e
    }, "default");
    mAlert(a, 2, [function() {
        _g("friends&a=fdel&id=" + t)
    }
    , function() {}
    ])
}
function friendInviteParty(t) {
    _g("party&a=inv&id=" + t)
}
function showMenu(e, menu, forceshow) {
    var m = "<div id=h-orn1></div><div id=h-orn2></div>";
    if (!(1 != menu.length || isset(menu[0][2]) && menu[0][2] || isset(forceshow) && forceshow))
        return eval(menu[0][1]);
    for (var k in menu)
        m += "<button onclick='" + menu[k][1] + "'>" + menu[k][0] + "</button><br>";
    $("#hmenu").html(m),
    $("#hmenu BUTTON").last().attr("class", "last");
    var mw = $("#hmenu").width()
      , mh = $("#hmenu").height()
      , of = $(e.target).offset()
      , tw = $(e.target).width()
      , th = $(e.target).height()
      , tx = of.left - mw / 2 + tw / 2
      , ty = of.top - mh / 2 + th / 2;
    Tip.hide(),
    $("#hmenu").css({
        left: tx,
        top: ty
    }).fadeIn("fast"),
    g.menu = !0,
    g.menushowing = !0
}
function hideMenu() {
    g.menu = !1,
    $("#hmenu").fadeOut("fast")
}
function fillSex(t) {
    return TextModifyByTag.sexModify(t)
}
function npcTalk(t) {
    clearInterval(g.talk.scrollCheckInterval),
    removeScrollbar("dlgin", "talkscroll"),
    $("#dlgin").css({
        "margin-right": ""
    });
    var e = !g.talk.id;
    if (g.lock.check("npcdialog") || g.lock.add("npcdialog"),
    !g.talk.id && 4 == parseInt(t[0]))
        return g.lock.remove("npcdialog"),
        void delete g.talk.bubblevisible;
    for (var a = "", i = "", n = 0, o = 0; o < t.length; o += 3)
        if (t[o] = parseInt(t[o]),
        t[o]) {
            if (4 == t[o])
                return $("#dialog").css("display", "none"),
                $("#hero_dialog_img").remove(),
                $("#bubbledialog").fadeOut("fast"),
                g.talk.dialogCloud = null,
                $(".dialogCloud").remove(),
                map.resizeView(),
                (g.talk.id + "").match(/23085|21933|22310|21952|22172|17176/),
                g.talk.id = 0,
                g.lock.remove("npcdialog"),
                delete g.talk.block,
                hero.centerViewOnMe(),
                void delete g.talk.insideDialogSynchroId;
            t[o + 1] = t[o + 1].split("~").join(",").split("[NICK]").join(hero.nick),
            t[o + 1] = fillSex(t[o + 1]);
            var s = !1
              , l = !1
              , r = !1;
            if (/#([0-9]+|this|player|pet)#/.test(t[o + 1])) {
                var c = /#([0-9]+|this|player|pet)#/.exec(t[o + 1])[1];
                switch (t[o + 1] = t[o + 1].replace(/#([0-9]+|this|player|pet)#/, ""),
                c) {
                case "player":
                    l = !0,
                    g.talk.name = hero.nick,
                    g.talk.dialogCloud = "hero",
                    $("#dlgin h4 b").html(parseBasicBB(g.talk.name, !1) + ":");
                    break;
                case "pet":
                    hero.pet ? (r = !0,
                    g.talk.name = hero.pet.name,
                    g.talk.dialogCloud = "pet",
                    $("#dlgin h4 b").html(parseBasicBB(g.talk.name, !1) + ":")) : (c = g.talk.id,
                    isset(g.npc[c]) ? (s = !0,
                    initiateNpcInsideDialog(c, !0, !1)) : g.talk.insideDialogSynchroId = c,
                    g.talk.dialogCloud = c);
                    break;
                default:
                    c = "this" == c ? g.talk.id : c,
                    isset(g.npc[c]) ? (s = !0,
                    initiateNpcInsideDialog(c, !0, !1)) : g.talk.insideDialogSynchroId = c,
                    g.talk.dialogCloud = c
                }
            }
            if (/#BOXOFF#/.test(t[o + 1]) && (t[o + 1] = t[o + 1].replace(/#BOXOFF#/, ""),
            e = !1),
            /#REWARD/.test(t[o + 1])) {
                for (var d = t[o + 1].split("#REWARD").splice(1), p = {}, h = null, u = 0; u < d.length; u++)
                    for (var m = d[u].split(","), f = 0; f < m.length; f++) {
                        var v = m[f].split(":");
                        if ("prof" == v[0]) {
                            var _ = v[1].split(" ");
                            h = {};
                            for (var b = 0; b < _.length; b++) {
                                h[(k = _[b].replace(" ", "").split("->"))[1]] = k[0]
                            }
                        } else {
                            var k = v[0].split(".");
                            isset(p[k[1]]) || (p[k[1]] = []),
                            "item" == k[0] ? ("object" != _typeof(p[k[1]][k[0]]) && (p[k[1]][k[0]] = []),
                            p[k[1]][k[0]].push(v[1].replace(" ", ""))) : p[k[1]][k[0]] = v[1].replace(" ", "")
                        }
                    }
                var w = drawRewards(h, p);
                t[o + 1] = t[o + 1].replace(/#REWARD.*/, "<h2>" + _t("reward_header", null, "talk") + "</h2>" + w.join(""))
            }
            if (/#PLAY\(.*?\)/.test(t[o + 1])) {
                var y = /#PLAY\((.*?)\)/.exec(t[o + 1])[1];
                t[o + 1] = t[o + 1].replace(/#PLAY\((.*?)\)/, ""),
                soundManager.createSound({
                    id: "dialogSound" + g.dialog.soundId++,
                    url: y,
                    autoPlay: !0
                })
            }
            var x = "";
            if (/#SHOP\(.*?\)#/.test(t[o + 1])) {
                var C = /#SHOP\((.*?)\)#/.exec(t[o + 1])[1];
                t[o + 1] = t[o + 1].replace(/#SHOP\(.*?\)#/, ""),
                x = "showShopPanel('" + C + "')"
            }
            if (/#IMG\(.*?\)/.test(t[o + 1])) {
                if ($("#hero_dialog_img").remove(),
                "remove" == (y = /#IMG\((.*?)\)/.exec(t[o + 1])[1]))
                    return;
                t[o + 1] = t[o + 1].replace(/#IMG\((.*?)\)/, "");
                var I = new Image;
                I.src = y,
                I.onload = function() {
                    var t = this;
                    $('<div id="hero_dialog_img"></div>').css({
                        width: t.width,
                        height: t.height,
                        background: "url(" + y + ")",
                        top: 32 * hero.y - hero.fh,
                        position: "absolute",
                        left: 32 * hero.x + 16 - t.width / 2,
                        "z-index": parseInt($("#hero").css("z-index")) - 1
                    }).appendTo("#base")
                }
            }
            if ("_" == t[o + 1].substr(0, 1) && (!0,
            t[o + 1] = t[o + 1].substr(1)),
            /<sakwa>/.test(t[o + 1]) && (t[o + 1] = t[o + 1].replace(/<sakwa>/, ""),
            $(document.createElement("div")).css({
                width: 64,
                height: 32,
                background: "url(img/arrow-right.gif)",
                position: "absolute",
                top: 218,
                left: 465,
                zIndex: 331
            }).attr("id", "sakwa-arrow").appendTo("#centerbox").delay(4e3).fadeOut(1e3, (function() {
                $(this).remove()
            }
            )),
            arrowIntervalAmount = 0,
            arrowInterval = setInterval((function() {
                arrowIntervalAmount++,
                $("#sakwa-arrow").toggle(),
                6 == arrowIntervalAmount && clearInterval(arrowInterval)
            }
            ), 500)),
            1 & t[o]) {
                var T = _t("end_talk1", null, "talk");
                4 != g.talk.type && 5 != g.talk.type || (T = _t("end_talk2", null, "talk")),
                g.talk.bubbleEndLineCommand = "talk&id=" + g.talk.id + "&c=" + t[o + 2],
                g.talk.bubbleEndLineTxt = T,
                g.talk.bubbleTxt = t[o + 1],
                t[o + 1].length > 180 && (e = !1),
                a += "<h4><b>" + parseBasicBB(g.talk.name, !1) + "</b></h4>" + parseContentBB(t[o + 1], !1),
                4 & t[o] ? i += '<li class="icon LINE_EXIT" onclick="_g(\'talk&id=' + g.talk.id + "&c=" + t[o + 2] + '\')"><div class="icon LINE_EXIT"></div>' + T + "</li>" : t[o + 2] && (i += '<li class="icon LINE_NEXT" onclick="_g(\'talk&id=' + g.talk.id + "&c=" + t[o + 2] + '\')"><div class="icon LINE_NEXT"></div>' + _t("dialog_next", null, "talk") + "</li>",
                e = !1)
            }
            if (2 & t[o]) {
                !(++n > 1) && 4 & t[o] || (e = !1),
                g.talk.bubbleEndLineCommand = "talk&id=" + g.talk.id + "&c=" + t[o + 2],
                g.talk.bubbleEndLineTxt = t[o + 1],
                t[o + 1].length > 180 && (e = !1);
                var M = getLineClass(t[o]);
                i += "<li onclick=\"_g('talk&id=" + g.talk.id + "&c=" + t[o + 2] + "'); " + x + '"class="icon ' + M + '"><div class="icon ' + M + '"></div>' + t[o + 1] + "</li>"
            }
            s && (e || map.resizeView(512, 192),
            initiateNpcInsideDialog(c, !0, !0)),
            l && (e || map.resizeView(512, 192),
            map.center(32 * hero.x, 32 * hero.y, !0)),
            r && (e || map.resizeView(512, 192),
            map.center(32 * hero.pet.x, 32 * hero.pet.y, !0))
        } else
            g.talk.name = t[o + 1],
            g.talk.id = t[o + 2],
            g.talk.type = 1,
            g.talk.dialogCloud = t[o + 2],
            isset(g.npc[g.talk.id]) && (g.talk.type = g.npc[g.talk.id].type);
    if ((c + "").match(/23085|21933|22310|21952|22172|17176/) && tutorialStart(1),
    e) {
        i = '<i style="color:#999;cursor:pointer" onclick="event.stopPropagation(); _g(\'' + g.talk.bubbleEndLineCommand + '\'); g.talk.block=true; return false;" class="endtalk2">' + parseContentBB(g.talk.bubbleEndLineTxt, !1) + "</i>",
        $("#bubbledialog .container").html(parseContentBB(g.talk.bubbleTxt, !1) + '<div class="interface">' + i + "</div>");
        var S = function() {
            var t;
            !isset(c) || "player" != c && "pet" != c ? t = isset(c) ? $("#npc" + c) : $("#npc" + g.talk.id) : ("player" == c && (t = $("#hero")),
            "pet" == c && (t = $("#base").find(".pet")));
            var e = parseInt(t.css("left"))
              , a = {
                top: parseInt(t.css("top")) - $("#bubbledialog").height(),
                zIndex: parseInt(t.css("z-index")) + 10
            };
            e + 32 + $("#bubbledialog").width() > $("#base").width() ? ($("#bubbledialog").removeClass("left"),
            a.left = e - $("#bubbledialog").width()) : ($("#bubbledialog").addClass("left"),
            a.left = e + 32),
            $("#bubbledialog").css(a).show(),
            g.talk.bubblevisible = !0
        };
        if (isset(g.npc[g.talk.id]))
            g.npc[g.talk.id].y >= 5 ? S() : ($("#dlgin .message").html(a),
            $("#dlgin .replies").html(i),
            $("#dialog").show(),
            map.resizeView(512, 192));
        else
            var P = setInterval((function() {
                isset(g.npc[g.talk.id]) && (g.npc[g.talk.id].y >= 5 ? S() : ($("#dlgin .message").html(a),
                $("#dlgin .replies").html(i),
                $("#dialog").show(),
                map.resizeView(512, 192)),
                clearInterval(P))
            }
            ), 100)
    } else
        e || ($("#dlgin .message").html(a),
        $("#dlgin .replies").html(parseContentBB(i, !1)),
        $("#dialog").show(),
        map.resizeView(512, 192));
    e || (clearInterval(g.talk.scrollCheckInterval),
    g.talk.scrollCheckInterval = setInterval((function() {
        $("#talkscroll").length || $("#dlgin").height() < $("#dlgin .message").innerHeight() + $("#dlgin .replies").innerHeight() && ($("#dlgin").css({
            "margin-right": 20
        }),
        addScrollbar("dlgin", 490, "talkscroll"))
    }
    ), 100),
    $("#dlgin").height() < $("#dlgin .message").innerHeight() + $("#dlgin .replies").innerHeight() && ($("#dlgin").css({
        "margin-right": 20
    }),
    addScrollbar("dlgin", 490, "talkscroll"))),
    g.talk.dialogCloud && createDialogCloud(g.talk.dialogCloud)
}
function parseJSONRajController(t) {
    var e;
    try {
        e = JSON.parse(t)
    } catch (e) {
        console.error("RajController.js", "parseJSON", "Incorrect JSON format!", t)
    }
    e.weather && map.weatherRayControllerServe(e),
    e.mapFilter && map.weatherRayControllerServe(e),
    e.night && g.nightController.updateData(e)
}
function showShopPanel(t) {
    switch (shop_close(),
    t) {
    case "gold":
        shop_close(),
        _g("creditshop&credits_gold=-1");
        break;
    case "sl":
        slShopOpen()
    }
}
function drawRewards(t, e) {
    var a = [];
    for (var i in e) {
        var n = e[i]
          , o = '<div class="rewardLine' + (null !== t && t[i].search(hero.prof) >= 0 || null === t ? " mine" : "") + '">';
        if (isset(n.item)) {
            o += '<div class="rewardElement rew_item"><span class="label">' + _t("rew_item", null, "talk") + "</span>";
            for (var s = 0; s < n.item.length; s++)
                o += '<div class="container rew_item_' + n.item[s] + '"></div>';
            o += "</div>"
        }
        isset(n.gold) && (o += '<div class="rewardElement rew_gold"><span>' + _t("rew_gold", null, "talk") + "</span> " + n.gold + "</div>"),
        isset(n.exp) && (o += '<div class="rewardElement rew_exp"><span>' + _t("rew_exp", null, "talk") + "</span> " + n.exp + "</div>"),
        isset(n.ph) && (o += '<div class="rewardElement rew_ph"><span>' + _t("rew_ph", null, "talk") + "</span> " + n.ph + "</div>"),
        o += "<div class=clear></div></div>",
        a.push(o)
    }
    return a
}
function getLineClass(t) {
    for (var e = {
        2: "LINE_OPTION",
        4: "LINE_EXIT",
        8: "LINE_NEW_QUEST",
        16: "LINE_CONT_QUEST",
        32: "LINE_SHOP",
        64: "LINE_ATTACK",
        128: "LINE_GAME",
        256: "LINE_HEAL"
    }, a = 256; a > 1; ) {
        if (t & a)
            return "icon " + e[a];
        a >>= 1
    }
    return null
}
function createDialogCloud(t) {
    var e = [0, 0];
    switch (t) {
    case "hero":
        if (!hero.x || !hero.y)
            return;
        e = [32 * hero.y - hero.fh + 16, 32 * hero.x + hero.fw / 2 - 8];
        break;
    case "pet":
        if (!hero.pet.x || !hero.pet.y)
            return;
        e = [32 * hero.pet.y - hero.pet.fh + 16, 32 * hero.pet.x + hero.pet.fw / 2 - 8];
        break;
    default:
        if (t = parseInt(t),
        !isset(g.npc[t]) || t != g.talk.dialogCloud)
            return;
        e = [32 * g.npc[t].y - g.npc[t].fh + 16, 32 * g.npc[t].x + g.npc[t].fw / 2 - 8]
    }
    $(".dialogCloud").remove(),
    $(document.createElement("div")).css({
        width: 16,
        height: 16,
        background: "url(" + CFG.epath + "npctalk.gif)",
        position: "absolute",
        top: e[0],
        left: e[1],
        zIndex: 222
    }).addClass("dialogCloud").appendTo("#base")
}
function initiateNpcInsideDialog(t) {
    var e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
      , a = !(arguments.length > 2 && void 0 !== arguments[2]) || arguments[2];
    a && map.center(32 * g.npc[t].x, 32 * g.npc[t].y, isset(e) && e),
    g.talk.name = g.npc[t].nick,
    $("#dlgin h4 b").html(parseBasicBB(g.talk.name, !1)),
    g.talk.id = t
}
function cfgupdate() {
    for (var t = 1; t <= 27; t++)
        hero.opt2 & 1 << t - 1 ? $("#config [opt=" + t + "]").addClass("active") : $("#config [opt=" + t + "]").removeClass("active")
}
function getStateLocalOptFromStorage(t) {
    var e = margoStorage.get("silocalopt/" + t + "/status");
    return null == e ? (margoStorage.set("silocalopt/" + t + "/status", !1),
    !1) : e
}
function clan_click() {
    hero.clan ? _g("clan&a=myclan") : _g("clan&a=list&page=1")
}
function config_show() {
    for (var t in hero.opt2 = hero.opt,
    hero.localOption2 = {},
    hero.localOption)
        hero.localOption2[t] = hero.localOption[t];
    cfgupdate(),
    $("#config").absCenter().fadeIn(),
    g.lock.add("config")
}
function getStatusOfLocalOpt() {
    hero.localOption = {},
    $(".local-opt").each((function() {
        var t = $(this).attr("opt");
        hero.localOption[t] = getStateLocalOptFromStorage(t)
    }
    ))
}
function serveroptclick(t) {
    x = $(t.target).attr("opt"),
    hero.opt2 ^= 1 << x - 1,
    cfgupdate()
}
function changeClient() {
    var t = new Date;
    t.setTime(t.getTime() + 2592e6),
    setCookie("interface", "ni", t, "/", "margonem.pl"),
    window.location.reload()
}
function get_config_opt(t) {
    return hero.opt & 1 << t - 1
}
function config_save() {
    _g("config&opt=" + hero.opt2),
    hero.opt = hero.opt2,
    $("#config").fadeOut(),
    g.lock.remove("config"),
    $.fx.off = 128 & hero.opt,
    4096 & hero.opt ? $(".itemHighlighter").addClass("nodisp") : $(".itemHighlighter").removeClass("nodisp");
    hero.localOption[15];
    for (var t in hero.localOption = {},
    hero.localOption2) {
        var e = hero.localOption2[t];
        hero.localOption[t] = e,
        margoStorage.set("silocalopt/" + t + "/status", e)
    }
    g.nightController.rebuiltAfterSettingsSave()
}
function config_cancel() {
    $("#config").fadeOut(),
    g.lock.remove("config")
}
function logout_logoff(t) {
    if (t > 0) {
        g.logoff.time = t;
        var e = setInterval((function() {
            var a = $("#logout_logoff_time_left")
              , i = 1 === a.length;
            --t,
            i && t >= 0 ? a.text(t) : clearInterval(e)
        }
        ), 1e3)
          , a = _t("logout-time %val%", {
            "%val%": '<span id="logout_logoff_time_left">'.concat(t, "</span>")
        }, "logoff");
        mAlert(a, 1, [function() {
            location.href = "http://" + location.href.split(".").splice(-2).join("."),
            clearInterval(e)
        }
        , function() {
            _g("logoff&a=stop"),
            clearInterval(e)
        }
        ])
    } else
        g.logoff.start = null,
        g.logoff.time = null
}
function logout(t) {
    if ("pl" != _l())
        return location.href = "http://margonem.com";
    if (isset(hero.preview_acc) && 1 == hero.preview_acc && !isset(t)) {
        var e = "<div>" + _t("logout_tmpacc") + "</div>";
        return mAlert(e, 2, [function() {
            logout(!0)
        }
        ])
    }
    null !== g.logoff.start || g.battle || _g("logoff&a=start", (function(t) {
        isset(t.alert) || (g.logoff.start = unix_time())
    }
    ))
}
function showHelp() {
    showDialog(("en" == _l() ? "en/" : "") + "help-title.png", $("#h_help").html()),
    $("#h_help_scrolled_scroll").length || addScrollbar("h_help_scrolled", 380, "h_help_scrolled_scroll", !1)
}
function showNews() {
    g.news || _g("promotions&a=show")
}
function partyToggle() {
    var t = $("#party").position();
    parseInt(t.top) < 0 ? $("#party").animate({
        top: 0
    }, "slow") : $("#party").animate({
        top: -$("#party").height()
    }, "slow")
}
function clearWeather() {
    clearUpdateEveryGameUpdate(),
    $(".weather-moving-thing").remove(),
    $(".weatherwrapper").remove()
}
function elementIsObject(t) {
    return "object" === _typeof(t)
}
function checkFilterDataCorrect(t) {
    return elementIsObject(t) ? !!isset(t.remove) || (t.color ? isset(t.color.r) && isset(t.color.g) && isset(t.color.b) && isset(t.color.a) ? !!isset(t.color.g) && (!!isset(t.color.b) && (!!isset(t.color.a) && (isInt(t.color.r) && isInt(t.color.g) && isInt(t.color.b) ? !!isFloatVal(t.color.a) || (console.error("WeatherManager.js", "checkFilterDataCorrect", "attr color.a must be double val!", t),
    !1) : (console.error("WeatherManager.js", "checkFilterDataCorrect", "attr color.r or color.g or color.b must be integer!", t),
    !1)))) : (console.error("WeatherManager.js", "checkFilterDataCorrect", "attr color.r or color.g or color.b or color.a not exist!", t),
    !1) : (console.error("WeatherManager.js", "checkFilterDataCorrect", "attr color not exist!", t),
    !1)) : (console.error("WeatherManager.js", "checkFilterDataCorrect", "mapFilter must be object!", t),
    !1)
}
function setMapFilter(t) {
    if (checkFilterDataCorrect(t) && ($(".mapfilterwrapper").remove(),
    !isset(t.remove))) {
        var e = $("#ground").width()
          , a = $("#ground").height()
          , i = $('<div class="mapfilterwrapper"></div>');
        i.css({
            width: e,
            height: a,
            background: "rgba(".concat(t.color.r, ",").concat(t.color.g, ",").concat(t.color.b, ",").concat(t.color.a, ")"),
            zIndex: getLayerOrder(map.y, 10)
        }),
        $("#base").append(i)
    }
}
function changeWeather(t) {
    var e = t.toLowerCase();
    if (isMoveObjectsWeather(e))
        return showFished(!1, e);
    var a = $("<div>").addClass("weatherwrapper weather-".concat(e))
      , i = $("#ground");
    a.css({
        width: i.width(),
        height: i.height(),
        backgroundImage: "url(".concat(CFG.fpath, "/weather/weather_").concat(e, ".gif)"),
        zIndex: getLayerOrder(map.y, 10)
    }),
    $("#base").append(a)
}
function isMoveObjectsWeather(t) {
    return ["fish", "bat", "halloweenbat", "light", "latern"].includes(t)
}
function removeWeather(t) {
    var e = t.toLowerCase();
    isMoveObjectsWeather(e) && removeFromUpdateEveryGameUpdate(e),
    $("#base").find(".weather-".concat(e)).remove()
}
function weatherMovingThing(t, e, a) {
    var i = this;
    return this.onRemove = null,
    this.container = null,
    this.pos = {
        top: 0,
        left: 0
    },
    this.addPos = {
        top: 0,
        left: 0
    },
    a *= 1 + Math.random() / 12,
    this.moveVector = {
        x: e[0] * a,
        y: e[1] * a
    },
    this.last = null,
    this.$ = $("<div>").addClass("weather-moving-thing"),
    t && this.$.addClass(t),
    this.borderDest = function(t, e, a, i) {
        return t > 0 ? a + i : t < 0 ? -i : e
    }
    ,
    this.update = function(t) {
        var e = (t - i.last) / 10;
        i.pos.left += i.moveVector.x * e,
        i.pos.top += i.moveVector.y * e,
        i.last = t,
        i.$.css(i.pos),
        this.test() && i.remove()
    }
    ,
    this.test = function() {
        var t = i.$.position()
          , e = this.addPos.top - i.$.height() - 20
          , a = this.addPos.left - i.$.width()
          , n = i.container.width() - this.addPos.left + i.$.width()
          , o = i.container.height() - this.addPos.top + i.$.height();
        return t.top < e || t.left < a || t.left > n || t.top > o
    }
    ,
    this.remove = function() {
        i.onRemove && i.onRemove(),
        i.$.remove()
    }
    ,
    this.appendTo = function(t) {
        i.last = Date.now(),
        i.$.hide(),
        t.append(i.$),
        i.container = t
    }
    ,
    this.setPos = function(t, e) {
        this.pos.top = e,
        this.pos.left = t,
        i.$.show(),
        i.$.css(this.pos)
    }
    ,
    this
}
function showFished(t, e) {
    var a = $("#base");
    function i(t, a, i, n) {
        return this.left = i,
        this.right = n,
        this.vec = t,
        this.clone = function(i) {
            return new weatherMovingThing("weather-" + e + " weather-" + e + "-" + i,t,a)
        }
        ,
        this
    }
    var n = {
        lampion0: {
            type: new i([-.9, -.43],.5,[0, 0],[0, 0]),
            ids: [0],
            nokey: !0
        },
        lampion1: {
            type: new i([.9, .43],.5,[0, 0],[0, 0]),
            ids: [1],
            nokey: !0
        },
        lampion2: {
            type: new i([-.9, -.43],.5,[0, 0],[0, 0]),
            ids: [2],
            nokey: !0
        },
        lampion3: {
            type: new i([.9, .43],.5,[0, 0],[0, 0]),
            ids: [3],
            nokey: !0
        },
        lampion4: {
            type: new i([-.9, -.43],.5,[0, 0],[0, 0]),
            ids: [4],
            nokey: !0
        }
    }
      , o = {
        light: {
            type: new i([-.9, -.43],.5,[0, 0],[0, 0]),
            ids: [0],
            nokey: !0
        },
        light1: {
            type: new i([.9, -.43],.8,[0, 0],[0, 0]),
            ids: [3],
            nokey: !0
        },
        lightconstant: {
            type: new i([-.9, -.43],.4,[0, 0],[0, 0]),
            ids: [1],
            nokey: !0
        },
        lightconstant1: {
            type: new i([.9, -.43],.6,[0, 0],[0, 0]),
            ids: [4],
            nokey: !0
        }
    }
      , s = {
        bat: {
            type: new i([-.9, -.43],1,[0, 0],[0, 0]),
            ids: [0],
            nokey: !0
        },
        bat1: {
            type: new i([.9, -.43],.8,[0, 0],[0, 0]),
            ids: [3],
            nokey: !0
        },
        batupdown: {
            type: new i([-.1, .43],.8,[0, 0],[0, 0]),
            ids: [10],
            nokey: !0
        }
    }
      , l = {
        bat: {
            type: new i([-.9, -.43],1,[0, 0],[0, 0]),
            ids: [0],
            nokey: !0
        },
        bat1: {
            type: new i([.9, -.43],.8,[0, 0],[0, 0]),
            ids: [3],
            nokey: !0
        },
        batpump: {
            type: new i([-.9, -.43],1.3,[0, 0],[0, 0]),
            ids: [1],
            nokey: !0
        },
        batpump1: {
            type: new i([.9, -.43],1.3,[0, 0],[0, 0]),
            ids: [4],
            nokey: !0
        },
        batskull: {
            type: new i([-.9, -.43],1.2,[0, 0],[0, 0]),
            ids: [2],
            nokey: !0
        },
        batskull1: {
            type: new i([.9, -.43],1.2,[0, 0],[0, 0]),
            ids: [5],
            nokey: !0
        },
        batpumpupdown: {
            type: new i([.1, .43],.8,[0, 0],[0, 0]),
            ids: [6],
            nokey: !0
        },
        batpumpupdown1: {
            type: new i([.2, -.6],1.1,[0, 0],[0, 0]),
            ids: [7],
            nokey: !0
        },
        batskullupdown: {
            type: new i([-.2, .8],1.2,[0, 0],[0, 0]),
            ids: [8],
            nokey: !0
        },
        batskullupdown1: {
            type: new i([-.1, -.73],.8,[0, 0],[0, 0]),
            ids: [9],
            nokey: !0
        },
        batupdown: {
            type: new i([-.1, .43],.8,[0, 0],[0, 0]),
            ids: [10],
            nokey: !0
        },
        batupdown1: {
            type: new i([.1, -.6],1,[0, 0],[0, 0]),
            ids: [11],
            nokey: !0
        }
    }
      , r = {
        kalamarnica: {
            type: new i([-.9, -.43],.5,[40, 6],[-16, 30]),
            ids: [0, 1, 2],
            nokey: !1
        },
        kalamarnical: {
            type: new i([.9, -.43],.5,[-40, 6],[16, 30]),
            ids: [3, 4, 5],
            nokey: !1
        },
        krewetka: {
            type: new i([-1, 0],.25,[16, 16],[16, -16]),
            ids: [6],
            nokey: !1
        },
        krewetkal: {
            type: new i([1, 0],.25,[-16, 16],[-16, -16]),
            ids: [7],
            nokey: !1
        },
        meduza: {
            type: new i([0, -1],.05,[32, 32],[-32, 32]),
            ids: [8, 9, 10],
            nokey: !0
        },
        rekin: {
            type: new i([1, .1736],1,[-30, -24],[-30, 24]),
            ids: [11, 12],
            nokey: !0
        },
        rekinl: {
            type: new i([-1, .1736],1,[30, -24],[30, 24]),
            ids: [13, 14],
            nokey: !0
        },
        rybka: {
            type: new i([-.985, -.174],.75,[24, -24],[24, 24]),
            ids: [15, 16, 17],
            nokey: !1
        },
        rybkal: {
            type: new i([.985, -.174],.75,[-24, -24],[-24, 24]),
            ids: [18, 19, 20],
            nokey: !1
        },
        wegorz: {
            type: new i([-.869, -.233],.5,[20, -22],[24, 24]),
            ids: [21, 22],
            nokey: !1
        },
        wegorzl: {
            type: new i([.869, -.233],.5,[-20, -22],[-24, 24]),
            ids: [23, 24],
            nokey: !1
        },
        "big-wegorz": {
            type: new i([.934, .358],.5,[32, -10],[-24, -18]),
            ids: [25, 26],
            nokey: !0
        },
        "big-wegorzl": {
            type: new i([-.934, .358],.5,[-32, -10],[24, -18]),
            ids: [27, 28],
            nokey: !0
        }
    };
    function c(t) {
        var e = t.length - 1;
        return t[Math.round(Math.random() * e)]
    }
    var d = [];
    function p(t, e, a, i) {
        var n = c(t.ids)
          , o = t.type.clone(n);
        o.appendTo(i);
        var s, l, r, d, p, h, g, u = (s = t.type,
        l = i,
        r = o.$,
        d = {
            x: l.scrollLeft(),
            y: l.scrollTop()
        },
        p = {
            y: 0,
            x: 1
        },
        h = !1,
        g = !1,
        s.vec[0] < 0 ? p.x = 1 : s.vec[0] > 0 ? (p.x = 0,
        d.x -= r.width()) : (p.x = 0,
        d.x -= r.width(),
        g = !0),
        s.vec[1] < 0 ? p.y = 1 : s.vec[1] > 0 ? (p.y = .1,
        d.y -= r.height()) : (p.y = 0,
        d.y -= r.height(),
        h = !0),
        h || g ? h ? p.y = Math.random() : g && (p.x = Math.random()) : Math.random() > .5 ? p.y = Math.random() : p.x = Math.random(),
        d.x += p.x * l.width(),
        d.y += p.y * l.height() - 20,
        d);
        return o.addPos.top = o.moveVector.y * e * o.$.height(),
        o.addPos.left = o.moveVector.x * e * o.$.width(),
        u.x -= o.addPos.left,
        u.y -= o.addPos.top,
        o.setPos(u.x, u.y),
        o
    }
    function h(t, e, a, i, n) {
        var o = c(e.ids)
          , s = e.type.clone(o)
          , l = (e.type.left,
        e.type.right,
        a.pos.left)
          , r = a.pos.top
          , d = t;
        1 & d ? (d += 1,
        d /= 2,
        l += e.type.left[0] * d,
        r += e.type.left[1] * d) : (d /= 2,
        l += e.type.right[0] * d,
        r += e.type.right[1] * d);
        var p = s.test;
        return s.test = function() {
            return !a.leaderAlive && p.apply(this, arguments)
        }
        ,
        s.onRemove = function() {
            var t = i.indexOf(s);
            -1 != t && i.splice(t, 1)
        }
        ,
        s.appendTo(n),
        s.setPos(l, r),
        s
    }
    var g = [];
    function u() {
        var t = function(t) {
            switch (t) {
            case "bat":
                return s;
            case "halloweenbat":
                return l;
            case "fish":
                return r;
            case "light":
                return o;
            case "latern":
                return n
            }
        }(e)
          , i = function(t) {
            var e = [];
            for (var a in t)
                e.push(a);
            var i = e.length - 1;
            return t[e[Math.round(Math.random() * i)]]
        }(t)
          , c = Math.round(4 * Math.random());
        i.nokey && (c = 1);
        var d = 2 * c - 1
          , u = p(i, c, 0, a);
        g.push(u),
        u.leaderAlive = !0,
        u.onRemove = function() {
            var t = g.indexOf(u);
            this.leaderAlive = !1,
            -1 != t && g.splice(t, 1)
        }
        ;
        for (var m = 1; m < d; m++) {
            var f = h(m, i, u, g, a);
            g.push(f)
        }
    }
    var m = 5
      , f = 80;
    addToUpdateEveryGameUpdate((function() {
        if (f >= 80) {
            for (; g.length < 5; )
                u();
            f = 0
        }
        m >= 5 && "fish" == e && (d.length < 75 && function() {
            var t = new weatherMovingThing("weather-bubble weather-bubble-" + (1 + Math.round(9 * Math.random())),[0, -1],.5)
              , e = $("#base").scrollLeft() + Math.round(Math.random() * $("#base").width())
              , i = $("#base").scrollTop() + $("#base").height();
            t.appendTo(a),
            t.setPos(e, i),
            d.push(t),
            t.onRemove = function() {
                var t = d.indexOf(this);
                -1 != t && d.splice(t, 1)
            }
        }(),
        m = 0),
        m++,
        f++;
        var t = Date.now();
        for (var i in g)
            g[i].update(t);
        if ("bat" != e && "halloweenbat" != e && "light" != e && "latern" != e)
            for (var i in d)
                d[i].update(t)
    }
    ), e)
}
function newClanList() {
    _g("clan&a=list&page=1"),
    g.clanController && g.clanController.resetLastValClanList(),
    g.clan.fn = newClanList
}
function clanRecruit() {
    g.clanController.updateRecruit(),
    g.clan.fn = clanRecruit
}
function clanPriv() {
    var t = "";
    t += g.clan.logoimg + t + parseClanBB(g.clan.info),
    32 & g.clan.myrank && (t += "<br><br><button onclick=clEditPriv()>" + _t("clan_edit_privpage", null, "clan") + "</button>");
    var e = $('<div class="clan-priv-page">'.concat(t, "</div>"));
    setLogoInClan(e),
    $("#clanbox").html(e),
    g.clan.fn = clanPriv
}
function setLogoInClan(t, e) {
    var a = isset(e) ? e : g.clan.logo;
    if ("" != a)
        if (t.length)
            if (1 != t.length) {
                var i = t.find(".cl_logo");
                i.length ? i.empty().css("background-image", "url(" + a + ")") : t.each((function() {
                    $(this).hasClass("cl_logo") && $(this).empty().css("background-image", "url(" + a + ")")
                }
                ))
            } else
                t.find(".cl_logo").empty().css("background-image", "url(" + a + ")");
        else
            console.error(".cl_logo not exist!")
}
function clanOfficial() {
    _g("clan&a=getclan&id=" + g.clan.id),
    g.clan.fn = clanOfficial
}
function clChRank(t) {
    _g("clan&a=member&id=" + g.clan.m[t] + "&rank=" + $("#cl_chrank").val())
}
function clDismiss(t) {
    mAlert(_t("player_dismiss_confirm", {
        "%name%": g.clan.m[t + 1]
    }, "clan"), 1, [function() {
        _g("clan&a=member&dismiss=1&id=" + g.clan.m[t])
    }
    , function() {}
    ])
}
function clLeadership(t) {
    mAlert(_t("give_clan_leadership_confirm %name%", {
        "%name%": g.clan.m[t + 1]
    }, "clan"), 2, [function() {
        _g("clan&a=member&id=" + g.clan.m[t] + "&leader=1" + (parseInt($("#cl_payself").val()) ? "&pay=self" : ""))
    }
    , function() {}
    ])
}
function clGoldIn() {
    var t = parsePrice($("#cl_gold").val())
      , e = formNumberToNumbersGroup(t);
    mAlert(_t("gold_deposit_confirm %amount%", {
        "%amount%": e
    }, "clan"), 1, [function() {
        _g("clan&a=save&f=gold&v=" + t)
    }
    , function() {}
    ])
}
function clGoldOut() {
    var t = parsePrice($("#cl_gold").val() ? $("#cl_gold").val() : 0);
    mAlert(_t("gold_widthdraw %amount% %player%", {
        "%amount%": round(t, 10),
        "%player%": $("#cl_goldout option[value='" + $("#cl_goldout").val() + "']").text()
    }, "clan"), 1, [function() {
        _g("clan&a=save&f=gold&v=-" + parsePrice(t) + "&pid=" + $("#cl_goldout").val())
    }
    , function() {}
    ])
}
function clCreditsIn() {
    var t = $("#cl_credits").val();
    mAlert(_t("credits_in %amount%", {
        "%amount%": t
    }, "clan"), 1, [function() {
        _g("clan&a=save&f=credits&v=" + t)
    }
    , function() {}
    ])
}
function clanTreasury() {
    var t = []
      , e = 0;
    for (var a in g.clan.goldlog)
        if (e < 6 && ("gold" == g.clan.goldlog[a].kind || "credit" == g.clan.goldlog[a].kind)) {
            var i = g.clan.goldlog[a].txt.split("]");
            t[e] = i.slice(1).join("]"),
            e++
        }
    var n = g.clan.logoimg + "<div class=treasury><h2>" + _t("treasury_manage", null, "clan") + "</h2><table><tr><td>" + _t("gold_amount %amount%", {
        "%amount%": round(g.clan.gold, 10)
    }, "clan") + "<br>" + _t("gold_cl", null, "clan") + "<input id=cl_gold><button onclick=clGoldIn()>" + _t("put_gold", null, "clan") + "</button><br>";
    4 & g.clan.myrank && (n += "<select id=cl_goldout>" + g.clan.mlist + "</select><button onclick=clGoldOut()>" + _t("give_gold %amount%", {
        "%amount%": g.clan.credits
    }, "clan") + "</button><br>"),
    n += "<td>" + _t("slamount %amount%", {
        "%amount%": g.clan.credits
    }, "clan") + "<br>",
    1 & g.clan.bits ? n += _t("put_sl", null, "clan") + "<input id=cl_credits><button onclick=clCreditsIn()>" + _t("put_sl_in", null, "clan") + "</button><br>" + (1 & g.clan.myrank ? '<button onclick=_g("clan&a=credits&allow=0")>' + _t("put_sl_off", null, "clan") + "</button><br>" : "") : n += _t("put_sl_turnedoff") + "<br>" + (1 & g.clan.myrank ? '<button onclick=_g("clan&a=credits&allow=1")>' + _t("put_sl_on", null, "clan") + "</button><br>" : ""),
    n += "</table>",
    2 & g.clan.bits ? n += _t("outfit_available", null, "clan") + '<button onclick=_g("clan&a=wear")>' + _t("use_outfit", null, "clan") + "</button><br>" : n += _t("outfit_notavailable", null, "clan") + "<br>";
    g.clan.bits;
    n += '<div style="background-color:beige;border:1px solid #000;position:absolute;padding:3px;display:none" id="depoUpgradeConfirmBox">' + _t("upg_cost %gold% %sl%", {
        "%gold%": round(g.clan.upg_gold, 10),
        "%sl%": g.clan.upg_cr ? "+" + g.clan.upg_cr + _t("sl", null, "clan") : ""
    }) + '<br /><button tip="' + _t("click_to_upg", null, "clan") + '" onclick="_g(\'clan&a=upgrade\'); return false;">' + _t("upg_confirm", null, "clan") + "</button></div></div></div>";
    var o = $(n + t.join("<br>") + "</div>");
    setLogoInClan(o),
    $("#clanbox").html(o),
    g.clan.fn = clanTreasury
}
function clInvite() {
    _g("clan&a=invite&n=" + $("#cl_invite").val())
}
function clDrop() {
    _g("clan&a=member&dismiss=1&id=" + $("#cl_drop").val())
}
function clRename() {
    _g("clan&a=save&f=name&v=" + esc($("#cl_name").val()) + (parseInt($("#cl_payself").val()) ? "&pay=self" : ""))
}
function clDisband() {
    g.clan.gold > 0 ? mAlert(_t("disband_gold_info", null, "clan"), 1, [function() {
        _g("clan&a=disband&agree=" + $("#cl_disband").val())
    }
    , function() {}
    ]) : _g("clan&a=disband&agree=" + $("#cl_disband").val())
}
function clLeave() {
    _g("clan&a=leave&agree=" + $("#cl_leave").val(), (function(t) {
        isset(t.msg) && ($(".clan").css("display", "none"),
        $("#clanmenu>.boxhover>li.to-disable").addClass("disabled"),
        delete hero.clan,
        g.clan = 0)
    }
    ))
}
function clSaveLogo() {
    var t = $("#cl_logo").val();
    "" !== t ? _g("clan&a=save&f=logo&v=" + t) : mAlert(_t("https_alert", null, "clan"))
}
function checkHttps(t) {
    return /^(https)/.test(t)
}
function htmlRank(t, e, a) {
    return "<b><label for=cl_rank" + a + ">" + t + ":</label> <input id=cl_rank" + a + (g.clan.ranks[e].r & a ? " checked" : "") + " type=checkbox></b>"
}
function printRankSelect(t, e, a) {
    for (var i = "", n = 0; n <= t; n++)
        i += "<option " + (n == e ? 'selected="selected"' : "") + ' value="' + n + '">' + n + (isset(a) && 0 == n ? " " + a : "") + "</option>";
    return i
}
function clRankSave(t) {
    for (var e = 0, a = $("#cl_rankid").val(), i = 1; i < 12; i++)
        if (i < 9)
            "on" == $("#cl_rank" + Math.pow(2, i) + ":checked").val() && (e += Math.pow(2, i));
        else {
            switch (i) {
            case 9:
                e += $("#dt").val() << 9;
                break;
            case 10:
                e += $("#du").val() << 12;
                break;
            case 11:
                e += $("#dl").val() << 15
            }
        }
    _g("clan&a=rank&a2=edit&rid=" + t + "&name=" + esc($("#cl_rankname").val()) + "&r=" + e + (isset(a) && t != a ? "&nrid=" + a : ""))
}
function clRankDel(t) {
    mAlert(_t("confirm_rank_delete", null, "clan"), 1, [function() {
        _g("clan&a=rank&a2=del&rid=" + t)
    }
    , function() {}
    ])
}
function clRankEdit(t) {
    var e = g.clan.logoimg + '<div style="margin:10px; line-height:130%"><h2>' + _t("edit_rank %name%", {
        "%name%": g.clan.ranks[t].name
    }, "clan") + "</h2><br><center>";
    t < 100 && (e += "<div class=rankedit>" + htmlRank(_t("rank_rEdit", null, "clan"), t, 2) + htmlRank(_t("rank_treasury", null, "clan"), t, 4) + htmlRank(_t("rank_inviting", null, "clan"), t, 8) + htmlRank(_t("rank_dismiss", null, "clan"), t, 16) + htmlRank(_t("rank_privatepage", null, "clan"), t, 32) + htmlRank(_t("rank_officialpage", null, "clan"), t, 64) + htmlRank(_t("rank_diplomate", null, "clan"), t, 128) + htmlRank(_t("rank_outfit", null, "clan"), t, 256) + '<b><label tip="' + _t("rank_tabs_view_tip", null, "clan") + '" for="dt">' + _t("rank_tabs_view", null, "clan") + "</label><select onchange=\"if($(this).val()<$('#du').val()){$(this).val($('#du').val());mAlert('" + _t("rank_tabs_view_info", null, "clan") + '\')}"class=txt id="dt">' + printRankSelect(5, (3584 & g.clan.ranks[t].r) >> 9, _t("tabs_view no_access", null, "clan")) + '</select></b><b><label tip="' + _t("rank_tabs_usage_tip", null, "clan") + '" for="du">' + _t("rank_tabs_usage", null, "clan") + "</label><select onchange=\"if($('#dt').val()<$(this).val())$('#dt').val($(this).val())\" class=txt id=\"du\">" + printRankSelect(5, (28672 & g.clan.ranks[t].r) >> 12, _t("tabs_view no_usage", null, "clan")) + '</select></b><b><label tip="' + _t("rank_tabs_itemlimit_tip", null, "clan") + '" for="dl">' + _t("rank_tabs_itemlimit", null, "clan") + '</label><select class=txt id="dl">' + printRankSelect(3, (98304 & g.clan.ranks[t].r) >> 15, _t("tabs_view no_limit", null, "clan")) + "</select></b></div>"),
    e += "<b>" + _t("rank_name", null, "clan") + '</b><input id="cl_rankname" value="' + g.clan.ranks[t].name + '"><br>',
    t && t < 100 && (e += '<b>ID rangi (1-99):</b><input id="cl_rankid" value="' + t + '" size=2><br>'),
    e += "<br><big>" + (100 != t ? '<button onclick="clRankDel(' + t + ')">' + _t("rank_del", null, "clan") + "</button>" : "") + '<button onclick="g.clan.fn()">' + _t("rank_cancel", null, "clan") + "</button> <button onclick=clRankSave(" + t + ")>" + _t("rank_save", null, "clan") + "</button></big></center>";
    var a = $(e + "</div>");
    setLogoInClan(a),
    $("#clanbox").html(a),
    $("#cl_rankid").mask("00")
}
function clAddNewRank() {
    _g("clan&a=rank&a2=add&rid=" + $("#cl_newr_id").val() + "&name=" + esc($("#cl_newr_name").val()) + "&r=0")
}
function clanManage() {
    var t = g.clan.logoimg + '<div style="margin:10px; line-height:1.5"><h2>' + _t("clan_manage_header", null, "clan") + "</h2>";
    1 & g.clan.myrank ? t += _t("clan_name_change", null, "clan") + "<input id=cl_name><select id=cl_payself><option value=0>" + _t("clan_sl", null, "clan") + "</option><option value=1>" + _t("private_sl", null, "clan") + "</option></select><button onclick=clRename()>" + _t("cl_name_save", null, "clan") + "</button><br>" + _t("logo_url", null, "clan") + '<input id=cl_logo style="width:260px" value="' + htmlspecialchars(g.clan.logo) + '"><button onclick=clSaveLogo()>' + _t("logo_save", null, "clan") + "</button>" + _t("ok_to_confirm", null, "clan") + "<input size=2 id=cl_disband><button onclick=clDisband()>" + _t("clan_resolve", null, "clan") + "</button> " : t += _t("ok_to_confirm", null, "clan") + "<input size=2 id=cl_leave><button onclick=clLeave()>" + _t("clan_leave", null, "clan") + "</button> ",
    96 & g.clan.myrank && (t += "<br>"),
    t += "<table class='members rankstable'><tr><th>ID<th>" + _t("rank_th", null, "clan") + "<th tip='" + _t("creator_th", null, "clan") + "'><div class=\"clr_ico founder\"></div><th tip='" + _t("rEdit_th", null, "clan") + "'><div class=\"clr_ico rank_edit\"></div><th tip='" + _t("gold_th", null, "clan") + "'><div class=\"clr_ico treasury_ico\"></div><th tip='" + _t("invit_th", null, "clan") + "'><div class=\"clr_ico g_invite\"></div><th tip='" + _t("dismiss_th", null, "clan") + "'><div class=\"clr_ico g_expel\"></div><th tip='" + _t("privedit_th", null, "clan") + "'><div class=\"clr_ico private_edit\"></div><th tip='" + _t("mainedit_th", null, "clan") + "'><div class=\"clr_ico official_edit\"></div><th tip='" + _t("diplom_th", null, "clan") + "'><div class=\"clr_ico diplomat\"></div><th tip='" + _t("outUse_th", null, "clan") + "'><div class=\"clr_ico g_outfit\"></div><th tip='" + _t("tabview_th", null, "clan") + "'><div class=\"clr_ico depo_tabs_view\"></div><th tip='" + _t("tabuse_th", null, "clan") + "'><div class=\"clr_ico depo_tabs_access\"></div><th tip='" + _t("tablimit_th", null, "clan") + '\'><div class="clr_ico depo_tabs_withdraw"></div>';
    var e = 1 & g.clan.myrank;
    e && (t += "<th width=50>");
    var a = "";
    for (var i in g.clan.ranks) {
        for (var n = "<tr class=cen><td width=30>" + i + "<td class=left>" + g.clan.ranks[i].name, o = 0; o < 12; o++)
            if (o < 9)
                n += "<td>" + (g.clan.ranks[i].r & Math.pow(2, o) ? "â" : "-");
            else {
                var s = 0;
                switch (o) {
                case 9:
                    s = (3584 & g.clan.ranks[i].r) >> 9;
                    break;
                case 10:
                    s = (28672 & g.clan.ranks[i].r) >> 12;
                    break;
                case 11:
                    s = (98304 & g.clan.ranks[i].r) >> 15
                }
                n += "<td>" + (s || "-")
            }
        e && (n += "<td><button onclick=clRankEdit(" + i + ")>" + _t("redit_td", null, "clan") + "</button>"),
        a = n + a
    }
    t += a,
    e && (t += "<tr><td><input size=2 id=cl_newr_id><td><input id=cl_newr_name><td colspan=13><button onclick=clAddNewRank()>" + _t("add_new_rank", null, "clan") + "</button>"),
    t += "</table>";
    var l = $(t + "</div>");
    setLogoInClan(l),
    $("#clanbox").html(l),
    g.clan.fn = clanManage
}
function clSavePriv() {
    _g("clan&a=save&f=info", {
        v: $("#cl_priv").val()
    })
}
function clEditPriv() {
    $("#clanbox").html('<div style="margin:10px;"><h2>' + _t("private_page", null, "clan") + "</h2><center><textarea class=cl_edit id=cl_priv>" + escapeHTML(g.clan.info) + "</textarea><br><button onclick=clSavePriveteMain()>" + _t("privPage_save", null, "clan") + "</button><button onclick=g.clan.fn()>" + _t("privPage_cancel", null, "clan") + "</button></center></div>")
}
function clSavePriveteMain() {
    _g("clan&a=save&f=info", {
        v: $("#cl_priv").val()
    })
}
function clSaveOfficialMain() {
    _g("clan&a=save&f=official", {
        v: $("#cl_main").val()
    })
}
function clEditMain() {
    $("#clanbox").html('<div style="margin:10px;"><h2>' + _t("main_page", null, "clan") + "</h2><center><textarea class=cl_edit id=cl_main>" + escapeHTML(g.clan.official) + "</textarea><br><button onclick=clSaveOfficialMain()>" + _t("privPage_save") + "</button><button onclick=g.clan.fn()>" + _t("privPage_cancel", null, "clan") + "</button></center></div>")
}
function clDelFr(t) {
    mAlert(_t("cancel_alignment", null, "clan"), 2, [function() {
        _g("clan&a=dipl&id=" + t + "&op=cancel_a")
    }
    , function() {}
    ])
}
function clDelEn(t) {
    mAlert(_t("cancel_war", null, "clan"), 2, [function() {
        _g("clan&a=dipl&id=" + t + "&op=cancel_e")
    }
    , function() {}
    ])
}
function clNewFr() {
    _g("clan&a=dipl&name=" + esc($("#clan_fr").val()) + "&op=ally")
}
function clNewEn() {
    _g("clan&a=dipl&name=" + esc($("#clan_en").val()) + "&op=enemy")
}
function clanDiplomacy() {
    var t = g.clan.logoimg + "<h2>" + _t("clan_diplomacy_header %name%", {
        "%name%": escapeHTML(g.clan.name)
    }, "clan") + '</h2><div style="margin:10px;">'
      , e = 128 & g.clan.myrank;
    t += "<table class=members><tr><th>" + _t("friend_clans", null, "clan") + "<th width=50><th width=50><th width=50>" + _t("clan_power", null, "clan") + "<th width=50>" + _t("plrs_amount", null, "clan") + (e ? "<th width=25>" : "");
    for (var a = 0; a < g.clan.fr.length; a += 4)
        t += "<tr><td colspan=3>" + escapeHTML(g.clan.fr[a + 1]) + "<td>" + g.clan.fr[a + 2] + "<td>" + g.clan.fr[a + 3] + (e ? "<td><button onclick=clDelFr(" + g.clan.fr[a] + ') tip="' + _t("cl_del", null, "clan") + '">X</button>' : "");
    t += "<tr><td colspan=6>" + _t("new_alignment", null, "clan") + "<input id=clan_fr><button onclick=clNewFr()>" + _t("inviteClan", null, "clan") + "</button>",
    t += "<tr><th>" + _t("enemy_clans", null, "clan") + "<th>" + _t("clan_wins", null, "clan") + "<th>" + _t("clan_losts", null, "clan") + "<th>" + _t("clan_power", null, "clan") + "<th>" + _t("plrs_amount", null, "clan") + (e ? "<th>" : "");
    for (a = 0; a < g.clan.en.length; a += 6)
        t += "<tr><td>" + escapeHTML(g.clan.en[a + 3]) + "<td class=cen>" + g.clan.en[a + 1] + "<td class=cen>" + g.clan.en[a + 2] + "<td>" + g.clan.en[a + 4] + "<td>" + g.clan.en[a + 5] + (e ? "<td><button onclick=clDelEn(" + g.clan.en[a] + ') tip="' + _t("cl_del", null, "clan") + '">X</button>' : "");
    t += "<tr><td colspan=6>" + _t("new_enemy", null, "clan") + "<input id=clan_en><button onclick=clNewEn()>" + _t("addClan", null, "clan") + "</button>";
    var i = $(t + "</table></div>");
    setLogoInClan(i),
    $("#clanbox").html(i),
    g.clan.fn = clanDiplomacy
}
function clanHistory(t) {
    t = !(!isset(t) || !t);
    var e = []
      , a = new RegExp("depozyt zakÅ|z depozytu|do depozytu,","gi");
    for (var i in g.clan.goldlog)
        isset(g.clan.goldlog[i].txt) && (!t && !g.clan.goldlog[i].txt.match(a) || t) && (e[i] = '<div class="histRow">' + g.clan.goldlog[i].txt + "</div>");
    $("#clanbox").html("<div class=history><h2>" + _t("clan_ops_histry", null, "clan") + '</h2><div class="depohist_filter"><span class="' + (t ? "active" : "") + '" onclick="clanHistory(true)">' + _t("hist_filter_depo", null, "clan") + '</span><span class="' + (t ? "" : "active") + '" onclick="clanHistory(false)">' + _t("hist_filter_nodepo", null, "clan") + "</span></div>" + e.join("") + "</div>"),
    g.clan.fn = clanHistory
}
function loadMails(t) {
    var e = g.mails;
    g.mails || (g.mails = !0,
    $("#mails").fadeIn("fast"),
    g.lock.add("mails"));
    for (var a = [], i = !1, n = 0; n < t.length; n += 7) {
        var o = ""
          , s = "";
        t[n + 4] > 0 && (o = '<span class="mail_gold">' + _t("gold_att %amount%", {
            "%amount%": t[n + 4]
        }, "mails")),
        t[n + 5] > 0 && (o += " " + _t("sl_att %amount%", {
            "%amount%": t[n + 5]
        }, "mails")),
        t[n + 3] > 0 && (o += '<span class=mailitem id="mailatt' + t[n + 3] + '"></span>'),
        "" != o ? s = "<span class=mail_att><button onclick=\"oncePerRequest(this, 'mail&a=get&id=" + t[n] + '\')" class=get tip="' + _t("get_attachment", null, "mails") + '"></button><button onclick="oncePerRequest(this, \'mail&a=del&id=' + t[n] + '\')" class=getdel tip="' + _t("get_attachment_del", null, "mails") + '"></button></span><button onclick="oncePerRequest(this, \'mail&a=del&id=' + t[n] + '\')" class=del style="display:none" tip="' + _t("del_message", null, "mails") + '"></button>' : (o = _t("no_attach", null, "mails"),
        s = "<button onclick=\"oncePerRequest(this, 'mail&a=del&id=" + t[n] + '\')" class=del tip="' + _t("del_message", null, "mails") + '"></button>'),
        o = "<span class=mail_att>" + o + "<br></span>";
        var l = calculateDiff(unix_time(), t[n + 1])
          , r = ["Aukcjoner", "Auctioneer", "System", "Grabarz", "Baraki w Ithan", "Zajazd u Makiny", "Ratusz w Karka-han", "Karczma pod ZÅotÄ WywernÄ", "Karczma Umbara", "Karczma pod Fioletowym KrysztaÅem", "Karczma pod PosÄpnym Czerepem", "Siedziba ergassaj", "Alabastrowy Hotel", "Knajpa pod Czarnym Tulipanem", "Zajazd pod TÄczowym Å»ukiem", "Zajazd pod ZÅamanym Dukatem", "Kamienica Kandelia", "Arena GladiatorÃ³w", "Zajazd pod RÃ³Å¼Ä WiatrÃ³w", "Tawerna pod BosmaÅskim Biczem", "Kamienica Bursztynek", "ZbÃ³jnicka spiÅ¼arnia", "OberÅ¼a pod ZÅotym KÅosem", "Austeria Karibiego", "Kwatery u Morcera"]
          , c = r.indexOf(t[n + 2]) > -1 || /\*/.test(t[n + 2])
          , d = "<b class=mailnick onclick=mailReply(" + t[n] + ') tip="' + _t("from_tip", null, "mails") + '" rollover=30>' + t[n + 2] + "</b> "
          , p = t[n + 2].replace(/\*/g, "");
        c && (d = '<b tip="' + _t("npc_msg") + '"class="mailnick special">' + p + "</b> "),
        a.push("<div id=msg" + t[n] + " class=onemail" + (i ? ' style="background:url(img/mail-back2.jpg?v=' + _CLIENTVER + ')"' : "") + "><span class=mhead>&nbsp;" + _t("from", null, "mails") + d + _t("ago %ago%", {
            "%ago%": l
        }, "mails") + (checkFraud(t[n + 6]) && r.indexOf(t[n + 2]) < 0 ? '<span class="fraudInfo">' + _t("fraud_possible", null, "mails") + "</span>" : "") + '<small style="float:right">' + ut_fulltime(t[n + 1]) + '</small><hr clear=all style="color:#a87227; background:#a87227; height:1px; border:none"><span style="float:right; top:-5px; position:relative; right:5px">' + s + "</span>&nbsp;<b>" + _t("attachments", null, "mails") + "</b> " + o + '</span><span style="padding:4px">' + parseMailBB(t[n + 6].replace(/position\s*:\s*(fixed|absolute)/gi, "")) + "</span></div>"),
        i = !i
    }
    e ? $("#newmail").after(a.join("")) : ($("#inbox").html("<div class=newmsgout>" + (isset(hero.clan) && 64 & hero.clan.rank ? '<div class="clanmail_infobox">' + _t("clanmsg_info %clan_rcp_name%", {
        "%clan_rcp_name%": _t("clanmsg_rcp_name", null, "mails")
    }, "mails") + "</div>" : "") + "<button onclick=newMail() class=newmsg></button><span class=neml>" + _t("to", null, "mails") + '<input style="width:200px" id=mailto> <small style="font-size:85%">' + _t("send_cost", null, "mails") + "</small></span> <br clear=all><div id=newmail class=neml><textarea id=mailmsg></textarea><table><tr><td>" + _t("gold_attachment", null, "mails") + '<input style="width:60px" id=mailgold><td>' + _t("item_attachment", null, "mails") + "<td><span id=mailitem class=mailitem></span><td width=100>" + _t("chats_left", null, "mails") + "<b id=mailchars>0</b>/1000<td><button onclick=cancelMail() class=cancelmsg></button><td><button onclick=sendMail() class=sendmsg></button></table></div></div>" + a.join("") + "<br><br>"),
    $("#mailmsg").keyup((function() {
        $("#mailmsg").val().length > 1e3 && $("#mailmsg").val($("#mailmsg").val().substring(0, 1e3)),
        $("#mailchars").html($("#mailmsg").val().length)
    }
    )),
    $("#inbox .get, #inbox .getdel, #inbox .del").attr("rollover", 22),
    $("#inbox .reply").attr("rollover", 15))
}
function hideMails() {
    g.mails && (g.mails = !1,
    $("#mails").fadeOut("fast"),
    $(".clanmail_infobox").hide(),
    g.lock.remove("mails"))
}
function newMail() {
    clearMail(),
    $(".clanmail_infobox").show(),
    $("#inbox .neml").show()
}
function cancelMail() {
    $("#inbox .neml").hide()
}
function clearMail() {
    $("#inbox .neml").hide(),
    $("#inbox .neml INPUT, #inbox .neml TEXTAREA").val(""),
    $("#mailitem").empty()
}
function mailReply(t) {
    newMail(),
    $("#mailto").val($("#msg" + t + " B.mailnick").html()),
    $(".neml TEXTAREA").focus()
}
function mailAtt(t) {
    if (g.mails) {
        var e = $(t).attr("id").substr(4);
        $("#mailitem").empty(),
        $("#item" + e).clone().css({
            position: "relative",
            top: 0,
            left: 0
        }).attr({
            id: "att-item",
            iid: e
        }).appendTo("#mailitem").click((function(t) {
            $(this).remove()
        }
        ))
    }
}
function sendMail() {
    var t = esc($("#mailto").val())
      , e = esc($("#mailmsg").val())
      , a = parsePrice($("#mailgold").val())
      , i = $("#mailitem DIV").attr("iid");
    _g("mail&a=send&r=" + t + "&gold=" + a + "&iid=" + (i = null == i ? "" : i) + "&msg=" + e)
}
function mailDel(t) {
    $("#msg" + t).find("button").removeAttr("onclick"),
    $("#msg" + t).fadeOut("fast", (function() {
        $(this).remove()
    }
    ))
}
function mailDelAtt(t) {
    var e = t.id
      , a = t.gold
      , i = $("#msg" + e);
    0 == a ? (i.find(".mail_att").remove(),
    i.find(".del").show()) : (i.find(".mailitem").remove(),
    i.find(".mail_gold").html(_t("gold_att %amount%", {
        "%amount%": a
    }, "mails") + "<br>"))
}
function moveItemSafe(t, e) {
    if (isset(g.item[t]) && g.item[t].readyToAction) {
        g.item[t].readyToAction = !1,
        "" != e && (e = "&" + e);
        var a = checkItemHasStatToBlockHeroMove(t);
        a && g.lock.add("item_block_move"),
        _g("moveitem&id=" + t + e, (function(e) {
            if (a && g.lock.remove("item_block_move"),
            isset(g.item[t]) && (g.item[t].readyToAction = !0),
            !isset(e.alert)) {
                var i = new RegExp("animation");
                new RegExp("recipe");
                i.test(g.item[t].stat) && (g.chestAnimation = !0)
            }
        }
        ))
    }
}
function checkItemHasStatToBlockHeroMove(t) {
    var e = parseItemStat(g.item[t].stat);
    if (!e.hasOwnProperty("action"))
        return !1;
    var a = e.action;
    if (a.search("shop") > -1)
        return !0;
    switch (a) {
    case "deposit":
    case "mail":
    case "auction":
    case "clandeposit":
        return !0;
    default:
        return !1
    }
}
function oncePerRequest(t, e) {
    $(t).removeAttr("onclick").unbind("click");
    var a = !0;
    a && (a = !1,
    _g(e, (function() {
        a = !0
    }
    )))
}
function initRecipes(t) {}
function ah_item(t) {
    g.ah.even = !g.ah.even;
    var e = parseItemStat(g.item[t].stat)
      , a = g.item[t]
      , i = ""
      , n = "";
    isset(e.unique) && (i = "class=unique"),
    isset(e.heroic) && (i = "class=heroic"),
    isset(e.legendary) && (i = "class=legendary"),
    isset(e.artefact) && (i = "class=artefact"),
    isset(e.lvl) && (n = " (" + e.lvl + ")");
    var o = a.stat.match(/(amount|ammo)=([0-9]+)/)
      , s = "";
    o && parseInt(o[2]) > 0 && 10 != a.st && (s = '<small style="opacity:0.5">' + o[2] + "</small>"),
    $(document).on("click", ".ahitem #item" + t, (function(t) {
        if (isset(e.canpreview)) {
            var i = '_g("moveitem&st=2&tpl=' + a.tpl + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
            showMenu(t, [[_t("show", null, "item"), i, !0]])
        }
    }
    ));
    var l = createItem(a);
    return l.append(s),
    l.css("background-image", 'url("'.concat(CFG.ipath).concat(a.icon, '")')),
    "\n        <tr ".concat(g.ah.even ? "" : ' class="even"', '>\n            <td style="text-align:left">\n                <div class="ahitem">').concat(l[0].outerHTML, '</div>\n            </td>\n            <td style="text-align:left" ').concat(i, ">").concat(a.name).concat(n, "<td>\n    ")
}
function ah_time() {
    $(".ah_time").each((function() {
        var t = $(this)
          , e = parseInt(t.attr("timer"));
        if (e < 1)
            t.html(_t("auction_ended", null, "auction")).prev().html("-").prev().html("-");
        else {
            t.attr("timer", e - 1);
            var a = [Math.floor(e / 3600), Math.floor(e / 60) % 60, e % 60];
            e < 3600 ? t.html(a[1] + "m" + a[2] + "s") : t.html(a[0] + "h" + a[1] + "m")
        }
    }
    ))
}
function auctionsHide() {
    g.ah.timer && (clearInterval(g.ah.timer),
    g.ah.timer = 0),
    g.ah.opened = !1,
    $("#auctions").fadeOut(),
    g.lock.remove("auctions")
}
function ah_pr(t, e, a, i) {
    return 0 == t ? a : i ? '<b style="color:red">' + round(t, 3) + _t("sl") + "</b>" + e : round(t, 3) + e
}
function ah_sort_time(t) {
    var e = [];
    for (var a in t) {
        var i = t[a];
        i.id = a,
        e.push(i)
    }
    return e.sort((function(t, e) {
        return t.time - e.time
    }
    )),
    e
}
function auctionShow(t, e) {
    g.ah.opened = !0,
    g.lock.add("auctions");
    var a = !1;
    for (var i in t)
        if (!isset(g.item[i])) {
            a = !0;
            break
        }
    for (var i in e)
        if (!isset(g.item[i])) {
            a = !0;
            break
        }
    if (a)
        setTimeout((function() {
            auctionShow(t, e)
        }
        ), 100);
    else {
        $("#ahselect B").removeClass("selected"),
        $("#ahselect B:first").addClass("selected"),
        $("#ah_item, #ah_item-s").empty(),
        $("#ah_new, #ah_new-s, #ah_list").hide(),
        $("#ah_window").show(),
        $("#ah_new SMALL").html(_t("auction_cost %cost%", {
            "%cost%": Math.max(100, 10 * hero.lvl)
        }, "auction"));
        var n = [];
        for (var o in t = ah_sort_time(t)) {
            var s = t[o];
            isset(g.item[s.id]) ? n.push(ah_item_row_mod(s, 1)) : log("AuctionItem#" + s.id + " not found.", 1)
        }
        var l = [];
        for (var o in e = ah_sort_time(e)) {
            s = e[o];
            isset(g.item[s.id]) ? l.push(ah_item_row_mod(s, 2)) : log("AuctionItem#" + s.id + " not found.", 1)
        }
        $("#ah_mylist").html("<h5></h5><table><tr><th width=30>" + _t("item_th", null, "auction") + "</th><th>" + _t("name_th", null, "auction") + "</th><th>" + _t("price_th", null, "auction") + "</th><th>" + _t("price_buynow_th", null, "auction") + "</th><th width=50>" + _t("endat_th", null, "auction") + "</th><th>" + _t("offer_th", null, "auction") + n.join("") + "</th></tr></table><h5 class=bids></h5><table><tr><th width=30>" + _t("item_th", null, "auction") + "</th><th>" + _t("name_th", null, "auction") + "</th><th>" + _t("price_th", null, "auction") + "</th><th>" + _t("price_buynow_th", null, "auction") + "</th><th width=50>" + _t("endat_th", null, "auction") + l.join("") + "</th></tr></table>"),
        g.ah.timer || (g.ah.timer = setInterval(ah_time, 1e3)),
        $("#auctions").fadeIn()
    }
}
function ah_bid(t) {
    var e = Math.abs(parsePrice($("#bid" + t).val()));
    mAlert(_t("item_confirm_au %name% %val%", {
        "%name%": g.item[t].name,
        "%price%": round(e, 10)
    }, "auction"), 1, [function() {
        _g("ah&bid=" + t + "&price=" + e + "&cat=" + g.ah.cat + "&page=" + g.ah.page + "&filter=" + g.ah.filter.join("|"))
    }
    , function() {}
    ])
}
function ah_bid_credits(t) {
    mAlert(_t("item_confirm_au_sl %name% %val%", {
        "%name%": g.item[t].name,
        "%price%": round(parsePrice($("#bid" + t).val()), 3)
    }, "auction"), 1, [function() {
        _g("ah&bid=" + t + "&price=" + parsePrice($("#bid" + t).val()) + "&cat=" + g.ah.cat + "&page=" + g.ah.page + "&filter=" + g.ah.filter.join("|"))
    }
    , function() {}
    ])
}
function ah_bo_g(t, e) {
    mAlert(_t("item_confirm_buynow %name% %price%", {
        "%name%": g.item[t].name,
        "%price%": formNumberToNumbersGroup(e)
    }, "auction"), 1, [function() {
        _g("ah&bo=" + t + "&cat=" + g.ah.cat + "&page=" + g.ah.page + "&filter=" + g.ah.filter.join("|"))
    }
    , function() {}
    ])
}
function ah_bo_sl(t, e) {
    mAlert(_t("item_confirm_buynow_sl %name% %price%", {
        "%name%": g.item[t].name,
        "%price%": formNumberToNumbersGroup(e)
    }, "auction"), 1, [function() {
        _g("ah&bo=" + t + "&cat=" + g.ah.cat + "&page=" + g.ah.page + "&filter=" + g.ah.filter.join("|"))
    }
    , function() {}
    ])
}
function ah_bo_sl_g(t, e, a) {
    mAlert(_t("item_confirm_buynow_sl_gold %name% %price% %price2%", {
        "%name%": g.item[t].name,
        "%price%": formNumberToNumbersGroup(a),
        "%price2%": formNumberToNumbersGroup(e)
    }, "auction"), 1, [function() {
        _g("ah&bo=" + t + "&cat=" + g.ah.cat + "&page=" + g.ah.page + "&filter=" + g.ah.filter.join("|"))
    }
    , function() {}
    ])
}
function ah_checkbid(t, e, a) {
    a || (a = "bid");
    var i = $("#bid" + t);
    i.nextAll("button").attr("class", (parsePrice(i.val()) >= Math.round(1.1 * e) ? "" : "no") + a)
}
function ah_price_node(t, e, a, i) {
    var n = '<input value="' + ah_pr(e, "", "-") + '" style="width:50px" id=bid' + t;
    (a && (n += " onkeyup=ah_checkbid(" + t + "," + e + ',"' + i + '")'),
    n += "><br><button onclick=ah_" + i + "(" + t + ") class=",
    a) ? n += "no" + i + ' tip="' + _t("minimal_offer %val%", {
        "%val%": round(Math.round(1.1 * e), 10)
    }, "auction") + '"' : n += i;
    return n += "></button>"
}
function ah_recordHolder(t) {}
function ah_item_row_mod(t, e) {
    var a = "-"
      , i = "-"
      , n = 0;
    if (isset(t.bidder) && (n = t.bidder),
    null === e ? isset(t.bid_c) ? a = ah_price_node(t.id, t.bid_c, 0 != n, "bid_credits") : isset(t.bid_g) && (a = ah_price_node(t.id, t.bid_g, 0 != n, "bid")) : isset(t.bid_c) ? a = ah_pr(t.bid_c, "", "-") : isset(t.bid_g) && (a = ah_pr(t.bid_g, "", "-")),
    isset(t.bo_c) && isset(t.bo_g)) {
        var o = ah_pr(t.bo_g, "", "-");
        i = ah_pr(t.bo_c, "", "-", !0) + "<br>" + o,
        null === e && (i += '<br><button onclick="ah_bo_sl_g(' + t.id + ", " + t.bo_g + ", " + t.bo_c + ')" class=buyout></button>')
    } else
        isset(t.bo_c) ? (i = ah_pr(t.bo_c, "", "-", !0),
        null === e && (i += '<br><button onclick="ah_bo_sl(' + t.id + ", " + t.bo_c + ')" class=buyout></button>')) : isset(t.bo_g) && (i = ah_pr(t.bo_g, "", "-"),
        null === e && (i += '<br><button onclick="ah_bo_g(' + t.id + ", " + t.bo_g + ')" class=buyout></button>'));
    if (1 == e) {
        var s = _t("au_offer_yes");
        return 0 == n && (s = _t("au_offer_no") + '<br><button onclick=_g("ah&end=' + t.id + '") class=end></button>'),
        ah_item(t.id) + a + "<td>" + i + "</td><td class=ah_time timer=" + t.time + "></td><td>" + s + "</td>"
    }
    return ah_item(t.id) + a + "<td>" + i + "</td><td class=ah_time timer=" + t.time + "></td>"
}
function auctionBrowse(t, e) {
    var a = [];
    g.ah.page = e[0];
    var i = ah_sort_time(t);
    for (var n in i) {
        var o = i[n];
        if (isset(g.item[o.id])) {
            g.item[o.id];
            a.push(ah_item_row_mod(o, null))
        } else {
            var s = '<tr class="auction-record-id-' + o.id + ' "></tr>';
            a.push(s),
            g.ah.synchroItems[o.id] = o
        }
    }
    var l = "";
    e[1] > 1 && (e[0] > 1 && (l = "<button onclick=ah_page(" + (e[0] - 1) + ") class=prev></button> "),
    l += '<b style="color:#700">[' + e[0] + "/" + e[1] + "]</b>",
    e[0] < e[1] && (l += " <button onclick=ah_page(" + (e[0] + 1) + ") class=next></button>"),
    l = "<center>" + l + "</center>");
    var r = [_t("type_all", null, "auction"), _t("type_unique", null, "auction"), _t("type_heroic", null, "auction"), _t("type_legendary", null, "auction")];
    tprofs = {
        "*": _t("prof_all", null, "auction"),
        w: _t("prof_warrior", null, "auction"),
        p: _t("prof_paladin", null, "auction"),
        m: _t("prof_mage", null, "auction"),
        h: _t("prof_hunter", null, "auction"),
        b: _t("prof_bdancer", null, "auction"),
        t: _t("prof_tracker", null, "auction")
    };
    for (var c, d = g.ah.filter, p = "", h = 0; h < 4; h++)
        p += "<option value=" + h + (d[3] == h ? " selected" : "") + ">" + r[h];
    for (var u in tprofs)
        c += "<option value=" + u + (d[2] == u ? " selected" : "") + ">" + tprofs[u];
    $("#ah_list").html('<div id=ah_filter>Lvl:<input id=ah_lvl1 value="' + d[0] + '">-<input id=ah_lvl2 value="' + d[1] + '">' + _t("at_least", null, "auction") + "<select id=ah_type>" + p + "</select>" + _t("price_filter", null, "auction") + '<input id=ah_pr1 value="' + d[4] + '">-<input id=ah_pr2 value="' + d[5] + '"><br>' + _t("filter_prof", null, "auction") + "<select id=ah_prof>" + c + "</select>" + _t("filter_name", null, "auction") + '<input id=ah_search value="' + d[6] + '"><button onclick=ah_apply() rollover=285></button></div><div class=sep></div><table><tr><th width=30>' + _t("item_th", null, "auction") + "</th> <th>" + _t("name_th", null, "auction") + "</th> <th>" + _t("price_th", null, "auction") + "</th> <th>" + _t("price_buynow_th", null, "auction") + "</th><th width=50>" + _t("endat_th", null, "auction") + "</th></tr>" + a.join("") + "</table>" + l),
    $("#ah_window").hide(),
    $("#ah_list").show()
}
function ah_apply() {
    g.ah.filter = [$("#ah_lvl1").val(), $("#ah_lvl2").val(), $("#ah_prof").val(), $("#ah_type").val(), parsePrice($("#ah_pr1").val()), parsePrice($("#ah_pr2").val()), $("#ah_search").val()],
    _g("ah&cat=" + g.ah.cat + "&page=1&filter=" + ah_getFilterJoinStr())
}
function ah_getFilterJoinStr() {
    var t = JSON.parse(JSON.stringify(g.ah.filter));
    return t[6] = t[6] ? esc(t[6]) : "",
    t.join("|")
}
function ah_page(t) {
    _g("ah&cat=" + g.ah.cat + "&page=" + t + "&filter=" + g.ah.filter.join("|"))
}
function auctionSell(t) {
    if (!isset(g.ah.opened) || !g.ah.opened)
        return !1;
    var e = $(t).attr("id").substr(4);
    if (g.item[e].stat.indexOf("permbound") > -1)
        return mAlert(_t("sell_cannot_permbound"));
    if (g.item[e].stat.indexOf("noauction") > -1)
        return mAlert(_t("noauction_block", null, "auction"));
    var a = g.item[e].stat.indexOf("soulbound") > -1
      , i = parseItemStat(g.item[e].stat)
      , n = 0;
    if (a) {
        var o = i.lvl
          , s = i.lvl;
        if (o = Math.min(30, 10 + o / 10),
        s = Math.min(20, 10 + s / 10),
        isset(i.legendary) ? (o *= 3,
        n = Math.round(o)) : isset(i.heroic) ? (o *= 1.5,
        n = Math.round(o)) : isset(i.unique) ? (s *= 1.2,
        n = Math.round(s)) : n = Math.round(s),
        isNaN(n))
            return mAlert(_t("noauction_block", null, "auction"));
        n *= g.sl_multiplier[_l()],
        $("#au_unbind_price").text(isNaN(n) ? "---" : n)
    }
    $("#ah_item, #ah_item-s").empty(),
    toggleAuxGoldAuction(!0),
    $("#ah_time").val("48"),
    $("#item" + e).clone().css({
        position: "relative",
        top: 0,
        left: 0
    }).attr({
        id: "ah-item",
        iid: e
    }).appendTo("#ah_item" + (a ? "-s" : "")).click((function(t) {
        $(this).remove(),
        $("#ah_new, #ah_new-s").hide()
    }
    )),
    $("#ah_new" + (a ? "" : "-s")).hide(),
    $("#ah_new" + (a ? "-s" : "")).fadeIn(),
    isNaN(n) || (isset(i.legendary) || isset(i.heroic) ? $("#ah_new-s .special_gold").css("display", "block") : $("#ah_new-s .special_gold_info").css("display", "block"))
}
function ah_sellItem() {
    if ($("#ah-item").length) {
        var t = $("#ah-item").attr("iid")
          , e = parsePrice($("#ah_price").val().split(" ").join(""))
          , a = parsePrice($("#ah_bo").val().split(" ").join(""))
          , i = $("#ah_time").val();
        _g("ah&sell=".concat(t, "&price=").concat(e, "&bo=").concat(a, "&time=").concat(i))
    }
}
function ah_sellItemS() {
    if (g.item[$("#ah-item").attr("iid")].stat.search(/soulbound/) >= 0) {
        var t = getAuxGoldPrice();
        t ? _g("ah&sell=" + $("#ah-item").attr("iid") + "&price=" + t) : mAlert(_t("soulbound_sell_info", null, "auction"), 2, [function() {
            _g("ah&sell=" + $("#ah-item").attr("iid"))
        }
        ])
    } else
        _g("ah&sell=" + $("#ah-item").attr("iid"))
}
function getAuxGoldPrice() {
    return parsePrice($("#ah_price_special").val())
}
function toggleAuxGoldAuction(t) {
    $("#_t41").toggleClass("active"),
    isset(t) && ($("#_t41").removeClass("active"),
    $("#ah_price_special").val(""),
    $("#ah_new-s .special_gold").css("display", "none"),
    $("#ah_new-s .special_gold_info").css("display", "none")),
    $("#_t41").hasClass("active") ? ($("#ah_price_special_hidden").css("display", "inline-block"),
    $("#_t42").css("display", "block")) : ($("#ah_price_special_hidden").css("display", "none"),
    $("#_t42").css("display", "none"))
}
function ah_select(t, e) {
    $("#ahselect B").removeClass("selected"),
    g.ah.cat = t,
    0 == t ? (_g("ah"),
    $("#b_myah").css({
        backgroundPosition: "0 -38px"
    }).removeAttr("rollover")) : ($("#b_myah").css({
        backgroundPosition: "0 0px"
    }).attr("rollover", "19"),
    _g("ah&cat=" + t + "&page=1&filter=" + ah_getFilterJoinStr()),
    $(e).addClass("selected"))
}
function depoShow(t, e) {
    if (g.crafting.opened && g.crafting.close(),
    g.lock.add("depo"),
    $("#depo-buttons").hide(),
    g.depo.clan = !(!isset(e) || !e),
    g.depo.gold = t.gold,
    g.depo.expire = t.expire,
    g.depo.isDebtOverLimit = t.is_debt_over_limit,
    g.depo.nextExpiration = t.next_expiration,
    !g.depo.clan) {
        var a = new Date(1e3 * t.expire);
        g.depo.expireLock = a.getFullYear() >= 2038
    }
    g.depo.size = t.size,
    g.depo.msize = t.msize;
    var i = $("#depo .depo-pay");
    if (g.depo.clan) {
        if ($("#depo-back").append('<span class="clandeponame">' + _t("clan_depo", null, "depo") + "</span>"),
        g.depo.visibleTabs = (3584 & t.myrights) >> 9,
        g.depo.myrights = t.myrights,
        0 == g.depo.visibleTabs && !(1 & g.depo.myrights))
            return g.lock.remove("depo"),
            mAlert(_t("no_rights_to_see_cd", null, "depo"));
        $("#depo-back").addClass("clan_depo"),
        $("#depo-balance,#depo-gold,#depo-goldin,#depo-goldout,#depo-del,#depo-pays,#depo-payz,#depo-buttons").css("display", "none"),
        g.depo.size > 0 ? $("#depo-time").html("pl" == _l() ? "tak" : "yes").css("color", "#fffefe") : $("#depo-time").html("pl" == _l() ? "nie" : "no").css("color", "red"),
        $("#depo-txt-rent").html(_t("depo_available_info", null, "depo")),
        $("#depo-toggle").css("display", "none")
    } else {
        $("#depo-back").find(".clandeponame").remove(),
        $("#depo-back").removeClass("clan_depo"),
        $("#depo-balance, #depo-gold, #depo-goldin, #depo-goldout, #depo-del, #depo-pays, #depo-payz, #depo-toggle").css("display", ""),
        $("#depo-time").css("color", "#fffefe");
        var n = g.depo.isDebtOverLimit ? "depo_debt_cost" : "depo_monthcost";
        $("#depo-buttons .infotxtdepo.private-section .shadowed").html(_t(n, null, "depo") + "<br>"),
        $("#depo-buttons").attr("class", "private-on"),
        i.html("");
        for (var o = 0, s = [{
            text: _t("pay_tears %val%", {
                "%val%": t.cost_prolong.credits
            }, "depo"),
            classes: ["small", "green"],
            action: function() {
                return depoPay("s")
            }
        }, {
            text: _t("pay_gold %val%", {
                "%val%": round(t.cost_prolong.gold)
            }, "depo"),
            classes: ["small", "green"],
            action: function() {
                return depoPay("z")
            }
        }]; o < s.length; o++) {
            var l = new Button(s[o]).getButton();
            i.append(l)
        }
    }
    if ($("#depo-gold .info-tip").tip(_t("unit_tip", null, "depo")),
    t.has_multi_items_at_zero_zero) {
        var r = $("<div>").addClass("highlight multiZeroZeroDepo").css({
            top: "0px",
            left: "0px"
        });
        $("#depo-items").prepend(r),
        message(_t("depoMultiZeroZero"))
    } else
        $(".multiZeroZeroDepo").remove();
    g.depo.vis = !0,
    $("#depo-items").css("width", 462 * g.depo.size);
    var c = _t("depotxt", null, "depo")
      , d = "";
    if (g.depo.size < g.depo.msize)
        if (g.depo.clan) {
            if (1 & g.depo.myrights) {
                var p, h = t.cost_upgrade.gold, u = t.cost_upgrade.credits;
                p = 0 == t.size ? _t("buydepoalert", {
                    "%gold%": round(h),
                    "%credits%": u
                }, "depo") : _t("increasedepoalert", {
                    "%gold%": round(h),
                    "%credits%": u
                }, "depo"),
                $("#upgrade_alert_str").html(p),
                $("#clan_depo_pay_1").html(_t("stamina_shop_cost") + "<b> " + round(h) + "</b>"),
                $("#clan_depo_pay_2").html(_t("stamina_shop_cost") + "<b> " + u + " SÅ</b>");
                var m = round(h) + " lub " + u + "SÅ";
                d += '<div tip="' + _t("depo_upgrade_clan", {
                    "%val%": m
                }, "depo") + '" class="depoUpgrade" onclick="showUpgradeClanDepoAlert()">+</div>'
            }
        } else
            d += '<div tip="<b>' + _t("depo_upgrade", null, "depo") + "</b>" + (t.expire && t.expire >= unix_time() ? c : _t("depo_upgrade_error", null, "depo")) + '" class="depoUpgrade" onclick="' + (t.expire && t.expire >= unix_time() ? "mAlert('" + _t("depo_upgrade_confirm", null, "depo") + "', 2, [function(){_g('depo&upgrade=1')}])" : "return false;") + '">+</div>';
    else
        d += '<div class="depoUpgrade haveFull" onclick="return false;">+</div>';
    d += "<br>",
    d += "<div class=depoSwitchWrapper>",
    d += '<span class="d-movebar" onclick="return depoSwitchSectionScroll(-1);"><</span>',
    d += "<div class=depoTabScrollWrapper>";
    for (var f = 1; f <= g.depo.msize; f++) {
        var v = !g.depo.clan || f <= g.depo.visibleTabs
          , _ = f > g.depo.size;
        d += '<span onclick="return ' + (v && !_ ? "depoSwitchSection(" + f + ")" : "false") + '" sId="' + f + '" class="d-section' + (f == g.depo.section ? " active" : "") + (v ? "" : " disabled") + (_ ? " notExists" : "") + '">' + f + "</span>"
    }
    function b() {
        var t = $("#depo-sections");
        return t.offset().left + t.width() - 36
    }
    d += "</div>",
    d += '<span class="d-movebar" onclick="return depoSwitchSectionScroll(1);">></span>',
    d += "</div>",
    $("#depo-sections").html(d),
    $("#depo-sections .depoTabScrollWrapper").scrollLeft(g.depo.switchScroll),
    g.depo.size > 1 && setTimeout((function() {
        depoSwitchSection(g.depo.section)
    }
    ), 200),
    $("#depo-sections .d-section:not(.depoUpgrade,.disabled,.notExists)").droppable({
        accept: ".item",
        over: function(t, e) {
            e.position.left > b() || depoSwitchSection($(t.target).index() + 1)
        },
        drop: function(t, e) {
            if (!(e.position.left > b())) {
                for (var a = e.draggable.attr("id").substr(4), i = $(this).attr("sid"), n = 0; n < 8; n++)
                    for (var o = 14 * (i - 1); o < 14 * i; o++)
                        if (!isset(g.depo.tmpDropMatrix[o]) || isset(g.depo.tmpDropMatrix[o]) && !isset(g.depo.tmpDropMatrix[o][n]))
                            switch (g.item[a].loc) {
                            case "g":
                                return g.depo.clan ? _g("clan&a=depo&op=item_put&id=" + a + "&x=" + o + "&y=" + n) : _g("depo&put=" + a + "&x=" + o + "&y=" + n);
                            case "d":
                                return _g("depo&move=" + a + "&x=" + o + "&y=" + n);
                            case "c":
                                return _g("clan&a=depo&op=item_move&id=" + a + "&x=" + o + "&y=" + n)
                            }
                mAlert(_t("depo_no_space_intab", null, "depo"))
            }
        }
    }),
    g.depo.clan || (t.expire ? (g.depo.expireLock && $("#depo-toggle, #depo-buttons").css("display", "none"),
    $("#depo-time").html(ut_fulltime(t.expire, !0)),
    t.expire < unix_time() ? $("#depo-time").css("color", "red") : $("#depo-time").css("color", "#fffefe"),
    $("#depo-buttons span.next_renew").show(),
    $("#depo-buttons span.next_renew span.date").html(ut_fulltime(g.depo.nextExpiration, !0))) : ($("#depo-items").empty(),
    $("#depo-time").html(_t("depo_missing", null, "depo")),
    $("#depo-buttons span.next_renew").hide())),
    $("#depo-gold INPUT").val(""),
    $("#depo-balance b").html(t.gold),
    $("#depo").fadeIn()
}
function clanDepoUpgradeOpt() {
    $("#upgradeclandepoalert")
}
function showUpgradeClanDepoAlert() {
    $("#upgradeclandepoalert").absCenter().fadeIn()
}
function hideUpgradeClanDepoAlert() {
    $("#upgradeclandepoalert").css("display", "none")
}
function depoHide() {
    for (var t in $("#depo").fadeOut(),
    g.depo.tmpDropMatrix = {},
    g.depo.switchScroll = 0,
    g.lock.remove("depo"),
    g.depo.vis = !1,
    g.item)
        "d" != g.item[t].loc && "c" != g.item[t].loc || ($("#item" + t).remove(),
        delete g.item[t]);
    g.depo.clan && _g("clan&a=depo&op=close")
}
function depoSwitchSection(t) {
    if (t <= g.depo.msize && t >= 1) {
        g.depo.section = t,
        $("#depo-items-wrapper").scrollLeft(462 * (t - 1)),
        $("#depo-sections .d-section:not(.depoUpgrade)").removeClass("active");
        var e = $("#depo-sections .d-section");
        $(e[t - 1]).addClass("active")
    }
}
function depoSwitchSectionScroll(t) {
    var e = $("#depo-sections .depoTabScrollWrapper")
      , a = e.scrollLeft() + 43 * t;
    a < 0 ? a = 0 : a > e.width() && (a = e.width()),
    e.scrollLeft(a),
    g.depo.switchScroll = a
}
function deposit(t) {
    if (g.depo.vis) {
        for (var e = $(t).attr("id").substr(4), a = 0; a < 8; a++)
            for (var i = 14 * (g.depo.section - 1); i < 14 * g.depo.section; i++)
                if (!isset(g.depo.tmpDropMatrix[i]) || isset(g.depo.tmpDropMatrix[i]) && !isset(g.depo.tmpDropMatrix[i][a]))
                    return g.depo.clan ? _g("clan&a=depo&op=item_put&id=" + e + "&x=" + i + "&y=" + a) : _g("depo&put=" + e + "&x=" + i + "&y=" + a);
        g.depo.size > 1 ? mAlert(_t("depo_tabno_space ask", null, "depo"), 2, [function() {
            for (var t = 0; t < g.depo.size; t++)
                for (var e = 0; e < 8; e++)
                    for (var a = 14 * t; a < 14 * (t + 1); a++)
                        if (!isset(g.depo.tmpDropMatrix[a]) || isset(g.depo.tmpDropMatrix[a]) && !isset(g.depo.tmpDropMatrix[a][e]))
                            return depoSwitchSection(t + 1);
            mAlert(_t("depo_no_space", null, "depo"))
        }
        , function() {}
        ]) : mAlert(_t("depo_no_space", null, "depo"))
    }
}
function depoPay(t) {
    "z" == t && hero.lvl < 75 ? mAlert(_t("low_lvl_to_paygold", null, "depo")) : "s" == t && hero.lvl < 20 ? mAlert(_t("low_lvl_to_usedepo", null, "depo")) : _g("depo&pay=" + t + "&time=1")
}
function depoDel() {
    mAlert(_t("depo_remove_confirm_txt", null, "depo"), 1, [function() {
        _g("depo&remove=OK")
    }
    , function() {}
    ])
}
function findEmptyBagPlace() {
    for (var t = {}, e = 0; e < 3; e++)
        if (g.bags[e] && g.bags[e][0] - g.bags[e][1] > 0) {
            for (var a in g.item)
                "g" == g.item[a].loc && 0 == g.item[a].st && (t[g.item[a].x + 7 * g.item[a].y] = !0);
            for (var i = 6 * e; i < 6 * (e + 1); i++)
                for (var n = 0; n < 7; n++)
                    if (!isset(t[n + 7 * i]))
                        return [n, i]
        }
    return !1
}
function depoGet(t) {
    var e = $(t).attr("id").substr(4);
    g.depo.clan ? findEmptyBagPlace() ? _g("clan&a=depo&op=item_get&id=" + e) : mAlert(_t("depo_no_space_inbag", null, "depo")) : _g("depo&get=" + e)
}
function depoGoldin() {
    _g("depo&goldin=" + parsePrice(removeSpaces($("#depo-gold INPUT").val()))),
    $("#depo-gold INPUT").val("")
}
function depoGoldout() {
    _g("depo&goldout=" + parsePrice(removeSpaces($("#depo-gold INPUT").val()))),
    $("#depo-gold INPUT").val("")
}
function bookSetup(t) {
    g.book = t,
    g.book.content = g.book.content.split("#PAGE#"),
    g.book.pages = g.book.content.length,
    g.book.page = 1,
    $("#book_c").html(parseContentBB(g.book.content[0], !1)),
    $("#book_t").html("<h1>" + parseContentBB(g.book.title, !1) + "</h1>" + parseContentBB(g.book.author, !1)),
    $("#book_p").html("<span>1</span>/" + g.book.pages),
    $("#books").fadeIn()
}
function bookPage(t) {
    g.book.page = Math.max(1, Math.min(g.book.pages, g.book.page + t)),
    $("#book_c").html(parseContentBB(g.book.content[g.book.page - 1], !1)),
    $("#book_p").html("<span>" + g.book.page + "</span>/" + g.book.pages)
}
function motelSetup(t) {
    g.lock.add("motel");
    for (var e = "<h2>" + t.name + "</h2>" + t.desc + "<table><tr><th>" + _t("room_th", null, "motel") + "<th>" + _t("state_th", null, "motel") + "<th>" + _t("price_th", null, "motel") + "<th width=80>" + _t("amount_th", null, "motel") + "<th width=105>", a = 0; a < t.rooms.length; a += 5) {
        e += "<tr><td><b>" + t.rooms[a + 1] + "</b><td class=cen>";
        var i = round(t.rooms[a + 2], 3);
        2 == t.rooms[a + 3] ? e += '<b style="color:blue">wynajmujesz do ' + ut_fulltime(t.rooms[a + 4]) + "</b><td id=motel_price" + t.rooms[a] + " class=cen value=" + t.rooms[a + 2] + ">" + i + "<td class=cen><select onclick=changePrice(" + t.rooms[a] + ") id=rotime" + t.rooms[a] + ' style="width:60px"><option value=1>' + _t("time_1m", null, "motel") + "<option value=2>" + _t("time_2m", null, "motel") + "<option value=3>" + _t("time_3m", null, "motel") + "<option value=6>" + _t("time_6m", null, "motel") + "<option value=12>" + _t("time_12m", null, "motel") + "</select><br><input type=text id=rokey" + t.rooms[a] + ' value=1 style="width:60px"><br>' + _t("all**", null, "motel") + "<td class=cen><button onclick=rentRoom(" + t.rooms[a] + ")>" + _t("long_opt", null, "motel") + "</button><button onclick=dupKeys(" + t.rooms[a] + ")>" + _t("keysadd_opt", null, "motel") + "</button><button onclick=delKeys(" + t.rooms[a] + ")>" + _t("keysrm_opt", null, "motel") + "</button>" : 0 == t.rooms[a + 3] ? e += '<b style="color:green">' + _t("room_free") + "</b><td id=motel_price" + t.rooms[a] + " class=cen value=" + t.rooms[a + 2] + ">" + i + "<td class=cen><select onclick=changePrice(" + t.rooms[a] + ") id=rotime" + t.rooms[a] + ' style="width:60px"><option value=1>' + _t("time_1m", null, "motel") + "<option value=2>" + _t("time_2m", null, "motel") + "<option value=3>" + _t("time_3m", null, "motel") + "<option value=6>" + _t("time_6m", null, "motel") + "<option value=12>" + _t("time_12m", null, "motel") + "</select><td class=cen><button onclick=rentRoom(" + t.rooms[a] + ")>" + _t("rent_this", null, "motel") + "</button>" : e += '<b style="color:red">' + _t("room_taken", null, "motel") + " do<br>" + ut_fulltime(t.rooms[a + 4]) + "</b><td class=cen>" + i + "<td class=cen>-<td class=cen>-"
    }
    $("#rooms_c").html(e + "</table>" + _t("room_info_txt2", null, "motel")),
    $("#rooms").fadeIn("fast")
}
function changePrice(t) {
    var e = $("#motel_price" + t)
      , a = $("#rotime" + t).val()
      , i = e.attr("value");
    e.html(round(a * i, 3), 5)
}
function rentRoom(t) {
    var e = $("#rotime" + t).val()
      , a = _t("rm_1month", null, "motel");
    e > 4 ? a = e + _t("rm_2months", null, "motel") : e > 1 && (a = e + _t("rm_2months*", null, "motel"));
    var i = $("#motel_price" + t).attr("value")
      , n = round(i * e, 5);
    mAlert(_t("room_confirm_question2 %time% %gold%", {
        "%time%": a,
        "%gold%": n
    }, "motel"), 2, [function() {
        _g("rooms&rent=" + t + "&m=" + e)
    }
    , function() {}
    ])
}
function dupKeys(t) {
    var e = $("#rokey" + t).val()
      , a = $("#motel_price" + t).attr("value")
      , i = round(parsePrice(a) * e * .1, 5);
    mAlert(_t("duplicate_key_confirm" + (e > 4 ? 3 : e > 1 ? 2 : 1) + " %amount% %gold%", {
        "%amount%": e,
        "%gold%": i
    }, "motel"), 2, [function() {
        _g("rooms&room=" + t + "&keydup=" + $("#rokey" + t).val())
    }
    , function() {}
    ])
}
function delKeys(t) {
    var e = $("#motel_price" + t).attr("value")
      , a = round(.3 * e, 5);
    mAlert(_t("room_key_remove_confirm2 %gold%", {
        "%gold%": a
    }, "motel"), 2, [function() {
        _g("rooms&delkeys=" + t)
    }
    , function() {}
    ])
}
function lootWindow(t) {
    if (isset(t.init)) {
        g.loots && closeLootWindow(!0),
        createLootAnim(),
        tutorialStart(3),
        $("#loots TR").empty(),
        $("#loots").absCenter().fadeIn("fast"),
        $("#loots_header_label").html(goldTxt(_t("loots_header")));
        var e = t.endTs - g.ev;
        $("#loots_counter").html(Math.floor(e)),
        updateBags();
        try {
            $("#inpchat:focus") || $("#loots_button").focus()
        } catch (t) {
            try {
                "inpchat" != $(document.activeElement).attr("id") && $("#loots_button").focus()
            } catch (t) {
                $("#loots_button").focus()
            }
        }
        var a = e;
        g.loots = {
            init: t.init,
            owners: t.owners ? t.owners : null,
            source: t.source ? t.source : null,
            interval: setInterval((function() {
                a--,
                $("#loots_counter").html(Math.floor(a)),
                a < 1 && closeLootWindow()
            }
            ), 1e3)
        }
    }
    if (g.loots)
        for (var i in updateBags(),
        g.loots.want = [],
        g.loots.must = [],
        g.loots.not = [],
        t.states) {
            var n = t.states[i];
            switch (n) {
            case 0:
                g.loots.not.push(i);
                break;
            case 1:
                g.loots.want.push(i);
                break;
            case 2:
                g.loots.must.push(i)
            }
            setStateOnOneLootItem(i, n)
        }
}
function lootsUpdateFreeBagSlots() {
    $("#loots_bag").html(_t("bag_room %amount%", {
        "%amount%": g.freeSlots
    }, "loot"))
}
function closeLootWindow(t) {
    t ? $("#loots").css("display", "none") : $("#loots").fadeOut("fast"),
    clearInterval(g.loots.interval),
    g.loots = !1
}
function setStateOnOneLootItem(t, e) {
    var a = $("#loot" + t);
    if (a.length && !a.find(".yours").length) {
        a.find(".sel").removeClass("sel");
        var i = g.loots.want
          , n = g.loots.not
          , o = g.loots.must
          , s = {
            0: {
                text: _t("dont_want", null, "loot"),
                selector: ".no"
            },
            1: {
                text: _t("want", null, "loot"),
                selector: ".yes"
            },
            2: {
                text: _t("really_want", null, "loot"),
                selector: ".need"
            }
        };
        if (null == e) {
            for (var l = 0; l < i.length; l++)
                t == i[l] && a.find(s[1].selector).addClass("sel").attr("tip", s[1].text);
            for (l = 0; l < n.length; l++)
                t == n[l] && a.find(s[0].selector).addClass("sel").attr("tip", s[0].text);
            for (l = 0; l < o.length; l++)
                t == o[l] && a.find(s[2].selector).addClass("sel").attr("tip", s[2].text)
        } else
            a.find(s[e].selector).addClass("sel").attr("tip", s[e].text)
    }
}
function createLootAnim() {
    var t = $("#loots");
    if (t.removeClass("colorized video"),
    g.chestAnimation) {
        if ("colorized" === g.chestAnimationType)
            return t.addClass("colorized"),
            void (g.chestAnimation = !1);
        if ("video" == g.chestAnimationType) {
            var e = $("<video>").attr("id", "chest-animation")
              , a = $("<source>").attr({
                src: "video/chest.m4v",
                type: "video/x-m4v"
            });
            e.append(a),
            t.append(e),
            e[0].play(),
            e[0].onended = function() {
                e.animate({
                    left: -10,
                    top: -10,
                    opacity: 0,
                    width: t.width(),
                    height: t.height()
                }, (function() {
                    e.remove(),
                    g.chestAnimation = !1
                }
                ))
            }
        }
    }
}
function sendLoots(t, e, a) {
    for (var i = {
        want: [],
        not: [],
        must: []
    }, n = g.loots.want, o = g.loots.not, s = g.loots.must, l = 0; l < n.length; l++) {
        var r = n[l];
        $("#loot" + r).hasClass("yours") || (0 != e && r == e ? i[a].push(e) : i.want.push(r))
    }
    for (l = 0; l < o.length; l++) {
        r = o[l];
        $("#loot" + r).hasClass("yours") || (0 != e && r == e ? i[a].push(e) : i.not.push(r))
    }
    for (l = 0; l < s.length; l++) {
        r = s[l];
        $("#loot" + r).hasClass("yours") || (0 != e && r == e ? i[a].push(e) : i.must.push(r))
    }
    _g("loot&want=" + i.want.join(",") + "&not=" + i.not.join(",") + "&must=" + i.must.join(",") + "&final=" + t),
    t && closeLootWindow()
}
function cancelLoots() {
    _g("loot&not=" + g.loots.not.concat(g.loots.want, g.loots.must).join(",") + "&final=1"),
    $("#loots").fadeOut("fast"),
    g.loots = !1
}
function lootboxItem(t) {
    if (g.loots) {
        var e = "k" == t.loc
          , a = e && t.own == hero.id ? "class='yours' " : ""
          , i = ""
          , n = createItem(t);
        if (i += "<td ".concat(a, ' id="loot').concat(t.id, '" class="loot-wrapper"><div class="loot">').concat(n[0].outerHTML, "</div>"),
        e) {
            var o = getNameAndAvatar(t.own);
            i += '<div class="nick">' + o.name + "</div>" + ('<div class="icon" style="background-image:url(' + o.imgUrl + ')"></div')
        } else {
            var s = parseItemStat(t.stat)
              , l = "";
            isset(s.reqp) && -1 == s.reqp.indexOf(hero.prof) && (l = "cant-need");
            var r = "onclick='sendLoots(0, \"" + t.id + '", "want")\''
              , c = "onclick='sendLoots(0, \"" + t.id + '", "not")\''
              , d = "onclick='sendLoots(0, \"" + t.id + '", "must")\'';
            i += "lootbox" == g.loots.source ? "" : "<div class='loot-decision'><b class='yes sel' " + r + " tip='" + _t("want", null, "loot") + "'></b><b class=no " + c + " tip='" + _t("dont_want", null, "loot") + "'></b>" + (g.loots.init > 1 ? "<b class='need " + l + "' " + d + " tip='" + _t("really_want", null, "loot") + "'></b>" : "")
        }
        $("#loots TR").append(i);
        var p = $("#loots.colorized .loot-wrapper");
        if (p.length > 0 && p.addClass(getNewItemType(s)),
        setStateOnOneLootItem(t.id),
        e) {
            var h = $("#loot" + t.id).find(".nick");
            h[0].scrollWidth > h.innerWidth() && h.tip(o.name)
        }
    }
}
function getNewItemType(t) {
    return t.hasOwnProperty("heroic") ? "t-her" : t.hasOwnProperty("unique") ? "t-uniupg" : t.hasOwnProperty("upgraded") ? "t-upgraded" : t.hasOwnProperty("legendary") ? "t-leg" : t.hasOwnProperty("artefact") ? "t-art" : "none"
}
function lootItem(t) {
    return lootboxItem(t)
}
function getNameAndAvatar(t) {
    if (hero.id == t)
        return {
            name: hero.nick,
            imgUrl: hero.icon
        };
    var e = g.other[t];
    if (e)
        return {
            name: e.nick,
            imgUrl: CFG.opath + e.icon
        };
    var a = lookForInLoadQueue("newOther");
    return a && a[t] ? {
        name: a[t].nick,
        imgUrl: CFG.opath + a[t].icon
    } : g.loots.owners[t] ? {
        name: g.loots.owners[t].nick,
        imgUrl: CFG.opath + g.loots.owners[t].icon
    } : {
        name: "Undefined",
        imgUrl: "/img/def-npc.gif"
    }
}
function newEmoData(t) {
    for (var e = 0; e < t.length; e++) {
        var a = t[e];
        if (2 != a.source_type && 2 != a.target_type) {
            var i = !!isset(a.target_id) && a.target_id;
            emotion(a.name, a.source_id, i, a.end_ts, t)
        }
    }
}
function emotion(t, e, a, i) {
    if (g.init < 4)
        setTimeout("emotion('" + t + "'," + e + "," + a + ")", 500);
    else {
        var n = t
          , o = hero.id != e ? "#other" + e : "#hero"
          , s = hero.id != e ? g.other[e] : hero;
        if (!($(o).length < 1) || 0 == e && 0 == a) {
            if (0 != a) {
                var l = hero.id != a ? "#other" + a : "#hero";
                if ($(l).length < 1)
                    return
            }
            var r = "emo" + Math.round(1e4 * Math.random());
            if ("flag-" == t.substr(0, 5)) {
                var c = '<img src="' + CFG.epath + t + '" class="emo emo-' + t + '" id=' + r + ">";
                t = "flag"
            } else
                c = '<img src="' + CFG.epath + t + '.gif" class="emo emo-' + t + '" id=' + r + ">";
            var d = 8e3
              , p = t;
            t = /fire/.test(t) ? "fireworks" : p,
            t = /VisualEffects/.test(t) ? "VisualEffects" : t;
            var h = CFG.epath + p + ".gif"
              , u = CFG.epath + p + ".png";
            switch (t) {
            case "away":
            case "battle":
            case "stasis":
                appendConteinerAndEmo(o, c, n);
                break;
            case "angry":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').fadeOut(500)", 7500),
                setTimeout("$('#" + r + "').remove()", d);
                break;
            case "logoff":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').remove()", 5e3);
                break;
            case "lvlup":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').remove()", 1e3);
                break;
            case "login":
            case "respawned":
            case "abyssout":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').remove()", 2e3);
                break;
            case "teleported":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').remove()", 3e3);
                break;
            case "VisualEffects":
                $.getScript("https://www.margonem.pl/js/" + p.split("|")[1] + ".min.js");
                break;
            case "pvpprotected":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').remove()", 1e3 * (i - (g.ev ? g.ev : 0)));
                break;
            case "flag":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').fadeOut(500, function(){$(this).remove()})", 5e3);
                break;
            case "curse":
                !function() {
                    var e = new Image;
                    e.src = CFG.epath + "klatwa.gif?11";
                    var a = 0;
                    e.onload = function() {
                        var e = this
                          , i = $("<div></div>").css({
                            bottom: $(o).height(),
                            left: $(o).width() / 2 - e.width / 2,
                            width: e.width,
                            height: e.height / 5,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + CFG.epath + "klatwa.gif?11)"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            i.css({
                                backgroundPosition: "0px -" + a % 4 * 32 + "px"
                            }),
                            8 == ++a && (popEmoInterval(t),
                            i.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 200)
                    }
                }();
                break;
            case "lampion1":
            case "lampion2":
            case "lampion3":
            case "lampion4":
            case "lampion5":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = [parseInt($(o).css("left")), parseInt($(o).css("top"))]
                          , i = $("<div></div>").css({
                            width: 48,
                            height: 48,
                            left: e[0],
                            top: e[1],
                            position: "absolute",
                            "background-image": "url(" + h + ")",
                            backgroundPosition: "0px -912px"
                        }).addClass("notippropagation").appendTo($("#ground"));
                        setEmoInterval(t, (function() {
                            var n = e[1] - 5 * a
                              , o = e[0] + 3 * a
                              , s = a < 20 ? 912 - 48 * a : 0;
                            i.css({
                                backgroundPosition: "0px -" + s + "px",
                                top: n,
                                left: o,
                                zIndex: getLayerOrder(Math.ceil(n / 32), 20)
                            }),
                            100 == ++a && (popEmoInterval(t),
                            i.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 120)
                    }
                }();
                break;
            case "guma1":
            case "guma2":
            case "guma3":
            case "guma4":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            bottom: 0,
                            left: $(o).width() / 2 - 16,
                            width: 32,
                            height: 48,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 48 * a + "px"
                            }),
                            11 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 120)
                    }
                }();
                break;
            case "roza":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            bottom: 0,
                            left: $(l).width() / 2 - 16,
                            width: 32,
                            height: 32,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo(l);
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 32 * a + "px"
                            }),
                            10 == ++a && (popEmoInterval(t),
                            setTimeout((function() {
                                e.remove()
                            }
                            ), 5e3))
                        }
                        ), 150)
                    }
                }();
                break;
            case "buzia1":
            case "buzia2":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0
                      , i = "buzia1" == t ? 23 : 35;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            bottom: 0,
                            left: $(l).width() / 2 - 17,
                            width: 32,
                            height: 48,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo(l);
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 48 * a + "px"
                            }),
                            ++a == i + 1 && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 50)
                    }
                }();
                break;
            case "banki":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            bottom: 0,
                            left: $(o).width() / 2 - 16,
                            width: 32,
                            height: 48,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 48 * a + "px"
                            }),
                            25 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 120)
                    }
                }();
                break;
            case "emonutki":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            bottom: $(o).height(),
                            left: $(o).width() / 2 - this.width / 2,
                            width: 32,
                            height: 32,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 32 * a + "px"
                            }),
                            25 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 100)
                    }
                }();
                break;
            case "emosnow":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            top: 32 * s.y,
                            left: 32 * s.x - 32,
                            width: 32,
                            height: 32,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).addClass("notippropagation").appendTo("#base");
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 32 * a + "px"
                            }),
                            45 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 70)
                    }
                }();
                break;
            case "bat":
                (m = new Image).src = h,
                m.onload = function() {
                    var t = this;
                    $('<div><img src="' + h + '"/></div>').css({
                        width: t.width,
                        height: t.height,
                        bottom: $(o).height(),
                        position: "absolute",
                        left: $(o).width() / 2 - t.width / 2
                    }).addClass("notippropagation").appendTo(o).delay(3e3).fadeOut("fast")
                }
                ;
                break;
            case "spider":
                var m;
                (m = new Image).src = h,
                m.onload = function() {
                    var t = this;
                    $('<div><img src="' + h + '"/></div>').css({
                        width: t.width,
                        height: t.height,
                        bottom: $(o).height(),
                        position: "absolute",
                        left: $(o).width() / 2 - t.width / 2
                    }).addClass("notippropagation").appendTo(o).delay(3e3).fadeOut("fast")
                }
                ;
                break;
            case "ptaszek":
                !function() {
                    var e = new Image;
                    e.src = u;
                    var a = 0;
                    e.onload = function() {
                        var e = this
                          , i = $("<div></div>").css({
                            bottom: $(o).height(),
                            left: $(o).width() / 2 - e.width / 2,
                            width: e.width,
                            height: e.height / 7,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + u + ")"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            i.css({
                                backgroundPosition: "0px -" + a % 7 * 32 + "px"
                            }),
                            56 == ++a && i.fadeOut(null, (function() {
                                popEmoInterval(t),
                                $(this).remove()
                            }
                            ))
                        }
                        ), 85)
                    }
                }();
                break;
            case "kuciak":
                !function() {
                    var e = new Image;
                    e.src = u;
                    var a = 0;
                    e.onload = function() {
                        var e = this
                          , i = $("<div></div>").css({
                            bottom: $(o).height(),
                            left: $(o).width() / 2 - e.width / 2,
                            width: e.width,
                            height: e.height / 22,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + u + ")"
                        }).addClass("notippropagation").appendTo(o);
                        setEmoInterval(t, (function() {
                            i.css({
                                backgroundPosition: "0px -" + a % 22 * 32 + "px"
                            }),
                            22 == ++a && (popEmoInterval(t),
                            setTimeout((function() {
                                i.fadeOut(null, (function() {
                                    $(this).remove()
                                }
                                ))
                            }
                            ), 3e3))
                        }
                        ), 150)
                    }
                }();
                break;
            case "ghost":
                !function() {
                    var e = new Image;
                    e.src = h;
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            top: 32 * s.y - 50,
                            left: 32 * s.x,
                            width: this.width,
                            height: this.height / 6,
                            position: "absolute",
                            "z-index": parseInt($(l).css("z-index")) - 1,
                            "background-image": "url(" + h + ")"
                        }).appendTo("#base");
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + a % 5 * 48 + "px"
                            }),
                            16 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 200)
                    }
                }();
                break;
            case "zombie":
                !function() {
                    var e = new Image;
                    e.src = CFG.epath + "lapa.gif?11";
                    var a = 0;
                    e.onload = function() {
                        var e = $("<div></div>").css({
                            top: 32 * s.y + 3,
                            left: 32 * s.x + 8,
                            width: 16,
                            height: 32,
                            position: "absolute",
                            "z-index": parseInt($(o).css("z-index")),
                            "background-image": "url(" + CFG.epath + "lapa.gif?11)"
                        }).appendTo("#base");
                        setEmoInterval(t, (function() {
                            e.css({
                                backgroundPosition: "0px -" + 32 * a + "px"
                            }),
                            6 == ++a && (popEmoInterval(t),
                            e.fadeOut(null, (function() {
                                $(this).remove()
                            }
                            )))
                        }
                        ), 300)
                    }
                }();
                break;
            case "holly":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + h + ")"
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = $(l).offset()
                      , n = Math.max(Math.abs(a.left - i.left), Math.abs(a.top - i.top));
                    e.css({
                        width: 32,
                        height: 32,
                        left: a.left + $("#base").scrollLeft() - g.left,
                        top: a.top + $("#base").scrollTop() + 8 - g.top
                    }).animate({
                        left: i.left + $("#base").scrollLeft() - g.left,
                        top: i.top + $("#base").scrollTop() - 20 - g.top
                    }, 500 + 5 * n, (function() {
                        var a = 0;
                        setEmoInterval(t, (function() {
                            if (++a > 6)
                                return e.remove(),
                                void popEmoInterval(t);
                            e.css("backgroundPosition", "0 -" + 32 * a + "px")
                        }
                        ), 300)
                    }
                    ))
                }();
                break;
            case "emohug1":
            case "emohug2":
            case "emohug3":
                !function() {
                    var e = {
                        emohug1: 12,
                        emohug2: 15,
                        emohug3: 8
                    }[t]
                      , a = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + h + ")"
                    }).appendTo("#base")
                      , i = $(o).offset()
                      , n = $(l).offset()
                      , s = Math.max(Math.abs(i.left - n.left), Math.abs(i.top - n.top));
                    a.css({
                        width: 32,
                        height: 32,
                        left: i.left + $("#base").scrollLeft() - g.left,
                        top: i.top + $("#base").scrollTop() + 8 - g.top
                    }).animate({
                        left: n.left + $("#base").scrollLeft() - g.left,
                        top: n.top + $("#base").scrollTop() - 20 - g.top
                    }, 500 + 5 * s, (function() {
                        var t = 0
                          , i = setInterval((function() {
                            if (++t > e - 1)
                                return a.fadeOut((function() {
                                    $(this).remove()
                                }
                                )),
                                void clearInterval(i);
                            a.css("backgroundPosition", "0 -" + 32 * t + "px")
                        }
                        ), 200)
                    }
                    ))
                }();
                break;
            case "gift":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + h + ")"
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = $(l).offset()
                      , n = Math.max(Math.abs(a.left - i.left), Math.abs(a.top - i.top));
                    e.css({
                        width: 32,
                        height: 32,
                        left: a.left + $("#base").scrollLeft() - g.left,
                        top: a.top + $("#base").scrollTop() + 8 - g.top
                    }).animate({
                        left: i.left + $("#base").scrollLeft() - g.left,
                        top: i.top + $("#base").scrollTop() + 8 - g.top
                    }, 500 + 5 * n, (function() {
                        var a = 0;
                        setEmoInterval(t, (function() {
                            if (++a > 9)
                                return setTimeout((function() {
                                    e.fadeOut(200, (function() {
                                        $(this).remove()
                                    }
                                    ))
                                }
                                ), 1e3),
                                void popEmoInterval(t);
                            e.css("backgroundPosition", "0 -" + 32 * a + "px")
                        }
                        ), 200)
                    }
                    ))
                }();
                break;
            case "kiss":
                $("#base").append('<img src="' + h + '" class=emo2 id=' + r + ">");
                var f = $(o).offset()
                  , v = $(l).offset();
                $("#" + r).css({
                    left: (f.left + v.left >> 1) + $("#base").scrollLeft() + 8 - g.left,
                    top: (f.top + v.top >> 1) + $("#base").scrollTop() - 16 - g.top
                }),
                setTimeout("$('#" + r + "').fadeOut(500)", 7500),
                setTimeout("$('#" + r + "').remove()", d);
                break;
            case "frnd":
                appendConteinerAndEmo(o, c, n),
                setTimeout("$('#" + r + "').fadeOut(500, function(){$(this).remove()})", 3750);
                break;
            case "snowball":
                var _ = $("<div class=imgemo2></div>").css({
                    backgroundImage: "url(" + h + ")"
                }).appendTo("#base")
                  , b = (f = $(o).offset(),
                v = $(l).offset(),
                Math.max(Math.abs(f.left - v.left), Math.abs(f.top - v.top)));
                _.css({
                    left: f.left + $("#base").scrollLeft() + 8 - g.left,
                    top: f.top + $("#base").scrollTop() + 16 - g.top
                }).animate({
                    left: v.left + $("#base").scrollLeft() + 8 - g.left,
                    top: v.top + $("#base").scrollTop() + 8 - g.top
                }, 500 + 5 * b, (function() {
                    var e = 0;
                    setEmoInterval(t, (function() {
                        if (++e > 5)
                            return _.remove(),
                            void popEmoInterval(t);
                        _.css("backgroundPosition", "0 -" + 16 * e + "px")
                    }
                    ), 200)
                }
                ));
                break;
            case "cocos":
                _ = $("<div class=imgemo2></div>").css({
                    backgroundImage: "url(" + h + ")",
                    width: 32,
                    height: 32
                }).appendTo("#base"),
                f = $(o).offset(),
                v = $(l).offset(),
                b = Math.max(Math.abs(f.left - v.left), Math.abs(f.top - v.top));
                _.css({
                    left: f.left + $("#base").scrollLeft() - g.left,
                    top: f.top + $("#base").scrollTop() - g.top
                }).animate({
                    left: v.left + $("#base").scrollLeft() - g.left,
                    top: v.top + $("#base").scrollTop() - g.top
                }, 500 + 5 * b, (function() {
                    var e = 0;
                    setEmoInterval(t, (function() {
                        if (++e > 10)
                            return _.remove(),
                            void popEmoInterval(t);
                        _.css("backgroundPosition", "0 -" + 32 * e + "px")
                    }
                    ), 200)
                }
                ));
                break;
            case "pillow":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + CFG.epath + "poducha.gif)"
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = $(l).offset()
                      , n = Math.max(Math.abs(a.left - i.left), Math.abs(a.top - i.top));
                    e.css({
                        width: 32,
                        height: 32,
                        left: a.left + $("#base").scrollLeft() - g.left,
                        top: a.top + $("#base").scrollTop() - g.top
                    }).animate({
                        left: i.left + $("#base").scrollLeft() - g.left,
                        top: i.top + $("#base").scrollTop() - g.top
                    }, {
                        duration: 500 + 5 * n,
                        complete: function() {
                            var a = 0;
                            setEmoInterval(t, (function() {
                                if (++a > 8)
                                    return e.remove(),
                                    void popEmoInterval(t);
                                e.css("backgroundPosition", "0px -" + (96 + 32 * a) + "px")
                            }
                            ), 100)
                        }
                    });
                    var s = 1
                      , r = setInterval((function() {
                        s > 3 ? clearInterval(r) : (e.css("backgroundPosition", "0px -" + 32 * s + "px"),
                        s++)
                    }
                    ), 125)
                }();
                break;
            case "kiss2":
                _ = $("<div class=imgemo2></div>").css({
                    backgroundImage: "url(" + h + ")"
                }).appendTo("#base"),
                f = $(o).offset(),
                v = $(l).offset(),
                b = Math.max(Math.abs(f.left - v.left), Math.abs(f.top - v.top));
                _.css({
                    width: 32,
                    height: 32,
                    left: f.left + $("#base").scrollLeft() - g.left,
                    top: f.top + $("#base").scrollTop() + 16 - g.top
                }).animate({
                    left: v.left + $("#base").scrollLeft() - g.left,
                    top: v.top + $("#base").scrollTop() - g.top - 15
                }, 500 + 5 * b, (function() {
                    var e = 0;
                    setEmoInterval(t, (function() {
                        if (++e > 13)
                            return _.remove(),
                            void popEmoInterval(t)
                    }
                    ), 200)
                }
                ));
                break;
            case "fireworks":
                !function() {
                    var e = {
                        w: 48,
                        h: 48,
                        i: 25,
                        b: 20,
                        f: 2,
                        r: !0
                    };
                    switch (p) {
                    case "fire_1":
                    case "fire_2":
                        e.i = 12,
                        e.b = 4,
                        e.r = !1,
                        e.f = 4;
                        break;
                    case "fire_3":
                    case "fire_4":
                    case "fire_5":
                    case "fire_6":
                    case "fire_7":
                        e.i = 15,
                        e.b = 5,
                        e.r = !1,
                        e.f = 5;
                        break;
                    case "fire_8":
                        e.i = 22,
                        e.b = 5,
                        e.r = !1,
                        e.f = 5;
                        break;
                    case "fire_9":
                        e.i = 15,
                        e.b = 3,
                        e.r = !1,
                        e.f = 3
                    }
                    var a = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + h + ")",
                        width: 48,
                        height: 48
                    }).appendTo("#base")
                      , i = $(o).offset()
                      , n = 0
                      , s = i.top + $("#base").scrollTop() - 16 - g.top;
                    a.css({
                        left: i.left + $("#base").scrollLeft() - 8 - g.left,
                        top: s
                    }),
                    setEmoInterval(t, (function() {
                        if (++n > e.i)
                            return a.remove(),
                            void popEmoInterval(t);
                        n < e.b ? a.css({
                            backgroundPosition: "0 -" + 48 * (e.r ? n % e.f : n) + "px",
                            top: s - n * (e.r ? 6 : 12)
                        }) : a.css("backgroundPosition", "0 -" + 48 * (n - (e.r ? e.b - 2 : 0)) + "px")
                    }
                    ), 75)
                }();
                break;
            case "water":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + u + ")",
                        width: 16,
                        height: 56
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = 0
                      , n = a.top + $("#base").scrollTop() - 16 - g.top;
                    e.css({
                        left: a.left + $("#base").scrollLeft() + 8 - g.left,
                        top: n
                    }),
                    setEmoInterval(t, (function() {
                        ++i > 10 ? (e.remove(),
                        popEmoInterval(t)) : e.css("backgroundPosition", "0 -" + 64 * i + "px")
                    }
                    ), 125)
                }();
                break;
            case "stars":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + CFG.epath + "gwiazdki.gif)",
                        width: 32,
                        height: 32
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = 0
                      , n = a.top + $("#base").scrollTop() - 16 - g.top;
                    e.css({
                        left: a.left + $("#base").scrollLeft() - g.left,
                        top: n
                    }),
                    setEmoInterval(t, (function() {
                        ++i >= 20 ? (e.remove(),
                        popEmoInterval(t)) : e.css("backgroundPosition", "0 -" + 32 * i + "px")
                    }
                    ), 80)
                }();
                break;
            case "termofor":
                !function() {
                    var e = $("<div class=imgemo2></div>").css({
                        backgroundImage: "url(" + h + ")",
                        width: 32,
                        height: 32
                    }).appendTo("#base")
                      , a = $(o).offset()
                      , i = 0
                      , n = a.top + $("#base").scrollTop() - 32 - g.top;
                    e.css({
                        left: a.left + $("#base").scrollLeft() - g.left,
                        top: n
                    }),
                    setEmoInterval(t, (function() {
                        ++i >= 11 ? (e.remove(),
                        popEmoInterval(t)) : e.css("backgroundPosition", "0 -" + 32 * i + "px")
                    }
                    ), 200)
                }();
                break;
            case "noemo":
                $(o + " IMG").remove()
            }
        }
    }
}
function appendConteinerAndEmo(t, e, a) {
    var i = $(t).find(".emo-cointainer");
    i.length < 1 && (i = $("<div>").addClass("emo-cointainer"),
    $(t).append(i));
    var n = i.find(".emo-" + a);
    n.length > 0 && n.remove(),
    i.append(e)
}
function removeEmotionBySourceIdAndEmoType(t, e) {
    g.other[e] ? $("#other" + e).find(".emo-" + t).remove() : hero.id == e && $("#hero").find(".emo-" + t).remove()
}
function setEmoInterval(t, e, a) {
    isset(g.emoIntervals[t]) || (g.emoIntervals[t] = []),
    g.emoIntervals[t].splice(0, 0, setInterval(e, a))
}
function popEmoInterval(t) {
    isset(g.emoIntervals[t]) && g.emoIntervals[t].length > 0 && clearInterval(g.emoIntervals[t].pop())
}
function setBlockSendNextInit(t) {
    g.blockSendNextInit = t
}
function startEngine() {
    g.engineStopped = !1
}
function stopEngine() {
    g.engineStopped = !0,
    clearInterval(g.gt),
    sound.manager.engineStop()
}
function PvpIndicator() {
    this.toggleShow = function(t) {
        "none" == $("#pvpStatMainBox").css("display") || isset(t) ? $("#pvpStatMainBox").show(100) : $("#pvpStatMainBox").hide(100)
    }
    ,
    this.setValue = function(t) {
        if (0 == t)
            $("#pvpStatContainer .indicator").css({
                width: 0
            });
        else {
            var e = Math.abs(t) / 2;
            t < 0 ? ($("#pvpStatContainer .raise .indicator").css({
                width: 0
            }),
            $("#pvpStatContainer .fall .indicator").animate({
                width: e
            })) : ($("#pvpStatContainer .raise .indicator").animate({
                width: e
            }),
            $("#pvpStatContainer .fall .indicator").css({
                width: 0
            }))
        }
    }
}
function PlayerCatcher() {
    this.activePlayer = null,
    this.alreadyActive = [],
    this.follow = null,
    this.followInterval = null,
    this.tmpZIndex = null,
    this.next = function() {
        for (var t in null != this.followInterval && clearInterval(this.followInterval),
        this.follow = null,
        this.revertZIndex(),
        g.other) {
            var e = !1;
            if (Math.abs(g.other[t].x - hero.x) <= 8 && Math.abs(g.other[t].y - hero.y) <= 8) {
                for (var a = 0; a < this.alreadyActive.length; a++)
                    if (this.alreadyActive[a] == t) {
                        e = !0;
                        break
                    }
                if (e)
                    continue;
                return void this.activatePlayer(t)
            }
        }
        this.resetAll()
    }
    ,
    this.revertZIndex = function() {
        null != this.activePlayer && isset(g.other[this.activePlayer]) && $("#other" + this.activePlayer).css("z-index", this.tmpZIndex)
    }
    ,
    this.activatePlayer = function(t) {
        this.alreadyActive.push(t),
        $(".other").css("border", ""),
        this.activePlayer = t,
        this.tmpZIndex = $("#other" + this.activePlayer).css("z-index"),
        $("#other" + this.activePlayer).css({
            border: "1px solid #ff0000",
            "z-index": 221
        })
    }
    ,
    this.startFollow = function() {}
    ,
    this.calculatePath = function() {}
    ,
    this.refreshPath = function() {}
    ,
    this.stopFollow = function() {}
    ,
    this.resetAll = function() {
        $(".other").css("border", ""),
        this.alreadyActive = [],
        this.activePlayer = null
    }
}
function GameLoader() {
    this.steps = {
        map: {
            msg: _t("map_file", null, "loader"),
            status: !1
        },
        loc: {
            msg: _t("location", null, "loader"),
            status: !1
        },
        npc: {
            msg: _t("npc", null, "loader"),
            status: !1
        },
        items: {
            msg: _t("items", null, "loader"),
            status: !1
        },
        player: {
            msg: _t("player", null, "loader"),
            status: !1
        }
    },
    this.maxStep = 5,
    this.infoDelay = null,
    this.startStep = function(t) {
        $("#loading .progressInfo").append('<span class="step_' + t + '">' + this.steps[t].msg + "</span>")
    }
    ,
    this.finishStep = function(t) {
        $("#loading .progressInfo .step_" + t).css("color", "lime"),
        this.steps[t].status = !0,
        this.progress()
    }
    ,
    this.activateDelayedInfo = function() {
        this.infoDelay = setInterval((function() {
            $("#loading .helptxt").fadeIn(500)
        }
        ), 1e4)
    }
    ,
    this.progress = function() {
        var t = 0;
        for (var e in null !== this.infoDelay && clearInterval(g.gameLoader.infoDelay),
        this.activateDelayedInfo(),
        this.steps)
            this.steps[e].status && t++;
        $("#loading .bar").width($("#loading .progressbar").width() / this.maxStep * t),
        5 == t && ($("#loading .progressbar").delay(600).fadeOut(),
        $("#loading .progressInfo").delay(600).fadeOut(),
        clearInterval(g.gameLoader.infoDelay),
        delete g.gameLoader)
    }
    ,
    this.activateDelayedInfo()
}
var conquerStats = {
    result: [],
    order: !1,
    show: function(t) {
        if (this.result = [],
        t.length > 0) {
            t = t.split("|");
            for (var e = 0; e < t.length; e += 4) {
                var a = /m|t|b/.test(hero.prof) ? -1 * parseInt(t[e + 3]) : parseInt(t[e + 3]);
                this.result.push({
                    id: parseInt(t[e]),
                    pId: parseInt(t[e + 1]),
                    name: t[e + 2],
                    c: parseInt(a)
                })
            }
            this.result.sort((function(t, e) {
                return e.c - t.c
            }
            ))
        }
        this.display(),
        this.result.length > 13 && addScrollbar("conquerStatWrapper", 370, "conquestSroll", !1)
    },
    display: function() {
        mAlert('<div id="conquer_stats_box">' + this.render(this.order) + "</div>", null, null, "msg")
    },
    prepareList: function(t) {
        if (!t)
            return this.result;
        for (var e = {}, a = 0; a < this.result.length; a++) {
            var i = 0 == this.result[a].pId ? id : this.result[a].pId;
            isset(e[i]) || (e[i] = []),
            e[i].push(this.result[a])
        }
        return e
    },
    render: function(t) {
        var e = this.prepareList(t)
          , a = "<h3>" + _t("conquer_loc_stats", null, "map") + ':</h3><div id="conquerStatWrapper">';
        if (this.result.length > 0)
            if (t)
                for (var i in e) {
                    a += '<div class="conquerGroup">';
                    for (var n = 0; n < e[i].length; n++)
                        a += this.renderLine(e[i][n], n == e[i].length - 1);
                    a += "</div>"
                }
            else {
                a += "<div>";
                for (i = 0; i < e.length; i++)
                    a += this.renderLine(e[i], i == e.length - 1);
                a += "</div>"
            }
        else
            a += _t("no_data", null, "map");
        return a += "</div>"
    },
    getTip: function(t) {
        var e = 1 + t.c / 100 * 3;
        return t.c < 0 ? _t("loc_lost %val% %exp%", {
            "%val%": Math.abs(t.c),
            "%exp%": roundNumber(e, 2)
        }, "map") : _t("loc_conquer %val% %exp%", {
            "%val%": t.c,
            "%exp%": roundNumber(e, 2)
        }, "map")
    },
    renderLine: function(t, e) {
        return '<div tip="' + this.getTip(t) + '" class="el' + (t.c > 0 ? " g" : " r") + (e ? " last" : "") + '"><div class="name">' + (t.name.length > 25 ? t.name.substr(0, 25) + "..." : t.name) + " <strong>" + Math.abs(t.c) + '%</strong></div><div class="bar"><div class="red"><div style="width:' + (t.c < 0 ? Math.abs(t.c) / 2 + "px" : "0px") + '" class=indicator></div></div><div class="green"><div style="width:' + (t.c > 0 ? t.c / 2 + "px" : "0px") + '" class=indicator></div></div><div style="clear:both"></div></div><div style="clear:both"></div></div>'
    },
    changeOrder: function() {}
};
function ItemRecovery(t) {
    this.times = {},
    this.recoverAmount = 0,
    this.itemsBuffer = [],
    this.itemToConfirm = null,
    this.init = function(t) {
        if (t.length > 0)
            for (var e = 0; e < t.length; e += 2)
                this.times[t[e]] = t[e + 1],
                this.recoverAmount++;
        0 == this.recoverAmount && mAlert(_t("no_items_to_recover", null, "recover"), null, null, "msg")
    }
    ,
    this.renderBufferedItems = function() {
        for (var t = "", e = 0; e < this.itemsBuffer.length; e++) {
            var a = this.itemsBuffer[e]
              , i = {
                upgraded: "t_upg",
                unique: "t_uni",
                heroic: "t_her",
                legendary: "t_leg",
                artefact: "t_art"
            }
              , n = [];
            for (var o in i)
                if (RegExp(o).test(a.stat)) {
                    n.push(i[o]);
                    break
                }
            var s = createItem(a)
              , l = $('<div class="itemHighlighter '.concat(n.join(" "), " ").concat(4096 & hero.opt ? "nodisp" : "", '"></div>'));
            s.append(l),
            t += '<li id="recovery' + a.id + '" class="' + (e == this.itemsBuffer.length - 1 ? "last" : "") + '">' + s[0].outerHTML + '<div class="recoveryInfo"><span class="dateInfo">' + _t("item_destroyed %timeago%", {
                "%timeago%": calculateDiff(a.time, unix_time())
            }, "recover") + '</span><span class="button" onclick="g.itemRecovery.recoverItem(' + a.id + ')">' + _t("recover_1sl", null, "recover") + "</span></div></li>"
        }
        mAlert("<h4>" + _t("item_recover_header") + '</h4><p style="color:red">' + _t("item_recover_info", null, "recover") + '</p><br /><div id="itemRecoveryList">' + (0 == this.recoverAmount ? _t("no_items_on_list", null, "recover") : "<ul>" + t + "</ul>") + "</div>", null, null, "msg"),
        $("#alert").css({
            left: $("#base").offset().left + 256 - $("#alert").width() / 2
        }),
        this.recoverAmount > 8 && addScrollbar("itemRecoveryList", 370, "recoverItemScroll")
    }
    ,
    this.addItem = function(t) {
        t.time = this.times[t.id],
        this.itemsBuffer.push(t),
        this.itemsBuffer.length == this.recoverAmount && (this.itemsBuffer.sort((function(t, e) {
            return e.time - t.time
        }
        )),
        this.renderBufferedItems())
    }
    ,
    this.recoverItem = function(t) {
        this.itemToConfirm ? this.itemToConfirm == t ? _g("recovery&item=" + t) : ($("#recovery" + this.itemToConfirm + " span.button").html(_t("recover_1sl", null, "recover")),
        $("#recovery" + t + " span.button").html(_t("confirm_recover", null, "recover")),
        this.itemToConfirm = t) : (this.itemToConfirm = t,
        $("#recovery" + t + " span.button").html(_t("accept", null, "recover")))
    }
    ,
    this.removeItem = function(t) {
        $("#recovery" + t) && (this.recoverAmount--,
        $("#recovery" + t).remove(),
        this.recoverAmount <= 8 && $("#recoverItemScroll").remove())
    }
    ,
    this.init(t)
}
var PK_watch = {
    list: null,
    miniPos: 0,
    firstRun: !0,
    filter: "",
    watchList: [],
    enabled: !1,
    mini: null,
    container: null,
    firstParse: !1,
    box: null,
    hasScroll: !1,
    blockSendPkToChat: !1,
    parse: function(t) {
        if (0 != lengthObject(t))
            for (var e in this.list = {},
            t)
                this.list[e] = [t[e].id, t[e].nick, t[e].town, "", t[e].x, t[e].y];
        else
            this.list = null;
        this.firstParse = !0,
        this.updateHtml()
    },
    lvl: function(t) {
        var e = this;
        this.blockSendPkToChat || (chatSendMsg("/lvl " + t),
        this.blockSendPkToChat = !0,
        setTimeout((function() {
            e.blockSendPkToChat = !1
        }
        ), 3e3))
    },
    updateHtml: function() {
        if (this.enabled) {
            for (var t in this.container.find(".list li").addClass("old"),
            this.firstParse && (this.container.find(".waiter").remove(),
            "none" == $("#pk_filter").css("display") && $("#pk_filter").css("display", "inline")),
            this.list) {
                var e = this.list[t]
                  , a = '<div class="name">' + this.getButton(e[0]) + "<span onclick=\"PK_watch.lvl('" + e[1] + '\'); return false;" class="name">' + e[1] + '</span></div><div class="loc">' + e[2] + "<span>(" + e[4] + "," + e[5] + ")</span></div><div class=clear></div>"
                  , i = this.container.find("#pk" + e[0]).detach();
                i.length ? i.html(a).attr("class", "") : i = $(document.createElement("li")).html(a),
                i.attr("id", "pk" + e[0]);
                var n = new RegExp(this.filter,"ig");
                if ("" == this.filter || n.test(e[1])) {
                    var o = e[1].match(n);
                    "" != this.filter && i.find("div.name span.name").replaceWith(i.find("div.name span.name").html().replace(n, '<span class="sel">' + o[0] + "</span>")),
                    map.name == e[2] ? this.container.find(".list").prepend(i) : this.container.find(".list").append(i)
                }
            }
            this.container.find(".list .old").remove();
            var s = this.container.find(".list li").length;
            s > 10 && !this.hasScroll ? (addScrollbar("pk_list_container", 490, "pk_list_scroll", !1),
            this.hasScroll = !0) : this.hasScroll && s <= 10 && (removeScrollbar("pk_list_container", "pk_list_scroll"),
            this.hasScroll = !1),
            this.firstParse && (s <= 0 ? $("#pk_list_info").css("display", "block") : $("#pk_list_info").css("display", "none"))
        }
        this.showOrUpdateMini()
    },
    applyFilter: function(t) {
        this.filter = t,
        this.updateHtml(),
        this.saveSettings()
    },
    start: function(t) {
        this.enabled = !0,
        this.getSettings();
        var e = this;
        if (!this.container && this.enabled) {
            var a = $(document.createElement("input")).attr("id", "pk_filter").keyup((function(t) {
                e.applyFilter($(this).val())
            }
            )).val(this.filter);
            this.container = $(document.createElement("div")).attr("id", "pk_list").append("<h3>" + _t("pklist_header", null, "pklist") + "</h3><span class=header>" + _t("pk_filter", null, "pklist") + "</span>").append(a).append('<span class="waiter">' + _t("loading_list", null, "pklist") + "</span>"),
            this.container.append($(document.createElement("span")).click((function() {
                e.hide()
            }
            )).addClass("pk_closeButton closebut")),
            this.container.append($(document.createElement("div")).attr("id", "pk_list_container"));
            var i = $(document.createElement("ul")).addClass("list");
            this.container.find("#pk_list_container").append(i).append('<div id="pk_list_info">' + _t("list_empty", null, "pklist") + "</div>"),
            $("#centerbox").append(this.container),
            this.container.fadeIn(),
            this.enabled = !0,
            this.container.on("click", "#pk_list_container span.ctrl", (function(t) {
                var a = parseInt($(this).parent().parent().attr("id").substr(2));
                e.toggleWatch(parseInt(a))
            }
            )),
            g.lock.add("pkwatch")
        }
        _g("wanted&show=1"),
        this.update(t)
    },
    update: function(t) {
        this.getSettings(),
        isset(t) && this.parse(t),
        this.updateHtml(),
        this.watchList.length <= 0 && !this.enabled && _g("wanted&show=0")
    },
    getButton: function(t) {
        var e = this.watchList.indexOf(parseInt(t)) >= 0;
        return '<span tip="' + (e ? _t("remove_observed", null, "pklist") : _t("add_observed", null, "pklist")) + '" class="ctrl ' + (e ? "r" : "g") + '">' + (e ? "[-]" : "[+]") + "</span> "
    },
    toggleWatch: function(t) {
        this.watchList.indexOf(t) < 0 ? this.addToWatch(t) : this.removeFromWatch(t)
    },
    addToWatch: function(t) {
        var e = !1;
        if (this.watchList.indexOf(t) < 0 && this.watchList.length >= 10) {
            for (var a = 0; a < this.watchList.length; a++)
                if (!isset(this.list[this.watchList[a]])) {
                    this.watchList.splice(a, 1, t),
                    e = !0;
                    break
                }
        } else
            this.watchList.indexOf(t) < 0 && (this.watchList.push(t),
            e = !0);
        e ? (this.updateHtml(),
        this.saveSettings()) : mAlert(_t("observed_limi_reached", null, "pklist"))
    },
    removeFromWatch: function(t) {
        this.watchList.indexOf(t) >= 0 && this.watchList.splice(this.watchList.indexOf(t), 1),
        this.saveSettings(),
        this.updateHtml()
    },
    showOrUpdateMini: function() {
        var t = this;
        if (this.watchList.length > 0) {
            var e = 0
              , a = $(document.createElement("div")).addClass("pk_mini_wrapper");
            for (var i in this.list) {
                var n = this.list[i];
                if (this.watchList.indexOf(parseInt(n)) >= 0) {
                    var o = a.find(".m_loc" + n[3] + ":first")
                      , s = $(document.createElement("div")).addClass("el").addClass("m_loc" + n[3]);
                    s.append("<span class=name>" + n[1] + "</span> <span class=loc>" + n[2] + "(" + n[4] + "," + n[5] + ")</span>"),
                    n[3] == map.id ? a.prepend(s) : o.length ? s.insertBefore(o) : a.append(s),
                    e++
                }
            }
            a.append('<div style="clear:both"></div>'),
            !this.mini && e && (this.mini = $(document.createElement("div")).attr("id", "pk_mini"),
            this.mini.appendTo("#centerbox2")),
            null != this.mini && e && (this.mini.html(""),
            this.mini.append(a).append($(document.createElement("div")).addClass("list").click((function() {
                t.start()
            }
            )).attr("tip", _t("open_list", null, "pklist"))).append($(document.createElement("div")).addClass("del").click((function() {
                t.watchList = [],
                t.saveSettings(),
                t.update()
            }
            )).attr("tip", _t("clear_list", null, "pklist"))))
        } else
            null != this.mini && (this.mini.remove(),
            this.mini = null)
    },
    getSettings: function() {
        var t = getCookie("pkWatch");
        if (t) {
            t = t.split("|"),
            this.miniPos = parseInt(t[1]);
            var e = t[2].split(",");
            this.watchList = [];
            for (var a = 0; a < e.length; a++)
                isNaN(parseInt(e[a])) || this.watchList.push(parseInt(e[a]))
        }
    },
    saveSettings: function() {
        setCookie("pkWatch", "0|" + this.miniPos + "|" + (this.watchList.length ? this.watchList.join(",") : ""))
    },
    hide: function(t) {
        g.lock.remove("pkwatch"),
        (this.watchList.length <= 0 || isset(t) && t) && _g("wanted&show=0"),
        this.enabled = !1,
        this.list = null,
        this.hasScroll = !1,
        this.firstParse = !1,
        null != this.container && this.container.remove(),
        this.container = null
    }
}
  , qlog = new function(t) {
    this.init = function(t) {
        g.qlogVisible = !0;
        for (var e = [], a = 0; a < t.length; a += 5) {
            for (var i = /g/.test(t[a]), n = /d/.test(t[a]), o = "", s = t[a].replace(/g|d/, ""), l = getCookie("qtrack" + hero.id), r = t[a + 4].split("<br>"), c = [], d = 1; d < r.length; d++)
                c.push("- " + r[d].replace(/#[KB]\.([0-9]+)#/g, ""));
            (n || i) && (o = '<small class="dg_q" tip="' + (n ? _t("daily_quest", null, "quest") : _t("quild_quest", null, "quest")) + '">' + (n ? "D" : "G") + "</small>");
            var p = new Image;
            p.extId = s,
            p.src = CFG.npath + t[a + 3],
            p.onload = function() {
                var t = [];
                t.push(this.width > 50 ? 50 / this.width : 1),
                t.push(this.height > 60 ? 60 / this.height : 1);
                for (var e = 1, a = 0; a < t.length; a++)
                    t[a] < e && (e = t[a]);
                var i = $(this);
                1 !== e && i.css({
                    width: Math.floor(this.width * e),
                    heigh: Math.floor(this.height * e)
                }),
                $("#questObj_" + this.extId).append(i.addClass("questObjImg"))
            }
            ,
            e.push('<div id="questObj_' + s + '" class=questObj><h3>' + o + t[a + 1] + '<small class="btn q_abadon" onclick=cancelQuest(\'' + s + "')>abandon</small><small onclick=questTrack.toggleTrack('" + s + "') class=\"btn q_track " + (parseInt(s) == l ? "active" : "") + '" id=qtrack' + s + '>track</small></h3><div style="width:285px;">' + t[a + 2] + ': <span class="qmsg">' + r[0] + '</span><div class="auxinfo">' + c.join("<br>") + "</div></div></div>")
        }
        showDialog(("en" == _l() ? "en/" : "") + "quests-title.png", '<div class="scroll400 questlist">' + e.join("<p></p>") + "</div>")
    }
}
  , cancelQuest = function(t) {
    mAlert(_t("quest_cancel_confirm", null, "quest"), 2, [function() {
        questTrack.stopTracking(t),
        _g("quests&cancel=" + t)
    }
    ])
}
  , questTrack = new function() {
    var t = !1;
    this.trackList = {},
    this.activeTrack = null,
    this.tasks = {},
    this.gwHighlight = null,
    this.trackedNpcs = {},
    this.resetTasks = function() {
        for (var t in this.tasks = {},
        this.trackedNpcs = {},
        this.trakList)
            delete this.trakList[t].closerPos
    }
    ,
    this.checkTaskNpc = function(t) {
        var e = g.npc[t];
        if (isset(this.trackedNpcs[t]) && void 0 === e) {
            if (isset(this.trackList[this.activeTrack][this.trackedNpcs[t]].closerPos[t])) {
                var a = !1
                  , i = this.trackList[this.activeTrack][this.trackedNpcs[t]].closerPos[t];
                $("#qTarget_" + i[1] + "_" + i[2]).remove(),
                this.trackList[this.activeTrack][this.trackedNpcs[t]].pos[1] == this.trackList[this.activeTrack][this.trackedNpcs[t]].closerPos[t][1] && this.trackList[this.activeTrack][this.trackedNpcs[t]].pos[2] == this.trackList[this.activeTrack][this.trackedNpcs[t]].closerPos[t][2] && (a = this.trackedNpcs[t]),
                delete this.trackList[this.activeTrack][this.trackedNpcs[t]].closerPos[t],
                delete this.trackedNpcs[t],
                a && this.putPlaceholder(a, /#[B]\.([0-9]+)#/.test(this.trackList[this.activeTrack].data) ? "item" : "npc")
            }
        } else if (void 0 !== e && this.activeTrack) {
            var n = null;
            for (var o in this.tasks)
                if (this.tasks[o] == e.nick && (n = o),
                null == n && isset(this.trackList[this.activeTrack])) {
                    var s = this.trackList[this.activeTrack][o].pos;
                    parseInt(s[1]) == e.x && parseInt(s[2]) == e.y && (n = o)
                }
            null !== n && (this.trackedNpcs[t] = n,
            isset(this.trackList[this.activeTrack][n].closerPos) || (this.trackList[this.activeTrack][n].closerPos = {}),
            this.trackList[this.activeTrack][n].closerPos[t] = [1, e.x, e.y],
            this.removePlaceholder(this.trackList[this.activeTrack][n].closerPos[t]))
        }
    }
    ,
    this.updateQtrack = function(e) {
        "block" == $("#quests").css("display") && _g("quests"),
        $(".qArrow").remove(),
        $(".qTarget").remove(),
        $(".qtrack_placeholder").remove(),
        $(".gw").removeClass("highlight"),
        t = !0;
        var a = [];
        for (var i in $(".qArrow").remove(),
        e)
            if ("*" != e[i])
                if ("" != e[i]) {
                    var n = e[i].split("|");
                    a.indexOf(n[0]) < 0 && (a.push(n[0]),
                    this.trackList[n[0]] = []),
                    this.trackList[n[0]].push({
                        pos: n[2].split("."),
                        data: n[1],
                        txt: n[1].replace(/#[KB]\.([0-9]+)#/g, ""),
                        quest: n[0]
                    })
                } else
                    1 == e.length && this.activeTrack && isset(this.trackList[this.activeTrack]) && (delete this.trackList[this.activeTrack],
                    this.stopTracking());
            else
                this.trackList = {};
        getCookie("qtrack" + hero.id) && !this.activeTrack && this.startTracking(parseInt(getCookie("qtrack" + hero.id))),
        this.settrack && this.startTracking(this.settrack),
        t = !1,
        this.upgradeTasks(),
        this.draw()
    }
    ,
    this.toggleTrack = function(t) {
        if (t == this.activeTrack)
            return this.stopTracking();
        this.startTracking(t)
    }
    ,
    this.startTracking = function(t) {
        if (this.resetTasks(),
        this.stopTracking(),
        $(".qArrow").remove(),
        $(".qTarget").remove(),
        $(".qtrack_placeholder").remove(),
        $(".gw").removeClass("highlight"),
        this.gwHighlight = null,
        isset(this.trackList[t])) {
            var e = new Date;
            e.setTime(e.getTime() + 31104e7),
            setCookie("qtrack" + hero.id, t, e),
            $("#qtrack" + t).addClass("active"),
            this.activeTrack = t,
            this.upgradeTasks(),
            this.draw()
        } else
            this.settrack = t
    }
    ,
    this.upgradeTasks = function() {
        if (this.resetTasks(),
        this.activeTrack && isset(this.trackList[this.activeTrack])) {
            for (var t = this.trackList[this.activeTrack], e = !1, a = 0; a < t.length; a++)
                if (/#[BK]\.([0-9]+)#/.test(t[a].data)) {
                    this.tasks[a] = t[a].data.replace(/(.*?#)|\s(\(.*)/g, "");
                    var i = "item";
                    /#[B]\.([0-9]+)#/.test(t[a].data) && 4 == t[a].pos.length && (i = "npc",
                    this.tasks[a] = t[a].pos[3]),
                    this.putPlaceholder(a, i),
                    e = !0
                }
            if (e)
                for (var a in g.npc)
                    this.checkTaskNpc(a)
        }
    }
    ,
    this.putPlaceholder = function(t, e) {
        var a = this.trackList[this.activeTrack][t].pos;
        if (!isset(g.gw[a[1] + "." + a[2]])) {
            var i = a[1] + "_" + a[2]
              , n = $("#placeholder" + i);
            $("#qTarget_" + a[1] + "_" + a[2]).remove(),
            n.length || $('<div class="qtrack_placeholder ph_' + e + '" id="placeholder' + i + '"></div>').css({
                top: 32 * a[2] + 4,
                left: 32 * a[1]
            }).attr("tip", _t("quest_placeholder_" + e, {
                "%NAME%": this.tasks[t]
            }, "quest")).appendTo("#base")
        }
    }
    ,
    this.checkGwAndHighlight = function(t) {
        if (isset(this.trackList[this.activeTrack]))
            for (var e in this.trackList[this.activeTrack])
                isset(g.gwIds[t]) && this.trackList[this.activeTrack][e].pos[0] == t && ($(".gwmap" + t).addClass("highlight"),
                this.gwHighlight = t)
    }
    ,
    this.removePlaceholder = function(t) {
        var e = t[1] + "_" + t[2];
        $("#placeholder" + e).remove()
    }
    ,
    this.stopTracking = function(t) {
        void 0 !== t && t != this.activeTrack || (deleteCookie("qtrack" + hero.id),
        $(".btn.q_track").removeClass("active"),
        this.activeTrack = null,
        this.subtrack = [],
        $(".qArrow").remove(),
        $(".qTarget").remove(),
        $(".qtrack_placeholder").remove(),
        $(".gw").removeClass("highlight"),
        this.gwHighlight = null)
    }
    ,
    this.draw = function() {
        if (!t) {
            if (!isset(this.trackList[this.activeTrack]))
                return this.stopTracking();
            for (var e in this.trackList[this.activeTrack]) {
                var a = this.trackList[this.activeTrack][e].pos;
                -1 != parseInt(a[0]) && -1 != parseInt(a[1]) && -1 != parseInt(a[2]) && (parseInt(a[0]) > 0 && this.checkGwAndHighlight(a[0]),
                this.updateArrow(this.trackList[this.activeTrack][e]))
            }
        }
    }
    ,
    this.updateArrow = function(t) {
        var e = t.pos.join("_").replace(" ", "_")
          , a = t.pos;
        if (isset(t.closerPos)) {
            var i = null
              , n = [t.pos];
            for (var o in t.closerPos)
                n.push(t.closerPos[o]);
            for (var o in n) {
                var s = n[o]
                  , l = hero.rx - parseInt(s[1])
                  , r = hero.ry - parseInt(s[2])
                  , c = Math.max(Math.abs(l), Math.abs(r));
                (null === i || i > c) && (i = c,
                a = n[o],
                $(".qTarget").remove())
            }
        }
        var d = hero.rx - parseInt(a[1])
          , p = hero.ry - parseInt(a[2])
          , h = Math.max(Math.abs(d), Math.abs(p))
          , u = Math.min(99, 16 * Math.sqrt(d * d + p * p))
          , m = Math.min(130, 16 * Math.sqrt(d * d + p * p));
        h ? (d = Math.round(u * d / h),
        p = Math.round(u * p / h)) : (d = 0,
        p = 0);
        var f = $("#qArrow_" + e)
          , v = $('[pos="' + a[1] + "_" + a[2] + '"]');
        if (!f.length) {
            var _ = [];
            if (v.length)
                for (var o in f = v,
                this.trackList[this.activeTrack]) {
                    var b = this.trackList[this.activeTrack][o];
                    a[1] == b.pos[1] && a[1] == b.pos[1] && _.push(b.txt)
                }
            else
                _.push(t.txt),
                f = $('<div class="qArrow" notippropagation="1" id="qArrow_' + e + '"></div>').appendTo("#base").click((function(t) {
                    t.stopPropagation()
                }
                )).attr("pos", a[1] + "_" + a[2]);
            f.attr("tip", _.join("<br />"))
        }
        var k = m - 130 + 80
          , w = k >= 80 ? 1 : k <= 0 ? 0 : k / 80;
        if (!$("#placeholder" + a[1] + "_" + a[2]).length && !isset(g.gw[a[1] + "." + a[2]])) {
            v = $("#qTarget_" + a[1] + "_" + a[2]);
            w < 1 ? v.length || (v = $('<div class="qTarget" id="qTarget_' + a[1] + "_" + a[2] + '"></div>').appendTo("#base")) : $("#qTarget_" + a[1] + "_" + a[2]).remove(),
            v.css({
                opacity: 1 - w,
                top: 32 * a[2] + 14,
                left: 32 * a[1] + 16 - 26
            })
        }
        f.css({
            backgroundPosition: -24 * Math.round(12 + 8 * Math.atan2(p, d) / Math.PI) + "px 0",
            display: w <= 0 ? "none" : "block"
        }).css({
            opacity: .6 * (w > 0 ? Math.min(1, w) : 1),
            left: 32 * hero.rx + hero.fw / 2 - d - 12,
            top: 32 * hero.ry - p
        })
    }
}
  , Highlighter = new function() {
    this.darkboxes = {
        top: null,
        right: null,
        bottom: null,
        left: null
    },
    this.coords = null,
    this.lightArea = function(t, e, a, i) {
        this.coords = arguments,
        this.onresize(),
        __tutorials.onresize()
    }
    ,
    this.onresize = function() {
        if (null !== this.coords) {
            var t = $("#centerbox").offset()
              , e = $(window).height()
              , a = $(window).width();
            for (var i in this.darkboxes) {
                null === this.darkboxes[i] && (this.darkboxes[i] = $('<div class="highlighter_darkbox"></div>'),
                this.darkboxes[i].appendTo("body"));
                var n = {};
                switch (i) {
                case "top":
                    n = {
                        width: a,
                        height: t.top + this.coords[1],
                        top: 0,
                        left: 0
                    };
                    break;
                case "right":
                    n = {
                        width: a - (t.left + this.coords[0] + this.coords[2]),
                        height: this.coords[3],
                        top: t.top + this.coords[1],
                        left: t.left + this.coords[2] + this.coords[0]
                    };
                    break;
                case "bottom":
                    n = {
                        width: a,
                        height: e - (t.top + this.coords[3] + this.coords[1]),
                        top: t.top + this.coords[3] + this.coords[1],
                        left: 0
                    };
                    break;
                case "left":
                    n = {
                        width: t.left + this.coords[0],
                        height: this.coords[3],
                        top: t.top + this.coords[1],
                        left: 0
                    }
                }
                this.darkboxes[i].css(n)
            }
        }
    }
    ,
    this.hide = function() {
        if (null !== this.coords) {
            for (var t in this.darkboxes)
                this.darkboxes[t].remove(),
                this.darkboxes[t] = null;
            this.coords = null
        }
    }
    ,
    this.startH = new function(t) {
        this.p = t,
        this.req = {
            npc: !1,
            hero: !1,
            tutorial: !1
        },
        this.npcid = null,
        this.synchroStart = function(t) {
            for (var e in this.req[t] = !0,
            this.req)
                if (!this.req[e])
                    return;
            null !== this.npcId && this.show()
        }
        ,
        this.show = function() {
            $("#centerbox").offset();
            var t = [0, 0, 0, 0]
              , e = g.npc[this.npcId]
              , a = $("#base").scrollTop()
              , i = $("#base").scrollLeft();
            hero.y > e.y ? (t[1] = parseInt($("#npc" + this.npcId).css("top")),
            t[3] = Math.abs(parseInt($("#npc" + this.npcId).css("top")) - (parseInt($("#hero").css("top")) + hero.fh))) : (t[1] = parseInt($("#hero").css("top")),
            t[3] = Math.abs(parseInt($("#hero").css("top")) - (parseInt($("#npc" + this.npcId).css("top")) + g.npc[this.npcId].fh))),
            hero.x > e.x ? (t[0] = parseInt($("#npc" + this.npcId).css("left")),
            t[2] = Math.abs(parseInt($("#npc" + this.npcId).css("left")) - (parseInt($("#hero").css("left")) + hero.fw))) : (t[0] = parseInt($("#hero").css("left")),
            t[2] = Math.abs(parseInt($("#hero").css("left")) - (parseInt($("#npc" + this.npcId).css("left")) + g.npc[this.npcId].fw))),
            t[0] -= i,
            t[1] -= a,
            this.p.lightArea.apply(this.p, t)
        }
    }
    (this),
    this.startG = new function(t) {
        this.p = t,
        this.synchroStart = function(t) {
            var e = null;
            switch (t) {
            case 1063:
                e = [224, 384, 64, 32];
                break;
            case 1095:
                e = [224, 416, 64, 32];
                break;
            case 1076:
                e = [192, 384, 96, 32];
                break;
            case 1061:
                e = [224, 416, 96, 32];
                break;
            case 1091:
                e = [256, 352, 32, 32];
                break;
            case 583:
                e = [288, 320, 64, 32]
            }
            this.p.lightArea.apply(this.p, e)
        }
    }
    (this)
}
;
function shake() {
    this.shakeCounter = 0;
    var t = this;
    this.interval = setInterval((function() {
        var e = map.scrollpos;
        if (50 == t.shakeCounter)
            return clearInterval(t.interval),
            $("#base").scrollTop(e[1]),
            void $("#base").scrollLeft(e[0]);
        var a = Math.random() > .5 ? -1 : 1
          , i = Math.random() > .5 ? -1 : 1;
        $("#base").scrollTop(Math.ceil(10 * Math.random() * a) + e[1]),
        $("#base").scrollLeft(Math.ceil(10 * Math.random() * i) + e[0]),
        t.shakeCounter++
    }
    ), 30)
}
var EndOfTheWorld = new function() {
    this.val = {},
    this.started = !1,
    this.endTimeout = null,
    this.endTimeout2 = null,
    this.timeoutShake = function() {
        var t = this;
        shake(),
        this.endTimeout2 = setTimeout((function() {
            t.timeoutShake()
        }
        ), 1e3 * Math.round(30 * Math.random() + 45))
    }
    ,
    this.check = function(t) {
        if (this.val = t.split(";"),
        parseInt(this.val[0])) {
            if (!this.started) {
                var e = this;
                this.endTimeout = setTimeout((function() {
                    e.timeoutShake()
                }
                ), 1e3 * Math.round(15 * Math.random() + 15)),
                this.started = !0
            }
        } else
            clearTimeout(this.endTimeout),
            clearTimeout(this.endTimeout2),
            this.started = !1
    }
}
  , _mPos = new function() {
    this.buffer = [],
    this.flushInterval = null,
    this.queue = !1,
    this.activeAddon = null,
    this.uninstallTmpType = null,
    this.init = function() {
        var t = this;
        $(document).bind("mousemove click", (function(e) {
            t.event(e)
        }
        )),
        this.flushInterval = setInterval((function() {
            t.flush()
        }
        ), 1e4)
    }
    ,
    this.flush = function() {
        this.buffer.length >= 100 && (this.queue = this.buffer.join(";"),
        this.buffer = [])
    }
    ,
    this.getQueue = function() {
        var t = this.queue;
        return this.queue = !1,
        t
    }
    ,
    this.event = function(t) {
        var e = "keydown" == t.type ? t.which : t.clientX + 1e4 * (t.clientY + 1);
        this.buffer.length >= 100 && this.buffer.splice(0, 1),
        isNaN(e) || this.buffer.push("keydown" == t.type ? t.which : t.clientX + 1e4 * (t.clientY + 1))
    }
    ,
    this.init()
}
  , extManager = new function() {
    var t = this
      , e = _t("default_comment_txt", null, "extManager");
    function a(e) {
        var a = t.getRequestedBuildTypeByParams();
        "v" != a || t.activeAddon.verified || (a = "p");
        var i = t.getCookie();
        t.scrollEventParams;
        i[e] = a,
        t.saveCookie(i),
        t.refreshControlls(e)
    }
    function i() {
        var e, a = t.getRequestedBuildTypeByParams();
        switch ("v" != a || t.activeAddon.verified || (a = "p"),
        a) {
        case "v":
            e = "verified";
            break;
        case "p":
            e = "public";
            break;
        case "d":
            e = "dev"
        }
        return "https://addons2.margonem.pl/get/" + Math.floor(t.activeAddon.id / 1e3) + "/" + t.activeAddon.id + e + ".js"
    }
    this.activePanel = null,
    this.searchDelay = null,
    this.scrollEvent = function() {
        if (!($("#" + this.activePanel + " .view_port .content_loader").length || Math.ceil(t.amount / t.limit) <= this.lastPage)) {
            this.scrollEventParams.page = null === this.lastPage ? 1 : this.lastPage + 1;
            var e = [];
            for (var a in this.scrollEventParams) {
                var i = this.scrollEventParams[a];
                null !== i && e.push(a + "=" + i)
            }
            $("#" + this.activePanel + " .view_port").append('<div class="content_loader">' + _t("loading_content", null, "extManager") + "</div>"),
            this.call("list?" + e.join("&"))
        }
    }
    ,
    this.updateList = function(e) {
        var a = this.printList(e.addons);
        $("#" + this.activePanel + " .view_port .content_loader").replaceWith(a),
        isset(e.l) && (t.limit = e.l),
        isset(e.am) && (t.amount = e.am),
        isset(e.p) && (t.lastPage = e.p)
    }
    ,
    this.printList = function(t) {
        for (var e = $("<div class=page></div>"), a = 0; a < t.length; a++) {
            var i = '<div id="addon_' + t[a].id + '" onclick="extManager.callDetails(' + t[a].id + ')" class=addon>';
            i += '<div class="image" ' + (t[a].img_url ? "" : 'tip="' + _t("no_image", null, "extManager") + '"') + ' style="' + (t[a].img_url ? "background-image:url(https://addons2.margonem.pl" + t[a].img_url + ")" : "background-image:url(/img/addon_holder.png?v=".concat(_CLIENTVER, ")")) + '"></div>',
            i += "<div class=description>",
            i += "<h2 class=name>" + t[a].name + "</h2>",
            i += "<div class=author>" + t[a].acc_name + "</div>";
            var n = t[a].points > 0 ? "plus" : t[a].points < 0 ? "minus" : "zero";
            i += '<div class="point_holder"><span tip="' + _t("addon_points_tip", null, "extManager") + '" class="ptVal' + n + '">' + (t[a].points > 0 ? "+" : "") + t[a].points + "</span>",
            0 == t[a].attr && (i += "<div class=old>" + _t("update_needed", null, "extManager") + ' <span class=update onclick="extManager.update(' + t[a].id + ')">' + _t("update_me", null, "extManager") + "</span></div>"),
            i += "</div>",
            i += "</div>",
            e.append(i)
        }
        return e
    }
    ,
    this.printControlls = function(t) {
        var e = this.getCookie()
          , a = "";
        return isset(e[t]) || (a += '<span tip="' + _t("install_tip", null, "extManager") + '" class="install button" onclick="extManager.install(' + t + ')">' + _t("ad_install", null, "extManager") + "</span>"),
        isset(e[t]) && (a += '<span tip="' + _t("uninstall_tip", null, "extManager") + '" class="uninstall button" onclick="extManager.uninstall(' + t + ')">' + _t("ad_uninstall", null, "extManager") + "</span>"),
        a += '<span tip="' + _t("closeaddon_tip", null, "extManager") + '" class="close button" onclick="extManager.addonClose(' + t + ')">' + _t("ad_close", null, "extManager") + "</span>"
    }
    ,
    this.call = function(t, e, a) {
        var i = a || "GET"
          , n = "https://public-api.margonem.pl/addons/" + t;
        $.ajax({
            url: n,
            data: isset(e) ? e : {},
            type: i,
            xhrFields: {
                withCredentials: !0
            },
            crossDomain: !0,
            dataType: "json",
            success: this.parseResponse
        })
    }
    ,
    this.parseResponse = function(e) {
        isset(e.list) && t.updateList(e.list),
        isset(e.update) && t.updateInfo(e.update),
        isset(e.addon) && t.addonDetails(e.addon),
        isset(e.message) && mAlert(_t(e.message, null, "extManager"))
    }
    ,
    this.callDetails = function(t) {
        this.call("details/" + t, null)
    }
    ,
    this.addonDetails = function(t) {
        this.activeAddon = t;
        var a = '<div id="addonDetails">';
        a += "<div>",
        a += '<div class="image" ' + (t.img_url ? "" : 'tip="' + _t("no_image", null, "extManager") + '"') + ' style="' + (t.img_url ? "background-image:url(https://addons2.margonem.pl" + t.img_url + ")" : "background-image:url(/img/addon_holder.png?v=".concat(_CLIENTVER, ")")) + '"></div>',
        a += "<div class=description>";
        var i = t.points > 0 ? "plus" : t.points < 0 ? "minus" : "zero"
          , n = '<div><div class="ptValBox"><span tip="' + _t("addon_points_tip", null, "extManager") + '" class="ptVal' + i + '">' + (t.points > 0 ? "+" : "") + t.points + '</span></div><div onclick="extManager.toggleLike(' + t.id + ", 'like')\" tip=\"" + _t("addon_like", null, "extManager") + '" class="ad_points_but like ' + (1 === t.like ? "active" : "") + '"></div><div onclick="extManager.toggleLike(' + t.id + ", 'unlike')\" tip=\"" + _t("addon_unlike", null, "extManager") + '" class="ad_points_but unlike ' + (-1 === t.like ? "active" : "") + '"></div>' + (t.reported ? "" : '<div onclick="extManager.report(' + t.id + ')" tip="' + _t("addon_report", null, "extManager") + '" class="ad_points_but report"></div>') + "</div>";
        if (a += "<h2 class=name>" + t.name + "</h2>",
        a += '<div class=author><a target="_blank" href="https://www.margonem.pl/profile/view,' + t.acc_id + '">' + t.acc_name + "</a></div>",
        a += "<div class=infoBox>" + _t("created_at %time%", {
            "%time%": ut_date(t.created_at)
        }, "extManager") + "<br />" + n + "</div>",
        a += "<div class=controlls>" + this.printControlls(t.id) + "</div>",
        a += "</div>",
        a += '<div class="content">',
        a += "<div class=contentWrapper>",
        a += "<p>" + t.description + "</p>",
        a += "<div class=commentBox>",
        a += "<strong>" + _t("add_comment", null, "extManager") + "</strong>",
        a += "<textarea id=addonCommentArea>" + e + "</textarea><br />",
        a += '<span tip="' + _t("comment_tip", null, "extManager") + '" class="comment button" onclick="extManager.publishComment(' + t.id + ')">' + _t("ad_comment", null, "extManager") + "</span>",
        a += "<div class=commentsList>",
        t.comments.length)
            for (var o = 0; o < t.comments.length; o++) {
                var s = t.comments[o]
                  , l = calculateDiff(t.comments[o].created_at, unix_time());
                a += "<div class=singlecomment><span class=nick>" + s.nick + '</span> <span class="time">(' + l + ")</span> " + s.body + "</div>"
            }
        else
            a += _t("no_addon_comments");
        a += "</div>",
        a += "</div>",
        a += "</div>",
        a += "</div>",
        a += "</div>",
        a += "</div>",
        $("#addonDetails").remove(),
        $("#addons").append(a);
        $("#addonCommentArea").click((function() {
            $(this).val() == e && $(this).val("")
        }
        )).blur((function() {
            "" == $(this).val() && $(this).val(e)
        }
        ))
    }
    ,
    this.publishComment = function(t) {
        var a = $("#addonCommentArea").val();
        if (a == e || "" == a)
            return mAlert(_t("give_comment_txt", null, "extManager"));
        this.call("details/" + t, {
            comment: a
        }, "POST")
    }
    ,
    this.report = function(t) {
        if (!this.activeAddon.reported) {
            var e = this;
            mAlert(_t("report_reason", null, "extManager"), 3, [function() {
                !function(a) {
                    if ("" == a || a.length < 5)
                        return mAlert(_t("report_short", null, "extManager"));
                    e.call("details/" + t, {
                        report: a
                    }, "POST")
                }($('#alert input[name="mAlertInput"]').val())
            }
            ])
        }
    }
    ,
    this.toggleLike = function(t, e) {
        this.call("details/" + t, {
            like: e
        }, "POST")
    }
    ,
    this.addonClose = function() {
        $("#addonDetails").remove(),
        this.activeAddon = null,
        this.uninstallTmpType = null
    }
    ,
    this.task = function(t, e) {
        var a = null
          , i = null;
        "object" == _typeof(t) ? (i = t.tab,
        a = t.type) : i = t,
        g.lock.add("addons"),
        tutorialStart(13);
        if ($(".add_list_menu .menu_element").removeClass("active"),
        ["add_list", "add_mine", "add_active", "add_help"].indexOf(i) >= 0) {
            if (!(i != this.activePanel || isset(e) && e))
                return;
            $(".content_loader").remove(),
            this.clearActivePanel(),
            $("#addons>DIV:not(#addon_search_div)").hide(),
            $("#addons,#addonspanel").show(),
            $("#" + i).show(),
            this.activePanel = i
        }
        switch (i) {
        case "add_list":
            $("#addon_search_div").show(),
            this.scrollEventParams.tab = "all",
            a ? this.scrollEventParams.type = a : (this.scrollEventParams.type = "all",
            $("#ad_opt_all").addClass("active")),
            this.scrollEvent();
            break;
        case "add_mine":
            $("#addon_search_div").show(),
            this.scrollEventParams.tab = "mine",
            this.scrollEvent();
            break;
        case "add_active":
            $("#addon_search_div").show(),
            this.scrollEventParams.tab = "installed",
            this.scrollEventParams.ids = this.getCookie(!0),
            this.scrollEvent();
            break;
        case "quit":
            $("#addon_search_div").hide(),
            this.exit();
            break;
        case "add_help":
            $("#addon_search_div").hide()
        }
    }
    ,
    this.getRequestedBuildTypeByParams = function() {
        if (null !== this.uninstallTmpType)
            return this.uninstallTmpType;
        var t = null
          , e = this.scrollEventParams;
        return "all" == e.tab && ("all" != e.type && "badged" != e.type && "popular" != e.type || (t = "v"),
        "unverified" == e.type && (t = "p")),
        "mine" == e.tab && (t = "d"),
        t
    }
    ,
    this.install = function(e) {
        t.activeAddon.verified ? a(e) : mAlert(_t("install-not-verified-addon %url%", {
            "%url%": i()
        }), 2, [function() {
            a(e)
        }
        , function() {}
        ])
    }
    ,
    this.uninstall = function(t) {
        var e = this.getCookie();
        isset(e[t]) && ("installed" == this.scrollEventParams.tab && (this.uninstallTmpType = e[t]),
        delete e[t]),
        this.saveCookie(e),
        this.refreshControlls(t)
    }
    ,
    this.refreshControlls = function(t) {
        $("#addonDetails .controlls").html(this.printControlls(t))
    }
    ,
    this.getCookie = extMgrCookieGet,
    this.saveCookie = function(t) {
        var e = [];
        for (var a in t)
            e.push(t[a].toString() + a);
        var i = new Date;
        i.setTime(i.getTime() + 31104e7),
        setCookie("__mExts", e.join(","), i)
    }
    ,
    this.clearActivePanel = function() {
        $("#" + this.activePanel + " .view_port").html(""),
        this.activePanel = null,
        this.scrollEventParams = {
            type: null,
            tab: "all",
            page: 1,
            name: void 0 !== this.scrollEventParams ? this.scrollEventParams.name : null,
            ids: null
        },
        this.addonClose(),
        this.limit = null,
        this.amount = null,
        this.lastPage = null
    }
    ,
    this.exit = function() {
        this.clearActivePanel(),
        $("#addons,#addonspanel").hide(),
        g.lock.remove("addons")
    }
    ,
    $(document).ready((function() {
        $(".view_port").on("scroll", (function(e) {
            $(this).prop("scrollHeight") - $(this).scrollTop() - $(this).height() <= 0 && t.scrollEvent()
        }
        )),
        $(".add_list_menu .menu_element").click((function() {
            $(".add_list_menu .menu_element").removeClass("active");
            var e = $(this).attr("id").substr(7);
            t.task({
                type: e,
                tab: "add_list"
            }, !0),
            $(this).addClass("active")
        }
        )),
        $("#addon_search").keyup((function() {
            t.scrollEventParams.name = $("#addon_search").val();
            null !== t.searchDelay && clearTimeout(t.searchDelay),
            t.searchDelay = setTimeout((function() {
                if ("add_list" == t.activePanel) {
                    var e = $(".add_list_menu .menu_element.active")
                      , a = e.attr("id").substr(7);
                    t.task({
                        type: a,
                        tab: t.activePanel
                    }, !0),
                    e.addClass("active")
                } else
                    t.task(t.activePanel, !0)
            }
            ), 500)
        }
        ))
    }
    ))
}
  , waitItemManage = new function() {
    this.list = [],
    this.add = function(t) {
        this.list.indexOf(t) < 0 && ($("#itemWaitBox .items-container").prepend('<div class="itemWrapper" id="itemWaitWrapper' + t + '"></div>'),
        this.list.push(t)),
        $("#itemWaitWrapper" + t).append(createItem(g.item[t])),
        this.check()
    }
    ,
    this.remove = function(t) {
        var e = this.list.indexOf(t);
        e >= 0 && ($("#itemWaitWrapper" + t).remove(),
        this.list.splice(e, 1),
        this.check())
    }
    ,
    this.check = function() {
        this.list.length ? $("#itemWaitBox").show() : $("#itemWaitBox").hide()
    }
}
;
function initItemChanger(t) {
    g.itemChanger || (g.itemChanger = new itemChanger,
    g.itemChanger.init()),
    g.itemChanger.update(t)
}
function initBarter(t) {
    g.barter || (g.barter = new barter,
    g.barter.init()),
    g.barter.update(t)
}
function initChooseOutfit(t) {
    g.chooseOutfit && g.chooseOutfit.close(),
    g.chooseOutfit = new chooseOutfit,
    g.chooseOutfit.init(),
    g.chooseOutfit.update(t)
}
function initCaptcha(t) {
    g.captcha || (g.captcha = new captcha),
    g.captcha.update(t)
}
function initPoll() {
    g.poll || (g.poll = new poll,
    g.poll.init())
}
function initRewardsCalendar(t) {
    g.rewardsCalendar || (g.rewardsCalendar = new rewardsCalendar),
    g.rewardsCalendar.update(t)
}
function smoczeKuferki(t, e) {
    g.chests.createAllChests(e, t.items_offers)
}
function initDragonChests() {
    g.chests = new dragonChests
}
function initMCAddon() {
    g.mCAddon = new MCAddon
}
function initSMCAddon() {
    g.sMCAddon = new SMCAddon
}
function initPrePremium() {
    g.prePremium = new prePremiumPanel
}
function initLootPreview(t) {
    g.lootPreview && g.lootPreview.close(),
    g.lootPreview = new LootPreview,
    g.lootPreview.init(),
    g.lootPreview.update(t)
}
function initMatchmakingSummary() {
    g.matchmakingSummary = new matchmakingSummary
}
function callSmoczeKuferki() {
    if ("pl" == _l())
        return shop_close(),
        _g("creditshop&npc=436")
}
function initMatchmakingTutorialManager() {
    g.matchmakingTutorial = new MatchmakingTutorial
}
function initTplsManager() {
    g.tplsManager = new tplsManager
}
function initMessageController() {
    g.messageController = new messageController,
    g.messageController.init()
}
function initChatController() {
    newChatMode && (g.chatController = new ChatController,
    g.chatController.init())
}
function initBusinessCardsManager() {
    newChatMode && (g.businessCardManager = new BusinessCardsManager,
    g.businessCardManager.init())
}
function initNightController() {
    g.nightController = new nightController,
    g.nightController.init()
}
function initDisableItemsManager() {
    g.disableItemsManager = new disableItemsManager,
    g.disableItemsManager.init()
}
function initItemsMovedManager() {
    g.itemsMovedManager = new itemsMovedManager,
    g.itemsMovedManager.init()
}
function initQuestLog() {
    g.questLog = new questLog,
    g.questLog.init()
}
function showPremiumPanel() {
    $("#premiumshop").show()
}
function initPremiumShop() {
    for (var t = 0; t < 16; t++) {
        var e = _t("premium_item_" + t, null, "premium_panel");
        "pl" != _l() || 0 != t && 12 != t || (e = _t("premium_item_pl_" + t, null, "premium_panel"));
        var a = $('<div tip="' + e + '" class="premiumItem" onclick="premiumShopItemClick(' + t + ')"></div>');
        a.css({
            top: 36 + 107 * Math.floor(t / 4) + (Math.floor(t / 4) > 1 ? Math.floor(t / 4) - 1 : 0),
            left: 28 + t % 4 * 124
        });
        var i = t;
        "en" == _l() && (2 == t && (i = 11),
        t > 10 && (i += 1),
        16 == i && (i = 2)),
        a.append($("<div class=item_bg></div>").css({
            backgroundPosition: -i % 6 * 81 + "px " + (-621 - 84 * Math.floor(i / 6)) + "px"
        })),
        $("#premiumshop .items_wrapper").append(a)
    }
}
function premiumShopItemClick(t) {
    if (!g.lock.check("shop") && !g.lock.check("staminashop")) {
        var e = "pl" == _l() ? [436, 306, "stamina", "gold", 297, 301, 296, 298, 302, 299, 303, 294, 304, 295, 293, 300] : [73821, 73822, 73830, "gold", 73823, 73824, 73825, 73826, 73827, 73828, 73829, 73831, 73832, 73833, 73834, 74122];
        isset(e[t]) && ("gold" == e[t] && _g("creditshop&credits_gold=-1"),
        "stamina" == e[t] && showStaminaShop(),
        "number" == typeof e[t] && _g("creditshop&npc=" + e[t]))
    }
}
var codeManager = new function() {
    var t = this
      , e = null
      , a = null
      , i = null
      , n = null
      , o = []
      , s = !1
      , l = this;
    this.showCodeInputWindow = function() {
        mAlert(_t("give_promo_code", null, "codeManager"), 3, [function() {
            t.sendCode($(".mAlertInputContainer input").val())
        }
        ])
    }
    ,
    this.sendCode = function(t) {
        this.reset(),
        e = t,
        _g("codeprom&code=" + t)
    }
    ,
    this.prepareItemBoxes = function() {
        var e = $("<div class=item_boxes_inner></div>");
        if (null === n)
            return i;
        for (var a = 0; a < 3; a++)
            if (n[a].length) {
                var o = $("<div class=item_group id=item_group_" + a + "></div>")
                  , s = function() {
                    var t = n[a][r]
                      , e = $('<div class=item id="item' + t.id + "\" ctip=t_item tip='" + t.tip + "'></div>");
                    e.css({
                        top: t.y % 3 * 33 + 1,
                        left: 33 * t.x + 1
                    }),
                    e.click((function() {
                        l.showMenuItem(t, e)
                    }
                    )),
                    o.append(e)
                };
                for (var r in n[a])
                    s();
                o.append($('<div id="choose_' + a + '" class="promogroup_button">' + _t("promo_choose", null, "promocodes") + "</div>").click(t.choosegroup)),
                isset(n[a + 1]) && n[a + 1].length && o.append('<div class="or_container">' + _t("promo_or", null, "promocodes") + "</div>"),
                e.append(o)
            }
        return e
    }
    ,
    this.showMenuItem = function(t, e) {
        if (isset(parseItemStat(t.stat).canpreview)) {
            var a = '_g("moveitem&st=2&tpl=' + t.tpl + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
            showMenu({
                target: e
            }, [[_t("show", null, "item"), a, !0]])
        }
    }
    ,
    this.choosegroup = function(a) {
        if (s)
            return !1;
        var i = parseInt($(a.target).attr("id").substr(7)) + 1;
        $("#alert").hide(),
        _g("codeprom&code=" + e + "&opt=" + i, (function() {
            t.reset
        }
        ))
    }
    ,
    this.updateItems = function() {
        o.indexOf("items") < 0 && o.push("items"),
        this.createBonusWindow()
    }
    ,
    this.updateBonusWindow = function(t) {
        a = t,
        o.indexOf("data") < 0 && o.push("data"),
        this.createBonusWindow()
    }
    ,
    this.createBonusWindow = function() {
        if (!(o.indexOf("data") >= 0 && o.indexOf("items") >= 0))
            return !1;
        var t = "";
        t += '<div class="promocodes">',
        t += "<div class=promoname>" + a.name + "</div>",
        t += "<div class=promodesc>" + a.desc + "</div>",
        a.used && (t += "<div class=promoalert>" + a.used + "</div>",
        s = !0),
        a.expire > 0 && a.expire < unix_time() && (t += "<div class=promoexpirealert>" + _t("promo_expired", null, "promocodes") + "</div>",
        s = !0),
        t += '<div id="item_boxes"></div>',
        t += "</div>";
        for (var e = 0, i = 0; i < 3; i++)
            e += n[i].length ? 1 : 0;
        t += "<div class=aux_bottom_info>",
        e > 1 && (t += "<div>" + _t("multiple_group_info", null, "promocodes") + "</div>"),
        t += "<div>" + (0 != a.usage_limit ? _t("promo_use_count %use% %max%", {
            "%use%": a.usage_limit - a.usage_count
        }, "promocodes") : _t("promo_unlimited %use% %max%", null, "promocodes")) + "</div>",
        t += "</div>",
        mAlert(t, 1),
        $("#a_ok").hide(),
        s && $("#alert .promocodes").addClass("inactive"),
        $("#item_boxes").append(this.prepareItemBoxes()),
        $("#alert").absCenter()
    }
    ,
    this.addItem = function(t) {
        null === n && (n = [[], [], []]);
        var e = Math.floor(t.y / 3);
        n[e].push(t)
    }
    ,
    this.reset = function() {
        e = null,
        i = null,
        o = [],
        n = null,
        a = null,
        s = !1
    }
}
;
ingameRegistration = new function() {
    var t = this
      , e = null;
    this.show = function() {
        var t = _t("reg_header", null, "ingame_register")
          , e = '<div class="registration-wrapper"><div class="header">' + _t("complete_registration", null, "ingame_register") + '<div class="mark-outer"><div class="mark"></div></div></div><div class="short-info"></div><div class="main-container"><div class="input-section"><div class="section-wrapper login"><div class="row r_login"><label for="r_login">' + _t("reg_login_label", null, "ingame_register") + '</label><div class=input-wrapper><input id="r_login" /></div></div><div class="row r_password"><label for="r_pass">' + _t("reg_passwd_label", null, "ingame_register") + '</label><div class=input-wrapper><input type=password id="r_pass" /></div></div></div><div class="section-wrapper email"><div class="row r_email"><label for="r_email">' + _t("reg_email_label", null, "ingame_register") + '</label><div class=input-wrapper><input id="r_email" /></div></div></div><div class="section-wrapper born"><div class="row birth"><label for="r_bdate_day">' + _t("reg_birth_label", null, "ingame_register", "ingameRegistration.save()") + '</label><div class=birth-wrapper><div class="input-wrapper birth-day"><input placeholder="dd" maxlength=2 id="r_bdate_day" /></div><div class="input-wrapper birth-month"><input placeholder="mm" maxlength=2 id="r_bdate_month" /></div><div class="input-wrapper birth-year"><input placeholder="yyyy" maxlength=4 id="r_bdate_year" /></div></div></div></div><div class="save-area">' + drawButton(_t("save_form", null, "ingame_register"), "ingameRegistration.save()") + '</div></div><div class="reward-section"><div class=inner><div class=header>' + _t("rew_head", null, "ingame_register") + '<div class="mark-outer"><div class="mark"></div></div></div><div class="rewards-row row1"><div class="rew-info-holder"></div><div class="reward-box" id=rewards0><div class="item0 item-wrapper-register"></div><div class="item1 item-wrapper-register"></div><div class="item2 item-wrapper-register"></div></div></div><div class="rewards-row row2"><div class="rew-info-holder"></div><div class="reward-box" id=rewards1><div class="item0 item-wrapper-register"></div><div class="item1 item-wrapper-register"></div><div class="item2 item-wrapper-register"></div></div></div><div class="rewards-row row3"><div class="rew-info-holder"></div><div class="reward-box" id=rewards2><div class="item0 item-wrapper-register"></div><div class="item1 item-wrapper-register"></div><div class="item2 item-wrapper-register"></div></div></div><div class="mark-outer"><div class="mark"></div></div><div class="collect-area">' + drawButton(_t("collect_form", null, "ingame_register"), "ingameRegistration.collect()") + '</div></div></div></div><div class="check-area" onclick="ingameRegistration.checkbox()"><div class="checkbox_wrapper" id="check_reg"></div>' + _t("dont_show_again", null, "ingame_register") + "</div></div>";
        showEnWindow(t, e),
        this.init()
    }
    ,
    this.collect = function() {
        _g("registernoob&collect=1")
    }
    ,
    this.save = function() {
        var a = {
            regcomp: !1,
            chmail: !1,
            chbdate: !1
        }
          , i = "";
        for (var n in a) {
            var o = {
                chash: getCookie("chash"),
                user_id: getCookie("user_id")
            };
            switch (n) {
            case "regcomp":
                if (e.login)
                    continue;
                o.login = $("#r_login").val(),
                o.pass = $("#r_pass").val(),
                i = "regcomp";
                break;
            case "chmail":
                if (!e.login || e.email)
                    continue;
                o.newmail = $("#r_email").val(),
                o.newmail2 = $("#r_email").val(),
                i = "chmail";
                break;
            case "chbdate":
                if (!e.login || e.born)
                    continue;
                o.bdate = $("#r_bdate_year").val() + "-" + $("#r_bdate_month").val() + "-" + $("#r_bdate_day").val(),
                i = "chbdate"
            }
            var s = setTimeout((function() {
                _g("registernoob")
            }
            ), 100);
            !function(e) {
                clearTimeout(s),
                $.ajax({
                    url: "http://margonem.com/ajax/" + e,
                    type: "post",
                    dataType: "json",
                    data: o,
                    success: function(i) {
                        a[e] = !0,
                        t.validate(e, i),
                        clearTimeout(s),
                        s = setTimeout((function() {
                            _g("registernoob")
                        }
                        ), 100)
                    }
                })
            }(i)
        }
    }
    ,
    this.validate = function(t, e) {
        var a = null;
        switch (t) {
        case "regcomp":
            a = $(".section-wrapper.login");
            break;
        case "chmail":
            a = $(".section-wrapper.email");
            break;
        case "chbdate":
            a = $(".section-wrapper.born")
        }
        if (a) {
            var i = a.find(".msg_holder");
            i.length || (i = $('<div class="msg_holder"></div>'),
            a.append(i)),
            i.attr("tip", e.msg),
            e.ok ? i.addClass("isok").attr("tip", _t("correct", null, "ingame_register")) : i.removeClass("isok")
        }
    }
    ,
    this.addItem = function(t) {
        var e = g.item[t];
        $("#rewards" + e.y + " .item" + e.x).html(createItem(e))
    }
    ,
    this.parseRegisternoobInfo = function(t) {
        e = t;
        var a = ["email", "born"]
          , i = !0;
        for (var n in 1 == t.login ? $(".registration-wrapper .short-info").html(_t("register_info_short2", null, "ingame_register")) : $(".registration-wrapper .short-info").html(_t("register_info_short", null, "ingame_register")),
        t) {
            2 != t[n] && (i = !1);
            var o = null
              , s = null;
            switch (n) {
            case "born":
                s = $(".section-wrapper.born"),
                o = $("#rewards2");
                break;
            case "email":
                s = $(".section-wrapper.email"),
                o = $("#rewards1");
                break;
            case "login":
                s = $(".section-wrapper.login"),
                o = $("#rewards0")
            }
            switch (t[n]) {
            case 0:
                a.indexOf(n) >= 0 && !e.login ? (s.find("input").attr("tip", _t("fill_in_login_first", null, "ingame_register")).attr("disabled", "disabled"),
                s.css("opacity", .3)) : (s.find("input").attr("tip", _t("fill_in_fields", null, "ingame_register")).attr("disabled", ""),
                s.css("opacity", 1)),
                o.css("opacity", .3);
                break;
            case 1:
                s.find("input").attr("disabled", "disabled").val(_t("born" == n ? "disabled_info_short" : "disabled_info", null, "ingame_register")).attr("tip", ""),
                s.find("label").css("opacity", .5),
                o.css("opacity", 1).parent().find(".rew-info-holder").html('<div class="rew-info" tip="' + _t("collect_reward_info", null, "ingame_register") + '"></div>'),
                s.find("");
                break;
            case 2:
                s.find("label").css("opacity", .5),
                s.find("input").attr("disabled", "disabled").val(_t("born" == n ? "disabled_info_short" : "disabled_info", null, "ingame_register")).attr("tip", ""),
                o.css("opacity", .3).parent().find(".rew-info-holder").html('<div class="rew-info" style="opacity:0.3" tip="' + _t("collected_reward_info", null, "ingame_register") + '"></div>')
            }
        }
        i && ($("#bm_register").hide(),
        delete hero.preview_acc,
        hideEnWindow(),
        message(_t("register_finished", null, "ingame_register")))
    }
    ,
    this.forceDialog = function() {
        this.checkbox(1),
        this.show()
    }
    ,
    this.checkbox = function(t) {
        isset(t) ? t ? $("#check_reg").removeClass("active") : $("#check_reg").addClass("active") : $("#check_reg").toggleClass("active"),
        setCookie("reg_noshow", $("#check_reg").hasClass("active") ? 1 : 0),
        $("#check_reg").hasClass("active") ? $("#bm_register").hide() : $("#bm_register").show()
    }
    ,
    this.init = function() {
        _g("registernoob")
    }
}
,
eventCalendar = new function() {
    function t(t) {
        return t < 10 ? "0" + t : t
    }
    var e = this
      , a = null
      , i = null
      , n = [_t("m_styczen", null, "event_calendar"), _t("m_luty", null, "event_calendar"), _t("m_marzec", null, "event_calendar"), _t("m_kwiecien", null, "event_calendar"), _t("m_maj", null, "event_calendar"), _t("m_czerwiec", null, "event_calendar"), _t("m_lipiec", null, "event_calendar"), _t("m_sierpien", null, "event_calendar"), _t("m_wrzesien", null, "event_calendar"), _t("m_pazdziernik", null, "event_calendar"), _t("m_listopad", null, "event_calendar"), _t("m_grudzien", null, "event_calendar")]
      , o = [_t("d_monday", null, "event_calendar"), _t("d_tuesday", null, "event_calendar"), _t("d_wednesday", null, "event_calendar"), _t("d_thursday", null, "event_calendar"), _t("d_friday", null, "event_calendar"), _t("d_saturday", null, "event_calendar"), _t("d_sunday", null, "event_calendar")];
    this.show = function(t) {}
    ,
    this.close = function() {
        $("#eventCallendar").hide(),
        g.lock.remove("event_calendar")
    }
    ,
    this.changeDateCalback = function() {
        $("#eventCallendar .date-display").html(a.getDate() + "-" + (a.getMonth() + 1) + "-" + a.getFullYear()),
        $("#eventCallendar .month-display").html(n[a.getMonth()]),
        this.printWeek()
    }
    ,
    this.printWeek = function() {
        $("#eventCallendar .days-wrapper .cell").remove();
        for (var e = null, n = 0; n < 14; n++) {
            var s = new Date(a.getTime() + 24 * n * 3600 * 1e3);
            null === e && (e = s.getFullYear());
            var l = [];
            for (var r in i) {
                if (isset(i[r].lvl_req)) {
                    var c = i[r].lvl_req
                      , d = hero.lvl;
                    if (!(d >= c[0] && d <= c[1]))
                        continue
                }
                switch ((A = i[r]).attr = -2 & A.attr,
                A.attr) {
                case 6:
                case 0:
                    var p = parseInt(A.date)
                      , h = p % 100
                      , g = parseInt(Math.floor(p / 100));
                    e != (v = s.getFullYear()) && (v = e);
                    var u = (b = strtotime(t(v) + "-" + t(g) + "-" + t(h) + " 00:00:00")) + 86400 - 1 + 24 * (A.duration - 1) * 3600;
                    (_ = s.getTime() / 1e3) >= b && _ <= u && l.push(A);
                    break;
                case 2:
                    var m = A.duration > 7 ? 7 : A.duration
                      , f = [];
                    for (h = A.date; h < A.date + m; )
                        f.push(h % 7),
                        h++;
                    f.indexOf(s.getDay()) >= 0 && l.push(A);
                    break;
                case 4:
                    if (A.date < 40) {
                        h = t(A.date),
                        g = t(s.getMonth() + 1);
                        var v = s.getFullYear();
                        u = b = strtotime(t(v) + "-" + t(g) + "-" + t(h) + " 00:00:00");
                        if (A.duration > 1)
                            u = strtotime("+" + (A.duration - 1) + " days", b) + 86400 - 1;
                        (_ = s.getTime() / 1e3) > b && _ < u && l.push(A)
                    } else {
                        g = t(s.getMonth() + 1),
                        v = s.getFullYear();
                        var _, b = strtotime(t(v) + "-" + t(g) + "-" + t(h) + " 00:00:00"), k = new Date(1e3 * b), w = A.date % 10, y = Math.floor((A.date - 30) / 10), x = 0 == k.getDay() ? 7 : k.getDay(), C = b + 24 * (w - x) * 3600 + 7 * (y - (w - x < 0 ? 0 : 1)) * 24 * 3600;
                        u = C + 24 * A.duration * 3600 - 1;
                        (_ = s.getTime() / 1e3) >= C && _ <= u && l.push(A)
                    }
                }
            }
            var I = $('<div class=cell>\n                    <div class="inner-cell">\n                      <div class="day-and-date">\n                      </div>\n                      <div class="events-holder">\n                      </div>\n                    </div>\n                  </div>');
            I.find(".inner-cell .day-and-date").append("<span class=dayname>" + o[n % 7] + "</span>"),
            I.find(".inner-cell .day-and-date").append("<span class=day>" + s.getDate() + "/" + t(s.getMonth() + 1) + "</span>"),
            l.sort((function(t, e) {
                return t.duration - e.duration
            }
            ));
            var T = l.splice(0, 2)
              , M = I.find(".events-holder");
            for (var S in T) {
                var P = $('<div class="single-event"></div>')
                  , A = T[S];
                if (P.append("<span class=ev_name>" + A.name + "</span>").attr("tip", A.descr),
                A.icon) {
                    var L = $("<div class=bg></div>");
                    A.icon.match(/\./) ? L.css({
                        backgroundImage: "url(" + A.icon + ")"
                    }) : L.css({
                        backgroundColor: A.icon,
                        opacity: .2
                    }),
                    P.prepend(L)
                }
                M.append(P)
            }
            $("#eventCallendar .days-wrapper").append(I)
        }
        $(".single-event").mouseenter((function() {
            $(this).animate()
        }
        )).mouseleave((function() {}
        ))
    }
    ,
    this.nextMonth = function() {
        a.setMonth(a.getMonth() + 1),
        a = this.getStartPoint(a),
        this.changeDateCalback()
    }
    ,
    this.nextWeek = function() {
        a.setDate(a.getDate() + 7),
        this.changeDateCalback()
    }
    ,
    this.prevMonth = function() {
        a.setMonth(a.getMonth() - 1),
        a = this.getStartPoint(a),
        this.changeDateCalback()
    }
    ,
    this.prevWeek = function() {
        a.setDate(a.getDate() - 7),
        this.changeDateCalback()
    }
    ,
    this.getStartPoint = function(t) {
        return 1 != t.getDay() && t.setTime(t.getTime() - 24 * ((0 == t.getDay() ? 7 : t.getDay()) - 1) * 36e5),
        t.setHours(0),
        t.setMinutes(0),
        t.setSeconds(0),
        t
    }
    ,
    this.initCall = function() {
        _g("calendar")
    }
    ,
    $(document).ready((function() {
        $("#eventCallendar .week-switch.next .inner-cell").click((function() {
            e.nextWeek()
        }
        )),
        $("#eventCallendar .week-switch.previous .inner-cell").click((function() {
            e.prevWeek()
        }
        )),
        $("#event_calendar_switch").click(e.initCall),
        $("#eventCallendar .month-switch.next").click((function() {
            e.nextMonth()
        }
        )),
        $("#eventCallendar .month-switch.previous").click((function() {
            e.prevMonth()
        }
        ))
    }
    ))
}
,
adventCallendar = new function() {
    var t = !1
      , e = {};
    this.parseData = function(t) {
        this.initWindow();
        for (var e = 0; e < t.length; e++)
            t[e] && ($("#advent_window_" + e).addClass("open").removeClass("closed"),
            this.addItem(t[e], e));
        this.show()
    }
    ,
    this.show = function(e) {
        t || ($("#adventCallendar").show(),
        t = !0)
    }
    ,
    this.checkItem = function(t, a) {
        a = parseInt(a);
        var i = t.x + 6 * t.y;
        return isset(e[i]) && e[i] == a
    }
    ,
    this.addItem = function(t, a) {
        t = parseInt(t),
        isset(g.item[t]) && $("#advent_window_" + a).length && (isset(e[a]) && e[a] == t || ($("#adv_item_wrapper_" + a).html(createItem(g.item[t])),
        e[a] = t))
    }
    ,
    this.initWindow = function() {
        if (!$(".advent-window").length) {
            for (var t = "<div class=inner>", e = 0; e < 24; e++)
                t += '<div class="advent-window closed" id="advent_window_' + e + '"><span tip="' + _t("open_window", null, "advent") + '">' + (e + 1) + '</span><div class="item-container" id="adv_item_wrapper_' + e + '"></div></div>';
            t += "</div>",
            $("#adventCallendar .windows-wrapper").html(t),
            $("#advent_header_txt").html(goldTxt(_t("advent_header", null, "advent"))),
            $("#adventCallendar .advent-window span").click((function() {
                _g("advent&day=" + (parseInt($(this).parent().attr("id").substr(14)) + 1))
            }
            ))
        }
    }
    ,
    this.close = function() {
        $("#adventCallendar").hide(),
        t = !1
    }
    ,
    this.callInit = function() {
        this.initWindow(),
        _g("advent")
    }
}
;
var progressbar = new function() {
    var t = function() {
        return $("#hero .__progress_bar").length ? $("#hero .__progress_bar") : null
    };
    this.update = function(e) {
        var a = e[1] - e[0];
        if (a < e[1]) {
            var i = t();
            i || (i = $('<div class="__progress_bar"><div class="inner"></div></div>'),
            $("#hero").append(i)),
            i.find(".inner").css({
                width: a / e[1] * 100 + "%"
            }),
            this.reposition(),
            g.lock.add("progressbar")
        } else
            this.hide()
    }
    ,
    this.reposition = function() {
        var e = t();
        e && e.css({
            left: $("#hero").width() / 2 - e.width() / 2
        })
    }
    ,
    this.hide = function() {
        var e = t();
        e && e.remove(),
        g.lock.remove("progressbar")
    }
}
;
tutorialStart(0),
$(document).ready((function() {
    initMessageController(),
    initTplsManager(),
    initNightController(),
    initBusinessCardsManager(),
    initChatController(),
    initDisableItemsManager(),
    initItemsMovedManager(),
    initQuestLog(),
    initMatchmakingTutorialManager(),
    initStaticStrings(),
    initClanAttrChange(),
    initBMAttrChange(),
    initPremiumShop(),
    initMatchmakingSummary(),
    initDragonChests(),
    initPrePremium(),
    initMCAddon(),
    initSMCAddon()
}
));
function RequestCorrect() {
    var n = null
      , t = function() {
        n = {
            init: {
                initlvl: function(n) {
                    return !0
                },
                clientTs: function(n) {
                    return !0
                },
                mucka: function(n) {
                    return !0
                },
                configSet: function(n) {
                    return !0
                },
                configGet: function(n) {
                    return !0
                },
                captcha: function(n) {
                    return !0
                },
                answerId: function(n) {
                    return !0
                }
            },
            captcha: {
                start: function(n) {
                    return isIntVal(n)
                },
                answerId: function(n) {
                    return e(n)
                }
            },
            moveitem: {
                st: function(n) {
                    return isIntVal(n)
                },
                set: function(n) {
                    return isIntVal(n)
                },
                tpl: function(n) {
                    return isIntVal(n)
                },
                id: function(n) {
                    return isIntVal(n)
                },
                answer1001012: function(n) {
                    return isIntVal(n)
                },
                answer1201001: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                },
                x: function(n) {
                    return isIntVal(n)
                },
                y: function(n) {
                    return isIntVal(n)
                },
                town_id: function(n) {
                    return isIntVal(n)
                },
                town_x: function(n) {
                    return isIntVal(n)
                },
                town_y: function(n) {
                    return isIntVal(n)
                },
                bonusIdx: function(n) {
                    return isIntVal(n)
                },
                put: function(n) {
                    return isIntVal(n)
                },
                findslot: function(n) {
                    return isIntVal(n)
                },
                ans: function(n) {
                    return isIntVal(n)
                },
                outfit_id: function(n) {
                    return isIntVal(n)
                },
                split: function(n) {
                    return isIntVal(n)
                },
                skillshop: function(n) {
                    return isIntVal(n)
                },
                locationId: function(n) {
                    return isIntVal(n)
                }
            },
            talk: {
                id: function(n) {
                    return isIntVal(n) || o(n, ["player", "pet"])
                },
                c: function(n) {
                    return isPl() ? isFloatVal(n) : isStringVal(n)
                },
                answer2501001: function(n) {
                    return isIntVal(n)
                }
            },
            shop: {
                answer1004001: function(n) {
                    return isIntVal(n)
                },
                buy: function(n) {
                    return i(n)
                },
                sell: function(n) {
                    return s(n)
                },
                can_sell: function(n) {
                    return isIntVal(n)
                },
                npc: function(n) {
                    return isIntVal(n)
                },
                filters: function(n) {
                    return isIntVal(n)
                }
            },
            codeprom: {
                code: function(n) {
                    return isStringVal(n)
                },
                opt: function(n) {
                    return isIntVal(n)
                }
            },
            skills: {
                learn: function(n) {
                    return isIntVal(n)
                },
                lvl: function(n) {
                    return isIntVal(n)
                },
                reset: function(n) {
                    return isIntVal(n)
                },
                show: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                },
                battleaction: function(n) {
                    return o(n, ["set", "show", "learn"])
                },
                battleskills: function(n) {
                    return e(n)
                },
                selectedskills: function(n) {
                    return u(n)
                },
                rpt: function(n) {
                    return isIntVal(n)
                },
                set: function(n) {
                    return isIntVal(n)
                },
                credits: function(n) {
                    return isIntVal(n)
                }
            },
            promotions: {
                a: function(n) {
                    return o(n, ["use", "show"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                }
            },
            clan: {
                nrid: function(n) {
                    return isIntVal(n)
                },
                a: function(n) {
                    return o(n, ["wear", "confirm", "disband", "invite_cancel", "recruit_applications_reject", "recruit_applications_accept", "set_attrs", "rank", "join", "apply", "leave", "skills_use", "skills_upgrade", "buy_quest", "credits", "invite_show", "recruit_applications_show", "invite", "set_attrs", "bring", "myclan", "list", "member", "members", "dipl", "quests_show", "getclan", "skills_show", "save", "depo", "create"])
                },
                a2: function(n) {
                    return o(n, ["add", "del", "edit"])
                },
                f: function(n) {
                    return o(n, ["gold", "credits", "info", "official", "logo", "name"])
                },
                agree: function(n) {
                    return isStringVal(n)
                },
                n: function(n) {
                    return isStringVal(n)
                },
                name: function(n) {
                    return isStringVal(n)
                },
                page: function(n) {
                    return isIntVal(n)
                },
                rid: function(n) {
                    return r(n)
                },
                r: function(n) {
                    return isIntVal(n)
                },
                inv: function(n) {
                    return isIntVal(n)
                },
                pid: function(n) {
                    return isIntVal(n)
                },
                dismiss: function(n) {
                    return isIntVal(n)
                },
                v: function(n) {
                    return !0
                },
                sort: function(n) {
                    return isIntVal(n)
                },
                ascending: function(n) {
                    return isIntVal(n)
                },
                id: function(n) {
                    return isIntVal(n)
                },
                rank: function(n) {
                    return isIntVal(n)
                },
                allow: function(n) {
                    return isIntVal(n)
                },
                leader: function(n) {
                    return isIntVal(n)
                },
                op: function(n) {
                    return o(n, ["confirm", "cancel_e", "cancel_a", "close", "ally", "enemy", "item_put", "item_move", "item_get", "upgrade"])
                },
                pay: function(n) {
                    return o(n, ["z", "s", "self"])
                },
                x: function(n) {
                    return isIntVal(n)
                },
                y: function(n) {
                    return isIntVal(n)
                },
                filters: function(n) {
                    return isStringVal(n)
                },
                search: function(n) {
                    return isStringVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                },
                ans: function(n) {
                    return isIntVal(n)
                },
                opt: function(n) {
                    return isIntVal(n)
                },
                amount: function(n) {
                    return isIntVal(n)
                },
                answer2301001: function(n) {
                    return isIntVal(n)
                }
            },
            skillshop: {},
            minimap: {},
            friends: {
                a: function(n) {
                    return o(n, ["faccept", "edown", "eup", "fdown", "fup", "finvite", "fdel", "inv", "show", "edel", "eadd"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                nick: function(n) {
                    return isStringVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                }
            },
            config: {
                opt: function(n) {
                    return isIntVal(n)
                },
                set: function(n) {
                    return isIntVal(n)
                },
                clear: function(n) {
                    return isIntVal(n)
                }
            },
            craft: {
                a: function(n) {
                    return o(n, ["list", "use"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                ans: function(n) {
                    return isIntVal(n)
                }
            },
            quests: {
                a: function(n) {
                    return o(n, ["observe_add", "use", "cancel", "observe_remove"])
                },
                quest_id: function(n) {
                    return isIntVal(n)
                }
            },
            emo: {
                a: function(n) {
                    return o(n, ["flag-anglia.gif", "flag-chorwacja.gif", "flag-czechy.gif", "flag-dania.gif", "flag-francja.gif", "flag-grecja.gif", "flag-hiszpania.gif", "flag-holandia.gif", "flag-irlandia.gif", "flag-niemcy.gif", "flag-polska.gif", "flag-portugalia.gif", "flag-rosja.gif", "flag-skull.gif", "flag-szwecja.gif", "flag-ukraina.gif", "flag-wlochy.gif", "bat", "spider", "banki", "curse", "emonutki", "guma1", "guma2", "guma3", "guma4", "kuciak", "ptaszek", "emosnow", "ghost", "water", "buzia1", "buzia2", "roza", "cocos", "emohug1", "emohug2", "emohug3", "gift", "holly", "snowball", "pillow", "fire_1", "fire_2", "fire_3", "fire_4", "fire_5", "fire_6", "fire_7", "fire_8", "fire_9", "fireworks", "stars", "termofor", "lampion1", "lampion2", "lampion3", "lampion4", "lampion5", "noemo", "zombie", "kiss", "kiss2", "angry", "acceptbless", "bless"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                iid: function(n) {
                    return isIntVal(n)
                },
                ans: function(n) {
                    return isIntVal(n)
                }
            },
            logoff: {
                a: function(n) {
                    return o(n, ["start", "stop"])
                }
            },
            mail: {
                a: function(n) {
                    return o(n, ["refresh", "send", "get", "del"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                gold: function(n) {
                    return r(n)
                },
                iid: function(n) {
                    return r(n)
                },
                r: function(n) {
                    return isStringVal(n)
                },
                msg: function(n) {
                    return isStringVal(n)
                }
            },
            match: {
                a: function(n) {
                    return o(n, ["prepared", "battleset", "accept_opp", "main", "profile", "statistics", "history", "season", "statistics_detailed", "signin", "signout", "ladder_global", "ladder_clan", "ladder_friends", "summary"])
                },
                ans: function(n) {
                    return isIntVal(n)
                },
                player_id: function(n) {
                    return isIntVal(n)
                },
                page: function(n) {
                    return isIntVal(n)
                },
                reward_stage: function(n) {
                    return isIntVal(n)
                },
                reward_season: function(n) {
                    return isIntVal(n)
                },
                reward_idx: function(n) {
                    return isIntVal(n)
                }
            },
            bonus_reselect: {
                action: function(n) {
                    return o(n, ["status", "apply", "select"])
                },
                item: function(n) {
                    return isIntVal(n)
                },
                bonusIdx: function(n) {
                    return isIntVal(n)
                }
            },
            enhancement: {
                answer1004001: function(n) {
                    return isIntVal(n)
                },
                action: function(n) {
                    return o(n, ["progress_preview", "progress", "status", "upgrade", "open", "show"])
                },
                item: function(n) {
                    return isIntVal(n)
                },
                ingredients: function(n) {
                    return a(n)
                },
                bonusIdx: function(n) {
                    return isIntVal(n)
                },
                answer1001012: function(n) {
                    return isIntVal(n)
                },
                answer1001015: function(n) {
                    return isIntVal(n)
                }
            },
            salvager: {
                answer1004001: function(n) {
                    return isIntVal(n)
                },
                action: function(n) {
                    return o(n, ["preview", "salvage"])
                },
                selectedItems: function(n) {
                    return a(n)
                }
            },
            extractor: {
                action: function(n) {
                    return o(n, ["preview", "extract"])
                },
                items: function(n) {
                    return isIntVal(n)
                },
                item: function(n) {
                    return isIntVal(n)
                },
                currency: function(n) {
                    return o(n, ["z", "s"])
                }
            },
            loot: {
                final: function(n) {
                    return isIntVal(n)
                },
                want: function(n) {
                    return e(n)
                },
                not: function(n) {
                    return e(n)
                },
                must: function(n) {
                    return e(n)
                }
            },
            rewards_calendar: {
                action: function(n) {
                    return o(n, ["show", "open"])
                },
                day_no: function(n) {
                    return isIntVal(n)
                },
                id: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                }
            },
            takeitem: {
                id: function(n) {
                    return isIntVal(n)
                }
            },
            recovery: {
                item: function(n) {
                    return isIntVal(n)
                }
            },
            setpvp: {
                mode: function(n) {
                    return isIntVal(n)
                }
            },
            tutorial: {
                opt: function(n) {
                    return isIntVal(n)
                }
            },
            depo: {
                upgrade: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                },
                move: function(n) {
                    return isIntVal(n)
                },
                get: function(n) {
                    return isIntVal(n)
                },
                put: function(n) {
                    return isIntVal(n)
                },
                x: function(n) {
                    return isIntVal(n)
                },
                y: function(n) {
                    return isIntVal(n)
                },
                goldin: function(n) {
                    return isIntVal(n)
                },
                goldout: function(n) {
                    return isIntVal(n)
                },
                time: function(n) {
                    return isIntVal(n)
                },
                pay: function(n) {
                    return o(n, ["z", "s"])
                },
                remove: function(n) {
                    return o(n, ["OK"])
                }
            },
            ah: {
                cat: function(n) {
                    return isIntVal(n)
                },
                filter: function(n) {
                    return isStringVal(n)
                },
                sort: function(n) {
                    return isStringVal(n)
                },
                auction: function(n) {
                    return isStringVal(n)
                },
                action: function(n) {
                    return o(n, ["sell", "end", "change_time", "change_time_all", "bid", "buyout", "observation_add", "observation_remove"])
                },
                item: function(n) {
                    return isIntVal(n)
                },
                price: function(n) {
                    return r(n)
                },
                buy_out: function(n) {
                    return r(n)
                },
                time: function(n) {
                    return isIntVal(n)
                },
                is_featured: function(n) {
                    return isIntVal(n)
                },
                answer1901001: function(n) {
                    return isIntVal(n)
                },
                answer1905001: function(n) {
                    return isIntVal(n)
                },
                answer1004001: function(n) {
                    return isIntVal(n)
                }
            },
            wanted: {
                show: function(n) {
                    return isIntVal(n)
                }
            },
            party: {
                a: function(n) {
                    return o(n, ["acceptsummon", "inv", "disband", "give", "rm", "accept"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                }
            },
            battlepass: {
                action: function(n) {
                    return o(n, ["buy_premium", "reroll", "status", "collect_reward"])
                },
                level: function(n) {
                    return isIntVal(n)
                },
                type: function(n) {
                    return o(n, ["standard", "premium"])
                }
            },
            barter: {
                id: function(n) {
                    return isIntVal(n)
                },
                offerId: function(n) {
                    return isIntVal(n)
                },
                selectedItems: function(n) {
                    return a(n)
                },
                usesCount: function(n) {
                    return isIntVal(n)
                },
                available: function(n) {
                    return isIntVal(n)
                },
                action: function(n) {
                    return o(n, ["use"])
                },
                desiredItem: function(n) {
                    return isIntVal(n)
                }
            },
            creditshop: {
                filters: function(n) {
                    return isIntVal(n)
                },
                npc: function(n) {
                    return isIntVal(n)
                },
                filterlvlunder: function(n) {
                    return isIntVal(n)
                },
                filterlvlabove: function(n) {
                    return isIntVal(n)
                },
                credits_gold: function(n) {
                    return isIntVal(n)
                },
                ttl_days: function(n) {
                    return isIntVal(n)
                },
                ttl_del: function(n) {
                    return isIntVal(n)
                }
            },
            chat: {
                a: function(n) {
                    return o(n, ["ban"])
                },
                ans: function(n) {
                    return o(n, ["OK", "null"])
                },
                getContent: function(n) {
                    return isStringVal(n)
                },
                tab: function(n) {
                    return isIntVal(n)
                },
                channel: function(n) {
                    return o(n, ["local", "global", "trade", "personal", "party", "clan"])
                },
                style: function(n) {
                    return o(n, ["special", "nar", "me"])
                },
                receiver: function(n) {
                    return isStringVal(n)
                }
            },
            rooms: {
                room: function(n) {
                    return isIntVal(n)
                },
                keydup: function(n) {
                    return isIntVal(n)
                },
                delkeys: function(n) {
                    return isIntVal(n)
                },
                rent: function(n) {
                    return isIntVal(n)
                },
                m: function(n) {
                    return isIntVal(n)
                }
            },
            trade: {
                a: function(n) {
                    return o(n, ["gold", "cancel", "ask", "confirm", "add", "sid", "del", "accept", "noaccept"])
                },
                id: function(n) {
                    return isIntVal(n)
                },
                buy: function(n) {
                    return a(n)
                },
                sell: function(n) {
                    return a(n)
                },
                tid: function(n) {
                    return isIntVal(n)
                },
                sid: function(n) {
                    return isIntVal(n)
                },
                ans: function(n) {
                    return isIntVal(n)
                },
                val: function(n) {
                    return isIntVal(n)
                },
                acceptGoldOverflow: function(n) {
                    return isIntVal(n)
                }
            },
            pet: {
                a: function(n) {
                    return isIntVal(n)
                }
            },
            fight: {
                a: function(n) {
                    return o(n, ["attack", "f", "exit", "strike", "move", "surrender", "spell", "nextmatch"])
                },
                auto: function(n) {
                    return isIntVal(n)
                },
                id: function(n) {
                    return isIntVal(n)
                },
                s: function(n) {
                    return isIntVal(n)
                },
                answer: function(n) {
                    return isIntVal(n)
                },
                answer1702002: function(n) {
                    return isIntVal(n)
                },
                ff: function(n) {
                    return isIntVal(n)
                }
            },
            registernoob: {
                collect: function(n) {
                    return isIntVal(n)
                }
            },
            artisanship: {
                action: function(n) {
                    return o(n, ["open", "close"])
                }
            }
        }
    }
      , r = function(n) {
        return "" == n || isIntVal(n)
    }
      , i = function(n) {
        if ("" == n)
            return !0;
        var t = n.split(";");
        for (var r in t) {
            var i = t[r].split(",");
            if (2 != i.length)
                return !1;
            if (!(isIntVal(i[0]) && isIntVal(i[1])))
                return !1
        }
        return !0
    }
      , e = function(n) {
        if ("" == n)
            return !0;
        var t = n.split(",");
        for (var r in t) {
            var i = t[r];
            if (!isIntVal(i))
                return !1
        }
        return !0
    }
      , u = function(n) {
        if ("" == n)
            return !0;
        var t = n.split(",");
        for (var r in t) {
            var i = t[r];
            if (!isIntVal(i) && "" != i)
                return !1
        }
        return !0
    }
      , a = function(n) {
        if ("" == n)
            return !1;
        var t = n.split(",");
        for (var r in t) {
            var i = t[r];
            if (!isIntVal(i))
                return !1
        }
        return !0
    }
      , o = function(n, t) {
        return !!n && t.includes(n)
    }
      , s = function(n) {
        if ("" == n)
            return !0;
        var t = n.split(",");
        for (var r in t)
            if (!isIntVal(t[r]))
                return !1;
        return !0
    }
      , c = function(t, r) {
        var i = r[0]
          , e = r[1];
        return n[t][i] ? !!n[t][i](e) || (console.error("Communication.js", "checkTaskIsCorrect", "Incorrect val in request task:" + t + ", in action:" + i, "Val:" + e),
        message("Incorrect val in request task:" + t + ", in action:" + i + "|Val:" + e),
        !1) : (console.warn("RequestController.js", "checkActionIsCorrect", "Unregistered action: " + i + ", in task:" + t, "Val:" + e),
        message("Unregistered action: " + i + ", in task:", t),
        !1)
    };
    this.init = function() {
        t()
    }
    ,
    this.checkStepsToSendCorrect = function(n) {
        for (var t in n) {
            var r = n[t].split(",");
            if (!(isIntVal(r[0]) && isIntVal(r[1])))
                return console.error("Engine.js", "checkStepsToSendCorrect", "Val in stepsToSend is incorrect:", r),
                !1
        }
        return !0
    }
    ,
    this.checkTimesToSendCorrect = function(n) {
        for (var t in n) {
            var r = n[t];
            if (!isFloatVal(r))
                return console.error("Engine.js", "checkTimesToSendCorrect", "Val in timesToSend is incorrect:", r),
                !1
        }
        return !0
    }
    ,
    this.checkTaskIsCorrect = function(t) {
        if (!getGlobalAddonsWasReceived())
            return !0;
        if ("_" == t)
            return !0;
        var r = t.split("&");
        if (1 == r.length)
            return !0;
        var i = r[0];
        if (!n[i]) {
            return ["gm", "console"].includes(i) || (console.warn("RequestController.js", "checkTaskIsCorrect", "unregistered task request:", i + " REQUEST:" + t),
            message("unregistered task request:" + i)),
            !0
        }
        for (var e = 1; e < r.length; e++) {
            var u = r[e].split("=");
            if (2 == u.length)
                if (!c(i, u))
                    return !0
        }
        return !0
    }
}
function _typeof(e) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    }
    : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }
    ,
    _typeof(e)
}
if (newCommunicationMode) {
    var lastRequest, webSocket, webSocketTask, webSocketCallBack, webSocketInMove, taskCallbacks = {}, taskQueue = [], zeroInitWasReceived = !1, globalAddonsInitWasReceived = !1;
    window.setGlobalAddonsWasReceived = function(e) {
        globalAddonsInitWasReceived = e
    }
    ,
    this.getGlobalAddonsWasReceived = function() {
        return globalAddonsInitWasReceived
    }
    ,
    window.initWebSocket = function() {
        var e = location.hostname.split(".")[0]
          , o = "local" == e
          , t = "https:" == location.protocol || o ? "wss" : "ws"
          , a = "pl" == _l() ? "pl" : "com";
        e = o ? "dev" : e,
        belugaComMode && (e = "beluga",
        a = "com"),
        (webSocket = new WebSocket(t + "://" + e + ".margonem." + a + "/ws-engine")).onopen = function(e) {
            (isNaN(parseInt(getCookie("__nga"))) ? 0 : parseInt(getCookie("__nga"))) ? (setGlobalAddonsWasReceived(!0),
            startGame()) : _g("addon")
        }
        ,
        webSocket.onclose = function(e) {}
        ,
        webSocket.onmessage = function(e) {
            var o = e.data;
            if (!zeroInitWasReceived) {
                var t = JSON.parse(o);
                if (isset(t.addon))
                    return (isNaN(parseInt(getCookie("__nga"))) ? 0 : parseInt(getCookie("__nga"))) || "" != t.addon && loadScript(t.addon),
                    setGlobalAddonsWasReceived(!0),
                    zeroInitWasReceived = !0,
                    void startGame()
            }
            if ("" == o)
                return console.log("webSocket onmessage empty"),
                void location.reload();
            successData(o)
        }
        ,
        webSocket.onerror = function(e) {
            errorData(e)
        }
    }
    ,
    window.errorData = function(e) {
        var o = webSocketTask;
        if (console.log(e),
        webSocketVarsClear(),
        504 == e.status)
            return g.tickSuccess = !0,
            void ("_" != o && removeFromTaskQueue(o));
        location.reload(),
        console.log("ERROR")
    }
    ,
    window.successData = function(e) {
        var o = webSocketCallBack
          , t = webSocketTask
          , a = webSocketInMove;
        webSocketVarsClear();
        var n = JSON.parse(e)
          , s = !1;
        g.tickSuccess = !0,
        manageHeroIdle(a),
        "_" != t && removeFromTaskQueue(t),
        g.engineStopped || (s = parseInput(n, o)),
        g.initAjaxState = s
    }
    ,
    window.webSocketVarsClear = function() {
        webSocketCallBack = null,
        webSocketTask = null,
        webSocketInMove = null
    }
    ,
    window.setLastRequest = function() {
        lastRequest = (new Date).getTime()
    }
    ,
    window._g = function(e, o) {
        g.requestCorrect.checkTaskIsCorrect(e) ? checkCanAddTaskToTaskQueue(e) ? addToTaskQueue(e, o) : sendRequest(e, o) : console.error("Communication.js", "_g", "Task is not correct", e)
    }
    ,
    window.sendRequest = function(e, o) {
        if (webSocketTask = e,
        webSocketCallBack = o,
        !(g.init > 4 && "walk" == e) || 2 & __tutorials.val || null === __tutorials.val) {
            if (e = "___walk" == e ? "walk" : e,
            g.sync = 0,
            g.delays.before = new Date,
            "_" != e || !g.ats) {
                webSocketInMove = !!hero.ml.length,
                hero.ml.length ? g.requestCorrect.checkStepsToSendCorrect(hero.ml) && g.requestCorrect.checkTimesToSendCorrect(hero.mts) && (e += "&ml=" + hero.ml.join(";"),
                e += "&mts=" + hero.mts.join(";")) : g.init > 4 && hero.remoteDir != hero.dir && (e += "&pdir=" + hero.dir,
                hero.sendDir = !0),
                g.ev && (null !== g.lastEv && g.lastEv === g.ev && window.location.reload(),
                e += "&ev=" + g.ev,
                g.lastEv = g.ev),
                g.browser_token && (e += "&browser_token=" + g.browser_token),
                g.tmpParams.length && (e += "&" + g.tmpParams.join("&"),
                g.tmpParams = []),
                g.bagupd != g.bag && (g.bagupd = g.bag,
                e += "&bag=" + g.bag),
                g.ats = ts();
                var t = {};
                arguments.length > 1 && (t = "object" == _typeof(arguments[1]) ? arguments[1] : null),
                g.initAjaxState = !1,
                webSocketSendData("t=" + e, t),
                setLastRequest(),
                g.tickSuccess = !1
            }
        } else
            _g("tutorial&opt=" + (2 | __tutorials.val), (function() {
                _g("___walk")
            }
            ))
    }
    ,
    window.webSocketSendData = function(e, o) {
        var t = {
            g: e,
            p: o ? JSON.stringify(o) : ""
        }
          , a = JSON.stringify(t);
        webSocket.send(a)
    }
    ,
    window.checkCanAddTaskToTaskQueue = function(e) {
        if (!globalAddonsInitWasReceived)
            return !1;
        var o = (new Date).getTime();
        return !(g.init <= 4) && ("_" != e && (!g.tickSuccess || o - lastRequest < g.delays.limit))
    }
    ,
    window.checkCanSendTaskFromTaskQueue = function() {
        return taskQueue.length
    }
    ,
    window.sendTaskFromQueue = function() {
        var e = taskQueue[0]
          , o = taskCallbacks[e];
        if (o)
            return _g(e, o);
        _g(e)
    }
    ,
    window.addToTaskQueue = function(e, o) {
        taskQueue.indexOf(e) > -1 || (taskQueue.push(e),
        taskCallbacks[e] = null == o ? null : o)
    }
    ,
    window.removeFromTaskQueue = function(e) {
        var o = taskQueue.indexOf(e);
        o < 0 || (taskQueue.splice(o, 1),
        delete taskCallbacks[e])
    }
}
function isset(t) {
    return void 0 !== t
}
function tplsManager() {
    var t = this
      , e = {}
      , n = {}
      , a = {};
    this.updateDATA = function(e) {
        var n = t.addAndGetIdToFetchPackageController(e);
        for (var a in e)
            this.checkExist(a, e[a]) && this.deleteTpl(e[a].loc, a),
            this.newTpl(a, e[a], n, !0);
        this.checkClearFetchPackageController(n)
    }
    ,
    this.addAndGetIdToFetchPackageController = function(t) {
        for (var e = 0; a[e]; )
            e++;
        for (var n in a[e] = {},
        t) {
            var i = t[n].loc;
            i && (isset(a[e][i]) || (a[e][i] = 0),
            a[e][i]++)
        }
        return e
    }
    ,
    this.checkClearFetchPackageController = function(t) {
        a[t] && (Object.keys(a[t]).length || delete a[t])
    }
    ,
    this.checkExist = function(t, n) {
        var a = n.loc
          , i = e[a];
        return !(!isset(i) || !isset(i[t])) && i[t]
    }
    ,
    this.getTplByIdAndLoc = function(t, n) {
        if (n) {
            var a = e[n];
            for (var i in a)
                if (i == t)
                    return e[n][i];
            return null
        }
    }
    ,
    this.getClone = function(e, n) {
        return t.getTplByIdAndLoc(e, n).$.clone(!0)
    }
    ,
    this.newTpl = function(n, a, i, s) {
        var o = createItem(a, itemTip(a))
          , l = []
          , r = $("<img>").attr("src", CFG.ipath + a.icon);
        if (addHClassesToHClass(a, l),
        l.length) {
            var c = l.join(" ") + " " + (4096 & hero.opt ? "nodisp" : "")
              , h = $("<div>").addClass("itemHighlighter " + c);
            o.append(h)
        }
        var u = g.tplsManager.parseTplStat(a.stat)
          , f = isset(u.ammo)
          , p = isset(u.amount);
        f && updateItemAmount(o, u.ammo),
        p && updateItemAmount(o, u.amount),
        o.append(r),
        isset(e[a.loc]) || (e[a.loc] = {}),
        e[a.loc][n] = $.extend(a, {
            $: o
        }),
        t.newTplInLocation(a.loc, e[a.loc][n], i, s)
    }
    ,
    this.deleteTpl = function(t, n) {
        delete e[t][n]
    }
    ,
    this.newTplInLocation = function(e, a, i) {
        var s = t.checkFetchFinish(i, a.loc);
        if (isset(n[e]))
            for (var o in n[e])
                t.delayLocationCallbacks(a, e, o, s)
    }
    ,
    this.decreaseFetchPackageController = function(t, e) {
        a[t][e]--,
        a[t][e] < 1 && delete a[t][e],
        this.checkClearFetchPackageController(t)
    }
    ,
    this.checkClearFetchPackageController = function(t) {
        a[t] && (Object.keys(a[t]).length || delete a[t])
    }
    ,
    this.checkFetchFinish = function(e, n) {
        return t.decreaseFetchPackageController(e, n),
        !a[e] || !isset(a[e][n])
    }
    ,
    this.deleteMessItemsByLoc = function(t) {
        if (isset(e[t])) {
            var n = e[t];
            for (var a in n)
                delete n[a]
        }
    }
    ,
    this.delayLocationCallbacks = function(t, e, a, i) {
        (0,
        n[e][a])(t, i)
    }
    ,
    this.fetchLocationTpls = function(t) {
        var n = [];
        if (isset(e[t])) {
            var a = e[t];
            for (var i in a)
                n.push(a[i])
        }
        return n
    }
    ,
    this.addCallback = function(t, e) {
        isset(n[t]) || (n[t] = []),
        n[t].push(e)
    }
    ,
    this.removeCallback = function(t, e) {
        if (isset(n[t])) {
            var a = n[t].indexOf(e);
            a >= 0 && n[t].splice(a, 1)
        }
    }
    ,
    this.fetch = function(e, n) {
        e = e.split(",");
        if ("function" == typeof n)
            for (var a = 0; a < e.length; a++) {
                t.addCallback(e[a], n);
                var i = t.fetchLocationTpls(e[a])
                  , s = i.length - 1;
                for (var o in i) {
                    var l = s == o;
                    n(i[o], l)
                }
            }
    }
    ,
    this.parseTplStat = function(t) {
        t = t.split(";");
        for (var e = {}, n = 0; n < t.length; n++) {
            var a = t[n].split("=");
            e[a[0]] = isset(a[1]) ? a[1] : null
        }
        return e
    }
    ,
    this.changeItemAmount = function(e, n, a) {
        var i, s = n.find("small"), o = parseItemStat(e.stat);
        if (s.length > 0) {
            var l = 1;
            isset(o.amount) && (l = o.amount),
            isset(o.ammo) && (l = o.ammo),
            i = parseInt(l) * a,
            s.html(i),
            t.changeAMountInTip(o, n, i)
        } else {
            if (1 == a)
                return;
            var r = $("<small>");
            i = a,
            r.html(i),
            n.append(r),
            t.changeAMountInTip(o, n, i)
        }
    }
    ,
    this.changeAMountInTip = function(t, e, n) {
        for (var a = e.attr("tip"), i = $(a), s = isset(t.cursed), o = [_t("cursed_amount %val%", {
            "%val%": n
        }), _t("amount %val% %split%", {
            "%val%": n,
            "%split%": ""
        })][s ? 0 : 1], l = $("<span>").html(o).addClass("amount-text"), r = $("<br>"), c = !1, h = 0, u = "", f = 0; f < i.length; f++)
            $(i[f]).hasClass("type-text") && (h = f),
            $(i[f]).hasClass("amount-text") && (i[f] = null,
            i[f] = l[0],
            f,
            c = !0);
        c || (i.splice(h + 2, 0, l[0]),
        i.splice(h + 3, 0, r[0]));
        for (f = 0; f < i.length; f++)
            u += isset(i[f].outerHTML) ? i[f].outerHTML : i[f].data;
        e.tip(u)
    }
    ,
    this.onClear = function() {}
    ,
    this.getItems = function() {
        return e
    }
    ,
    this.test = function() {
        return {
            tpls: e,
            callbacks: n
        }
    }
}
var Tip = {
    types: {
        _default: {
            classOverride: null,
            tipPosition: "top",
            mouseTrack: !1,
            show: function(t) {
                t.fadeIn(200)
            },
            hide: function(t) {
                t.fadeOut(200)
            }
        }
    },
    enabled: !0,
    hidden: !1,
    activeContent: null,
    target: null,
    currentCfg: null,
    mousePos: {
        x: null,
        y: null
    },
    isParent: function(t, e) {
        if (t == e)
            return !0;
        for (var i = $(t).parents(), o = 0; o < i.length; o++)
            if (i[o] == e)
                return !0;
        return !1
    },
    resize: function() {
        if (null !== this.tip && null !== this.target) {
            this.activeContent != this.target.attr("tip") && this.update(this.target.attr("tip"));
            var t = {
                clientY: this.mousePos.y,
                clientX: this.mousePos.x
            }
              , e = {
                tipPosition: this.currentCfg.tipPosition,
                mouseTrack: this.currentCfg.mouseTrack
            };
            this.reposition(e, t)
        }
    },
    init: function(t, e) {
        var i = this;
        null == e && (e = {}),
        this.types = $.extend(this.types, e),
        $(document).on("mouseover mouseout mousemove", t + " .notippropagation", (function(t) {
            return !1
        }
        )),
        $(document).on("mouseover mouseout mousemove", t, (function(t) {
            if (null == i.tip && i.initHtml(),
            null == i.target && (i.hidden = !1),
            i.enabled && !i.hidden) {
                var e = $(this).attr("ctip") && null != i.types[$(this).attr("ctip")] ? $(this).attr("ctip") : "_default";
                if ("t_npc" == $(this).attr("ctip") && $(this).attr("id")) {
                    var o = $(this).attr("id").replace(/npc/, "");
                    refreshTipOfNpc(o)
                }
                var s = $.extend({}, i.types._default, i.types[e])
                  , n = $(this).attr("ctip") && null == s.classOverride ? $(this).attr("ctip") : s.classOverride;
                "mouseover" == t.type ? (i.tip.stop(!0, !0),
                i.update($(this).attr("tip")),
                i.target = $(this),
                i.tip.removeAttr("class").addClass(n),
                s.show(i.tip),
                i.mousePos.x = t.clientX,
                i.mousePos.y = t.clientY,
                i.currentCfg = s,
                i.reposition(s, t),
                i.autoUpdateInterval = setInterval((function() {
                    null != i.target ? i.activeContent != i.target.attr("tip") && i.update(i.target.attr("tip")) : clearInterval(i.autoUpdateInterval)
                }
                ), 100)) : "mouseout" == t.type ? null !== i.target && i.isParent(t.toElement, i.target[0]) || (i.tip.stop(!0, !0),
                s.hide(i.tip),
                i.afterHide()) : "mousemove" == t.type && s.mouseTrack && i.reposition(s, t)
            }
        }
        ))
    },
    autoUpdateInterval: null,
    afterHide: function() {
        this.target = null,
        clearInterval(this.autoUpdateInterval)
    },
    reposition: function(t, e) {
        var i = this.getPos(t, e)
          , o = this.tip.outerHeight()
          , s = this.tip.outerWidth();
        switch (t.tipPosition) {
        case "top":
            i.top < 0 && (i = this.getPos({
                tipPosition: "bottom",
                mouseTrack: t.mouseTrack
            }, e)),
            i.left < 0 && (i.left = 0),
            i.left + s > $(window).width() && (i.left = $(window).width() - s);
            break;
        case "bottom":
            i.top + o > $(window).height() - 10 && (i = this.getPos({
                tipPosition: "top",
                mouseTrack: t.mouseTrack
            }, e)),
            i.left < 0 && (i.left = 0),
            i.left + s > $(window).width() - 10 && (i.left = $(window).width() - s);
            break;
        case "left":
            i.left < 0 && (i = this.getPos({
                tipPosition: "right",
                mouseTrack: t.mouseTrack
            }, e)),
            i.top < 0 && (i.top = 0),
            i.top + o > $(window).height() - 10 && (i.top = $(window).height() - o);
            break;
        case "right":
            i.left + s > $(window).width() - 10 && (i = this.getPos({
                tipPosition: "left",
                mouseTrack: t.mouseTrack
            }, e)),
            i.top < 0 && (i.top = 0),
            i.top + o > $(window).height() - 10 && (i.top = $(window).height() - o)
        }
        this.tip.css(i)
    },
    getPos: function(t, e) {
        var i = t.mouseTrack ? {
            top: e.clientY,
            left: e.clientX
        } : this.target.offset()
          , o = this.tip.outerHeight()
          , s = this.tip.outerWidth();
        switch (t.tipPosition) {
        case "top":
            i.top -= t.mouseTrack ? o + 10 : o + 2,
            i.left -= s / 2 - (t.mouseTrack ? 0 : this.target.outerWidth() / 2);
            break;
        case "bottom":
            i.top += t.mouseTrack ? 10 : this.target.outerHeight() + 2,
            i.left -= s / 2 - (t.mouseTrack ? 0 : this.target.outerWidth() / 2);
            break;
        case "left":
            i.left -= (t.mouseTrack ? 10 : 2) + s,
            i.top -= o / 2 - (t.mouseTrack ? 0 : this.target.outerHeight() / 2);
            break;
        case "right":
            i.left += t.mouseTrack ? 10 : this.target.outerWidth() + 2,
            i.top -= o / 2 - (t.mouseTrack ? 0 : this.target.outerHeight() / 2)
        }
        return i
    },
    update: function(t) {
        this.activeContent = t,
        this.tipContentHandler.html(this.activeContent)
    },
    initHtml: function() {
        var t = this;
        t.tip = $(document.createElement("div")).attr("id", "tip").append('<div id=tip-o1></div><div id=tip-o2></div><div class="tipInnerContainer"></div>'),
        t.tipContentHandler = t.tip.find(".tipInnerContainer"),
        $("body").append(t.tip)
    },
    hide: function() {
        null != this.tip && this.tip.hide(),
        this.afterHide(),
        this.hidden = !0
    },
    disable: function() {
        null != this.tip && this.tip.hide(),
        this.afterHide(),
        this.enabled = !1
    },
    enable: function() {
        this.enabled = !0
    }
};
Tip.init("[tip]");
function MCAddon() {
    var n = this;
    this.wnd = null,
    this.nick = null;
    this.init = function() {
        n.initWindow(),
        n.initAllText(),
        n.initAllMuteBtns(),
        n.initUnmuteBtn(),
        n.initCloseButton()
    }
    ,
    this.initCloseButton = function() {
        n.createButton("Zamknij", "mc-close-btn", $(".mc-header"), (function() {
            n.close()
        }
        ))
    }
    ,
    this.initWindow = function() {
        n.wnd = {
            $: null
        },
        n.wnd.$ = $("#mc-addon")
    }
    ,
    this.initAllText = function() {
        for (var t = n.wnd.$.find(".all-texts"), i = 0; i < 14; i++) {
            var e = n.getMcText()
              , l = _t(i, null, "mc-addon");
            t.append(e),
            e.find(".label-text").html(l),
            n.createButton("send", "green small", e.find(".send"), (function() {
                var t = $(this).find(".label").parent().parent().parent().find(".label-text").html()
                  , i = "!" + n.nick + " " + t;
                chatSend(i)
            }
            ))
        }
    }
    ,
    this.initAllMuteBtns = function() {
        for (var t = [1, 6, 12, 18, 24, 36, 48, 60, 72], i = n.wnd.$.find(".times-of-mute"), e = 0; e < t.length; e++) {
            var l = t[e];
            n.createButton(l, "green small", i, (function() {
                var t = "/mute " + $(this).find(".gfont").html() + " " + n.nick;
                chatSend(t)
            }
            ))
        }
    }
    ,
    this.initUnmuteBtn = function() {
        n.createButton("Unmute", "green small", n.wnd.$.find(".unmute"), (function() {
            var t = "/unmute " + n.nick;
            chatSend(t)
        }
        ))
    }
    ,
    this.createButton = function(n, t, i, e) {
        var l = drawSIButton(n).addClass(t);
        i.append(l),
        l.click(e)
    }
    ,
    this.update = function(t) {
        $("#mc-addon").css("display", "block"),
        n.wnd.$.find(".nick-header").html(t),
        n.nick = t.replace(/ /gi, "_")
    }
    ,
    this.close = function() {
        $("#mc-addon").css("display", "none")
    }
    ,
    this.getMcText = function() {
        return $('<div class="mc-text"><div class="label-wrapper"><div class="label-text"></div></div><div class="send"></div></div>')
    }
    ,
    this.init()
}
function SMCAddon() {
    var n = this;
    this.wnd = null,
    this.init = function() {
        n.initWindow(),
        n.createAllButtons(),
        n.initCheckboxes(),
        n.acceptBut(),
        n.initCloseButton()
    }
    ,
    this.initCloseButton = function() {
        var t = drawSIButton("Zamknij");
        $("#smc-addon").append(t),
        t.addClass("smc-addon-close"),
        t.click((function() {
            n.close()
        }
        ))
    }
    ,
    this.initWindow = function() {
        this.wnd = {
            $: $("#smc-addon")
        }
    }
    ,
    this.close = function() {
        $("#smc-addon").css("display", "none")
    }
    ,
    this.createAllButtons = function() {
        var t = [1, 3, 7, 14, 30];
        for (var a in t)
            n.createButton(t[a]);
        n.createButton()
    }
    ,
    this.createButton = function(t) {
        var a = "banday_" + (t || "custom")
          , i = n.getBanDayRow()
          , c = i.find(".nr");
        if (i.find(".checkbox").attr("id", a),
        t)
            c.attr("for", "banday_" + t).html(t);
        else {
            c.remove();
            var s = $("<input>").attr({
                id: "custom_banday_value",
                for: "banday_custom"
            }).addClass("default");
            i.find(".table-wrapper").append(s)
        }
        n.wnd.$.find(".days").append(i)
    }
    ,
    this.acceptBut = function() {
        var t = drawSIButton("Ok");
        n.wnd.$.find(".ban-btn").append(t),
        t.click((function() {
            var t = n.wnd.$.find(".checkbox:checked")
              , a = t.length ? t.attr("id").substr(7) : null
              , i = "custom" == a ? $("#custom_banday_value").val() : a;
            !isNaN(parseInt(i)) && $(".ban-reason").val().length >= 10 ? _g("gm&a=ban&nick=" + esc(n.nick) + "&days=" + i + "&reason=" + esc($("#banday_reason").val()), (function() {
                n.close()
            }
            )) : mAlert(_t("banday_wrong_values_error"))
        }
        ))
    }
    ,
    this.update = function(n) {
        $("#smc-addon").css("display", "block"),
        this.nick = n,
        this.updateNick()
    }
    ,
    this.updateNick = function() {
        n.wnd.$.find(".question").html(_t("bandays_amount for %name%", {
            "%name%": n.nick
        }))
    }
    ,
    this.initCheckboxes = function() {
        n.wnd.$.find(".banday-row").bind("click", (function() {
            $(".banday-row").find("input").removeAttr("checked"),
            $(this).find(".checkbox").attr("checked", !0),
            $(this).find("input").focus()
        }
        ))
    }
    ,
    this.getBanDayRow = function() {
        return $('<div class="banday-row"><div class="table-wrapper"><div class="checkbox-wrapper"><input class="checkbox" type="checkbox"></div><span class="nr"></span></div></div>')
    }
    ,
    this.init()
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
function ClanController() {
    var t, n, a, i, e, s, r, l, u, c, o, h, d, f, p = this, g = {}, m = {};
    this.init = function() {
        this.initClasses(),
        this.initTable()
    }
    ,
    this.getProp = function(t) {
        return !!f && f[t]
    }
    ,
    this.createPlaceHolder = function(t, n, a) {
        a.find(t).attr("placeholder", n)
    }
    ,
    this.createRecords = function(t, n) {
        for (var a = $("<tr>"), i = 0; i < t.length; i++) {
            var e = $("<td>").html(t[i]);
            "object" == _typeof(n) ? e.addClass(n[i]) : e.addClass(n),
            a.append(e)
        }
        return a
    }
    ,
    this.initClasses = function() {
        s = new clanAtributes(p),
        l = new clanBless(p),
        d = new clanQuests(p),
        e = new clanSkills(p)
    }
    ,
    this.initTable = function() {
        ["clan_info", "clan_list", "clan-official-page", "clan_priv-page", "clan_recruit", "clan_members", "clan_treasury", "clan_manage", "clan_diplomacy", "clan_history", "clan_quests", "clan_skills"],
        t = [this.tLang("th_nick"), this.tLang("th_location"), this.tLang("th_rank"), this.tLang("th_status"), this.tLang("th_levelAndProf")],
        n = [this.tLang("clan_name"), this.tLang("clan_level"), this.tLang("clan_amount_members"), this.tLang("clan_info")],
        [this.tLang("creator_th"), this.tLang("rank_rEdit"), this.tLang("rank_treasury"), this.tLang("rank_invite"), this.tLang("rank_dismiss"), this.tLang("rank_privatepage"), this.tLang("rank_officialpage"), this.tLang("rank_diplomate"), this.tLang("rank_outfit"), this.tLang("tabview_th"), this.tLang("tabuse_th"), this.tLang("tablimit_th")]
    }
    ,
    this.update = function(t) {
        this.updateData(t),
        this.updateRanks(t.ranks)
    }
    ,
    this.updateData = function(t) {
        for (var n in f || this.initD(),
        t)
            f[n] = t[n]
    }
    ,
    this.initD = function() {
        f = {}
    }
    ,
    this.updateRanks = function(t) {
        var n = hero.clan.rank;
        if (t) {
            var a = t.split(";")
              , i = [];
            for (var e in a)
                a[e] = a[e].split(","),
                i[parseInt(a[e][0])] = {
                    name: a[e][1],
                    r: parseInt(a[e][2])
                };
            f.ranks = i,
            f.myrank = i[n].r
        } else
            f.myrank = f.ranks[n].r
    }
    ,
    this.updateClanList = function(t) {
        i || (i = new clanList(p),
        r = new findPanel(p)),
        i.update(t),
        p.updateClList(t)
    }
    ,
    this.updateClanSkills = function(t) {
        e.update(t)
    }
    ,
    this.updateClanBless = function(t) {
        l && (l = new clanBless(p)),
        l.update(t)
    }
    ,
    this.updatePrivPage = function() {
        u || (u = new clanPage(p,"priv-page","clan")),
        u.update()
    }
    ,
    this.updateOfficialPage = function() {
        c || (c = new clanPage(p,"official-page","clan")),
        c.update()
    }
    ,
    this.updateClanQuests = function(t) {
        d || (d = new clanQuests(p)),
        d.update(t)
    }
    ,
    this.updateRecruit = function(t, n) {
        o || (o = new recruit(p)),
        o.init(),
        o.update(t, n)
    }
    ,
    this.updateRecruitApplications = function(t) {
        o || (o = new recruit(p)),
        o.updateClanApplications(t)
    }
    ,
    this.updateRecruitInvitations = function(t) {
        o || (o = new recruit(p)),
        o.updateClanInvitations(t)
    }
    ,
    this.updateMembers = function(t) {
        a || (a = new clanMembers(p)),
        a.update(t)
    }
    ,
    this.updatePlayerEdit = function(t) {
        h || (h = new playerEdit(p)),
        h.update(t)
    }
    ,
    this.getOtherClan = function(t) {
        for (var n = {}, a = m.id.length, i = 0; i < a && t != m.id[i]; i++)
            ;
        for (var e in m)
            n[e] = m[e][i];
        return n
    }
    ,
    this.alert = function(t, n) {
        mAlert(t, 1, [function() {
            return n(),
            !0
        }
        ])
    }
    ,
    this.createOneMember = function(t, n, i) {
        var e;
        e = 0 == t[8] ? $("<span>").addClass("green online-status").html("online") : $("<div>").addClass("red online-status-wrapper v-item").html('<div class="online-status">offline</div><div class="time-offline" time-offline="' + t[8] + '">' + calculateDiff(t[8]) + "</div>");
        var s = a.getClanMember()
          , r = t[1]
          , l = escapeHTML(t[4]) + " (" + t[5] + ", " + t[6] + ")"
          , u = f.ranks
          , c = $("<div>").addClass("member-rank").html(u[t[7]].name)
          , o = CFG.opath + t[9]
          , h = $("<div>")
          , d = $("<div>").addClass("profs-icon " + t[3]);
        c.attr("id-rank", t[7]),
        d.tip(t[3]);
        var p = $("<span>").addClass("member-lvl").html(t[2])
          , g = $("<span>").addClass("member-prof").html(t[3]);
        return h.append(p),
        h.append(g),
        s.find(".icon").css("background-image", "url(" + o + ")"),
        s.find(".char-stats").html(r),
        s.find(".last-visit").html(l),
        i && a.createAddToGroup(s, t[0]),
        n ? (a.createButRankEdit(s, t[7], t[0], t[1]),
        this.createRecords([s, h, c, e], "normal-td big-height-td")) : this.createRecords([s, c], "normal-td big-height-td")
    }
    ,
    this.addControll = function(t, n, a, i) {
        var e = drawSIButton(t);
        return a && e.click(a.bind(p)),
        (i = i || this.wnd.$).find("." + n).append(e),
        e
    }
    ,
    this.getMemberList = function() {
        return g
    }
    ,
    this.getClanInf = function() {
        return n
    }
    ,
    this.getFindPanel = function() {
        return r
    }
    ,
    this.getClanAtributs = function() {
        return s
    }
    ,
    this.getCharInf = function() {
        return t
    }
    ,
    this.getClanList = function() {
        return i
    }
    ,
    this.updateClList = function(t) {
        m = t
    }
    ,
    this.getRecruit = function() {
        return o
    }
    ,
    this.updateClasses = function() {}
    ,
    this.resetLastValClanList = function() {
        i && i.resetLastVal()
    }
    ,
    this.tLang = function(t, n) {
        return _t(t, null, n || "clan")
    }
    ,
    this.init()
}
function clanAtributes(t) {
    var a = this
      , e = {
        0: {
            name: "empty",
            input: "c",
            part: 0
        },
        1: {
            name: "empty",
            input: "c",
            part: 0
        },
        2: {
            name: t.tLang("min_level"),
            input: "i",
            range: [0, 300, 10],
            find: "BiggerOrEqual",
            part: 0,
            clanListFilter: 1
        },
        7: {
            name: t.tLang("max_level"),
            input: "i",
            range: [10, 300, 10, !0],
            find: "BiggerOrEqual",
            part: 0,
            clanListFilter: 2
        },
        12: {
            name: "empty",
            input: "i",
            range: [13, 30, 1],
            find: "BiggerOrEqual",
            part: 0
        },
        17: {
            name: "empty",
            input: "c",
            part: 1
        },
        18: {
            name: "empty",
            input: "c",
            part: 1
        },
        19: {
            name: t.tLang("clan type"),
            input: "m",
            strValues: [t.tLang("neutral"), t.tLang("feature"), t.tLang("war")],
            part: 1,
            clanListFilter: 4
        },
        21: {
            name: t.tLang("recruit_state_new"),
            input: "m",
            strValues: [_t("close_recruit"), _t("open_recruit"), _t("free recruitment")],
            part: 1,
            clanListFilter: 0
        },
        100: {
            name: t.tLang("clan_level"),
            input: "i",
            range: [0, 30, 1],
            find: "BiggerOrEqual",
            part: 0,
            clanListFilter: 3
        },
        101: {
            name: t.tLang("rank_outfit"),
            input: "c",
            part: 1,
            clanListFilter: 5
        },
        102: {
            name: t.tLang("depo"),
            input: "i",
            range: [0, 5, 1],
            part: 1,
            clanListFilter: 6
        },
        103: {
            name: t.tLang("maxParticipants"),
            input: "i",
            range: [0, 8, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 7
        },
        104: {
            name: t.tLang("expBonus"),
            input: "i",
            range: [0, 10, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 8
        },
        105: {
            name: t.tLang("questExpBonus"),
            input: "i",
            range: [0, 10, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 9
        },
        106: {
            name: t.tLang("allyEnemyCount"),
            input: "i",
            range: [0, 10, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 10
        },
        107: {
            name: t.tLang("blessing"),
            input: "i",
            range: [0, 7, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 11
        },
        109: {
            name: t.tLang("healPower"),
            input: "i",
            range: [0, 10, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 13
        },
        110: {
            name: t.tLang("timeTickets"),
            input: "i",
            range: [0, 10, 1],
            find: "BiggerOrEqual",
            part: 2,
            clanListFilter: 14
        }
    };
    this.getOneClanAtribute = function() {
        return $('<div class="one-clan-atribute"><div class="atribute-name-wrapper"><span class="atribute-name"></span></div><div class="atribute-value-wrapper"><span class="atribute-value"></span></div><div class="input-wrapper"></div></div>')
    }
    ,
    this.createAtribute = function(t, n, r, i, s, u) {
        var l = a.getOneClanAtribute()
          , p = e[n].input
          , c = e[n].name
          , o = e[n].part;
        if ("empty" == e[n].name && l.addClass("empty"),
        t.find(".clan-part-" + o).append(l),
        l.find(".atribute-name").html(c),
        s)
            switch (p) {
            case "i":
                var g = $("<input>");
                l.find(".input-wrapper").append(g),
                this.createTextInput(g, n, r, u),
                this.createTipToInput(g, n);
                break;
            case "m":
                g = $("<select>");
                l.find(".input-wrapper").append(g),
                this.createMenuInput(g, n, u);
                break;
            case "c":
                g = $("<div>");
                l.find(".input-wrapper").append(g),
                this.createDivideButton(g, n, u)
            }
        i && this.setMenuOptionOrTextInputOrDivideOptionOrNormalText(n, l, p, i)
    }
    ,
    this.setMenuOptionOrTextInputOrDivideOptionOrNormalText = function(t, a, e, n) {
        var r = this.parseValFromBits(t, n[0]);
        if ("inInput" == n[1])
            switch (e) {
            case "m":
                var i = (s = a.find("option:contains(" + r + ")")).attr("value");
                a.find("select").val(i);
                break;
            case "i":
                a.find("input").val(r);
                break;
            case "c":
                var s = a.find(".option:has(.label:contains(" + r + "))");
                a.find(".bck").removeClass("active"),
                s.find(".bck").addClass("active")
            }
        else
            a.find(n[1]).html(r)
    }
    ,
    this.getMapOfBits = function(t, e, n, r, i) {
        var s = {
            0: a.toBinary(1 & t),
            1: a.toBinary(t >> 1 & 1),
            2: a.toBinary(t >> 2 & 31),
            7: a.toBinary(t >> 7 & 31),
            12: a.toBinary(t >> 12 & 31),
            17: a.toBinary(t >> 17 & 1),
            18: a.toBinary(t >> 18 & 1),
            19: a.toBinary(t >> 19 & 3),
            21: a.toBinary(t >> 21 & 3)
        };
        return r ? (s[100] = a.toBinary(e),
        s[101] = "" == i ? 0 : 1,
        s[102] = a.toBinary(n),
        s[103] = a.toBinary(r.maxParticipants.lvl),
        s[104] = a.toBinary(r.expBonus.lvl),
        s[105] = a.toBinary(r.questExpBonus.lvl),
        s[106] = a.toBinary(r.allyEnemyCount.lvl),
        s[107] = a.toBinary(r.blessing.lvl),
        s[108] = a.toBinary(r.cursedItem.lvl),
        s[109] = a.toBinary(r.healPower.lvl),
        s[110] = a.toBinary(r.timeTickets.lvl),
        s) : s
    }
    ,
    this.parseValFromBits = function(t, a) {
        var n = e[t]
          , r = n.range
          , i = n.strValues
          , s = parseInt(t);
        return isset(i) ? this.getStrValFromBits(a, s) : isset(r) ? this.rangeOfBits(a, s) : 1 == a[t] ? _t("yes") : _t("no")
    }
    ,
    this.getStrValFromBits = function(t, a) {
        var n = e[a].strValues
          , r = n.length;
        this.amountBits(r);
        return n[parseInt(t[a], 2)]
    }
    ,
    this.rangeOfBits = function(t, a) {
        var n = e[a].range[0]
          , r = e[a].range[1]
          , i = e[a].range[2]
          , s = e[a].range[3]
          , u = parseInt(t[a], 2);
        return s ? Math.abs(n + u * i - (n + r)) : n + u * i
    }
    ,
    this.createMenuInput = function(t, a, e) {
        var n = this.getAttrDataMenu(a, e);
        for (var r in t.addClass("menu default"),
        n)
            t.append($("<option>").html(n[r].text).attr("value", n[r].val));
        t.addClass("input-val-" + a)
    }
    ,
    this.createDivideButton = function(t, a, e) {
        var n = this.getAttrDataMenu(a, e);
        t.createDivideButton(n, a, !0)
    }
    ,
    this.saveAtributes = function() {
        for (var e = [0, 1, 2, 7, 12, 17, 18, 19, 21], n = t.getRecruit().getContent(), r = t.getProp("attributes"), i = a.getMapOfBits(r), s = 0; s < e.length; s++) {
            var u = e[s]
              , l = a.prepareValueFromInput(n, u);
            if (l < 0)
                return;
            i[u] = a.toBinary(l)
        }
        a.sendData(i)
    }
    ,
    this.prepareValueFromInput = function(t, a) {
        var n, r = t.find(".input-val-" + a), i = e[a].input;
        if ("empty" == e[a].name)
            return 0;
        switch (i) {
        case "i":
        case "m":
            n = r.val();
            break;
        case "c":
            n = r.find(".active").attr("value")
        }
        return "" === (n = this.checkRangeExist(a, n)) ? -1 : parseInt(n)
    }
    ,
    this.checkRangeExist = function(t, a) {
        var n = e[t].range;
        return isset(n) ? a = n[3] ? Math.abs(a - n[1]) / n[2] : (a - n[0]) / n[2] : a
    }
    ,
    this.sendData = function(t) {
        var n = "";
        for (var r in t) {
            var i = t[r];
            if (e[r].range)
                var s = e[r].range[0]
                  , u = (e[r].range[1] - s) / e[r].range[2] + 1
                  , l = this.amountBits(u);
            else if (e[r].strValues) {
                var p = e[r].strValues.length;
                l = this.amountBits(p)
            } else
                l = 1;
            for (var c = ""; c.length < l - i.length; )
                c += 0;
            n = (c += i) + n
        }
        _g("clan&a=set_attrs&v=" + a.toDecimal(n))
    }
    ,
    this.amountBits = function(t) {
        for (var a = 2, e = 1; e < 10; e++) {
            if (t + 1 <= a)
                return e;
            a *= 2
        }
    }
    ,
    this.createTextInput = function(e, n, r) {
        var i = "input-val-" + n;
        e.addClass("default " + i),
        e.focusout((function() {
            var t = $(this).val()
              , e = a.isNumber(t);
            if ("" != t && e) {
                var n = $(this).attr("class").replace("default input-val-", "")
                  , r = a.correctVal(n, t);
                $(this).val(r)
            } else
                $(this).val("")
        }
        )),
        t.createPlaceHolder("." + i, "----", r)
    }
    ,
    this.createTipToInput = function(t, a) {
        var n = e[a].range
          , r = n[2]
          , i = _t("leap")
          , s = r > 1 ? " " + i + " " + r : ""
          , u = "Min: " + n[0] + " Max: " + n[1] + s;
        t.attr("tip", u)
    }
    ,
    this.getAttrDataMenu = function(t, a) {
        var n;
        n = a ? [] : [{
            text: '<div class="icon"><div class="zero"></div></div>',
            val: ""
        }];
        var r = e[t];
        return isset(r.range) ? this.createRangeValues(r, n) : isset(r.strValues) ? this.createStrValues(r, n) : (n.push({
            text: _t("yes"),
            val: 1
        }),
        n.push({
            text: _t("no"),
            val: 0
        }),
        n)
    }
    ,
    this.createRangeValues = function(t, a) {
        for (var e = t.range[0], n = t.range[1], r = t.range[2], i = e; i < n; i += r) {
            var s = {
                text: i,
                val: i
            };
            a.push(s)
        }
        return a
    }
    ,
    this.createStrValues = function(t, a) {
        for (var e = t.strValues, n = 0; n < e.length; n++) {
            var r = {
                text: e[n],
                val: n
            };
            a.push(r)
        }
        return a
    }
    ,
    this.correctVal = function(t, a) {
        var n = e[t].range
          , r = n[0];
        if (a <= r)
            return r;
        var i = n[1];
        if (a >= i)
            return i;
        for (var s = n[2], u = r; r < i; u += s) {
            if (u == a)
                return a;
            if (u + s > a)
                return u
        }
    }
    ,
    this.toBinary = function(t) {
        return (t >>> 0).toString(2)
    }
    ,
    this.toDecimal = function(t) {
        return parseInt(t, 2)
    }
    ,
    this.getAttrDataTab = function() {
        return e
    }
    ,
    this.isNumber = function(t) {
        return !isNaN(parseFloat(t)) && isFinite(t)
    }
}
function clanList(t) {
    var n, e, i, a, l, c = this, s = 0, r = !0, o = null;
    this.update = function(l) {
        (e = l.cur_page,
        l.clans_count,
        l.clans_per_page,
        a = l.max_page,
        1 == e) && (this.init(),
        t.getFindPanel().init(),
        i = !0);
        var s = l.id.length
          , r = n.find(".clan-list-table");
        e == a && (i = !1);
        for (var o = 0; o < s; o++) {
            var u = l.id[o]
              , d = l.name[o]
              , f = $("<td>").addClass("no-border").text(d)
              , h = l.level[o]
              , p = l.members_count[o]
              , v = (l.attributes[o],
            this.getRectruit(l.attributes[o], u))
              , g = 10 * (l.attributes[o] >> 2 & 31)
              , m = "normal-td"
              , b = t.createRecords([f, h, p, g, v], ["clan-name-td " + m, "clan-lvl-td " + m, "clan-members-td " + m, "clan-minlvl-td " + m, m]);
            b.addClass("hover one-clan-tr clan-id-" + u),
            c.trClick(b, u),
            c.addIdToMyClan(b, d),
            r.append(b)
        }
        if (1 == e) {
            var C = this.createTabHeaderClanList();
            r.prepend(C),
            this.createHeaderSortButtons()
        }
    }
    ,
    this.getGetNextPage = function() {
        i && c.sendRequest(e + 1)
    }
    ,
    this.getRectruit = function(t, n) {
        var e, i = t >> 21 & 3;
        return 0 == i ? _t("no") : (2 == i ? (e = drawSIButton(_t("Join_now"))).click((function() {
            return _g("clan&a=join&id=" + n),
            !1
        }
        )) : (e = drawSIButton(_t("Apply_now"))).click((function() {
            return _g("clan&a=apply&id=" + n),
            !1
        }
        )),
        e)
    }
    ,
    this.createSkills = function(t, n) {
        return {
            maxParticipants: {
                lvl: t.maxParticipants[n]
            },
            expBonus: {
                lvl: t.expBonus[n]
            },
            questExpBonus: {
                lvl: t.questExpBonus[n]
            },
            allyEnemyCount: {
                lvl: t.allyEnemyCount[n]
            },
            blessing: {
                lvl: t.blessing[n]
            },
            cursedItem: {
                lvl: t.cursedItem[n]
            },
            healPower: {
                lvl: t.healPower[n]
            },
            timeTickets: {
                lvl: t.timeTickets[n]
            }
        }
    }
    ,
    this.writeDataInElement = function(n, e, i, a, l, c) {
        var s = t.getClanAtributs().getMapOfBits(e, i, a, l, c);
        n.data("atribute", s)
    }
    ,
    this.addIdToMyClan = function(t, n) {}
    ,
    this.trClick = function(t, n) {
        t.click((function() {
            _g("clan&a=getclan&id=" + n)
        }
        ))
    }
    ,
    this.createLogo = function(t) {
        var n = $("<td>").addClass("logo");
        return n.css({
            background: "url(" + t + ")",
            "background-size": "100% 100%"
        }),
        n
    }
    ,
    this.createTabHeaderClanList = function() {
        var n = t.getClanInf()
          , e = t.tLang("recruitment")
          , i = t.tLang("min_level");
        return t.createRecords([n[0], n[1], n[2], i, e], "table-header hover-header")
    }
    ,
    this.createHeaderSortButtons = function() {
        for (var t = n.find(".clan-list-table tr").first(), e = 0; e < 5; e++)
            this.clickSort(t, e)
    }
    ,
    this.clickSort = function(t, n) {
        t.children().eq(n).click((function() {
            s == n ? r = !r : (s = n,
            r = !0),
            c.sendRequest(1)
        }
        ))
    }
    ,
    this.sendRequest = function(t, e) {
        var i = n.find(".clan-name-input").val()
          , a = "" == i ? "" : "&search=" + esc(i);
        _g("clan&a=list&page=" + t + "&sort=" + s + "&ascending=" + (r ? 1 : 0) + a + (e || ""))
    }
    ,
    this.init = function() {
        $("#clanbox").unbind("scroll"),
        this.initContent(),
        this.initInputSearch(),
        this.initScrollEvent()
    }
    ,
    this.initContent = function() {
        l = isset(n) ? n.find(".clan-name-input").val() : "",
        $("#clanbox").empty(),
        n = c.getClanListContent(),
        $("#clanbox").append(n),
        n.find(".clan-name-input").focus()
    }
    ,
    this.initInputSearch = function() {
        var t = n.find(".clan-name-input");
        t.val(l),
        t.keyup((function() {
            o ? (clearTimeout(o),
            o = null,
            c.createTimeout()) : c.createTimeout()
        }
        ))
    }
    ,
    this.createTimeout = function() {
        o = setTimeout((function() {
            c.sendRequest(1)
        }
        ), 1e3)
    }
    ,
    this.toBinary = function(t) {
        return (t >>> 0).toString(2)
    }
    ,
    this.getClanListContent = function() {
        return $('<div class="clan-list-content"><div class="clan-list-show-btn"></div><input class="clan-name-input default"/><div class="first-scroll-wrapper scroll-wrapper"><div class="scroll-pane"><table class="clan-list-table"></table></div></div></div>')
    }
    ,
    this.resetLastVal = function() {
        n.find(".clan-name-input").val("")
    }
    ,
    this.initScrollEvent = function() {
        $("#clanbox").scroll((function() {
            if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
                if ($("#clanbox").find(".clan-list-content").length < 1)
                    return;
                c.getGetNextPage()
            }
        }
        ))
    }
}
function findPanel(t) {
    var n, i, a = this;
    this.init = function() {
        this.initContent(),
        this.initAttrTab(),
        this.createFindPanel(),
        this.createShowFindPanelBtn(),
        this.hideElements()
    }
    ,
    this.hideElements = function() {
        n.find(".atribute-value-wrapper").css("display", "none")
    }
    ,
    this.initContent = function() {
        n = a.getFindPanelHtml(),
        $("#clanFilter").append(n)
    }
    ,
    this.initAttrTab = function() {
        var n = t.getClanAtributs();
        i = n.getAttrDataTab()
    }
    ,
    this.createFindPanel = function() {
        this.createHideBtn(),
        this.createFindBtn(),
        this.createFindPanelHeaders(),
        this.createAllAtributes()
    }
    ,
    this.createAllAtributes = function() {
        var a = n.find(".clan-list-find-content")
          , e = t.getClanAtributs();
        for (var s in i)
            "empty" != i[s].name && e.createAtribute(a, s, n, !1, !0)
    }
    ,
    this.createFindPanelHeaders = function() {
        var i = "clan-find-header-"
          , a = $("<span>").addClass("gfont").attr("name", t.tLang("advanced-find"));
        a.html(t.tLang("advanced-find")),
        n.find("." + i + 0).html(t.tLang(i + 0)),
        n.find("." + i + 1).html(t.tLang(i + 1)),
        n.find("." + i + 2).html(t.tLang(i + 2)),
        n.find(".clan-list-find-header").html(a)
    }
    ,
    this.showFindPanel = function() {
        n.toggleClass("active"),
        $("#clanFilter").toggle()
    }
    ,
    this.hideFindPanel = function() {
        $("#clanFilter").css("display", "none")
    }
    ,
    this.createShowFindPanelBtn = function() {
        var n = drawSIButton(t.tLang("filter"));
        $("#clanbox").find(".clan-list-show-btn").append(n),
        n.click(a.showFindPanel)
    }
    ,
    this.createHideBtn = function() {
        var t = drawSIButton(_t("hide"));
        t.click(a.hideFindPanel),
        n.find(".clan-list-hide-btn").append(t)
    }
    ,
    this.createFindBtn = function() {
        var t = drawSIButton(_t("search"));
        t.click(a.sortAttrClans),
        n.find(".clan-list-find-btn").append(t)
    }
    ,
    this.sortAttrClans = function() {
        var n = "&filters=" + a.getFilter().join("");
        t.getClanList().sendRequest(1, n),
        console.log(n),
        a.hideFindPanel()
    }
    ,
    this.checkClanMatch = function(t, n, e) {
        var s = !0;
        for (var l in e) {
            var d = "is" + (isset(i[l].find) ? i[l].find : "Equal")
              , r = this.getLookingForVal(e[l], l);
            if (!a[d](n[l], r)) {
                s = !1;
                break
            }
        }
        s || t.addClass("hide")
    }
    ,
    this.getLookingForVal = function(t, n) {
        var a = i[n].range;
        return a ? a[3] ? Math.abs((t - a[1]) / a[2]) : (t - a[0]) / a[2] : t
    }
    ,
    this.isEqual = function(t, n) {
        return parseInt(t, 2) == n
    }
    ,
    this.isBiggerOrEqual = function(t, n) {
        return parseInt(t, 2) >= n
    }
    ,
    this.isLesserOrEqual = function(t, n) {
        return parseInt(t, 2) <= n
    }
    ,
    this.getFilter = function() {
        var t = new Array(15);
        for (var a in i) {
            var e = i[a].clanListFilter;
            if ("empty" != i[a].name) {
                var s, l = i[a].input, d = n.find(".input-val-" + a);
                switch (l) {
                case "i":
                    s = d.val();
                    break;
                case "m":
                    s = d.attr("value");
                    break;
                case "c":
                    s = d.find(".active").attr("value")
                }
                t[e] = "" != s ? s + "|" : "|"
            }
        }
        return t
    }
    ,
    this.getFindPanelHtml = function() {
        return $('<div class="clan-list-find-panel"><div class="clan-list-find-header"></div><div class="clan-list-atributes"><div class="scroll-wrapper clan-list-find-content"><div class="scroll-pane"><div class="background-wrapper"><div class="clan-find-header-0"></div><div class="clan-part-0"></div><div class="clan-find-header-1"></div><div class="clan-part-1"></div><div class="clan-find-header-2"></div><div class="clan-part-2"></div></div></div></div></div><div class="clan-list-butts-wrapper"><div class="clan-list-butts"><div class="clan-list-hide-btn"></div><div class="clan-list-find-btn"></div></div></div></div>')
    }
}
function clanSkills(l) {
    var s, n = this;
    this.amountPoint = 0;
    var t = ["expBonus", "healPower", "questExpBonus"]
      , i = ["timeTickets"];
    this.update = function(l) {
        this.initContent(),
        this.amountPoint = l.points,
        this.showOrHideResetBtn(),
        this.createSkills(l.quest_bonuses, l.quest_bonuses_use),
        this.updateHeader(),
        this.showOrHideAddBtn(),
        this.updateScroll()
    }
    ,
    this.skillsWithMinutes = function(l) {
        return i.indexOf(l) > -1 ? " min" : ""
    }
    ,
    this.skillsWithPercent = function(l, s) {
        var n = t.indexOf(l) > -1
          , i = s.val;
        return n ? 100 * i + "%" : i
    }
    ,
    this.showOrHideResetBtn = function() {
        var l = n.canUse()
          , t = s.find(".clan-skill-reset>.button");
        t.css("display", "none"),
        l && t.css("display", "block")
    }
    ,
    this.createSkills = function(l, n) {
        var t = s.find(".scroll-pane");
        for (var i in l)
            this.createOneSkill(i, l[i], n, t)
    }
    ,
    this.createOneSkill = function(s, t, i, a) {
        var e, c = n.getClanSkill(), d = this.addPointBtn(c, s, t), o = t.type, r = i[s], u = t.val;
        switch (e = this.skillsWithPercent(s, t),
        e += this.skillsWithMinutes(s, t),
        this.createSklillBckLevel(c, t),
        this.createProgresLevel(c, t),
        c.addClass(s + "-skill"),
        c.find(".skill-icon").addClass(s),
        c.find(".skill-clan-name").html(l.tLang(s)),
        c.find(".skill-clan-description").html(l.tLang(s + "description")),
        c.find(".skill-actual-val").html("<b>" + l.tLang("skill-actual-val") + " " + e + "</b>"),
        c.find(".skill-clan-buts-add-point").append(d),
        o) {
        case 0:
            break;
        case 1:
            var p = this.createShowBlessBtn(r);
            c.find(".skill-increase-decrease").empty().append(p);
            break;
        case 2:
            var v = this.onOffButton(s, t, r);
            c.find(".skill-clan-buts-turn-on-off").append(v);
            break;
        case 3:
            var k = this.increaseDecreaseButton(s, t, r, u);
            c.find(".skill-increase-decrease").append(k)
        }
        a.append(c)
    }
    ,
    this.createProgresLevel = function(l, s) {
        for (var n = s.lvl, t = s.maxlvl, i = l.find(".skill-slots-wrapper"), a = l.find(".skill-points-wrapper"), e = 0; e < t; e++) {
            var c = "";
            c = 0 == e ? "left" : e != t - 1 ? "middle" : "right",
            (d = $("<div>")).addClass(c + " empty-lvl"),
            i.append(d)
        }
        for (e = 0; e < n; e++) {
            var d = $("<div>").addClass("use-lvl");
            a.append(d)
        }
    }
    ,
    this.increaseDecreaseButton = function(s, n, t, i) {
        var a = drawSIButton(l.tLang("show_blesses"))
          , e = ""
          , c = !1;
        return t && (c = !0,
        e += _t("skillBonusUsed") + "<br>"),
        0 == i && (c = !0,
        e += _t("notBuySkill") + "<br>"),
        c ? (a.addClass("black"),
        a.tip(e),
        a) : (a.click((function() {
            var l = $("<div>")
              , n = $("<div>").addClass("label").html(_t("timeTicketsAlert1"))
              , t = $("<div>").addClass("stamina_pay_options")
              , i = $("<span>").addClass("st_pay_1").html(_t("for_today_new"))
              , a = $("<button>").addClass("bal_pay_decrease active")
              , e = $("<button>").addClass("bal_pay_increase active");
            t.append(i),
            t.append(e),
            t.append(a),
            a.click((function() {
                mAlert(_t("new_stamina_alert_sub"), 1, [function() {
                    _g("clan&a=skills_use&name=" + s + "&opt=2")
                }
                ])
            }
            )),
            e.click((function() {
                mAlert(_t("new_stamina_alert_add"), 1, [function() {
                    _g("clan&a=skills_use&name=" + s + "&opt=1")
                }
                ])
            }
            )),
            l.append(n),
            l.append(t),
            mAlert(l, 5)
        }
        )),
        a)
    }
    ,
    this.onOffButton = function(l, s, n) {
        var t, i, a = 0 == s.lvl;
        return console.log(n),
        n ? (t = drawSIButton(_t("turn_off", null, "loot")),
        i = 2) : ((t = drawSIButton(_t("turn_on", null, "loot"))).addClass("green"),
        i = 1),
        a ? (t.addClass("black"),
        t.tip(_t("notBuySkill")),
        t) : (t.click((function() {
            _g("clan&a=skills_use&name=" + l + "&opt=" + i)
        }
        )),
        t)
    }
    ,
    this.createSklillBckLevel = function(l, s) {
        var n = l.find(".skill-level-bck")
          , t = l.find(".skill-level")
          , i = s.maxlvl
          , a = s.lvl
          , e = Math.round(6 * a / i)
          , c = a > 0 ? "chosen" : "";
        t.html(a + "/" + i).addClass(c),
        n.addClass("cl-" + e)
    }
    ,
    this.canUse = function() {
        return 1 & l.getProp("myrank") ? 1 : 0
    }
    ,
    this.addPointBtn = function(s, t, i) {
        var a = n.canUse()
          , e = ""
          , c = !1
          , d = i.maxlvl == i.lvl;
        if (a || (c = !0,
        e += l.tLang("clan_skills_can_use")),
        d)
            return s.find(".skill-clan-buts-label").css("display", "none"),
            null;
        0 != n.amountPoint || d || (c = !0,
        e += "" != e ? "<br><br>" : "",
        e += _t("skillPointsNotExist")),
        l.getProp("gold") < i.nextcost && (c = !0,
        e += "" != e ? "<br><br>" : "",
        e += _t("notEnoughGold"));
        var o = c ? "black" : ""
          , r = drawSIButton(_t("uprage_clan_skill") + " " + round(i.nextcost, 5)).addClass(o);
        return r.tip(e),
        c || r.click((function() {
            var l = _t("acceptSkillupgrade", {
                "%cost%": round(i.nextcost, 5)
            }, "clan");
            mAlert(l, 1, [function() {
                _g("clan&a=skills_upgrade&name=" + t)
            }
            ])
        }
        )),
        r
    }
    ,
    this.clearContent = function() {
        s.find(".scroll-pane").empty()
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", s).trigger("update")
    }
    ,
    this.init = function() {
        this.initContent()
    }
    ,
    this.resetSkillsBtn = function() {
        var t = tpl.get("button")
          , i = $("<div>").addClass("small-draconite")
          , a = $("<div>").addClass("cost").html("20k")
          , e = n.canUse();
        t.append(a, i),
        t.addClass("small purple"),
        t.find(".label").html(l.tLang("clan-skills-reset")),
        e && (t.click(n.resetSkilsRequest),
        s.find(".clan-skill-reset").append(t))
    }
    ,
    this.resetSkilsRequest = function() {
        n.canUse() && _g("clan&a=skills_reset")
    }
    ,
    this.showOrHideAddBtn = function() {
        var l = ["none", "table-cell"]
          , t = n.amountPoint > 0 ? l[1] : l[0];
        s.find(".skill-upgrade").css("display", t)
    }
    ,
    this.initContent = function() {
        s = n.getClanSkillsContent(),
        $("#clanbox").empty(),
        $("#clanbox").append(s)
    }
    ,
    this.updateHeader = function() {
        var t, i = this.canUse(), a = s.find(".clan-skill-header"), e = '<span class="' + (n.amountPoint > 0 ? "green" : "red") + '">' + n.amountPoint + "</span>", c = $("<div>").addClass("small-info MM-info-icon");
        t = i ? l.tLang("choose_skillpoints") : l.tLang("only_leader"),
        c.tip(_t("one_clan_skill_point")),
        a.html(t + e),
        a.append(c)
    }
    ,
    this.createShowBlessBtn = function(s) {
        var t = l.tLang("show_blesses")
          , i = drawSIButton(t);
        return i.click(n.showBless),
        i
    }
    ,
    this.showBless = function() {
        _g("clan&a=skills_use&name=blessing");
        l.tLang("clan_blesses")
    }
    ,
    this.getClanSkillsContent = function() {
        return $('<div class="clan-skills-content"><div class="clan-skill-main-header"></div><div class="clan-skill-header"></div><div class="clan-skill-reset"></div><div class="scroll-wrapper"><div class="scroll-pane"></div></div></div>')
    }
    ,
    this.getClanSkill = function() {
        return $('<div class="one-clan-skill"><div class="skill-icon-wrapper"><div class="skill-icon"></div><div class="skill-level-bck"><span class="skill-level"></span></div><div class="skill-increase-decrease"></div></div><div class="skill-clan-info"><div class="skill-clan-name"></div><div class="skill-clan-description"></div><div class="skill-progress"><div class="skill-slots-wrapper"></div><div class="skill-points-wrapper"></div></div><div class="skill-actual-val"></div></div><div class="skill-clan-buts-wrapper"><div class="skill-clan-buts-label" data-trans="#use_clan_point"></div><div class="skill-clan-buts-add-point"></div><div class="skill-clan-buts-turn-on-off"></div></div></div>')
    }
    ,
    this.init()
}
function clanBless(s) {
    var e, i, t = this, n = !0;
    this.init = function() {}
    ,
    this.update = function(s) {
        this.initContent(),
        this.initTexts(),
        this.setBlessLevel(s),
        n ? n = !1 : g.tplsManager.removeCallback("b", t.newBlessItem),
        this.initFetch(),
        this.updateScroll()
    }
    ,
    this.clearDisabled = function() {
        e.find(".scroll-pane").find(".disabled").removeClass("disabled")
    }
    ,
    this.setBlessLevel = function(s) {
        i = s.bless_max
    }
    ,
    this.getOneBlessSkillHtml = function() {
        return $('<div class="one-bless-skill"><div class="item-wrapper"></div><div class="info-wrapper"><div class="bless-name"></div><div class="bless-description"></div></div><div class="bless-use"><div class="bless-duration"></div></div></div>')
    }
    ,
    this.newBlessItem = function(s) {
        var n = e.find(".scroll-pane")
          , l = n.children().length
          , a = s.id;
        if (n.find(".bless-" + a).length > 0)
            (l = n.find(".bless-" + a).index()) + 1 > i && t.setDisabled(n.find(".bless-" + a));
        else {
            var d = t.getOneBlessSkillHtml();
            d.addClass("bless-" + a);
            var c = s.name
              , r = parseItemStat(s.stat)
              , o = r.opis
              , h = r.ttl
              , b = s.pr
              , u = t.useBlessBtn(l, b)
              , f = t.createCloneItem(s.$);
            d.find(".item-wrapper").append(f),
            d.find(".bless-name").html(c),
            d.find(".bless-description").html(parseClanBB(o)),
            d.find(".bless-duration").html(_t("battleTime", null, "matchmaking") + " " + h + "min"),
            d.find(".bless-use").prepend(u),
            l + 1 > i && t.setDisabled(d),
            n.append(d)
        }
    }
    ,
    this.createCloneItem = function(s) {
        var e = s.clone(!1)
          , i = e.attr("tip");
        return i = i.replace("s-7", "s-7 left"),
        e.attr("tip", i)
    }
    ,
    this.rebuiltDisabled = function() {
        var s = e.find(".one-bless-skill");
        s.removeClass("disabled"),
        s.each((function() {
            $(this).index() + 1 > i && t.setDisabled($(this))
        }
        ))
    }
    ,
    this.setDisabled = function(s) {
        s.addClass("disabled")
    }
    ,
    this.useBlessBtn = function(s, e) {
        var i = _t("use_it", null, "item")
          , t = drawSIButton(i + " " + round(e));
        return t.click((function() {
            _g("clan&a=skills_use&name=blessing&opt=" + (s + 1))
        }
        )),
        t
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("b", t.newBlessItem)
    }
    ,
    this.getClanBlessContent = function() {
        return $('<div class="clan-bless-content"><div class="bless-main-header"></div><div class="bless-header"></div><div class="scroll-wrapper"><div class="scroll-pane"></div></div></div>')
    }
    ,
    this.initContent = function() {
        e = t.getClanBlessContent(),
        $("#clanbox").empty(),
        $("#clanbox").append(e)
    }
    ,
    this.initBackBtn = function() {
        var i = s.tLang("back")
          , n = drawSIButton(i).addClass("small green");
        n.find(".label").html(i),
        n.click(t.showSkils),
        e.find(".back-to-skill-btn").append(n)
    }
    ,
    this.showSkils = function() {
        s.tLang("clan_skills")
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", e).trigger("update")
    }
    ,
    this.initTexts = function() {
        e.find(".bless-header").html(s.tLang("bless-header")),
        e.find(".bless-main-header").html(s.tLang("clan_blesses"))
    }
    ,
    this.init()
}
function clanPage(i, t, n) {
    var a, e, o, c;
    this.update = function(i) {
        this.updatePage(i),
        this.hideOrShowEditBut(),
        this.updateScroll()
    }
    ,
    this.updatePage = function(n) {
        if (n)
            c = deletePositionFixed(n.official);
        else {
            var e = "priv-page" == t ? "info" : "official";
            c = i.getProp(e)
        }
        a.find(".page-content").html(parseClanBB(c))
    }
    ,
    this.hideOrShowEditBut = function() {
        if ("clan" == n) {
            var i = "priv-page" == t ? "priv" : "official"
              , a = this["allow" + i + "Edit"]();
            e.find(".clan-" + i + "-page-content").find(".edit-page-but").css("display", a ? "block" : "none")
        }
    }
    ,
    this.allowprivEdit = function() {
        return 32 & i.getProp("myrank")
    }
    ,
    this.allowofficialEdit = function() {
        return 64 & i.getProp("myrank")
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", a).trigger("update")
    }
    ,
    this.init = function() {
        this.initWindow(),
        this.initContent(),
        this.initEditPageBut()
    }
    ,
    this.initWindow = function() {
        var t = "clan" == n ? 1 : 0
          , a = [["showcase", i.getShowcaseWnd().$], ["clan", i.wnd.$]];
        o = a[t][0],
        e = a[t][1]
    }
    ,
    this.initContent = function() {
        (a = tpl.get("clan-page-content")).addClass("clan-" + t + "-content"),
        e.find(".card-content").append(a),
        $(".scroll-wrapper", a).addScrollBar({
            track: !0
        })
    }
    ,
    this.showOtherClanOfficial = function() {
        var n = i.getShowcaseWnd().$.find(".card");
        i.showChooseCard(o, "clan-" + t),
        n.removeClass("active"),
        n.eq(0).addClass("active")
    }
    ,
    this.initEditPageBut = function() {
        if ("clan" == n) {
            var i = tpl.get("button").addClass("small green")
              , t = $("<div>").addClass("add-bck");
            a.find(".edit-page-but").append(i),
            i.append(t),
            this.butClick(i)
        }
    }
    ,
    this.butClick = function(n) {
        n.click((function() {
            i.showChooseCard(o, "clan-edit-" + t),
            "official-page" == t ? i.updateEditOfficialPage(c) : i.updateEditPrivPage(c)
        }
        ))
    }
    ,
    this.init()
}
function recruit(t, i) {
    var a, e, n, r = this;
    this.initCards = function() {
        n = [["recruit-main", !1], ["recruit-candidate", r.clickCuruitCandidate], ["recruit-invite", r.clickRecruitInvite]]
    }
    ,
    this.init = function() {
        this.initContent(),
        this.initCards(),
        this.initMenu(),
        this.initTexts(),
        this.initAttrTab(),
        this.initTableHeaders(),
        this.initInviteBut(),
        i || this.initSaveAttrBtn()
    }
    ,
    this.initButtonsWrapper = function() {
        var t = drawSIButton(_t("accept_all")).addClass("small green")
          , i = drawSIButton(_t("refuse_all")).addClass("small");
        a.find(".buttons-wrapper").append(t),
        a.find(".buttons-wrapper").append(i),
        t.click((function() {
            console.log(1)
        }
        )),
        i.click((function() {
            console.log(2)
        }
        ))
    }
    ,
    this.clickCuruitCandidate = function() {
        _g("clan&a=recruit_applications_show")
    }
    ,
    this.clickRecruitInvite = function() {
        _g("clan&a=invite_show")
    }
    ,
    this.getContent = function() {
        return a
    }
    ,
    this.initMenu = function() {
        for (var t = a.find(".clan-recruit-menu").find(".cards-header"), i = 0; i < n.length; i++)
            r.createRecruitCardMenu(n[i], t)
    }
    ,
    this.inviteToClan = function() {
        var t = a.find(".player-nick");
        _g("clan&a=invite&n=" + esc(t.val()), (function() {
            t.val("")
        }
        ))
    }
    ,
    this.initInviteBut = function() {
        if (t.getProp("myrank") & Math.pow(2, 3) ? 1 : 0) {
            a.find(".invite-to-clan").find(".input-wrapper").css("display", "table-cell"),
            a.find(".invite-to-clan").find(".label-info").html(t.tLang("clan_invite_new"));
            var i = drawSIButton(t.tLang("inviteClan"));
            a.find(".invite-but").append(i),
            i.click(r.inviteToClan)
        } else
            a.find(".input-wrapper").css("display", "none")
    }
    ,
    this.createRecruitCardMenu = function(i, a) {
        var e = i[0]
          , n = i[1]
          , c = t.tLang(e)
          , d = drawSIButton(c).addClass("card card-" + e)
          , s = $("<span>").html(c);
        a.append(d),
        d.append(s),
        d.click((function() {
            if (("recruit-candidate" == e || "recruit-invite" == e) && !(t.getProp("myrank") & Math.pow(2, 3) ? 1 : 0))
                return void mAlert(_t("accessDenied"));
            r.showSection(e),
            n && n()
        }
        ))
    }
    ,
    this.initTableHeaders = function() {
        var i = [_t("date", null, "matchmaking"), "Nick", "Lvl", _t("prof_th", null, "auction"), _t("decision", null, "clan"), _t("invitedBy", null, "clan"), _t("delete", null, "clan")]
          , e = t.createRecords([i[0], i[1], i[2], i[3], i[4]], "table-header")
          , n = t.createRecords([i[0], i[1], i[2], i[5], i[6]], "table-header");
        a.find(".recruit-candidate-table").append(e),
        a.find(".recruit-invite-table").append(n)
    }
    ,
    this.showSection = function(t) {
        a.find(".card").removeClass("active"),
        a.find(".card-" + t).addClass("active"),
        a.find(".recruit-section").removeClass("active"),
        a.find(".section-" + t).addClass("active")
    }
    ,
    this.update = function(t, i) {
        this.updateAtributes(),
        r.showSection("recruit-main")
    }
    ,
    this.updateClanApplications = function(t) {
        var i = a.find(".recruit-candidate-table");
        for (var e in i.find(".one-applicant").remove(),
        t) {
            var n = t[e];
            this.createOneTr(n, i)
        }
    }
    ,
    this.updateClanInvitations = function(t) {
        var i = a.find(".recruit-invite-table");
        for (var e in i.find(".one-invitation").remove(),
        t) {
            var n = t[e];
            this.createOneTrInvitation(n, i)
        }
    }
    ,
    this.createOneTr = function(i, e) {
        var n = drawSIButton(_t("accept_applicant")).addClass("small green")
          , r = drawSIButton(_t("refuse_applicant")).addClass("small")
          , c = $("<div>").addClass("buttons-wrapper")
          , d = t.createRecords([ut_date(i.send_ts), i.recruit_nick, i.recruit_lvl, getAllProfName(i.recruit_prof), c], "normal-td");
        d.addClass("one-applicant"),
        c.append(n),
        c.append(r),
        a.find(".section-recruit-candidate").find(".recruit-candidate-table").append(d),
        e.append(d),
        n.click((function() {
            _g("clan&a=recruit_applications_accept&id=" + i.id)
        }
        )),
        r.click((function() {
            _g("clan&a=recruit_applications_reject&id=" + i.id)
        }
        ))
    }
    ,
    this.createOneTrInvitation = function(i, e) {
        var n = drawSIButton(_t("delete"))
          , r = $("<div>").addClass("buttons-wrapper")
          , c = t.createRecords([ut_date(i.send_ts), i.recruit_nick, i.recruit_lvl, i.recruiter_nick, r], "normal-td");
        c.addClass("one-invitation"),
        r.append(n),
        a.find(".section-recruit-candidate").find(".recruit-candidate-table").append(c),
        e.append(c),
        n.click((function() {
            _g("clan&a=invite_cancel&id=" + i.id)
        }
        ))
    }
    ,
    this.updateAtributes = function() {
        var i = t.getProp("attributes").toString()
          , a = t.getClanAtributs()
          , e = t.getProp("quest_bonuses")
          , n = t.getProp("has_outfit")
          , r = t.getProp("level")
          , c = t.getProp("depo_tabs")
          , d = a.getMapOfBits(i, r, c, e, n)
          , s = 1 & t.getProp("myrank") ? 1 : 0;
        this.createAllAtributs(d, s, s ? "inInput" : ".atribute-value")
    }
    ,
    this.initContent = function() {
        a = r.getClanRecruitHtml(),
        $("#clanbox").empty(),
        i ? (a.removeClass("clan-recruit-content").addClass("clan-other-recruit-content"),
        t.getShowcaseWnd().$.find(".card-content").append(a)) : $("#clanbox").append(a)
    }
    ,
    this.initTexts = function() {
        (t.getProp("myrank") & Math.pow(2, 3) ? 1 : 0) && a.find(".clan-recruit-header-option").html(t.tLang("header-option")),
        a.find(".clan-recruit-header-atribute").html(t.tLang("header-atribute")),
        a.find(".clan-recruit-header-0").html(t.tLang("basic_atributes")),
        a.find(".clan-recruit-header-1").html(t.tLang("additional_atributes")),
        i && a.find(".clan-recruit-header-2").html(t.tLang("clan_skills"))
    }
    ,
    this.initAttrTab = function() {
        var i = t.getClanAtributs();
        e = i.getAttrDataTab()
    }
    ,
    this.initSaveAttrBtn = function() {
        if (1 & t.getProp("myrank") ? 1 : 0) {
            var i = drawSIButton(t.tLang("save")).addClass("green");
            i.click((function() {
                t.getClanAtributs().saveAtributes()
            }
            )),
            a.find(".save-atributes").append(i)
        }
    }
    ,
    this.createAllAtributs = function(n, r, c) {
        var d = a.find(".scroll-pane")
          , s = t.getClanAtributs();
        d.find(".one-clan-atribute").remove();
        var l = !!n && [n, c];
        for (var u in e) {
            if (u > 99 && !i)
                break;
            s.createAtribute(d, u, a, l, r, !0)
        }
        this.updateRights()
    }
    ,
    this.updateRights = function() {
        var e, n = ["none", "table-cell"];
        i ? e = n[0] : e = 1 & t.getProp("myrank") ? n[1] : n[0];
        a.find(".one-clan-atribute").find(".input-wrapper").css("display", e)
    }
    ,
    this.getClanRecruitHtml = function() {
        return $('<div class="clan-recruit-content"><div class="clan-recruit-menu"><div class="cards-header-wrapper"><div class="header-background-graphic"></div><div class="cards-header"></div></div></div><div class="recruit-section section-recruit-main"><div class="scroll-wrapper"><div class="scroll-pane"><div class="background-wrapper"><div class="clan-recruit-header-option"></div><div class="invite-to-clan"><div class="v-align"><div class="label-info v-item"></div><div class="input-wrapper v-item"><input class="player-nick default"></div><div class="invite-but v-but v-item"></div></div></div>\x3c!--<div class="clan-recruit-header-0"></div>--\x3e<div class="clan-recruit-header-atribute"></div><div class="clan-part-0"></div>\x3c!--<div class="clan-recruit-header-1"></div>--\x3e<div class="clan-part-1"></div>\x3c!--<div class="clan-recruit-header-2"></div>--\x3e<div class="clan-part-2"></div><div class="save-atributes"></div></div></div></div></div><div class="recruit-section section-recruit-candidate"><div class="scroll-wrapper"><div class="scroll-pane"><div class="background-wrapper"><table class="recruit-candidate-table"></table><div class="buttons-wrapper"></div></div></div></div></div><div class="recruit-section section-recruit-invite"><div class="scroll-wrapper"><div class="scroll-pane"><div class="background-wrapper"><table class="recruit-invite-table"></table></div></div></div></div></div>')
    }
}
function clanMembers(e) {
    var t, r, a = this, n = "invertrank";
    this.createTabHeaderMemberList = function() {
        var t = e.getCharInf()
          , r = $("<div>").html(t[0] + "/" + t[1])
          , a = $("<div>").html(t[4])
          , n = $("<div>").html(t[2])
          , i = $("<div>").html(t[3]);
        return r.tip(_t("sortForName")),
        a.tip(_t("sortForLvl")),
        n.tip(_t("sortForRank")),
        i.tip(_t("sortForStatus")),
        e.createRecords([r, a, n, i], "table-header hover-header")
    }
    ,
    this.update = function(t) {
        this.init(),
        this.clearTable();
        for (var a = 0; a < t.length; a += 10) {
            var n = t.slice(a, a + 10)
              , i = e.createOneMember(n, !0, !0)
              , s = n[0]
              , l = e.getMemberList();
            r.push(i),
            l[s] = n
        }
        this.createMembersListTable("invertrank")
    }
    ,
    this.clearTable = function() {
        r = [];
        for (var e = 0; e < r.length; e++)
            r[e].remove(),
            delete r[e]
    }
    ,
    this.deleteTable = function() {
        t.find(".clan-members-table").detach(),
        t.find(".clan-members-table").remove()
    }
    ,
    this.createMembersListTable = function(e) {
        var r = this.createTabHeaderMemberList()
          , a = $("<table>").addClass("clan-members-table")
          , n = this.getSortedTable(e);
        for (var i in this.deleteTable(),
        n) {
            var s = n[i];
            a.append(s)
        }
        a.prepend(r),
        t.find(".scroll-pane").append(a),
        this.createHeaderSortButtons(),
        $(".scroll-wrapper", t).trigger("update")
    }
    ,
    this.createHeaderSortButtons = function() {
        for (var e = t.find(".clan-members-table tr").first(), r = 0; r < 4; r++)
            this.clickSort(e, r)
    }
    ,
    this.clickSort = function(e, t) {
        var r = ["name", "lvl", "rank", "status"];
        e.children().eq(t).click((function() {
            var e = r[t];
            n = n == e ? "invert" + e : e,
            a.createClanListTable(n)
        }
        ))
    }
    ,
    this.createClanListTable = function(e) {
        var r = this.createTabHeaderMemberList()
          , a = $("<table>").addClass("clan-members-table")
          , n = this.getSortedTable(e);
        for (var i in this.deleteTable(),
        n) {
            var s = n[i];
            a.append(s)
        }
        a.prepend(r),
        t.find(".scroll-pane").append(a),
        this.createHeaderSortButtons(),
        $(".scroll-wrapper", t).trigger("update")
    }
    ,
    this.getSortedTable = function(e) {
        switch (e) {
        case "name":
            return this.sortByName(r, ".char-stats");
        case "invertname":
            return this.sortByName(r, ".char-stats", !0);
        case "lvl":
            return this.sortByAmount(r, ".member-lvl");
        case "invertlvl":
            return this.sortByAmount(r, ".member-lvl", !0);
        case "rank":
            return this.sortByRank(r, ".member-rank");
        case "invertrank":
            return this.sortByRank(r, ".member-rank", !0);
        case "status":
            return this.sortByOnline(r, ".online-status");
        case "invertstatus":
            return this.sortByOnline(r, ".online-status", !0)
        }
    }
    ,
    this.sortByRank = function(e, t, r) {
        var a = [];
        for (var n in e)
            a[n] = e[n];
        return a.sort((function(e, a) {
            var n = parseInt(e.find(t).attr("id-rank"))
              , i = parseInt(a.find(t).attr("id-rank"));
            return r ? i - n : n - i
        }
        )),
        a
    }
    ,
    this.sortByOnline = function(e, t, r) {
        var n = []
          , i = [];
        for (var s in e)
            "online" != e[s].find(t).html() ? n.push(e[s]) : i.push(e[s]);
        n.sort((function(e, t) {
            return a.orderPlayerPerTimeOffline(e, t, r)
        }
        ));
        for (var l = 0; l < i.length; l++)
            r ? n.push(i[l]) : n.unshift(i[l]);
        return n
    }
    ,
    this.orderPlayerPerTimeOffline = function(e, t, r) {
        var a = parseInt(e.find(".time-offline").attr("time-offline"))
          , n = parseInt(t.find(".time-offline").attr("time-offline"));
        return r ? n - a : a - n
    }
    ,
    this.sortByName = function(e, t, r) {
        var a = [];
        for (var n in e)
            a[n] = e[n];
        return a.sort((function(e, a) {
            var n = e.find(t).text().toLowerCase()[0]
              , i = a.find(t).text().toLowerCase()[0];
            return r ? n > i ? -1 : n < i ? 1 : 0 : n < i ? -1 : n > i ? 1 : 0
        }
        )),
        a
    }
    ,
    this.sortByAmount = function(e, t, r) {
        var a = [];
        for (var n in e)
            a[n] = e[n];
        return a.sort((function(e, a) {
            var n = parseInt(e.find(t).html())
              , i = parseInt(a.find(t).html());
            return r ? i - n : n - i
        }
        )),
        a
    }
    ,
    this.createButRankEdit = function(t, r, a, n) {
        var i = 19 & e.getProp("myrank")
          , s = hero.clan.rank;
        if (i && !(r >= s)) {
            var l = drawSIButton("Edytuj");
            l.tip(_t("memberManage"));
            var o = $("<div>").addClass("add-bck");
            t.find(".edit").append(l),
            l.append(o),
            l.click((function() {
                var t = e.getMemberList()[a];
                _t("player_edit %name%", {
                    "%name%": n
                }, "clan");
                e.updatePlayerEdit(t)
            }
            ))
        }
    }
    ,
    this.createAddToGroup = function(e, t) {
        if (hero.id != t) {
            var r = drawSIButton("Grupuj");
            r.tip(_t("sendInviteToGroup")),
            e.find(".add-to-group").append(r),
            r.click((function() {
                _g("party&a=inv&id=" + t)
            }
            ))
        }
    }
    ,
    this.hideDisableCards = function() {
        var t = e.getShowcaseWnd().$.find(".card");
        t.eq(1).add(t.eq(3)).css("display", "inline-block"),
        t.eq(4).css("display", "none")
    }
    ,
    this.init = function() {
        t = a.getClanMembersContent(),
        $("#clanbox").empty(),
        $("#clanbox").append(t)
    }
    ,
    this.getClanMembersContent = function() {
        return $('<div class="clan-members-content"><div class="scroll-wrapper"><div class="scroll-pane"><table class="clan-members-table"></table></div></div></div>')
    }
    ,
    this.getClanMember = function() {
        return $('<div class="clan-member"><div class="icon-wrapper"><div class="icon"></div></div><div class="char-info"><div class="char-stats"></div><div class="last-visit"></div></div><div class="edit"></div><div class="add-to-group"></div></div>')
    }
}
function playerEdit(e) {
    var a, n, t, i = this;
    this.update = function(e) {
        this.init(),
        n = e[0],
        t = e[1],
        this.createHeaderAndTable(e),
        this.createMenu(),
        this.hideOrShow(),
        Tip.hide()
    }
    ,
    this.createHeaderAndTable = function(n) {
        var t = this.createHeaderMemberList()
          , i = a.find(".player-edit-table")
          , s = e.createOneMember(n, !1, !1);
        i.html(""),
        i.append(t, s)
    }
    ,
    this.init = function() {
        a = this.getClanEditContetn(),
        $("#clanbox").empty(),
        $("#clanbox").append(a),
        this.createBut()
    }
    ,
    this.createHeaderMemberList = function() {
        var a = e.getCharInf();
        return e.createRecords([a[0] + "/" + a[1], a[2]], "table-header")
    }
    ,
    this.createBut = function() {
        var n = [e.tLang("cl_name_save"), e.tLang("cl_send"), e.tLang("del_member"), e.tLang("back")];
        e.addControll(n[0], "change-rank-but", this.changeRank, a).addClass("small green"),
        e.addControll(n[1], "send-but", this.changeBoss, a).addClass("small"),
        e.addControll(n[2], "remove-from-clan", this.removeFromClan, a).addClass("small"),
        e.addControll(n[3], "back-to-members", this.backToMemberList, a).addClass("small green")
    }
    ,
    this.changeRank = function() {
        var e = a.find(".rank-menu").val();
        _g("clan&a=member&id=" + n + "&rank=" + e, (function() {
            i.backToMemberList()
        }
        ))
    }
    ,
    this.hideOrShow = function() {
        var n = e.getProp("myrank")
          , t = ["block", "none"];
        a.find(".send-tears").css("display", 1 & n ? t[0] : t[1]),
        a.find(".edit-rank").css("display", 2 & n ? t[0] : t[1]),
        a.find(".remove-from-clan").css("display", 16 & n ? t[0] : t[1])
    }
    ,
    this.changeBoss = function() {
        var a = _t("give_clan_leadership_confirm %name%", {
            "%name%": t
        }, "clan");
        e.alert(a, i.changeBossReq)
    }
    ,
    this.changeBossReq = function() {
        var e = a.find(".send-menu").val();
        _g("clan&a=member&id=" + n + "&leader=1" + (parseInt(e) ? "" : "&pay=self"), (function() {
            i.backToMemberList()
        }
        ))
    }
    ,
    this.removeFromClan = function() {
        var a = _t("player_dismiss_confirm", {
            "%name%": t
        }, "clan");
        e.alert(a, (function() {
            _g("clan&a=member&dismiss=1&id=" + n, (function() {
                i.backToMemberList()
            }
            ))
        }
        ))
    }
    ,
    this.backToMemberList = function() {
        _g("clan&a=members")
    }
    ,
    this.createMenu = function() {
        var t = [e.tLang("change_rank"), e.tLang("give_clan_leadership")]
          , i = e.getProp("ranks")
          , s = hero.clan.rank
          , l = e.getMemberList()[n][7]
          , r = []
          , d = [{
            text: e.tLang("clan_sl"),
            val: 1
        }, {
            text: e.tLang("private_sl"),
            val: 0
        }];
        for (var c in i)
            c >= s || r.push({
                text: i[c].name,
                val: c
            });
        a.find(".edit-rank>.label").html(t[0]),
        a.find(".send-tears>.label").html(t[1]);
        var v = a.find(".rank-menu").empty()
          , o = a.find(".send-menu").empty()
          , m = r.reverse();
        for (var c in m)
            v.append($("<option>").html(r[c].text).attr("value", r[c].val));
        for (var c in d)
            o.append($("<option>").html(d[c].text).attr("value", d[c].val));
        a.find(".edit-rank").find("select").val(l),
        a.find(".rank-menu>span").html(i[l].name).attr("value", l)
    }
    ,
    this.getClanEditContetn = function() {
        return $('<div class="clan-edit-content"><table class="player-edit-table"></table><div class="player-edit-pane"><div class="edit-rank"><div class="label"></div><div class="v-align"><div class="v-item"><select class="rank-menu menu default"></select></div><div class="change-rank-but v-but v-item"></div></div></div><div class="send-tears"><div class="label"></div><div class="v-align"><div class="v-item"><select class="send-menu menu default"></select></div><div class="send-but v-but v-item"></div></div></div></div><div class="bottom-buttons"><div class="remove-from-clan"></div><div class="back-to-members"></div></div></div>')
    }
}
function clanQuests(t) {
    var e, i, s, n = this, a = !1;
    this.update = function(t) {
        this.initContent(),
        this.initToogleShowBtn(),
        this.createQuests(t),
        this.updateScroll(),
        this.initFetch(),
        this.initQuestHeader()
    }
    ,
    this.initToogleShowBtn = function() {
        var t = drawSIButton("");
        e.find(".toggle-show").append(t),
        n.hideOrShowFinished(),
        t.click((function() {
            a = !a,
            n.hideOrShowFinished(),
            n.updateScroll()
        }
        ))
    }
    ,
    this.hideOrShowFinished = function() {
        var i = a ? "none" : "block";
        e.find(".complete-and-unactive-quests").css("display", i);
        var s = e.find(".toggle-show").find(".label")
          , n = t.tLang((a ? "show" : "hide") + "-finish");
        s.find(".gfont").html(n).attr("name", n)
    }
    ,
    this.createQuests = function(t) {
        var n = e.find(".scroll-pane");
        for (var a in i = 0,
        s = 0,
        t)
            this.createOneQuest(a, t[a], n),
            t[a].finished && s++,
            i++
    }
    ,
    this.createOneQuest = function(e, i, s) {
        var a = n.getOneClanQuest()
          , d = i.finished
          , r = 1 == i.active || "bring" == i.task && !d
          , l = i.task
          , u = this.getQuestStatus(r, l, d)
          , c = t.tLang(i.task)
          , o = 1 == r ? ".active-quests" : ".complete-and-unactive-quests"
          , v = i.done / i.todo
          , p = $("<div>").addClass("progress-text").html(c + " " + i.done + " / " + i.todo);
        if (o = 1 == r ? ".active-quests" : d ? ".complete-quests" : ".unactive-quests",
        a.addClass(u + " " + e),
        a.find(".quest-header").html(i.title),
        a.find(".quest-content").html(i.description),
        a.find(".quest-progress").append(p),
        a.find(".quest-state").html(t.tLang(u)).addClass(u),
        a.find(".quest-percent").html(Math.round(100 * v) + "%"),
        a.find(".background-bar").css("width", 442 * v + "px"),
        this.createAllMeasure(a.find(".clan-progress-bar")),
        r && isset(i.gold) && this.buyQuest(i.gold, a),
        d || "bring" != l || this.giveItem(e, i, a),
        "kill" == l) {
            for (var h = "", f = 0; f < i.kill_names.length; f++)
                h += i.kill_names[f] + ", ";
            var g = h.slice(0, h.length - 2)
              , m = $("<div>").addClass("small-info MM-info-icon");
            m.tip(g),
            a.find(".quest-progress").append(m)
        }
        s.find(o).append(a)
    }
    ,
    this.createAllMeasure = function(t) {
        for (var e = $("<div>").addClass("measure-wrapper"), i = 0; i < 9; i++)
            e.append($("<div>").addClass("measure"));
        t.append(e)
    }
    ,
    this.getQuestStatus = function(t, e, i) {
        return i ? "quest_completed" : t ? "quest_active" : "quest_unactive"
    }
    ,
    this.buyQuest = function(t, e) {
        this.createBuyPanel(e, t)
    }
    ,
    this.createBuyPanel = function(e, i) {
        var s = ""
          , a = !1
          , d = n.canUse()
          , r = round(i, 5)
          , l = e.find(".right-side")
          , u = t.tLang("buy_quest") + " " + r;
        d || (s += "" != s ? "<br><br>" : "",
        s += t.tLang("clan_quests_can_use"),
        a = !0),
        t.getProp("gold") < i && (s += "" != s ? "<br><br>" : "",
        s += _t("notEnoughGold"),
        a = !0);
        var c = a ? "black" : ""
          , o = drawSIButton(u).addClass(c)
          , v = $("<div>").addClass("quest-buy-wrapper");
        v.append(o),
        l.append(v),
        a || o.click(n.buyQuestAlert)
    }
    ,
    this.canUse = function() {
        return 1 & t.getProp("myrank") ? 1 : 0
    }
    ,
    this.buyQuestAlert = function() {
        n.canUse() && _g("clan&a=buy_quest&ans=-1")
    }
    ,
    this.giveItem = function(t, e, i) {
        "bring" == e.task && this.createGiveItemPanel(t, e, i)
    }
    ,
    this.createGiveItemPanel = function(e, i, s) {
        var a = s.find(".quest-bring-item-wrapper")
          , d = n.getQuestBringItem();
        a.append(d);
        var r = d.find("input");
        r.attr("quest-clan-id", e),
        r.focusout((function() {
            var t = parseInt($(this).val());
            (!t || !Number.isInteger(t) || t < 0) && $(this).val("")
        }
        ));
        var l = drawSIButton(t.tLang("give_item"));
        d.find(".give-item-btn").append(l),
        d.find(".item-wrapper").addClass("item-id-" + i.bring_tpl),
        l.click((function() {
            n.giveItemAlert(r)
        }
        ))
    }
    ,
    this.giveItemAlert = function(e) {
        var i = e.val();
        if (0 == i)
            return mAlert(_t("fill_area_how_items"));
        var s = _t("give_q_item" + (i > 4 ? 1 : i > 1 ? 2 : 3) + " %amount%", {
            "%amount%": i
        }, "clan");
        t.alert(s, (function() {
            var t = e.attr("quest-clan-id");
            _g("clan&a=bring&id=" + t + "&amount=" + i, (function() {
                e.val("")
            }
            ))
        }
        ))
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", e).trigger("update")
    }
    ,
    this.init = function() {}
    ,
    this.initQuestHeader = function() {
        var n = $("<div>").addClass("small-info MM-info-icon");
        n.tip(_t("one_quest_clan_skill_point")),
        e.find(".quest-content-header").html(t.tLang("clan_quests")),
        e.find(".complete-quest-amount").html(_t("finishClanQuests") + " " + s + "/" + i),
        e.find(".complete-quest-amount").append(n)
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("q", n.newBringItem)
    }
    ,
    this.newBringItem = function(t) {
        e.find(".item-id-" + t.id).append(t.$)
    }
    ,
    this.initContent = function() {
        e = n.getClanQuestsContent(),
        $("#clanbox").empty(),
        $("#clanbox").append(e)
    }
    ,
    this.getOneClanQuest = function() {
        return $('<div class="one-clan-quest"><div class="left-side"><div class="quest-header"></div><div class="quest-content"></div><div class="quest-bring-item-wrapper"></div></div><div class="right-side"></div><div class="quest-progress-wrapper"><div class="quest-progress"></div><div class="clan-progress-bar"><div class="background-bar"></div></div><div class="quest-percent"></div></div><div class="quest-state"></div></div>')
    }
    ,
    this.getQuestBringItem = function() {
        return $('<div class="quest-bring-item" class="v-align" ><div class="item-wrapper v-item"></div><div class="input-wrapper v-item"><input type="number" class="default"></div><div class="give-item-btn v-item"></div></div>')
    }
    ,
    this.getClanQuestsContent = function() {
        return $('<div class="clan-quests-content"><div class="quest-content-header"></div><div class="complete-quest-amount"></div><div class="toggle-show"></div><div class="scroll-wrapper"><div class="scroll-pane"><div class="active-quests"></div><div class="complete-and-unactive-quests"><div class="unactive-quests"></div><div class="complete-quests"></div></div></div></div></div>')
    }
    ,
    this.init()
}
function news() {
    var t, i, e, n, s = this, o = {}, a = 402, r = 0;
    this.leftPromo = 0,
    this.leftNews = 0,
    this.$pagination = null,
    this.newsLength = null,
    this.wnd = null,
    this.init = function() {
        this.initWindow(),
        this.getNews(),
        this.initArrows(),
        g.lock.add("new_window"),
        $("#b_news").removeClass("notif")
    }
    ,
    this.connectEvents = function() {
        $(document).on("click", ".news-section .news-pagination-item", s.paginationOnClick.bind(s)),
        t.find(".left-news-btn").click(s.newsPrev.bind(s)),
        t.find(".right-news-btn").click(s.newsNext.bind(s))
    }
    ,
    this.initArrows = function() {
        t.find(".left-arrow").click((function() {
            s.updatePosition(!0, ".for-you", 134, "Promo")
        }
        )),
        t.find(".right-arrow").click((function() {
            s.updatePosition(!1, ".for-you", 134, "Promo")
        }
        ))
    }
    ,
    this.initPagination = function() {
        this.$pagination = t.find(".news-pagination");
        for (var i = 0; i < s.newsLength; i++) {
            var e = $('<div class="news-pagination-item" />');
            0 === i && e.addClass("active"),
            this.$pagination.append(e)
        }
    }
    ,
    this.paginationOnClick = function(t) {
        var i = $(t.currentTarget).index();
        this.goTo(i)
    }
    ,
    this.paginationUpdate = function(t) {
        this.$pagination.find(".news-pagination-item:eq(" + t + ")").addClass("active").siblings(".news-pagination-item").removeClass("active")
    }
    ,
    this.goTo = function(i) {
        var e = t.find(".news-section-overflow")
          , n = -i * a;
        s.paginationUpdate(i),
        r = i,
        e.css("left", n),
        s.setIntervalNews()
    }
    ,
    this.setIntervalNews = function() {
        n && clearInterval(n);
        var t = s.newsLength;
        t <= 1 || (n = setInterval((function() {
            var i = ++r >= t ? 0 : r;
            s.goTo(i)
        }
        ), 5e3))
    }
    ,
    this.newsNext = function() {
        var t = ++r >= s.newsLength ? 0 : r;
        s.goTo(t)
    }
    ,
    this.newsPrev = function() {
        var t = --r < 0 ? s.newsLength - 1 : r;
        s.goTo(t)
    }
    ,
    this.updateArrowsInNewGrapic = function() {
        t.find(".left-news-btn").click((function(t) {
            t.stopPropagation(),
            s.initTimeToChangeGraph(),
            s.updatePosition(!0, ".news-section-overflow", a, "News")
        }
        )),
        t.find(".right-news-btn").click((function(t) {
            t.stopPropagation(),
            s.initTimeToChangeGraph(),
            s.updatePosition(!1, ".news-section-overflow", a, "News")
        }
        ))
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("o", s.newPackItem)
    }
    ,
    this.newPackItem = function(t) {
        g.news.wnd.$.find(".offer-" + t.id).each((function() {
            var i = t.$.clone()
              , e = $(this).attr("data-amount");
            g.tplsManager.changeItemAmount(t, i, e),
            $(this).append(i),
            i.click((function(t) {
                itemMenu("tplo", this, t)
            }
            )),
            i.attr("id", "tpl" + t.id)
        }
        ))
    }
    ,
    this.createNewsText = function(t) {
        var i = s.wnd.$.find(".news-section-overflow").html(parseNewsBB(t.replace(/\\/gi, "")));
        s.newsLength = i.find("a").children().length,
        s.wnd.$.find(".news-section-overflow").css("width", s.newsLength * a),
        s.wnd.$.find(".news-graph-arrow").css("display", s.newsLength > 1 ? "block" : "none"),
        s.connectEvents(),
        s.setIntervalNews(),
        s.initPagination()
    }
    ,
    this.initWindow = function() {
        var i = goldTxt(_t("news", null, "news"));
        (t = this.getNewsPanel()).find(".news-panel-label").html(i),
        this.wnd = {},
        this.wnd.$ = t,
        $("body").append(this.wnd.$);
        var e = goldTxt(_t("whatIsNew", null, "news"))
          , n = goldTxt(_t("forYou", null, "news"))
          , o = goldTxt(_t("timePromo", null, "news"));
        this.wnd.$.absCenter(),
        this.wnd.$.find(".whatIsNew").html(e),
        this.wnd.$.find(".forYou").html(n),
        this.wnd.$.find(".timePromo").html(o),
        this.wnd.$.find(".closebut").click((function() {
            s.close()
        }
        ))
    }
    ,
    this.getNews = function() {
        $.ajax({
            url: "https://forum.margonem.pl/ajax/premiumnews.php",
            crossDomain: !0,
            xhrFields: {
                withCredentials: !0
            },
            success: function(t) {
                var i = JSON.parse(t);
                s.createNewsText(i)
            },
            error: function() {
                console.log("error")
            }
        })
    }
    ,
    this.updateChanged = function(t) {
        for (var i in t)
            t[i].is_used && this.setTileUsed(t[i].id)
    }
    ,
    this.setTileUsed = function(t) {
        s.wnd.$.find(".promo-tile-id-" + t).addClass("is-used")
    }
    ,
    this.update = function(i) {
        var n = t.find(".news-for-you-section").find(".for-you")
          , s = i.active;
        this.updateGlobalBackground(i.background),
        e = !0;
        var o = (r = this.getContLocalAndGlobalPromo(s)).global > 2 ? "small" : "big"
          , a = 134 * r.local;
        this.showOrHideArrows(r.local);
        for (var r = 1, d = 0; d < s.length; d++) {
            var l = s[d];
            1 == l.is_personal ? this.createClassicTile(l) : (this.createTimePromoTile(l, o, r),
            r++)
        }
        n.css("left", 0),
        n.css("width", a + "px"),
        this.initFetch()
    }
    ,
    this.showOrHideArrows = function(t) {
        var i = t > 3 ? "block" : "none";
        s.wnd.$.find(".news-arrow").css("display", i)
    }
    ,
    this.getContLocalAndGlobalPromo = function(t) {
        for (var i = 0, e = 0, n = 0; n < t.length; n++)
            1 == t[n].is_personal ? i++ : e++;
        return {
            local: i,
            global: e
        }
    }
    ,
    this.updateGlobalBackground = function(t) {
        if (isset(t)) {
            var e = "url(" + cdnUrl + "/obrazki/promocje/" + t + ")";
            i = e,
            s.wnd.$.find(".time-promo-background").css("background", e)
        } else
            console.warn("News: no promo background from engine")
    }
    ,
    this.createClassicTile = function(i) {
        var e = i.id
          , n = "url(" + cdnUrl + "/obrazki/promocje/" + i.image + ")"
          , o = s.getNewClassicTile().addClass("promo-tile-id-" + e)
          , a = isset(i.lvl_max) && isset(i.seconds_left)
          , r = isset(i.price) ? i.price : 0;
        o.find(".tile-background").css("background", n),
        o.find(".title-bck").css("background", n + "0 -167px"),
        o.find(".graphic-bck").css("background", n + "0px -209px"),
        o.find(".buy-info").html(r + _t("sl", null, "clan")),
        i.lvl_max && o.find(".requires-level").html("Max Lvl: " + i.lvl_max + (a ? " | " : ""));
        var d = drawSIButton(_t("buy_promo"));
        o.find(".buy-button-wrapper").append(d),
        d.click((function() {
            s.usePromoId(i.id)
        }
        )),
        this.createSlotsOnItems(o, i.offer),
        this.setInterval(e, i.seconds_left, o, a),
        t.find(".news-for-you-section").find(".for-you").append(o),
        i.is_used && this.setTileUsed(e)
    }
    ,
    this.createTimePromoTile = function(t, n, o) {
        var a = t.id
          , r = s.getNewsTimePromo().addClass(n).addClass("promo-tile-id-" + a)
          , d = i
          , l = "big" == n ? "0px -381px" : "-85px -381px"
          , c = "big" == n ? ["-85px -493px", "-85px -530px"] : ["-85px -567px", "-85px -596px"]
          , v = isset(t.price) ? t.price : 0;
        r.find(".tile-background").css("background", d),
        r.find(".tile-background").css("background-position", l),
        r.find(".title-time-promo-tile").html("Pakiet " + o),
        r.find(".price-time-promo-tile").html(v + " " + _t("sl", null, "clan"));
        var w = $("<div>").addClass("buy-button").css({
            background: d,
            "background-position": c[0]
        });
        if (w.hover((function() {
            w.css("background-position", c[1])
        }
        ), (function() {
            w.css("background-position", c[0])
        }
        )),
        w.append($("<div>").html(_t("buy_promo")).addClass("label")),
        r.find(".buy-button-wrapper").append(w),
        w.click((function() {
            s.usePromoId(a)
        }
        )),
        this.createSlotsOnItems(r, t.offer),
        s.wnd.$.find(".package-wrapper").append(r),
        t.is_used && this.setTileUsed(a),
        e) {
            e = !1;
            var p = s.wnd.$.find(".news-time-promo-section");
            this.setInterval(a, t.seconds_left, p)
        }
    }
    ,
    this.usePromoId = function(t) {
        _g("promotions&a=use&id=" + t)
    }
    ,
    this.updatePosition = function(i, e, n, o) {
        var a = t.find(e)
          , r = parseInt(a.css("width"))
          , d = parseInt(a.parent().width())
          , l = !1
          , c = "left" + o;
        return i ? s[c] += n : s[c] -= n,
        s[c] > 0 && (s[c] = 0),
        Math.abs(s[c]) > r - d && (s[c] = -(r - d),
        l = !0),
        a.css("left", s[c]),
        l
    }
    ,
    this.setInterval = function(t, i, e, n) {
        o[t] && this.clearInterval(t);
        var a = i;
        isset(i) && (console.log(n),
        e.find(".requires-text").html(getSecondLeft(a, n)),
        0 != a && (o[t] = setInterval((function() {
            0 == a && s.clearInterval(t),
            e.find(".requires-text").html(getSecondLeft(a--, n))
        }
        ), 1e3)))
    }
    ,
    this.clearInterval = function(t) {
        clearInterval(o[t]),
        o[t] = null,
        delete o[t]
    }
    ,
    this.createSlotsOnItems = function(t, i, e) {
        for (var n = 0; n < i.length; n++) {
            var s = i[n]
              , o = s[0]
              , a = s[1]
              , r = $("<div>").addClass("item-slot offer-" + o);
            e && r.css({
                background: e[0],
                "background-position": e[1]
            }),
            r.attr("data-amount", a),
            t.find(".tile-items-wrapper").append(r)
        }
    }
    ,
    this.close = function() {
        for (var t in o)
            this.clearInterval(t);
        o = {},
        delete o,
        n && (clearInterval(n),
        n = null),
        s.wnd.$.remove(),
        g.tplsManager.removeCallback("o", s.newPackItem),
        g.tplsManager.deleteMessItemsByLoc("o"),
        delete s.wnd,
        g.news = !1,
        delete s,
        g.lock.remove("new_window")
    }
    ,
    this.getNewsPanel = function() {
        return $('<div class="news-panel"><div class="header-wrapper"><div class="graphic"></div><div class="news-panel-label"></div></div><div class="middle-graphics"></div><div class="news-content">\t<div class="crazy-bar"></div>\t<div class="news-section">\t\t<div class="section-content">\t\t\t<div class="news-section-overflow"></div>\t\t</div>\t\t<div class="left-news-btn news-graph-arrow news-arrow-element"></div>\t\t<div class="right-news-btn news-graph-arrow news-arrow-element"></div>\t\t<div class="news-pagination"></div>\t</div>\t<div class="news-for-you-section">\t\t<div class="section-header forYou"></div>\t\t<div class="section-content">\t\t\t<div class="for-you"></div>\t\t</div>\t\t<div class="left-arrow news-arrow news-arrow-element"></div>\t\t<div class="right-arrow news-arrow news-arrow-element"></div>\t</div>\t<div class="news-time-promo-section">\t\t<div class="section-content">\t\t\t<div class="time-promo-background"></div>\t\t\t<div class="package-positioner">\t\t\t\t<div class="package-wrapper"></div>\t\t\t</div>\t\t\t<div class="requires-text-wrapper">\t\t\t\t<div class="requires-text"></div>\t\t\t</div>\t\t</div>\t</div></div><div class="bottom-panel-graphics"></div><div class="closebut"></div></div>')
    }
    ,
    this.getNewClassicTile = function() {
        return $('<div class="news-classic-tile"><div class="tile-background"><div class="graphic-bck"></div><div class="title-bck"></div></div><div class="tile-items-positioner"><div class="tile-items-wrapper"></div></div><div class="requires-text-wrapper"><div class="requires-level"></div><div class="requires-text"></div></div><div class="used-text"></div><div class="buy-button-wrapper"></div><div class="buy-info"></div></div>')
    }
    ,
    this.getNewsTimePromo = function() {
        return $('<div class="news-time-promo-tile"><div class="tile-background"></div><div class="title-time-promo-tile"></div><div class="price-time-promo-tile"></div><div class="tile-items-positioner"><div class="tile-items-wrapper"></div></div><div class="used-text-wrapper"><div class="used-text"></div></div><div class="buy-button-wrapper"></div><div class="buy-info"></div></div>')
    }
}
function _slicedToArray(i, t) {
    return _arrayWithHoles(i) || _iterableToArrayLimit(i, t) || _unsupportedIterableToArray(i, t) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(i, t) {
    if (i) {
        if ("string" == typeof i)
            return _arrayLikeToArray(i, t);
        var e = Object.prototype.toString.call(i).slice(8, -1);
        return "Object" === e && i.constructor && (e = i.constructor.name),
        "Map" === e || "Set" === e ? Array.from(i) : "Arguments" === e || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e) ? _arrayLikeToArray(i, t) : void 0
    }
}
function _arrayLikeToArray(i, t) {
    (null == t || t > i.length) && (t = i.length);
    for (var e = 0, n = new Array(t); e < t; e++)
        n[e] = i[e];
    return n
}
function _iterableToArrayLimit(i, t) {
    var e = null == i ? null : "undefined" != typeof Symbol && i[Symbol.iterator] || i["@@iterator"];
    if (null != e) {
        var n, a, r = [], d = !0, s = !1;
        try {
            for (e = e.call(i); !(d = (n = e.next()).done) && (r.push(n.value),
            !t || r.length !== t); d = !0)
                ;
        } catch (i) {
            s = !0,
            a = i
        } finally {
            try {
                d || null == e.return || e.return()
            } finally {
                if (s)
                    throw a
            }
        }
        return r
    }
}
function _arrayWithHoles(i) {
    if (Array.isArray(i))
        return i
}
function tpScroll() {
    var i, t = this, e = this, n = [], a = null, r = null;
    this.itemId,
    this.data = {},
    this.wnd = {},
    e.scale = null,
    e.big = 1,
    this.init = function() {
        this.initWindow(),
        this.modifyContent(),
        this.initSearch()
    }
    ,
    this.addCurrentMap = function() {
        data[map.id] = {
            name: map.name,
            img: CFG.mpath + map.file,
            cords: [[11, 12], [1, 15], [4, 2]]
        }
    }
    ,
    this.initWindow = function() {
        var t = _t("kcs_set");
        (i = e.getDividePanel()).find(".green-panel-label").html(t),
        this.wnd.$ = i,
        $("#tp-scroll").append(this.wnd.$),
        this.wnd.$.find(".closebut").click((function() {
            e.close()
        }
        ))
    }
    ,
    this.initSearch = function() {
        var i = this.wnd.$.find(".search-item");
        i.keyup((function() {
            var i = $(this).val()
              , t = e.wnd.$.find(".divide-list-group");
            "" == i ? t.css("display", "block") : t.each((function() {
                var t = $(this).find(".label").html().toLowerCase().search(i.toLowerCase()) > -1 ? "block" : "none";
                $(this).css("display", t)
            }
            ))
        }
        )),
        i.attr("placeholder", _t("search"))
    }
    ,
    this.update = function(i) {
        var t = this;
        this.itemId = i.item_id,
        this.data = i.targets;
        var n = []
          , a = function(i) {
            var a = t.data[i].n;
            (d = e.getTplDivideGroup().addClass("city-" + i)).find(".label").text(a),
            d.on("click", (function() {
                return t.onClickEvent(i)
            }
            )),
            n.push(d)
        };
        for (var r in this.data) {
            var d;
            a(r)
        }
        this.appendCityToWrapper(n),
        this.openCurrentLocation()
    }
    ,
    this.appendCityToWrapper = function(i) {
        if (i.length > 0) {
            i.sort((function(i, t) {
                var e = i.find(".label").text().toLowerCase()[0]
                  , n = t.find(".label").text().toLowerCase()[0];
                return e < n ? -1 : e > n
            }
            ));
            for (var t = this.wnd.$.find(".left-scroll").find(".scroll-pane"), e = 0; e < i.length; e++)
                t.append(i[e])
        }
    }
    ,
    this.modifyContent = function() {
        var i = $("<div>").addClass("mini-map-wrapper")
          , t = $("<div>").addClass("mini-map-positioner");
        i.append(t),
        e.wnd.$.find(".right-scroll").find(".scroll-pane").append(i);
        var n = $("<div>").addClass("city-name");
        e.wnd.$.find(".left-column-header").html(goldTxt(_t("loc"))),
        e.wnd.$.find(".right-column-header").append(n),
        e.wnd.$.find(".header-wrapper").html(goldTxt(_t("kcs_set")));
        var d = $("<div>").addClass("city-buffer-wrapper")
          , s = $("<div>").html(goldTxt("Ladowanie mapy")).addClass("city-buffer");
        d.append(s),
        e.wnd.$.find(".right-column").append(d),
        e.wnd.$.find(".city-buffer");
        var o = drawSIButton(_t("set_tp")).addClass("set-tp-stone black");
        e.wnd.$.find(".bottom-part").append(o),
        o.click((function() {
            var i = _slicedToArray(r, 2)
              , t = i[0]
              , n = i[1];
            _g("moveitem&st=2&id=" + e.itemId + "&town_id=" + a + "&town_x=" + t + "&town_y=" + n, (function() {
                e.close()
            }
            ))
        }
        ))
    }
    ,
    this.cordEvents = function(i, t, n) {
        i.hover((function() {
            e.wnd.$.find(".cord-" + n).addClass("hover")
        }
        ), (function() {
            e.wnd.$.find(".cord-" + n).removeClass("hover")
        }
        )),
        i.click((function(a) {
            e.wnd.$.find(".cords").removeClass("active"),
            e.wnd.$.find(".cord-" + n).addClass("active"),
            e.wnd.$.find(".one-item-on-divide-list").removeClass("active"),
            e.wnd.$.find(".city-" + t).find(".cord-list-" + n).addClass("active"),
            e.setChoice(t, i.data("coords")),
            a.stopPropagation()
        }
        )),
        $(document).on("click", ".cord-" + n + ".map-" + t, (function() {
            e.wnd.$.find(".city-" + t + " .cord-list-" + n).click()
        }
        ))
    }
    ,
    this.resetChoice = function() {
        a = null,
        r = null,
        e.wnd.$.find(".set-tp-stone").addClass("black")
    }
    ,
    this.setChoice = function(i, t) {
        a = i,
        r = t,
        e.wnd.$.find(".set-tp-stone").removeClass("black")
    }
    ,
    this.showHideBuffer = function(i) {
        e.wnd.$.find(".city-buffer-wrapper").css("display", i ? "block" : "none")
    }
    ,
    this.onClickEvent = function(i) {
        var e = t.wnd.$.find(".city-".concat(i));
        e.hasClass("active") ? e.removeClass("active") : _g("moveitem&st=1&id=" + t.itemId + "&locationId=" + i)
    }
    ,
    this.openCurrentLocation = function() {
        var i = map.id;
        if (isset(t.data[i])) {
            t.onClickEvent(i);
            var n = t.checkCityTabPosition(i);
            $(".left-column .scroll-pane", e.wnd.$).scrollTop(n)
        }
    }
    ,
    this.checkCityTabPosition = function(i) {
        return e.wnd.$.find(".left-scroll .city-".concat(i)).position().top
    }
    ,
    this.showLocation = function(i) {
        var a = e.wnd.$.find(".left-column .city-".concat(i.id));
        t.createCords(a, i.coords, i.id),
        t.activeGeoupItem(a);
        var r = new Image;
        r.src = CFG.mpath + i.file,
        n.indexOf(i.name) < 0 && e.showHideBuffer(!0),
        e.wnd.$.find(".one-item-on-divide-list").removeClass("active"),
        e.resetChoice(),
        r.onload = function() {
            var t = e.wnd.$.find(".mini-map-positioner").empty();
            e.setMapBackground(i, this.width, this.height, t),
            n.push(i.name);
            for (var a = 0; a < i.coords.length; a++) {
                var r = i.coords[a]
                  , d = $("<div>").addClass("cords cord-" + a + " map-" + i.id);
                d.tip(r[0] + ", " + r[1]),
                t.append(d),
                e.setCords(d, r)
            }
            e.showHideBuffer(!1)
        }
    }
    ,
    this.createCords = function(i, n, a) {
        var r = i.find(".group-list");
        r.html("");
        for (var d = 0; d < n.length; d++) {
            var s = n[d]
              , o = e.getOneItemOnDivideList().addClass("cord-list-" + d);
            o.find(".name").html(s[0] + ", " + s[1]),
            o.data("coords", s),
            r.append(o),
            t.cordEvents(o, a, d)
        }
    }
    ,
    this.setMapBackground = function(i, t, n, a) {
        var r = {
            x: t / 32,
            y: n / 32
        };
        e.wnd.$.find(".city-name").html(goldTxt(i.name)),
        e.setScale(r),
        a.css({
            background: "url(" + CFG.mpath + i.file + ") no-repeat",
            width: "100%",
            height: "100%",
            "background-size": "contain"
        })
    }
    ,
    this.activeGeoupItem = function(i) {
        var t = i.hasClass("active");
        e.wnd.$.find(".divide-list-group").removeClass("active"),
        t || i.addClass("active")
    }
    ,
    this.setCords = function(i, t) {
        i.css("left", e.scale * t[0] + "px"),
        i.css("top", e.scale * t[1] + "px")
    }
    ,
    this.setScale = function(i) {
        var t = e.wnd.$.find(".mini-map-wrapper")
          , n = t.width() / t.height();
        e.scale = i.x > i.y * n ? t.width() / i.x : t.height() / i.y
    }
    ,
    this.close = function() {
        e.wnd.$.remove(),
        delete this.data,
        delete e.wnd,
        g.tpScroll = !1,
        delete e
    }
    ,
    this.getDividePanel = function() {
        return $('<div class="divide-panel tp-scroll">  <div class="header-wrapper"></div>\t <div class="left-column">    <div class="left-column-header"></div>    <div class="search-item-wrapper">      <input class="search-item"/>    </div>    <div class="left-scroll scroll-wrapper classic-bar">      <div class="scroll-pane"></div>    </div>  </div>  <div class="right-column">    <div class="right-column-header"></div>    <div class="right-scroll scroll-wrapper classic-bar">      <div class="scroll-pane"></div>    </div>  </div>  <div class="bottom-part"></div>  <div class="closebut"></div></div>')
    }
    ,
    this.getTplDivideGroup = function() {
        return $('<div class="divide-list-group">  <div class="card-graphic"></div>  <div class="label"></div>  <div class="direction"></div>  <div class="group-list"></div></div>')
    }
    ,
    this.getOneItemOnDivideList = function() {
        return $('<div class="one-item-on-divide-list">  <div class="name-wrapper">    <div class="name"></div>  </div></div>')
    }
    ,
    this.init()
}
function AuctionBidAndBuyNowActions() {
    var t = function(t, n) {
        return n == AuctionData.BIDDER_VALUES.SOMEBODY_BID ? Math.ceil(11 * t / 10) : t
    }
      , n = function(n) {
        var i = n.bid_g
          , o = n.bid_c
          , u = n.bidder
          , r = {
            fullVal: null,
            strVal: null,
            tip: null
        };
        if (i) {
            var e = t(i, u);
            r.fullVal = e,
            r.strVal = round(e, 3),
            r.currency = "",
            u == AuctionData.BIDDER_VALUES.SOMEBODY_BID && (r.lastBid = i)
        }
        if (o) {
            var c = t(o, u);
            r.fullVal = c,
            r.strVal = c,
            u && (r.lastBid = o),
            r.currency = _t("sl")
        }
        return n.own_auction && (r.ownAuction = !0),
        n.bidder == AuctionData.BIDDER_VALUES.YOU_BID && (r.ownBid = !0),
        r
    }
      , i = function(t) {
        var n = t.bo_g
          , i = t.bo_c;
        return n && i ? round(n, 3) + " + " + i + _t("sl") : n ? round(n, 3) : i ? i + _t("sl") : (errorReport("AuctionManager", "getBuyNowText", "option not exist", t),
        null)
    }
      , o = function(t) {
        var n = t.bidder
          , i = t.bid_g
          , o = t.bid_c
          , u = "";
        return n == AuctionData.BIDDER_VALUES.YOU_BID && (u += "disabled "),
        i ? u + "green" : o ? u + "violet" : (errorReport("AuctionManager", "getColorBidButton", "option not exist", t),
        null)
    }
      , u = function(t) {
        var n = t.bo_g
          , i = t.bo_c;
        return n && i ? "violet" : n ? "green" : i ? "violet" : (errorReport("AuctionManager", "getColorBuyNowButton", "option not exist", t),
        null)
    }
      , r = function(t, n) {
        var i, o = g.auctions.getAuctionTemplates().get("auction-input-cost-ceil"), u = o.find(".auction-cost-btn-wrapper");
        if (t.ownAuction && u.css("display", "none"),
        t.ownAuction || t.ownBid ? ((i = o.find(".own-input-cost")).css("display", "block"),
        i.html(t.strVal)) : ((i = o.find(".input-cost")).css("display", "table-cell"),
        i.val(t.strVal)),
        t.lastBid) {
            var r = $("<div>").addClass("somebody-bid");
            r.tip(_t("somebody-bid")),
            o.append(r),
            i.tip(_t("last_bid") + formNumberToNumbersGroup(t.lastBid))
        }
        if (o.find(".auction-cost-currency").html(t.currency),
        !n)
            return o;
        i.attr("full-cost", t.fullVal),
        i.change((function() {
            i.attr("full-cost", parsePrice($(this).val()))
        }
        ));
        var e = l(n.text, n.color, (function() {
            n.clb && n.clb(o)
        }
        ));
        return n.buttonTip && e.tip(n.buttonTip),
        o.find(".auction-cost-btn-wrapper").append(e),
        o
    }
      , e = function(t, n) {
        var i = g.auctions.getAuctionTemplates().get("auction-cost-ceil");
        if (i.find(".auction-cost-label").html(t),
        !n)
            return i.find(".auction-cost-btn-wrapper").css("display", "none"),
            i;
        var o = l(n.text, n.color, n.clb);
        return i.find(".auction-cost-btn-wrapper").append(o),
        i
    }
      , c = function(t) {
        var n = null == t.bo_g ? 0 : t.bo_g
          , i = null == t.bo_c ? 0 : t.bo_c
          , o = t.id
          , u = t.item_id
          , r = function(t, n, i, o) {
            return 0 == t && n > 1 ? _t("item_confirm_buynow_sl %name% %price%", {
                "%name%": o,
                "%price%": formNumberToNumbersGroup(n)
            }, "auction") : t > 0 && n > 0 ? _t("item_confirm_buynow_sl_gold %name% %price% %price2%", {
                "%name%": o,
                "%price%": formNumberToNumbersGroup(n),
                "%price2%": formNumberToNumbersGroup(t)
            }, "auction") : _t("item_confirm_buynow %name% %price%", {
                "%name%": o,
                "%price%": formNumberToNumbersGroup(t)
            }, "auction")
        }(n, i, 0, g.auctions.getAuctionItems().getItemName(u));
        mAlert(r, 1, [function() {
            g.auctions.getAuctionRequest().buyNowRequest(o)
        }
        , function() {}
        ])
    }
      , a = function(t, n) {
        var i = null == t.bid_g ? 0 : t.bid_g
          , o = null == t.bid_c ? 0 : t.bid_c
          , u = t.id
          , r = t.item_id
          , e = g.auctions.getAuctionItems().getItemName(r)
          , c = parsePrice(n.find(".input-cost").attr("full-cost"))
          , a = function(t, n, i, o) {
            var u = null
              , r = null;
            return t && (u = "item_confirm_au",
            r = t),
            n && (u = "item_confirm_au_sl",
            r = n),
            _t(u + " %name% %val%", {
                "%name%": o,
                "%price%": formNumberToNumbersGroup(r)
            }, "auction")
        }(i ? c : null, o ? c : null, 0, e);
        mAlert(a, 1, [function() {
            g.auctions.getAuctionRequest().bidRequest(u, c)
        }
        , function() {}
        ])
    }
      , l = function(t, n, i) {
        var o = g.auctions.getAuctionTemplates().get("auction-but").addClass("small " + n);
        return o.find(".label").html(t),
        o.on("click", i),
        o
    };
    this.init = function(t) {}
    ,
    this.getBuyNowCeil = function(t) {
        var n = t.bo_g
          , o = t.bo_c;
        if (!n && !o)
            return "";
        var r = i(t);
        if (t.own_auction)
            return e(r);
        var a = u(t);
        return e(r, {
            text: _t("au_price_buynow", null, "auction"),
            clb: function() {
                c(t)
            },
            color: a
        })
    }
    ,
    this.getBidCeil = function(t) {
        var i = t.bid_g
          , u = t.bid_c;
        if (!i && !u)
            return "";
        var e = n(t);
        if (e.ownAuction)
            return r(e);
        var c, l = o(t);
        c = e.ownBid ? null : function(n) {
            a(t, n)
        }
        ;
        var s = e.ownBid ? _t("youAreBid") : "";
        return r(e, {
            text: _t("bid", null, "auction"),
            clb: c,
            color: l,
            buttonTip: s
        })
    }
}
function AuctionCards() {
    var i = function(i, t) {
        n(i),
        t && t()
    }
      , n = function(i) {
        var n = g.auctions.getAuctionWindow().getContent()
          , t = n.find(".cards-header").find(".SI-button").removeClass("active")
          , s = n.find(".bottom-bar")
          , a = n.find(".section").removeClass("visible");
        t.eq(i).addClass("active"),
        a.eq(i).addClass("visible"),
        s.children().css("display", "none"),
        s.children().eq(i).css("display", "block"),
        i
    };
    this.init = function() {}
    ,
    this.clickCard = i,
    this.newCard = function(n, t, s) {
        var a = drawSIButton(t);
        n.append(a),
        a.click((function() {
            var n = $(this).index();
            i(n, s)
        }
        ))
    }
}
var AuctionData = {
    CATEGORY: {
        weapon: [1, 4, 2, 6, 7, 3, 5, 21],
        armor: [8, 11, 10, 14, 9, 12, 13],
        other: [23, 16, 15, 22, 24, 27]
    },
    MAX_QUANTITY_OF_ITEMS_PACKAGE: 15,
    MY_AUCTION: "MY_AUCTION",
    UPDATE_PAGES: "UPDATE_PAGES",
    KIND_MY_AUCTION: {
        MY_AUCTION_OFF: 1,
        MY_BID: 2
    },
    KIND_OTHERS_AUCTION: {
        ALL_AUCTION: 4
    },
    TYPE_OF_AUCTION: {
        NORMAL: "NORMAL",
        EVENT: "EVENT"
    },
    ALL_AUCTION: "ALL_AUCTION",
    AUCTION_CEIL: {
        ITEM_SLOT_TD: {
            key: "item-slot-td",
            sort: null
        },
        ITEM_TIME_TD: {
            key: "item-time-td",
            sort: 1
        },
        ITEM_BID_TD: {
            key: "item-bid-td",
            sort: 2
        },
        ITEM_BUY_NOW_TD: {
            key: "item-buy-now-td",
            sort: 3
        },
        ITEM_LEVEL_TD: {
            key: "item-level-td",
            sort: 4
        },
        ITEM_NAME_TD: {
            key: "item-name-td",
            sort: 5
        },
        AUCTION_ACTION_TD: {
            key: "auction-action-td",
            sort: null
        }
    },
    SORT_ORDER: {
        ASC: 0,
        DESC: 1
    },
    COST_FEATURED_AUCTION: 100,
    FILTER_KEYS: {
        FILTER_NAME: "FILTER_NAME",
        FILTER_VAL: "FILTER_VAL",
        MIN_LEVEL: "MIN_LEVEL",
        PROF: "PROF",
        MAX_LEVEL: "MAX_LEVEL",
        RARITY: "RARITY",
        MIN_PRICE: "MIN_PRICE",
        MAX_PRICE: "MAX_PRICE",
        AUCTION_TYPE: "AUCTION_TYPE",
        NAME_ITEM: "NAME_ITEM"
    },
    FILTER_ID: {
        EMPTY_FILTER: -2,
        ADD_FILTER: -1
    },
    TYPE_OF_BUY_AUCTION: {
        ALL: 0,
        BUY_NOW: 1,
        BIDS: 2
    },
    TYPE_OF_RARITY: {
        ALL: 0,
        UNIQUE: 1,
        HEROIC: 2,
        LEGENDARY: 3
    },
    BIDDER_VALUES: {
        NO_BIDDER: 0,
        SOMEBODY_BID: 1,
        YOU_BID: 2
    },
    MAX_FEATURED_COUNT: 10
};
function AuctionItemCategory() {
    var t = null
      , n = {}
      , o = function(n) {
        t = n
    }
      , i = function() {
        var t = g.auctions.getAuctionWindow().getContent().find(".all-categories-auction");
        for (var o in AuctionData.CATEGORY) {
            var i = AuctionData.CATEGORY[o];
            for (var c in i) {
                var a = i[c]
                  , u = e(a);
                n[a] = u,
                t.append(u)
            }
        }
    }
      , e = function(t) {
        var n = g.auctions.getAuctionTemplates().get("one-category-auction");
        return n.addClass("auction-category-" + t),
        n.html(_t("au_cat" + t, null, "auction")),
        n.on("click", (function() {
            var n = u(t);
            r(1, n)
        }
        )),
        n
    }
      , c = function() {
        return 0 != t
    }
      , a = function() {
        g.auctions.getAuctionWindow().getContent().find(".one-category-auction.selected").removeClass("selected")
    }
      , u = function(n) {
        return t == n ? 0 : n
    };
    var r = function(n, i) {
        a(),
        o(i),
        c() && g.auctions.getAuctionWindow().getContent().find(".auction-category-".concat(t)).addClass("selected"),
        g.auctions.getAuctionRequest().mainAuctionRequest(n),
        g.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),
        g.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)
    };
    this.init = function() {
        i()
    }
    ,
    this.getShowCategory = function() {
        return t
    }
    ,
    this.isShowCategoryExist = c,
    this.clearItemCategory = function() {
        o(0),
        a()
    }
}
function AuctionItems() {
    var t = {}
      , e = function() {
        g.disableItemsManager.startSpecificItemKindDisable(g.disableItemsManager.CONST.AUCTION)
    }
      , n = function(e) {
        var n = t[e]
          , a = g.auctions.getOneOfferByItemId(e);
        if (null != a) {
            var c = a.get$Offer();
            i(n, e, c),
            a.setItemAttachToSlotState(!0)
        }
    }
      , i = function(t, e, n) {
        var i = g.item[e].$item.clone()
          , a = parseItemStat(t.stat);
        n.find("." + AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key).find(".auction-item-name").html(t.name),
        n.find("." + AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key).find(".auction-item-lvl").html(a.lvl ? " (" + a.lvl + ")" : ""),
        n.find("." + AuctionData.AUCTION_CEIL.ITEM_SLOT_TD.key).find(".item-slot").empty().append(i)
    };
    this.init = function() {
        e()
    }
    ,
    this.newReceivedItem = function(e) {
        t[e.id] || (t[e.id] = e),
        n(e.id)
    }
    ,
    this.checkItemExistInAllFetchItems = function(e) {
        return !!t[e]
    }
    ,
    this.getItemName = function(e) {
        return t[e] ? t[e].name : (console.error("AuctionManager", "getItemName", "Item not exist: " + e, t),
        "")
    }
    ,
    this.attachIconToSlotProcedure = n
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
function AuctionManager() {
    var t = null
      , n = null
      , e = 0
      , i = null
      , o = null
      , u = null
      , r = null
      , c = null
      , f = null
      , a = null
      , s = null
      , l = null
      , d = null
      , A = null
      , h = null
      , O = null
      , m = null
      , p = null
      , I = function() {
        r = new AuctionTemplates,
        f = new AuctionRequest,
        a = new AuctionTime,
        l = new AuctionPages,
        s = new AuctionSort,
        c = new AuctionWindow,
        d = new AuctionItems,
        A = new AuctionOffItemPanel,
        m = new AuctionCards,
        h = new AuctionSearchItems,
        O = new AuctionItemCategory,
        p = new AuctionBidAndBuyNowActions
    }
      , w = function() {
        r.init(),
        a.init(),
        f.init(),
        s.init(),
        l.init(),
        m.init(),
        c.init(),
        d.init(),
        p.init(),
        h.init(),
        O.init(),
        A.init()
    }
      , y = function(t) {
        T(t)
    }
      , T = function(t) {
        n = t
    }
      , b = function() {
        null != n ? T(n - 1) : console.error("AuctionManager.js", "decrementTotalOffers", "Can not decrement totalOffers, totalOffers = null!")
    }
      , C = function() {
        null != n ? T(n + 1) : console.error("AuctionManager.js", "incrementTotalOffers", "Can not increment totalOffers, totalOffers = null!")
    }
      , v = function(t, n, e) {
        for (var i in t) {
            var o = t[i]
              , u = o.id
              , r = o.item_id
              , f = k(u)
              , a = void 0;
            f ? (a = B(u)).updateOffer(o) : ((a = new OneOffer).init(o, e),
            D(u, a),
            F(r, u)),
            d.checkItemExistInAllFetchItems(r) && d.attachIconToSlotProcedure(r);
            var s = a.get$Offer();
            f || c.addToOffersTable(s, n)
        }
    }
      , S = function() {
        g.lock.add("auctions")
    }
      , _ = function() {
        g.lock.remove("auctions")
    }
      , M = function() {
        O.clearItemCategory(),
        c.clearAuctionsInTableWithOffers()
    }
      , N = function(n) {
        t = n
    }
      , P = function(t) {
        o[t].removeOffer(),
        delete o[t]
    }
      , F = function(t, n) {
        u[t] = n
    }
      , D = function(t, n) {
        o[t] = n
    }
      , k = function(t) {
        return !!o[t]
    }
      , B = function(t) {
        return o[t]
    }
      , K = function() {
        o = {}
    }
      , U = function() {
        u = {}
    };
    function j(t, n, e) {
        n && n[e] && t.on("click", (function() {
            n[e]()
        }
        ))
    }
    this.init = function() {
        K(),
        U(),
        I(),
        w(),
        S()
    }
    ,
    this.close = function() {
        A.close(),
        a.destroy(),
        g.disableItemsManager.endSpecificItemKindDisable(g.disableItemsManager.CONST.AUCTION),
        g.auctions = !1,
        _(),
        c.close()
    }
    ,
    this.tLang = function(t) {
        return _t(t, null, "auction")
    }
    ,
    this.updateData = function(t) {
        if (t.status && isset(t.status.featuredCount) && (N(t.status.featuredCount),
        A.manageVisibleSpecialOffer(),
        A.updateCheckbox()),
        t.add) {
            var n = k(t.add.id);
            n || C(),
            i == AuctionData.KIND_MY_AUCTION.MY_AUCTION_OFF ? (v([t.add], !0, i),
            n || c.scrollTop()) : v([t.add], !1, i),
            c.updateAmountOfAuction()
        }
        if (t.remove && (b(),
        P(t.remove),
        c.updateAmountOfAuction()),
        t.show) {
            var e = t.show.tab
              , o = t.show.offers;
            if (e != i)
                return;
            isset(t.show.totalOffers) && y(t.show.totalOffers),
            t.show.page && (l.updatePages(t.show.page),
            c.updateAmountOfAuction());
            var u = l.getCurrentPage()
              , r = l.getMaxPage();
            if (1 == u || 0 == r)
                O.isShowCategoryExist() ? c.clearOfferListAndOffersTableAndAttachHeaderOfTable() : (M(),
                c.setFirstHeaderOfTable());
            v(o, !1, i)
        }
    }
    ,
    this.updateTimeOfAuction = function() {
        for (var t in o)
            o[t].updateTime()
    }
    ,
    this.getAuctionBidAndBuyNowActions = function() {
        return p
    }
    ,
    this.getAuctionWindow = function() {
        return c
    }
    ,
    this.getAuctionItems = function() {
        return d
    }
    ,
    this.getAuctionCards = function() {
        return m
    }
    ,
    this.getAuctionOffItemPanel = function() {
        return A
    }
    ,
    this.getAuctionPages = function() {
        return l
    }
    ,
    this.getAuctionSort = function() {
        return s
    }
    ,
    this.getAuctionRequest = function() {
        return f
    }
    ,
    this.getAuctionSearchItems = function() {
        return h
    }
    ,
    this.getAuctionItemCategory = function() {
        return O
    }
    ,
    this.getAuctionTemplates = function() {
        return r
    }
    ,
    this.getTotalOffers = function() {
        return n
    }
    ,
    this.getOneOfferByItemId = function(t) {
        var n = u[t];
        return null == n ? null : B(n)
    }
    ,
    this.getFeaturedCount = function() {
        return t
    }
    ,
    this.getOneOffer = B,
    this.getActualKindOfAuction = function() {
        return i
    }
    ,
    this.getAuctionMode = function() {
        return e
    }
    ,
    this.setActualKindOfAuction = function(t) {
        i = t
    }
    ,
    this.setAuctionMode = function(t) {
        e = t
    }
    ,
    this.createRecords = function(t, n, e) {
        for (var i = $("<tr>"), o = 0; o < t.length; o++) {
            var u = $("<td>").html(t[o]);
            "object" == _typeof(n) ? u.addClass(n[o]) : u.addClass(n),
            j(u, e, o),
            i.append(u)
        }
        return i
    }
    ,
    this.removeFromOfferList = P,
    this.clearOfferList = K,
    this.clearPairItemIdOfferIdObject = U,
    this.putAuctionOffItem = function(t) {
        i != AuctionData.KIND_MY_AUCTION.MY_AUCTION_OFF && c.setMyAuctionOffTabAction(),
        A.manageOfShow(t),
        A.putAuctionOffItem(t)
    }
    ,
    this.clearAllStates = M
}
function AuctionOffItemPanel() {
    var n = null
      , i = null
      , t = null
      , a = function() {
        i.find(".auction-off-item-panel-close").on("click", (function() {
            I()
        }
        ))
    }
      , e = function() {
        i.find(".auction-bid").find(".label").html(g.auctions.tLang("filter_bid")),
        i.find(".auction-additional-gold-payment").find(".label").html(g.auctions.tLang("auction-additional-gold-payment")),
        i.find(".auction-buy-now").find(".label").html(g.auctions.tLang("auction-buy-now")),
        i.find(".auction-duration").find(".label").html(g.auctions.tLang("auction-duration")),
        i.find(".auction-tax").find(".tax-label").html(g.auctions.tLang("auction-tax")),
        i.find(".auction-cost").find(".cost-label").html(g.auctions.tLang("auction-cost"))
    }
      , o = function() {
        i.find(".buy-info-icon").tip(_t("break_soulbound_info"))
    }
      , c = function() {
        i.find(".auction-bid").append(createSiInput({})),
        i.find(".auction-additional-gold-payment").append(createSiInput({})),
        i.find(".auction-buy-now").append(createSiInput({})),
        i.find(".auction-duration").append(createSiInput({
            type: "number"
        }))
    }
      , u = function() {
        createInputPlaceholder("Min. 500", i.find(".auction-buy-now").find("input")),
        createInputPlaceholder("Min. 500", i.find(".auction-bid").find("input")),
        createInputPlaceholder("Min. 500", i.find(".auction-additional-gold-payment").find("input")),
        createInputPlaceholder("2-168", i.find(".auction-duration").find("input"))
    }
      , f = function() {
        var n = createSmallGoldIcon(0)
          , t = createSmallDraconiteIcon(AuctionData.COST_FEATURED_AUCTION)
          , a = i.find(".auction-cost").find(".second-span");
        a.append(n),
        a.append(t)
    }
      , d = function(n) {
        var i = g.auctions.getFeaturedCount() + (n ? 1 : 0)
          , t = g.auctions.tLang("featured_offer");
        return "".concat(t, " (").concat(i, "/").concat(AuctionData.MAX_FEATURED_COUNT, ")")
    }
      , l = function() {
        var n = d(!1)
          , t = createSiCheckBox(n, "", (function() {
            r(),
            p()
        }
        ));
        i.find(".special-offer").append(t)
    }
      , r = function() {
        var n = O();
        s(n)
    }
      , s = function(n) {
        var t = d(n);
        i.find(".special-offer").find(".one-checkbox").find(".label").html(t)
    }
      , p = function() {
        var n = E()
          , a = n && A(t)
          , e = O();
        if (X(),
        n) {
            var o = q(t);
            V(o),
            B(!0)
        } else
            B(!1);
        if (e) {
            if (a) {
                j(!0),
                z(!0),
                H(!1),
                R(!0);
                var c = m(t) + _t("sl");
                K(!0, c)
            } else
                j(!1),
                z(!1),
                H(!0),
                R(!1),
                J();
            N(!0),
            Q(!0, 336)
        } else {
            if (a) {
                j(!0),
                z(!0),
                H(!1),
                R(!0);
                var u = m(t) + _t("sl");
                K(!0, u)
            } else
                j(!1),
                z(!1),
                H(!0),
                R(!1),
                J();
            Q(!1, 168),
            N(!1)
        }
        i.find(".auction-buy-now").find("input").trigger("change"),
        i.find(".auction-bid").find("input").trigger("change"),
        i.find(".auction-additional-gold-payment").find("input").trigger("change"),
        i.find(".auction-duration").find("input").trigger("change")
    }
      , m = function(n) {
        return isset(n.unbindCost) ? n.unbindCost : null
    }
      , v = function() {
        i = g.auctions.getAuctionTemplates().get("auction-off-item-panel"),
        $("#auction-off-item-panel").append(i),
        S()
    }
      , b = function() {
        var n = createButton(_t("cancel"), ["small"], (function() {
            I()
        }
        ));
        i.find(".auction-off-btn-wrapper").append($(n))
    }
      , h = function() {
        var t = g.auctions.tLang("au_create");
        n = createButton(t, ["small", "green"], (function() {
            y()
        }
        ));
        var a = $(n);
        i.find(".auction-off-btn-wrapper").append(a)
    }
      , y = function() {
        if (t) {
            var n = x();
            g.auctions.getAuctionRequest().setAuctionOffActionRequest(t.id, n),
            I(),
            C(!1)
        }
    }
      , _ = function() {
        i.css("display", "block")
    }
      , I = function() {
        k(),
        S()
    }
      , A = function(n) {
        var i = parseItemStat(n.stat);
        return isset(i.soulbound)
    }
      , S = function() {
        i.css("display", "none")
    }
      , O = function() {
        return i.find(".special-offer").find(".checkbox.active").length ? 1 : 0
    }
      , C = function(n) {
        var t = i.find(".special-offer").find(".checkbox.active");
        n ? t.addClass("active") : t.removeClass("active")
    }
      , x = function() {
        var n = i.find(".auction-bid").find("input").val()
          , a = i.find(".auction-buy-now").find("input").val()
          , e = i.find(".auction-duration").find("input").val()
          , o = i.find(".auction-additional-gold-payment").find("input").val()
          , c = O()
          , u = [];
        return A(t) ? (null !== o && u.push("&price=" + parsePrice(removeSpaces(o))),
        c || null === e || u.push("&time=" + e)) : ("" !== n && u.push("&price=" + parsePrice(removeSpaces(n))),
        "" !== a && u.push("&buy_out=" + parsePrice(removeSpaces(a))),
        c || null === e || u.push("&time=" + e)),
        u.push("&is_featured=".concat(c)),
        u
    }
      , M = function() {
        if (t) {
            var n = t.id;
            L(n),
            T(null),
            w()
        }
    }
      , k = function() {
        M(),
        p()
    }
      , w = function() {
        i.find("#auction-off-item").remove()
    }
      , T = function(n) {
        t = n
    }
      , E = function() {
        return !!t
    }
      , L = function(n) {
        g.itemsMovedManager.removeItem(n)
    }
      , P = function(n) {
        i.find(".item-slot").append(n)
    }
      , D = function(n) {
        return $("#item" + n.id).clone().css({
            position: "relative",
            top: 0,
            left: 0
        }).attr({
            id: "auction-off-item",
            iid: n.id
        })
    }
      , U = function(n) {
        g.itemsMovedManager.addItem(n, "ITEM_TO_AUCTION", (function() {
            k()
        }
        ))
    }
      , F = function(n) {
        if (!A(n))
            return !1;
        var i = m(n);
        return null == i && (i = 0),
        i <= 0
    }
      , R = function(n) {
        Y(i.find(".buy-info-icon"), n)
    }
      , N = function(n) {
        i.find(".small-currency-icon").find(".small-draconite").parent().css("display", n ? "table-cell" : "none")
    }
      , B = function(n) {
        i.find(".small-currency-icon").find(".small-money").parent().css("display", n ? "table-cell" : "none")
    }
      , q = function(n) {
        var i = parseItemStat(n.stat).lvl;
        return i || (i = 10),
        10 * Math.max(i, 10)
    }
      , V = function(n) {
        i.find(".small-currency-icon").find(".small-money").parent().find(".value").html(n)
    }
      , X = function() {
        var n = g.auctions.getFeaturedCount() != AuctionData.MAX_FEATURED_COUNT;
        G(n)
    }
      , G = function(n) {
        var t = n ? "initial" : "none"
          , a = n ? 1 : .5
          , e = n ? "" : _t("special_offer_limit_reach")
          , o = i.find(".special-offer");
        o.tip(e),
        o.find(".one-checkbox").css({
            "pointer-events": t,
            opacity: a
        })
    }
      , j = function(n) {
        Y(i.find(".auction-additional-gold-payment"), n)
    }
      , z = function(n) {
        Y(i.find(".additional-soulbond-payment"), n)
    }
      , H = function(n) {
        Y(i.find(".auction-bid"), n)
    }
      , J = function() {
        var n = i.find(".auction-buy-now").find("input").val()
          , t = n.search(_t("sl")) > -1 ? "" : n;
        K(!1, t)
    }
      , K = function(n, t) {
        W(i.find(".auction-buy-now").find("input"), n, t)
    }
      , Q = function(n, t) {
        W(i.find(".auction-duration").find("input"), n, t)
    }
      , W = function(n, i, t) {
        n.prop("disabled", i),
        n.val(t)
    }
      , Y = function(n, i) {
        n.css("display", i ? "block" : "none")
    }
      , Z = function() {
        i.find(".item-slot").on("click", k)
    };
    this.close = function() {
        k(),
        i.remove()
    }
    ,
    this.manageOfShow = function() {
        _(),
        r()
    }
    ,
    this.getAuctionOffItem = function() {
        return t
    }
    ,
    this.setAuctionOffItem = T,
    this.putAuctionOffItem = function(n) {
        if (!function(n) {
            var i = parseItemStat(n.stat);
            return isset(i.permbound)
        }(n) && !F(n)) {
            M();
            var i = D(n);
            T(n),
            p(),
            function(n, i) {
                n.contextmenu((function(n, t) {
                    var a = {
                        txt: _t("unbuy all"),
                        f: function() {
                            k()
                        }
                    };
                    i.createOptionMenu(getE(n, t), a, {
                        move: !0,
                        use: !0
                    })
                }
                ))
            }(i, n),
            U(n),
            P(i)
        }
    }
    ,
    this.manageVisibleElements = p,
    this.manageVisibleSpecialOffer = X,
    this.updateCheckbox = r,
    this.init = function() {
        v(),
        c(),
        Z(),
        h(),
        b(),
        l(),
        f(),
        u(),
        o(),
        a(),
        e()
    }
}
function AuctionPages() {
    var t = null
      , n = null;
    this.init = function() {}
    ,
    this.updatePages = function(e) {
        t = e.number,
        n = e.total
    }
    ,
    this.getCurrentPage = function() {
        return t
    }
    ,
    this.getMaxPage = function() {
        return n
    }
    ,
    this.getNextPageAction = function() {
        if (null != t && null != n && t != n) {
            var e = t + 1;
            g.auctions.getAuctionRequest().getNextPageRequest(e, (function() {
                g.auctions.getAuctionWindow().stopDragBar()
            }
            ))
        }
    }
}
function AuctionRequest() {
    var t = function(t) {
        var i = n(t);
        _g(i)
    }
      , n = function(t, n) {
        var i = g.auctions.getAuctionSearchItems().getFilterString(t)
          , c = g.auctions.getAuctionSort().getSortString()
          , o = ""
          , e = g.auctions.getAuctionItemCategory().getShowCategory();
        return n && (o = "&action=".concat(n)),
        "ah".concat(o, "&cat=").concat(e, "&filter=").concat(i, "&sort=").concat(c)
    };
    this.init = function() {}
    ,
    this.firstPageOfMainAuctionRequest = function() {
        t(1)
    }
    ,
    this.setAuctionOffActionRequest = function(t, n) {
        _g("ah&action=sell&item=" + t + n.join(""))
    }
    ,
    this.getNextPageRequest = function(t, i) {
        var c = n(t);
        _g(c, (function() {
            i()
        }
        ))
    }
    ,
    this.mainAuctionRequest = t,
    this.buyNowRequest = function(t) {
        _g("ah&action=buyout&auction=".concat(t))
    }
    ,
    this.renewAuctionRequest = function(t, n) {
        _g("ah&action=change_time&auction=".concat(t, "&time=").concat(n))
    }
    ,
    this.renewAllAuctionRequest = function(t) {
        _g("ah&action=change_time_all&time=".concat(t))
    }
    ,
    this.deleteAuctionRequest = function(t) {
        _g("ah&action=end&auction=" + t)
    }
    ,
    this.observedRequest = function(t, i, c) {
        var o = function(t, i, c) {
            if (t) {
                var o = "observation_remove&auction=".concat(i);
                return n(c, o)
            }
            return "ah&action=observation_add&auction=" + i
        }(t, i, c);
        _g(o)
    }
    ,
    this.bidRequest = function(t, n) {
        _g("ah&action=bid&auction=".concat(t, "&price=").concat(n))
    }
}
function _defineProperty(e, t, n) {
    return t in e ? Object.defineProperty(e, t, {
        value: n,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : e[t] = n,
    e
}
function AuctionSearchItems() {
    var e = null
      , t = null
      , n = null
      , i = null
      , a = null
      , u = null
      , r = null
      , l = null
      , c = null
      , o = null
      , p = function() {
        n = t.find(".auction-type-wrapper").find(".menu-wrapper"),
        i = t.find(".item-prof-wrapper").find(".menu-wrapper"),
        a = t.find(".item-rarity-wrapper").find(".menu-wrapper"),
        t.find(".new-filter-wrapper").find(".menu-wrapper"),
        u = createSiInput({
            cl: "name-item-input",
            changeClb: R,
            clearClb: R
        }),
        r = createSiInput({
            cl: "min-price-input",
            changeClb: R,
            clearClb: R
        }),
        l = createSiInput({
            cl: "max-price-input",
            changeClb: R,
            clearClb: R
        }),
        c = createSiInput({
            cl: "min-level-input",
            changeClb: R,
            clearClb: R,
            type: "number"
        }),
        o = createSiInput({
            cl: "max-level-input",
            changeClb: R,
            clearClb: R,
            type: "number"
        }),
        t.find(".item-name-wrapper").append(u),
        t.find(".item-price-wrapper").prepend(r),
        t.find(".item-price-wrapper").append(l),
        t.find(".item-lvl-wrapper").prepend(c),
        t.find(".item-lvl-wrapper").append(o),
        u = u.find("input"),
        r = r.find("input"),
        l = l.find("input"),
        c = c.find("input"),
        o = o.find("input")
    }
      , f = function() {
        t = g.auctions.getAuctionTemplates().get("auction-search-item"),
        e.find(".main-column-auction").prepend(t)
    }
      , s = function() {
        var e = g.auctions.tLang("min-price")
          , t = g.auctions.tLang("max-price")
          , n = g.auctions.tLang("min-level")
          , i = g.auctions.tLang("max-level");
        createInputPlaceholder(_t("name_th", null, "auction"), u),
        createInputPlaceholder(e, r),
        createInputPlaceholder(t, l),
        createInputPlaceholder(n, c),
        createInputPlaceholder(i, o)
    }
      , _ = function(e) {
        return e.val()
    }
      , d = function() {
        var t = createButton(_t("filter_refresh", null, "auction"), ["green", "small"], (function() {
            g.auctions.getAuctionRequest().firstPageOfMainAuctionRequest(),
            g.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),
            g.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)
        }
        ));
        e.find(".refresh-button-wrapper").append(t)
    }
      , A = function() {
        var e = [u, r, l, c, o];
        for (var t in e)
            I(e[t])
    }
      , I = function(e) {
        e.on("keydown", (function(e) {
            "Enter" == e.key && P()
        }
        ))
    }
      , P = function() {
        g.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()
    }
      , m = function(e) {
        for (var t in e)
            null == e[t] && (e[t] = "")
    }
      , E = function() {
        var e, t = _(c), p = _(o), f = _(r), s = _(l), d = _(u), g = a.getValue(), A = n.getValue(), I = i.getValue();
        t = isNaN(parseInt(t)) ? null : parsePrice(t),
        p = isNaN(parseInt(p)) ? null : parsePrice(p),
        f = isNaN(parseInt(f)) ? null : parsePrice(f),
        s = isNaN(parseInt(s)) ? null : parsePrice(s),
        d = "" == d ? null : d;
        var P = AuctionData.FILTER_KEYS;
        return _defineProperty(e = {}, P.NAME_ITEM, d),
        _defineProperty(e, P.MIN_LEVEL, t),
        _defineProperty(e, P.MAX_LEVEL, p),
        _defineProperty(e, P.PROF, I),
        _defineProperty(e, P.MIN_PRICE, f),
        _defineProperty(e, P.MAX_PRICE, s),
        _defineProperty(e, P.RARITY, g),
        _defineProperty(e, P.AUCTION_TYPE, A),
        e
    }
      , v = function() {
        var e = [{
            text: _t("auction_type", null, "auctions"),
            val: AuctionData.TYPE_OF_BUY_AUCTION.ALL
        }, {
            text: _t("au_catmybids", null, "auction"),
            val: AuctionData.TYPE_OF_BUY_AUCTION.BIDS
        }, {
            text: _t("filter_buyout", null, "auction"),
            val: AuctionData.TYPE_OF_BUY_AUCTION.BUY_NOW
        }]
          , t = [{
            text: _t("rarity", null, "auctions"),
            val: null
        }, {
            text: T("all"),
            val: AuctionData.TYPE_OF_RARITY.ALL
        }, {
            text: T("unique"),
            val: AuctionData.TYPE_OF_RARITY.UNIQUE
        }, {
            text: T("heroic"),
            val: AuctionData.TYPE_OF_RARITY.HEROIC
        }, {
            text: T("legendary"),
            val: AuctionData.TYPE_OF_RARITY.LEGENDARY
        }]
          , u = [{
            text: g.auctions.tLang("filter_prof"),
            val: null
        }, {
            text: b("warrior"),
            val: "w"
        }, {
            text: b("paladin"),
            val: "p"
        }, {
            text: b("mage"),
            val: "m"
        }, {
            text: b("hunter"),
            val: "h"
        }, {
            text: b("bdancer"),
            val: "b"
        }, {
            text: b("tracker"),
            val: "t"
        }];
        createSiMenu(i, u, !0, (function(e) {
            console.log("asd"),
            R()
        }
        )),
        createSiMenu(n, e, !0, (function(e) {
            R()
        }
        )),
        createSiMenu(a, t, !0, (function(e) {
            R()
        }
        ))
    }
      , R = function() {
        P(),
        g.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),
        g.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)
    };
    function b(e) {
        return _t("prof_" + e, null, "auction")
    }
    function T(e) {
        return _t("type_" + e, null, "auction")
    }
    this.getFilterString = function(e) {
        var t = g.auctions.getActualKindOfAuction()
          , n = g.auctions.getAuctionMode()
          , i = e || g.auctions.getAuctionPages().getCurrentPage()
          , a = AuctionData.FILTER_KEYS
          , u = E();
        return m(u),
        esc(u[a.MIN_LEVEL]) + "|" + esc(u[a.MAX_LEVEL]) + "|" + u[a.PROF] + "|" + u[a.RARITY] + "|" + esc(u[a.MIN_PRICE]) + "|" + esc(u[a.MAX_PRICE]) + "|" + u[a.AUCTION_TYPE] + "|" + t + "|" + n + "|" + i + "|" + esc(u[a.NAME_ITEM])
    }
    ,
    this.init = function() {
        e = g.auctions.getAuctionWindow().getContent(),
        f(),
        p(),
        v(),
        d(),
        s(),
        A()
    }
}
function AuctionSort() {
    var t = AuctionData.AUCTION_CEIL.ITEM_TIME_TD.sort
      , n = AuctionData.SORT_ORDER.DESC
      , i = function(n) {
        if (t == n) {
            var i = u() ? AuctionData.SORT_ORDER.DESC : AuctionData.SORT_ORDER.ASC;
            a(i)
        } else
            o(n),
            a(AuctionData.SORT_ORDER.ASC)
    }
      , o = function(n) {
        t = n
    }
      , u = function() {
        return n == AuctionData.SORT_ORDER.ASC
    }
      , a = function(t) {
        n = t
    };
    this.callChangeSort = function(t) {
        i(t),
        g.auctions.clearOfferList();
        var n = g.auctions.getAuctionWindow();
        n.clearOffersTable(),
        n.setFirstHeaderOfTable(),
        g.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()
    }
    ,
    this.getSortType = function() {
        return t
    }
    ,
    this.getSortOrder = function() {
        return n
    }
    ,
    this.getSortString = function() {
        var i = null == n ? 0 : n;
        return "".concat(null == t ? "" : t, "|").concat(i)
    }
    ,
    this.init = function() {}
}
function AuctionTemplates() {
    var n = {}
      , i = function() {
        n["auction-window"] = '\n        <div class="auction-window">\n            <div class="auction-title"></div>\n            <div class="amount-of-auction"></div>\n            <div class="auction-close-button"></div>\n            \x3c!--<div class="middle-graphic"></div>--\x3e\n\n            <div class="left-column-auction">\n                <div class="auction-switch-wrapper"></div>\n                <div class="cards-header-wrapper">\n                    <div class="header-background-graphic"></div>\n                    <div class="cards-header"></div>\n                </div>\n                <div class="all-categories-auction"></div>\n            </div>\n            \n\n\n            <div class="main-column-auction">\n                <div class="all-auction-info-wrapper">\n                    <div class="all-auction-info"></div>\n                </div>\n                <div class="all-auction-section section middle">\n                    <table class="auction-table-header"></table>\n                    <div class="scroll-wrapper main-all-auction-scroll classic-bar">\n                        <div class="scroll-pane">\n                            <table class="auction-table"></table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>',
        n.card = '<div class="card">\n        <div class="label">\n            <div class="number"></div>\n            <div class="icons">\n                <div class="cl-icon icon-soulbound"></div>\n            </div>\n        </div>\n        <div class="amount"></div>\n    </div>',
        n["auction-off-item-panel"] = '\n                <div class="auction-off-item-panel">\n                    <div class="auction-off-item-panel-header"></div>\n                    <div class="auction-off-item-panel-close"></div>\n                    <div class="auction-off-item-panel-wrapper">\n                        <div class="item-slot-wrapper">\n                            <div class="item-slot"></div>\n                        </div>\n                        <div class="all-field">\n                            <div class="one-record auction-bid"><div class="label"></div></div>\n                            <div class="one-record auction-additional-gold-payment"><div class="label"></div></div>\n                            <div class="one-record auction-buy-now"><div class="label"></div><div class="info-icon buy-info-icon"></div></div>\n                            <div class="one-record auction-duration"><div class="label"></div><div class="h-char">h</div></div>\n                        </div>\n                        <div class="one-info special-offer"></div>\n                        <div class="one-info auction-tax"><span class="first-span tax-label"></span><span class="second-span tax-val">10%</span></div>\n                        <div class="one-info auction-cost">\n                            <span class="first-span cost-label"></span>\n                            <span class="second-span currency-icons"></span>\n                        </div>\n                    </div>\n                    <div class="auction-off-btn-wrapper"></div>\n                </div>\n        ',
        n["auction-search-item"] = '<div class="auction-search-item top">\n            <div class="item-lvl-wrapper">\n                <div class="between-arrow"></div>\n            </div>\n            <div class="item-price-wrapper">\n                <div class="between-arrow"></div>\n            </div>\n\n            <div class="item-name-wrapper"></div>\n            <div class="refresh-button-wrapper"></div>\n\n            <div class="all-menu-wrapper">\n                <div class="auction-type-wrapper">\n                    <select class="menu-wrapper menu default"></select>\n                </div>\n                <div class="item-rarity-wrapper">\n                    <select class="menu-wrapper menu default"></select>\n                </div>\n                <div class="item-prof-wrapper">\n                    <select class="menu-wrapper menu default"></select>\n                </div>\n            </div>\n\n        \x3c!--<div class="third-column-bar-search column-bar-search  menu-bar-search">--\x3e\n            \x3c!--<div class="new-filter-wrapper one-record one-line">--\x3e\n                \x3c!--<div class="menu-wrapper menu default"></div>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="refresh-button-wrapper"></div>--\x3e\n        \x3c!--</div>--\x3e\n\n    </div>',
        n["drop-down-menu-section"] = '<div class="drop-down-menu-section">\n        <div class="type-header">\n            <div class="type-header-label"></div>\n        </div>\n        <div class="state-of-type up-arrow"></div>\n        <div class="content-wrapper">\n            <div class="item-category-wrapper">\n\n            </div>\n        </div>\n      </div>',
        n["action-menu-item"] = '\n        <div class="action-menu-item">\n            <div class="label"></div>\n        </div>\n    ',
        n["one-category-auction"] = '<div class="one-category-auction">\n        <div class="icon"></div>\n      </div>',
        n["one-category-auction"] = '<div class="one-category-auction">\n        <div class="icon"></div>\n      </div>',
        n["auction-but"] = '<div class="auction-but">\n        <div class="label"></div>\n    </div>',
        n["auction-cost-ceil"] = '\n        <div class="auction-cost-ceil">\n            <div class="auction-cost-label"></div>\n            <div class="auction-cost-btn-wrapper"></div>\n        </div>',
        n["auction-input-cost-ceil"] = '\n        <div class="auction-input-cost-ceil">\n            <input class="default input-cost"/>\n            <div class="own-input-cost"></div>\n            <span class="auction-cost-currency"></span>\n            <div class="auction-cost-btn-wrapper"></div>\n        </div>'
    };
    this.get = function(i) {
        if (n[i])
            return $(n[i]);
        console.error("Templates not exist!", i)
    }
    ,
    this.init = function() {
        i()
    }
}
function AuctionTime() {
    var n = null
      , t = function() {
        n = setInterval((function() {
            i()
        }
        ), 1e3)
    }
      , i = function() {
        g.auctions.updateTimeOfAuction()
    };
    this.init = function() {
        t()
    }
    ,
    this.destroy = function() {
        clearInterval(n),
        n = null
    }
}
function _defineProperty(t, n, o) {
    return n in t ? Object.defineProperty(t, n, {
        value: o,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : t[n] = o,
    t
}
function AuctionWindow() {
    var t, n = null, o = !1, a = function() {
        var n = []
          , o = AuctionData.TYPE_OF_AUCTION.EVENT
          , a = AuctionData.TYPE_OF_AUCTION.NORMAL;
        n.push({
            text: _t(a + "_auction"),
            val: a
        }),
        n.push({
            text: _t(o + "_auction"),
            val: o
        });
        var i = $("<div>");
        i.createDivideButton(n, 0, !0, (function(t) {
            var n;
            n = t == AuctionData.TYPE_OF_AUCTION.NORMAL ? 0 : 1,
            g.auctions.setAuctionMode(n),
            g.auctions.getAuctionRequest().firstPageOfMainAuctionRequest(),
            g.auctions.getAuctionWindow().setVisibleAllAuctionsInfoWrapper(!1),
            g.auctions.getAuctionWindow().setVisibleAmountOfAuction(!0)
        }
        )),
        t.find(".auction-switch-wrapper").append(i)
    }, i = function() {
        t.find(".auction-close-button").click((function() {
            g.auctions.close()
        }
        ))
    }, e = function() {
        var n = $("<div>").addClass("scroll-auction-plug");
        $(".scroll-wrapper", t).find(".scrollbar-wrapper").append(n)
    }, c = function() {
        $(".all-auction-section")[0].scrollTo({
            top: 0,
            left: 0
        })
    }, u = function() {
        t = g.auctions.getAuctionTemplates().get("auction-window"),
        $("#auction-window").append(t)
    }, r = function() {
        var n = g.auctions.getActualKindOfAuction()
          , o = t.find(".auction-renew-btn-wrapper")
          , a = n == AuctionData.KIND_MY_AUCTION.MY_AUCTION_OFF ? "block" : "none"
          , i = n == AuctionData.KIND_OTHERS_AUCTION.ALL_AUCTION;
        A(i),
        l(!i),
        o.css("display", a)
    }, _ = function() {
        t.find(".all-auction-info").text(g.auctions.tLang("choose_category"))
    }, A = function(n) {
        t.find(".all-auction-info-wrapper").css("display", n ? "block" : "none")
    }, l = function(n) {
        t.find(".amount-of-auction").css("display", n ? "block" : "none")
    }, s = function() {
        var n = g.auctions.tLang("renev_all_auction")
          , o = createButton(n, ["small", "green"], (function() {
            var t = g.auctions.tLang("renev_all_auction_confirmation");
            confirmWitchTextInput(t, (function(t) {
                I(t)
            }
            ))
        }
        ));
        t.find(".auction-renew-btn-wrapper").append(o)
    }, T = function() {
        g.auctions.clearOfferList(),
        g.auctions.clearPairItemIdOfferIdObject(),
        d()
    }, I = function(t) {
        g.auctions.getAuctionRequest().renewAllAuctionRequest(t)
    }, f = function() {
        $(".all-auction-section")[0].onscroll = function(t) {
            C() && (o || (o = !0,
            setTimeout((function() {
                o = !1
            }
            ), 500),
            O()))
        }
    }, O = function(t) {
        g.auctions.getAuctionPages().getNextPageAction()
    }, C = function() {
        var t = $(".all-auction-section")[0];
        return t.scrollTop + t.offsetHeight >= t.scrollHeight - 1 && t.scrollTop + t.offsetHeight <= t.scrollHeight + 1
    }, D = function() {
        n = t.find(".auction-table")
    }, d = function() {
        n.empty(),
        t.find(".auction-table-header").empty()
    }, E = function(t) {
        var n = g.auctions.getAuctionSort();
        if (n.getSortType() != t)
            return null;
        var o = n.getSortOrder();
        switch (o) {
        case AuctionData.SORT_ORDER.ASC:
            return !1;
        case AuctionData.SORT_ORDER.DESC:
            return !0;
        default:
            errorReport("AuctionManager", "getSortVal", "Bad val of sortOrder:" + o)
        }
        return null
    }, N = function(t) {
        return t != AuctionData.KIND_OTHERS_AUCTION.ALL_AUCTION && t != AuctionData.KIND_MY_AUCTION.MY_BID
    }, p = function() {
        var n = g.auctions.getActualKindOfAuction()
          , o = t.find(".auction-table-header")
          , a = M(n, function(t) {
            var n, o, a = N(t);
            return a ? (_defineProperty(n = {}, AuctionData.AUCTION_CEIL.ITEM_SLOT_TD.key, null),
            _defineProperty(n, AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_NAME_TD.sort)),
            _defineProperty(n, AuctionData.AUCTION_CEIL.ITEM_TIME_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_TIME_TD.sort)),
            _defineProperty(n, AuctionData.AUCTION_CEIL.ITEM_BID_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_BID_TD.sort)),
            _defineProperty(n, AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.sort)),
            _defineProperty(n, AuctionData.AUCTION_CEIL.AUCTION_ACTION_TD.key, null),
            n) : a ? void 0 : (_defineProperty(o = {}, AuctionData.AUCTION_CEIL.ITEM_SLOT_TD.key, null),
            _defineProperty(o, AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_NAME_TD.sort)),
            _defineProperty(o, AuctionData.AUCTION_CEIL.ITEM_TIME_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_TIME_TD.sort)),
            _defineProperty(o, AuctionData.AUCTION_CEIL.ITEM_BID_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_BID_TD.sort)),
            _defineProperty(o, AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.key, E(AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.sort)),
            o)
        }(n));
        o.append(a),
        c()
    }, U = function(t, n) {
        return n + " " + (null == t[n] ? "" : "sort-arrow " + (t[n] ? "sort-arrow-up" : "sort-arrow-down"))
    }, M = function(t, n) {
        var o = "header-auction-td center "
          , a = "header-auction-td center hover-td "
          , i = g.auctions.getAuctionSort()
          , e = N(t)
          , c = ["Item", $("<span>").html(_t("name_th", null, "auction")), $("<span>").html(_t("au_time", null, "auction")), $("<span>").html(_t("price_bid", null, "auction")), $("<span>").html(_t("filter_buyout", null, "auction"))]
          , u = [o + U(n, AuctionData.AUCTION_CEIL.ITEM_SLOT_TD.key), a + U(n, AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key), a + U(n, AuctionData.AUCTION_CEIL.ITEM_TIME_TD.key), a + U(n, AuctionData.AUCTION_CEIL.ITEM_BID_TD.key), a + U(n, AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.key)]
          , r = [!1, function() {
            i.callChangeSort(AuctionData.AUCTION_CEIL.ITEM_NAME_TD.sort)
        }
        , function() {
            i.callChangeSort(AuctionData.AUCTION_CEIL.ITEM_TIME_TD.sort)
        }
        , function() {
            i.callChangeSort(AuctionData.AUCTION_CEIL.ITEM_BID_TD.sort)
        }
        , function() {
            i.callChangeSort(AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.sort)
        }
        ];
        return e && (c.push($("<span>").html(_t("clan_action", null, "clan"))),
        u.push(o + U(n, AuctionData.AUCTION_CEIL.AUCTION_ACTION_TD.key)),
        r.push(!1)),
        g.auctions.createRecords(c, u, r)
    }, h = function() {
        var n = t.find(".cards-header")
          , o = _t("tab_others_auctions", null, "auction")
          , a = _t("tab_my", null, "auction")
          , i = _t("tab_au_catmybids", null, "auction")
          , e = g.auctions.getAuctionCards();
        e.newCard(n, o, (function() {
            L(AuctionData.KIND_OTHERS_AUCTION.ALL_AUCTION)
        }
        )),
        e.newCard(n, a, (function() {
            L(AuctionData.KIND_MY_AUCTION.MY_AUCTION_OFF)
        }
        )),
        e.newCard(n, i, (function() {
            L(AuctionData.KIND_MY_AUCTION.MY_BID)
        }
        )),
        y()
    }, L = function(t) {
        b(t),
        r(),
        t == AuctionData.KIND_OTHERS_AUCTION.ALL_AUCTION ? g.auctions.clearAllStates() : g.auctions.getAuctionRequest().firstPageOfMainAuctionRequest()
    }, y = function() {
        g.auctions.getAuctionCards().clickCard(0, null),
        b(AuctionData.KIND_OTHERS_AUCTION.ALL_AUCTION),
        r()
    }, b = function(t) {
        g.auctions.getAuctionItemCategory().clearItemCategory(),
        g.auctions.setActualKindOfAuction(t)
    };
    this.init = function() {
        u(),
        D(),
        h(),
        s(),
        f(),
        e(),
        i(),
        a(),
        _()
    }
    ,
    this.close = function() {
        t.remove()
    }
    ,
    this.initCards = h,
    this.stopDragBar = function() {
        var t = $(".all-auction-section")[0];
        t.scrollTo({
            top: t.scrollTop,
            left: 0
        })
    }
    ,
    this.updateAmountOfAuction = function() {
        var n = _t("quantity_of_auction", null, "auction")
          , o = g.auctions.getTotalOffers();
        t.find(".amount-of-auction").html("".concat(n, ": ").concat(o))
    }
    ,
    this.setFirstHeaderOfTable = p,
    this.checkTabWithActionTDByActualKindOfAuction = N,
    this.setCard = b,
    this.getContent = function() {
        return t
    }
    ,
    this.addToOffersTable = function(t, o) {
        o ? n.prepend(t) : n.append(t)
    }
    ,
    this.clearOffersTable = d,
    this.scrollTop = c,
    this.setSelectorVars = D,
    this.setMyAuctionOffTabAction = function() {
        g.auctions.getAuctionCards().clickCard(1, null),
        L(AuctionData.KIND_MY_AUCTION.MY_AUCTION_OFF)
    }
    ,
    this.initScrollBar = f,
    this.clearAuctionsInTableWithOffers = T,
    this.clearOfferListAndOffersTableAndAttachHeaderOfTable = function() {
        T(),
        p()
    }
    ,
    this.setVisibleAllAuctionsInfoWrapper = A,
    this.setVisibleAmountOfAuction = l
}
function OneOffer() {
    var t, i = null, n = null, e = function(t) {
        t
    }, a = function(t) {
        i = t
    }, o = function(i) {
        var n = g.auctions.getActualKindOfAuction();
        t = d(i, n)
    }, u = function(t) {
        n = t
    }, c = function() {
        var i = t.find(".item-time-td").find(".time-wrapper")
          , e = i.html()
          , a = getSecondLeft(n, {
            short: !0
        });
        e != a && i.html(a)
    }, r = function() {
        t.remove()
    }, s = function(t) {
        var i = $("<div>").addClass("time-wrapper")
          , n = "<br>" + ut_fulltime(ts() / 1e3 + t.time)
          , e = _t("end_time %val%", {
            "%val%": n
        }, "end_time_auction");
        return i.tip(e),
        i.html(getSecondLeft(t.time, {
            short: !0
        })),
        i
    }, d = function(t, i) {
        t.id;
        var n = "auction-td center "
          , e = t.is_featured;
        e && (n += "is-featured ");
        var a = g.auctions.getAuctionBidAndBuyNowActions()
          , o = g.auctions.getAuctionWindow().checkTabWithActionTDByActualKindOfAuction(i)
          , u = [$("<div>").addClass("item-slot"), f(), s(t), a.getBidCeil(t), a.getBuyNowCeil(t)]
          , c = [n + AuctionData.AUCTION_CEIL.ITEM_SLOT_TD.key, n + AuctionData.AUCTION_CEIL.ITEM_NAME_TD.key, n + AuctionData.AUCTION_CEIL.ITEM_TIME_TD.key, n + AuctionData.AUCTION_CEIL.ITEM_BID_TD.key, n + AuctionData.AUCTION_CEIL.ITEM_BUY_NOW_TD.key];
        o && (u.push(A(t)),
        c.push(n + AuctionData.AUCTION_CEIL.AUCTION_ACTION_TD.key));
        var r = g.auctions.createRecords(u, c);
        return e && r.addClass("is-featured-tr"),
        r
    }, f = function() {
        return '<span class="auction-item-name"></span><span class="auction-item-lvl"></span>'
    }, A = function(t) {
        var i = $("<div>").addClass("auction-wrapper");
        return t.own_auction && i.append(l(t)),
        i
    }, l = function(t) {
        var i = g.auctions.tLang("canNotRemoveAuction")
          , n = g.auctions.tLang("removeAuction")
          , e = t.bidder ? i : n
          , a = t.bidder ? "inactive" : ""
          , o = drawSIButton("X")
          , u = $(o);
        return u.on("click", (function() {
            if (!u.hasClass("inactive")) {
                var i = g.auctions.tLang("removeAuctionConfirm")
                  , n = t.id;
                mAlert(i, 1, [function() {
                    g.auctions.getAuctionRequest().deleteAuctionRequest(n)
                }
                , function() {}
                ])
            }
        }
        )),
        u.tip(e),
        u.addClass(a),
        u
    };
    this.init = function(t) {
        u(t.time),
        a(t.id),
        o(t),
        e(!1)
    }
    ,
    this.updateTime = function() {
        if (--n < 0)
            return r(),
            void g.auctions.removeFromOfferList(i);
        c()
    }
    ,
    this.get$Offer = function() {
        return t
    }
    ,
    this.removeOffer = r,
    this.updateOffer = function(i) {
        u(i.time);
        var n = g.auctions.getActualKindOfAuction()
          , a = d(i, n);
        t.replaceWith(a),
        t = a,
        e(!1)
    }
    ,
    this.setItemAttachToSlotState = e
}
function preCaptcha() {
    var t = this
      , e = null
      , n = !1;
    this.wndEl = document.getElementById("pre-captcha"),
    this.toggleBtnEl = null,
    this.init = function(t) {
        this.clear(),
        this.addPreCaptchaInfo(t),
        this.createToggleButton()
    }
    ,
    this.createToggleButton = function() {
        t.toggleBtnEl = t.wndEl.querySelector(".captcha-pre-info__toggler"),
        t.toggleBtnEl.addEventListener("click", t.toggleWindow),
        t.show()
    }
    ,
    this.toggleWindow = function() {
        n ? t.show() : t.hide()
    }
    ,
    this.show = function() {
        t.wndEl.classList.add("show"),
        t.toggleBtnEl.classList.add("is-open"),
        n = !1
    }
    ,
    this.hide = function() {
        t.wndEl.classList.remove("show"),
        t.toggleBtnEl.classList.remove("is-open"),
        n = !0
    }
    ,
    this.createOneButton = function(t, e, n) {
        var a = drawSIButton(t, "wood")[0];
        return a.addEventListener("click", n),
        a
    }
    ,
    this.addPreCaptchaInfo = function(e) {
        var n = e
          , a = $(t.tpl())[0]
          , c = a.querySelector(".captcha-pre-info__time")
          , o = a.querySelector(".captcha-pre-info__label")
          , i = a.querySelector(".captcha-pre-info__button")
          , l = t.createOneButton(_t("captcha_resolve_now"), ["small", "green"], (function() {
            t.removePreCaptchaInfo(),
            _g("captcha&start=1")
        }
        ));
        o.textContent = _t("captcha_time"),
        c.textContent = --n,
        i.append(l),
        t.preCaptchaInfoTimeTick(c, n),
        t.wndEl.appendChild(a)
    }
    ,
    this.preCaptchaInfoTimeTick = function(n, a) {
        e = setInterval((function() {
            --a <= 0 && t.removePreCaptchaInfo(),
            n.innerHTML = a
        }
        ), 1e3)
    }
    ,
    this.removePreCaptchaInfo = function() {
        clearInterval(e),
        t.close()
    }
    ,
    this.close = function() {
        t.hide(),
        t.clear()
    }
    ,
    this.clear = function() {
        t.wndEl.innerHTML = ""
    }
    ,
    this.tpl = function() {
        return '\n    <div class="captcha-pre-info">\n        <span class="captcha-pre-info__label"></span>\n        <span class="captcha-pre-info__time"></span>s\n        <div class="captcha-pre-info__button"></div>\n        <div class="captcha-pre-info__toggler"></div>\n    </div>\n\t'
    }
}
function _toConsumableArray(t) {
    return _arrayWithoutHoles(t) || _iterableToArray(t) || _unsupportedIterableToArray(t) || _nonIterableSpread()
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(t, e) {
    if (t) {
        if ("string" == typeof t)
            return _arrayLikeToArray(t, e);
        var n = Object.prototype.toString.call(t).slice(8, -1);
        return "Object" === n && t.constructor && (n = t.constructor.name),
        "Map" === n || "Set" === n ? Array.from(t) : "Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? _arrayLikeToArray(t, e) : void 0
    }
}
function _iterableToArray(t) {
    if ("undefined" != typeof Symbol && null != t[Symbol.iterator] || null != t["@@iterator"])
        return Array.from(t)
}
function _arrayWithoutHoles(t) {
    if (Array.isArray(t))
        return _arrayLikeToArray(t)
}
function _arrayLikeToArray(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var n = 0, a = new Array(e); n < e; n++)
        a[n] = t[n];
    return a
}
function captcha() {
    var t, e = this, n = [];
    this.wndEl = document.getElementById("captcha"),
    this.init = function() {}
    ,
    this.update = function(t) {
        (isset(t.content) && e.openCaptcha(t),
        isset(t.autostart_time_left)) && (new preCaptcha).init(t.autostart_time_left);
        isset(t.done) && t.done && e.close(),
        isset(t.blockade_time_left) && (e.close(),
        e.countTimeToNextCaptcha(t.blockade_time_left),
        stopEngine(),
        setBlockSendNextInit(!0));
        var n = g.init >= 4;
        isset(t.blockadeEndTs) || !isset(t.content) || n || isset(t.blockade_time_left) || !isset(t.content) || n || (stopEngine(),
        setBlockSendNextInit(!0))
    }
    ,
    this.countTimeToNextCaptcha = function(t) {
        var e = t;
        mAlert(_t("captcha_wrong_answer"), 0, (function() {
            window.location.href = "https://www.margonem.pl/"
        }
        )),
        setInterval((function() {
            --e < 0 && (e = 0),
            e < 1 && location.reload(),
            $("#captcha-timer").html(getSecondLeft(e))
        }
        ), 1e3),
        $("#captcha-timer").html(getSecondLeft(e))
    }
    ,
    this.openCaptcha = function(t) {
        e.close(),
        e.initWindow(),
        e.create(t),
        g.lock.add("captcha")
    }
    ,
    this.create = function(t) {
        e.clear(),
        e.createImg({
            image: t.content.image
        }),
        e.createQuestion({
            text: t.content.question.text
        }),
        e.createButtons({
            answers: t.content.question.options
        }),
        e.createConfirmButton(),
        e.createTriesLeft(t.triesLeft),
        e.wndEl.style.display = "block",
        $(e.wndEl).absCenter()
    }
    ,
    this.createImg = function(e) {
        var n = e.image
          , a = document.createElement("IMG");
        a.setAttribute("src", n.data),
        a.setAttribute("width", n.resolution.x),
        a.setAttribute("height", n.resolution.y),
        t.querySelector(".captcha__image").append(a)
    }
    ,
    this.createQuestion = function(e) {
        var n = e.text;
        t.querySelector(".captcha__question").textContent = n
    }
    ,
    this.createOneButton = function(t, e, n) {
        var a = drawSIButton(t, e)[0];
        return a.addEventListener("click", n),
        a
    }
    ,
    this.createButtons = function(n) {
        var a = n.answers;
        for (var r in a) {
            var i = a[r]
              , c = e.createOneButton(i, "wood", e.buttonOnClick);
            t.querySelector(".captcha__buttons").append(c)
        }
    }
    ,
    this.createConfirmButton = function() {
        var n = e.createOneButton(_t("captcha_confirm"), "wood", e.confirmOnClick);
        t.querySelector(".captcha__confirm").append(n)
    }
    ,
    this.createTriesLeft = function(e) {
        t.querySelector(".captcha__triesleft").innerHTML = _t("captcha_triesleft") + e
    }
    ,
    this.buttonOnClick = function(t) {
        var n = t.target || t.srcElement
          , a = e.getNodeIndex(n);
        n.classList.toggle("active"),
        e.updateSelectedAnswers(a)
    }
    ,
    this.updateSelectedAnswers = function(t) {
        n.includes(t) ? n.splice(n.indexOf(t), 1) : n.push(t)
    }
    ,
    this.confirmOnClick = function() {
        var t = n.sort().join(",");
        g.init >= 4 ? _g("captcha&answerId=".concat(t)) : (startEngine(),
        sendFirstInit("&captcha&answerId=".concat(t))),
        e.close()
    }
    ,
    this.initWindow = function() {
        var t = _t("captcha");
        this.setDefaultContent(),
        this.wndEl.querySelector(".captcha__title").appendChild($(goldTxt(t))[0])
    }
    ,
    this.clear = function() {
        n = [],
        delete t
    }
    ,
    this.setDefaultContent = function() {
        t = $(e.tpl())[0],
        e.wndEl.appendChild(t)
    }
    ,
    this.getNodeIndex = function(t) {
        return _toConsumableArray(t.parentNode.children).indexOf(t)
    }
    ,
    this.close = function() {
        this.wndEl.style.display = "none",
        this.wndEl.innerHTML = "",
        delete t,
        g.lock.remove("captcha")
    }
    ,
    this.tpl = function() {
        return '\n\t\t<div class="captcha">\n\t\t\t<div class="captcha__header"></div>\n\t\t\t<div class="captcha__title"></div>\n\t\t\t<div class="captcha__content">\n\t\t\t\t<div class="captcha__question"></div>\n\t\t\t\t<div class="captcha__image"></div>\n\t\t\t\t<div class="captcha__buttons"></div>\n\t\t\t\t<div class="captcha__confirm"></div>\n\t\t\t\t<div class="captcha__triesleft"></div>\n\t\t\t</div>\n\t\t</div>\n\t'
    }
}
function asyncGeneratorStep(t, e, n, o, i, l, a) {
    try {
        var r = t[l](a)
          , s = r.value
    } catch (t) {
        return void n(t)
    }
    r.done ? e(s) : Promise.resolve(s).then(o, i)
}
function _asyncToGenerator(t) {
    return function() {
        var e = this
          , n = arguments;
        return new Promise((function(o, i) {
            var l = t.apply(e, n);
            function a(t) {
                asyncGeneratorStep(l, o, i, a, r, "next", t)
            }
            function r(t) {
                asyncGeneratorStep(l, o, i, a, r, "throw", t)
            }
            a(void 0)
        }
        ))
    }
}
function poll() {
    var t, e, n, o, i = this, l = {
        rateRange: [1, 10],
        pollApiUrl: null,
        pollApiUrlPush: null,
        pollHitKey: "pollHit",
        pollDisplayedKey: "pollDisplayed"
    };
    function a(t, e) {
        for (var n in e)
            t.setAttribute(n, e[n])
    }
    this.wndEl = document.getElementById("poll"),
    this.getApiDomain = function() {
        return i.getEngine().worldConfig.getApiDomain()
    }
    ,
    this.getConfig = function() {
        return l
    }
    ,
    this.setApiUrl = function() {
        var t = i.getHS3Cookie()
          , e = i.getApiDomain();
        i.getConfig().pollApiUrl = "".concat(e, "/surveys/get?hs3=").concat(t),
        i.getConfig().pollApiUrlPush = "".concat(e, "/surveys/vote")
    }
    ,
    this.init = function() {
        i.canHitForPoll().then((function(t) {
            t && (i.setPollHitDate(),
            i.getPollData())
        }
        ))
    }
    ,
    this.canHitForPoll = _asyncToGenerator((function*() {
        var t = yield i.hasPollDisplayedToday();
        return !(i.hasPollHitToday() || t)
    }
    )),
    this.hasPollDisplayedToday = _asyncToGenerator((function*() {
        var t = yield g.crossStorage.get(i.getConfig().pollDisplayedKey);
        return t && t === getCurrentDate()
    }
    )),
    this.setPollDisplayedDate = function() {
        g.crossStorage.set(i.getConfig().pollDisplayedKey, getCurrentDate())
    }
    ,
    this.hasPollHitToday = function() {
        var t = margoStorage.get(i.getConfig().pollHitKey);
        return t && t === getCurrentDate()
    }
    ,
    this.setPollHitDate = function() {
        margoStorage.set(i.getConfig().pollHitKey, getCurrentDate())
    }
    ,
    this.getPollData = function() {
        i.setApiUrl(),
        fetch(i.getConfig().pollApiUrl, {
            credentials: "include"
        }).then((function(t) {
            return t.json()
        }
        )).then((function(t) {
            var e = t.survey;
            e ? i.updateData({
                data: e
            }) : isset(t.error) && console.warn("Poll - Something went wrong.")
        }
        )).catch((function(t) {
            console.warn("Poll - Something went wrong.", t)
        }
        ))
    }
    ,
    this.updateData = function(t) {
        var e = t.data;
        isset(e) && (n = e.id,
        i.openPoll({
            data: e
        }))
    }
    ,
    this.openPoll = function(t) {
        var e = t.data;
        i.close(),
        i.setPollDisplayedDate(),
        i.initWindow(),
        i.create({
            data: e
        })
    }
    ,
    this.create = function(t) {
        var n = t.data;
        i.clear(),
        i.createQuestion({
            data: n
        }),
        i.createConfirmButton(),
        e = i.wndEl.querySelector("form"),
        i.wndEl.style.display = "block",
        $(i.wndEl).absCenter()
    }
    ,
    this.createQuestion = function(e) {
        var n = e.data
          , o = t.querySelector(".poll__list");
        n.questions.forEach((function(t, e, n) {
            var l = $(i.tplListItem())[0]
              , a = l.querySelector(".poll__answers");
            l.querySelector(".poll__question").textContent = "".concat(e + 1, ". ").concat(t),
            i.createAnswers(a, e + 1),
            o.appendChild(l)
        }
        ))
    }
    ,
    this.createAnswers = function(t, e) {
        for (var n = rateRange[0]; n <= rateRange[1]; n++) {
            var o = "answer_".concat(e, "-").concat(n)
              , l = document.createElement("div");
            l.classList.add("poll__answers-item");
            var r = document.createElement("input");
            a(r, {
                type: "radio",
                value: n,
                id: o,
                name: "q_".concat(e),
                required: !0
            }),
            r.addEventListener("change", i.checkValid);
            var s = document.createElement("label");
            a(s, {
                for: o
            }),
            s.textContent = n.toString(),
            l.appendChild(r),
            l.appendChild(s),
            t.appendChild(l)
        }
        return t
    }
    ,
    this.createOneButton = function(t, e, n) {
        var o = drawSIButton(t, e)[0];
        return o.addEventListener("click", n),
        o
    }
    ,
    this.createConfirmButton = function() {
        o = i.createOneButton(_t("send", null, "mails"), "wood disable", i.confirmOnClick),
        t.querySelector(".poll__confirm").append(o)
    }
    ,
    this.checkValid = function() {
        return e.checkValidity() ? (o.classList.remove("disable"),
        !0) : (o.classList.add("disable"),
        !1)
    }
    ,
    this.getHS3Cookie = function() {
        return getCookie("hs3")
    }
    ,
    this.confirmOnClick = function() {
        var t = $(e).serializeArray().map((function(t) {
            return parseInt(t.value)
        }
        ))
          , o = {
            vote: n,
            w: g.worldConfig.getWorldName(),
            answer: t,
            hs3: i.getHS3Cookie()
        };
        fetch(i.getConfig().pollApiUrlPush, {
            method: "POST",
            credentials: "include",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: JSON.stringify(o)
        }).then((function(t) {
            return 0 === t.status ? null : t.json()
        }
        )).then((function(t) {}
        )).catch((function(t) {
            console.warn("Something went wrong.", t)
        }
        ));
        i.close()
    }
    ,
    this.initWindow = function() {
        var t = _t("poll");
        i.setDefaultContent(),
        i.wndEl.querySelector(".poll__title").appendChild($(goldTxt(t))[0]),
        i.wndEl.querySelector(".closebut").addEventListener("click", (function() {
            i.close()
        }
        ))
    }
    ,
    this.clear = function() {
        delete t
    }
    ,
    this.setDefaultContent = function() {
        t = $(i.tpl())[0],
        i.wndEl.appendChild(t)
    }
    ,
    this.close = function() {
        this.wndEl.style.display = "none",
        this.wndEl.innerHTML = "",
        delete t
    }
    ,
    this.getEngine = function() {
        return g
    }
    ,
    this.tpl = function() {
        return '\n\t\t<div class="poll">\n\t\t\t<div class="poll__header"></div>\n\t\t\t<div class="poll__title"></div>\n\t\t\t<div class="poll__content">\n\t\t\t\t<form>\n\t\t\t\t\t<div class="poll__list"></div>\n\t\t\t\t\t<div class="poll__confirm"></div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t\t<div class="closebut"></div>\n    \t</div>\n\t'
    }
    ,
    this.tplListItem = function() {
        return '\n\t\t<div class="poll__list-item">\n\t\t\t<div class="poll__question"></div>\n\t\t\t<div class="poll__answers"></div>\n\t\t</div>\n\t'
    }
}
function MatchManager() {
    var a, t, n = null, i = null, e = null, s = null, d = !0, l = !0, o = !0, r = null, c = null, p = 0, u = 0, m = null, v = null, f = {
        header: null,
        body: null
    }, h = {
        startTime: null,
        avgTime: null,
        avgTimeFunc: null,
        endTime: null,
        $element: null,
        tipFunc: null,
        onUpdate: null
    }, M = [];
    function _(a) {
        var t = a % 60
          , n = (a - t) / 60
          , i = n % 60;
        return {
            s: t,
            m: i,
            mf: n,
            h: (a - 60 * i - t) / 3600
        }
    }
    function b(a, t, n, i) {
        var e = "";
        return null == i && (i = !1),
        (!i || i && 0 != n) && (e = n + " s"),
        t > 0 && (e = t + " min " + e),
        a > 0 && (!i || i && 0 != a) && (e = a + " h " + e),
        e
    }
    function k(a) {
        if (null != h.$element) {
            var t = _(a);
            if (a >= 6e3 ? h.$element.text("99:59") : a >= 60 ? h.$element.text(zero(t.mf) + ":" + zero(t.s)) : h.$element.text(t.s + " s"),
            null != h.tipFunc) {
                var n = b(t.h, t.m, t.s);
                h.$element.attr("tip", h.tipFunc(n))
            }
        }
    }
    function w() {
        var a = unix_time() - h.startTime;
        h.avgTime;
        if (a < 0 && (a = 0),
        null != h.onUpdate) {
            var t = _(a)
              , n = _(h.avgTime)
              , i = b(t.h, t.m, t.s)
              , e = "~" + b(n.h, n.m, n.s, !0);
            0 == h.avgTime && (e = "-"),
            h.onUpdate(i, e)
        }
        k(a)
    }
    function C() {
        var a = unix_time()
          , t = h.endTime - a;
        t < 0 && (t = 0),
        k(t)
    }
    function T(a, t) {
        var n = a - t;
        n < 0 && (n = 0);
        var i = n % 60;
        return (n - i) / 60 + ":" + zero(i) + " min"
    }
    function y(a) {
        var t = "";
        switch (a) {
        case "w":
            t = "prof_warrior";
            break;
        case "p":
            t = "prof_paladyn";
            break;
        case "b":
            t = "prof_bladedancer";
            break;
        case "m":
            t = "prof_mag";
            break;
        case "h":
            t = "prof_hunter";
            break;
        case "t":
            t = "prof_tracker"
        }
        return t
    }
    function x(a) {
        var t = "";
        switch (a) {
        case 0:
            t = "Win";
            break;
        case 1:
            t = "Lose";
            break;
        case 2:
            t = "Draw"
        }
        return t
    }
    function I(a, t, n, i) {
        var e = null;
        if (i)
            e = i;
        else {
            if (0 == a)
                return;
            if (!isset(g.item) || !isset(g.item[a]))
                return;
            e = g.item[a]
        }
        var s = $("<div>").addClass("item")
          , d = $("<img>");
        s.attr({
            tip: itemTip(e),
            ctip: "t_item"
        }),
        d.attr("src", CFG.ipath + e.icon),
        s.append(d),
        s.addClass("MM-item-st-" + t);
        var l = {
            upgraded: "t_upg",
            unique: "t_uni",
            heroic: "t_her",
            legendary: "t_leg",
            artefact: "t_art"
        };
        for (var o in l)
            if (RegExp(o).test(e.stat)) {
                var r = $("<div>").addClass("itemHighlighter " + l[o]);
                r.addClass(4096 & hero.opt ? "nodisp" : ""),
                s.prepend(r);
                break
            }
        return n && n.append(s),
        {
            $: s
        }
    }
    function F() {
        null != s && (s.remove(),
        $("#bottombar, #botloc, #lagmeter, #chat, #bchat").removeClass("MM-overlay-element"),
        $("#pvpmode").removeClass("MM-overlay-element2"),
        s = null)
    }
    function B() {
        null != e && (g.lock.remove("mmalert"),
        e.remove(),
        e = null)
    }
    function q() {
        $("#alert").hide(),
        null != s && F(),
        s = $("<div>").addClass("MM-overlay").appendTo("body"),
        $("#bottombar, #pvpmode, #botloc, #lagmeter, #chat, #bchat").addClass("MM-overlay-element"),
        $("#pvpmode").addClass("MM-overlay-element2");
        g.lock.add("mmalert"),
        h.tipFunc = null;
        var a = _t("found_opponent", null, "matchmaking");
        e = $("<div>").addClass("MM-alert").appendTo("body"),
        $("<div>").addClass("a1").appendTo(e);
        var t = $("<div>").addClass("a2 MM-asktxt").html(a).appendTo(e)
          , n = $("<div>").addClass("MM-timer").appendTo(t)
          , i = $("<div>").addClass("a3").appendTo(e)
          , d = $("<button>").addClass("bal_yes").appendTo(i)
          , l = $("<button>").addClass("bal_no").appendTo(i);
        d.unbind("click").click((function() {
            $a(),
            _g("match&a=accept_opp&ans=1"),
            d.unbind("click"),
            d.blur(),
            B()
        }
        )),
        l.unbind("click").click((function() {
            _g("match&a=accept_opp&ans=0"),
            F(),
            l.unbind("click"),
            d.blur(),
            B()
        }
        )),
        e.absCenter().fadeIn("fast", (function() {
            d.focus()
        }
        )),
        h.$element = n,
        C()
    }
    function S() {
        0 == n ? _g("match&a=signin") : 1 == n && _g("match&a=signout")
    }
    function D() {
        _g("match&a=profile")
    }
    function Q(a) {
        null == a ? _g("match&a=statistics") : _g("match&a=statistics_detailed&player_id=" + a)
    }
    function R(a) {
        null == a && (a = 1),
        _g("match&a=history&page=" + a)
    }
    function L(a) {
        null == a && (a = 1),
        _g("match&a=ladder_global&page=" + a)
    }
    function O(a) {
        null == a && (a = 1),
        _g("match&a=ladder_clan&page=" + a)
    }
    function P(a) {
        null == a && (a = 1),
        _g("match&a=ladder_friends&page=" + a)
    }
    function z() {
        _g("match&a=prepared"),
        $a()
    }
    function G(a) {
        return '<div class=MM-button><div class=left></div><div class="content">' + goldTxt(a) + "</div><div class=right></div></div>"
    }
    function U(a, t) {
        var n = $("<div>").addClass("MM-big-button MM-" + a + "-button");
        return null == t && (t = a),
        $("<div>").addClass("MM-big-button-header MM-" + t + "-header").appendTo(n),
        n
    }
    function W() {
        if ($("#MM-window").length > 0)
            return f.body.empty(),
            void $("#MM-window").find(".closebut").show();
        f.header = null,
        f.body = null;
        var a = $("<div>").attr("id", "MM-window").addClass("MM-dialog-container").appendTo("body")
          , t = ($("<div>").addClass("MM-dialog-header").appendTo(a),
        $("<div>").addClass("MM-dialog").appendTo(a))
          , n = $("<div>").addClass("MM-dialog-header-txt").appendTo(t)
          , i = $("<div>").addClass("closebut").appendTo(t)
          , e = $("<div>").addClass("MM-dialog-space").appendTo(t);
        i.attr("rollover", "22"),
        i.click((function() {
            V()
        }
        )),
        a.absCenter().fadeIn("fast"),
        g.lock.add("mmdialog"),
        f.header = n,
        f.body = e
    }
    function V() {
        $("#MM-window").remove(),
        g.lock.remove("mmdialog"),
        f.header = null,
        f.body = null
    }
    function j() {
        $("#MM-window").length > 0 && $("#MM-window").find(".closebut").hide()
    }
    function H(a) {
        return _t("time_in_queue %val", {
            "%val%": a
        }, "matchmaking")
    }
    function E(a) {
        var t = $("<tr>").addClass("MM-table-row")
          , n = 1;
        for (var i in a)
            $("<td>").addClass("MM-table-col MM-table-col-" + n).append(a[i]).appendTo(t),
            n++;
        return t
    }
    function Y() {
        var a = $("<div>").addClass("MM-dialog-timer").appendTo(f.body)
          , t = $("<div>").addClass("MM-dialog-timer-txt").appendTo(a);
        h.$element = t
    }
    function A(a, t, n, i) {
        null == a && (a = "");
        var e = $("<div>").addClass("MM-paginator " + a)
          , s = $("<div>").addClass("contxt")
          , d = $("<span>").addClass("txt").appendTo(s)
          , l = $("<input>").addClass("inptxt").appendTo(s)
          , o = $("<span>").addClass("txt2").appendTo(s);
        l.val(t),
        l.change((function() {
            var a = parseInt(l.val());
            a >= 1 && a <= n ? i(a) : l.val(t)
        }
        )),
        d.text(_t("page", null, "matchmaking")),
        o.text("/" + n);
        var r = $(G("<")).appendTo(e);
        s.appendTo(e);
        var c = $(G(">")).appendTo(e);
        r.click((function() {
            t <= 1 || i(t - 1)
        }
        )),
        c.click((function() {
            t >= n || i(t + 1)
        }
        )),
        e.appendTo(f.body)
    }
    function J() {
        return $('<div class="matchmaking-progress-stage"><div class="points-side"><div class="stage"></div><div class="ratio"></div></div><div class="bar-and-item-side"><div class="progress-bar"><div class="background-bar"></div></div><div class="items-wrapper"></div></div></div>')
    }
    function K(a) {
        if (function(a) {
            return /eterium/.test(a.name.toLowerCase())
        }(a)) {
            var t = isset(N(a).amount) ? parseInt(N(a).amount) : 1;
            p += t
        }
    }
    function N(a) {
        for (var t = a.stat.split(";"), n = {}, i = 0; i < t.length; i++) {
            var e = t[i].split("=");
            n[e[0]] = isset(e[1]) ? e[1] : null
        }
        return n
    }
    function X(a) {
        if (function(a) {
            return /y czempion/.test(a.name.toLowerCase())
        }(a)) {
            var t = isset(N(a).amount) ? parseInt(N(a).amount) : 1;
            u += t
        }
    }
    function N(a) {
        for (var t = a.stat.split(";"), n = {}, i = 0; i < t.length; i++) {
            var e = t[i].split("=");
            n[e[0]] = isset(e[1]) ? e[1] : null
        }
        return n
    }
    function Z(n) {
        !function(t) {
            if (isset(a))
                return;
            a = t
        }(n.big_reward_tpl),
        function(a) {
            if (isset(t))
                return;
            t = a
        }(n.small_reward_tpl)
    }
    function aa(a) {
        $("#MM-window").find(".progress-tpl-slot-id-" + a.id).each((function() {
            var t = a.$.clone();
            $(this).append(t),
            t.click((function() {
                ta(a, $(this).parent(), $(this))
            }
            ))
        }
        ))
    }
    function ta(a, t, n) {
        var i = [];
        isset(N(a).canpreview) && function(a, t) {
            var n = '_g("moveitem&st=2&tpl=' + a.id + '"); g.tplsManager.deleteMessItemsByLoc("p"); g.tplsManager.deleteMessItemsByLoc("s");';
            t.push([_t("show", null, "item"), n, !0])
        }(a, i),
        t && function(a, t) {
            var n = a.attr("reward_stage");
            if (null != n) {
                var i = '_g("match&a=profile&reward_stage=' + n + "&reward_idx=" + a.attr("reward_idx") + '");';
                t.push([_t("take_reward", null, "matchmaking"), i, !0])
            }
        }(t, i),
        0 != i.length && showMenu({
            target: n
        }, i)
    }
    function na(a) {
        var t = $('<div class="progress-wnd section"><div class="left-side"><div class="char-info"></div><div class="char-prof"></div><div class="outfit-wrapper"><div class="outfit-img"></div></div><div class="tokens-amount-1"></div><div class="progress-buttons-wrapper"><div class="details-btn"></div><div class="go-to-shop-btn"></div></div></div><div class="right-side"></div><div class="progress-bottom-panel"><div class="back-to-main"></div></div></div>');
        W(),
        ua(),
        t.appendTo(f.body),
        Z(a),
        function() {
            for (var a in p = 0,
            g.item)
                "g" == g.item[a].loc && K(g.item[a])
        }(),
        function() {
            for (var a in u = 0,
            g.item)
                "g" == g.item[a].loc && X(g.item[a])
        }();
        var n = $("<span>").addClass("green").html(_t("token_amount", null, "matchmaking"))
          , i = $("<span>").html(p)
          , e = $("<span>").addClass("red").html(_t("chempions_amount", null, "matchmaking"))
          , s = $("<span>").html(u)
          , l = $(G(_t("details", null, "matchmaking")))
          , o = $(G(_t("eterium-shop", null, "matchmaking")))
          , r = $(G(_t("champions-shop", null, "matchmaking")))
          , c = $(G(_t("back", null, "matchmaking"))).addClass();
        for (var m in t.find(".char-info").html(hero.nick),
        t.find(".char-prof").html(hero.lvl + hero.prof),
        t.find(".outfit-img").css("background-image", "url(" + hero.icon + ")"),
        t.find(".tokens-amount-1").empty().append(n),
        t.find(".tokens-amount-1").append(i),
        t.find(".tokens-amount-2").empty().append(e),
        t.find(".tokens-amount-2").append(s),
        t.find(".right-side").empty(),
        t.find(".details-btn").append(l),
        t.find(".go-to-shop-btn").append(o),
        t.find(".go-to-shop-btn").append(r),
        t.find(".back-to-main").append(c),
        l.click((function() {
            g.matchmaking.toggleDetailsWnd()
        }
        )),
        o.click((function() {
            V(),
            _g("creditshop&npc=472")
        }
        )),
        r.click((function() {
            V(),
            _g("creditshop&npc=471")
        }
        )),
        c.click(pa),
        a.daily_stages) {
            var v = a.daily_stages[m];
            sa(v.id, v.points_cur, v.points_max, v.rewards_max, v.rewards_cur, v.rewards_last)
        }
        d ? d = !1 : g.tplsManager.removeCallback("d", aa),
        g.tplsManager.fetch("d", aa),
        g.matchmakingTutorial.setTutorialById(1)
    }
    function ia(a) {
        if (a || (a = v),
        v || (v = a),
        0 != a.ladder_position && 0 != a.rewards.length) {
            var t = $('<div id="season-wrapper"><div class="your-place"></div><div class="txt-info-1 txt-info" data-trans="#txt-info-1#matchmaking"></div><div class="txt-info-2 txt-info" data-trans="#txt-info-2#matchmaking"></div><div class="your-reward-wrapper">\t\t<div class="your-reward"></div>\t\t<div class="your-outfits"></div></div><div class="take-in-next-time"></div><div class="take-reward-now"></div></div>');
            null == r && (r = a.ladder_position),
            g.matchmaking.show(),
            W();
            var n = $(G(_t("take_reward_in_next_time", null, "matchmaking")))
              , i = $(G(_t("take_rewards_now")));
            for (var e in t.find(".your-place").html(_t("your_place %place%", {
                "%place%": "#" + r
            }, "matchmaking")),
            t.find(".txt-info-1").html(_t("txt-info-1", null, "matchmaking")),
            t.find(".txt-info-2").html(_t("txt-info-2", null, "matchmaking")),
            t.find(".take-in-next-time").append(n),
            t.find(".take-reward-now").append(i),
            t.appendTo(f.body),
            n.click((function() {
                g.matchmaking.show()
            }
            )),
            i.click((function() {
                if (!$(this).hasClass("black")) {
                    var a = "match&a=season&reward_season=1";
                    _g(a += m ? "&outfit_idx=" + m : "", (function(a) {
                        isset(a.item) && (r = null,
                        g.matchmaking.show())
                    }
                    ))
                }
            }
            )),
            a.rewards) {
                var s = a.rewards[e]
                  , d = $("<div>").addClass("item-wrapper tpl-" + s[0]);
                d.attr("data-amount", s[1]),
                $("#season-wrapper").find(".your-reward").append(d)
            }
            o ? o = !1 : g.tplsManager.removeCallback("i", oa),
            g.tplsManager.fetch("i", oa),
            isset(a.outfit_one) && ($("#season-wrapper").find(".your-outfits").append(ea(a.outfit_one, "woman")),
            $("#season-wrapper").find(".your-outfits").append(ea(a.outfit_two, "man")),
            m = null,
            $("#season-wrapper").find(".active").removeClass("active"),
            $("#season-wrapper").find(".take-reward-now").find(".MM-button").addClass("black"))
        }
    }
    function ea(a, t) {
        var n = $("<div>").addClass("outfit-check-wrapper " + t)
          , i = $("<div>").addClass("outfit-wrapper")
          , e = $("<div>").addClass("one-checkbox")
          , s = $("<div>").html(_t(t)).addClass("label");
        return n.append(e),
        n.append(i),
        e.click((function() {
            self.wnd.$.find(".season-reward-main").find(".black").removeClass("black"),
            m = getOutfitIndex(t),
            $(this).hasClass("active") || ($(this).parent().parent().find(".active").removeClass("active"),
            $(this).parent().find(".outfit-wrapper").addClass("active"),
            $(this).parent().find(".checkbox").addClass("active"))
        }
        )),
        i.click((function() {
            $("#season-wrapper").find(".black").removeClass("black"),
            m = getOutfitIndex(t),
            $(this).hasClass("active") || ($(this).parent().parent().find(".active").removeClass("active"),
            $(this).parent().find(".outfit-wrapper").addClass("active"),
            $(this).parent().find(".checkbox").addClass("active"))
        }
        )),
        i.append(ca(a)),
        i.append(s),
        n
    }
    function sa(a, t, n, i, e, s) {
        var d = f.body.find(".progress-wnd")
          , l = J()
          , o = [!0];
        d.find(".right-side").append(l);
        var r = 250 / i
          , c = t / n * 250
          , p = l.find(".items-wrapper");
        l.find(".background-bar").css("width", c),
        l.find(".stage").html(_t("stage", null, "matchmaking") + " " + function(a) {
            switch (a) {
            case 0:
                return "I";
            case 1:
                return "II";
            case 2:
                return "III";
            case 3:
                return "IV";
            case 4:
                return "V";
            case 5:
                return "VI"
            }
        }(a)),
        l.find(".ratio").html(t + "/" + n);
        for (var u = 1; u < i + 1; u++) {
            var m = $("<div>").addClass("item-chest-slot")
              , v = u * r
              , g = $("<div>").addClass("item-chest-border");
            if (m.append(g),
            da(o, g, m, u, e, s, i, t, a),
            m.css("left", v),
            p.append(m),
            u != i) {
                var h = $("<div>").addClass("measure");
                h.css("left", v),
                p.append(h)
            }
        }
    }
    function da(n, i, e, s, d, l, o, r, c) {
        var p = ""
          , u = !1
          , m = !1
          , v = "unavailable-level"
          , f = t;
        l >= s && (p += "disabled",
        v = "disabled " + v,
        m = !0),
        0 == r && 0 == d && 0 == l && (p += "disabled",
        v = "disabled " + v,
        m = !0),
        !m && s <= d ? (p += " available-level",
        u = !0) : p += " unavailable-level",
        s == o && (p += "-last",
        v += "-last",
        f = a),
        0 == $("#MM-window").find(".first").length && u && !m && (p += " first",
        e.attr("reward_stage", c),
        e.attr("reward_idx", s - 1)),
        i.addClass(p),
        e.addClass(v),
        e.addClass("progress-tpl-slot-id-" + f)
    }
    function la(a) {
        $(".season-wnd").find(".tpl-" + a.id).each((function() {
            var t = a.$.clone()
              , n = $(this).attr("data-amount");
            if (n > 1) {
                var i = t.find(".amount");
                i.length < 1 && (i = $("<small>").css("opacity", .5).addClass("amount"),
                t.append(i)),
                i.html(n)
            }
            $(this).html(t);
            var e = N(a);
            isset(e.canpreview) && t.click((function() {
                var n = '_g("moveitem&st=2&tpl=' + a.id + '"); g.tplsManager.deleteMessItemsByLoc("p"); g.tplsManager.deleteMessItemsByLoc("s");';
                showMenu({
                    target: t
                }, [[_t("show", null, "item"), n, !0]])
            }
            ))
        }
        ))
    }
    function oa(a) {
        $("#season-wrapper").find(".tpl-" + a.id).each((function() {
            var t = a.$.clone()
              , n = $(this).attr("data-amount");
            if (n > 1) {
                var i = t.find(".amount");
                i.length < 1 && (i = $("<div>").css("opacity", .5).addClass("amount"),
                t.append(i)),
                i.html(n)
            }
            $(this).append(t),
            t.click((function() {
                ta(a, $(this).parent(), $(this))
            }
            ))
        }
        ))
    }
    function ra(a) {
        var t = $('<div class="season-wnd section">  <div class="season-reward-header"></div>\t <div class="reward-wrapper">    <div class="reward-graphic"></div>\t </div>  <div class="season-winners-header"></div>\t<div class="winners-background"></div>\t<div class="winners-wrapper">\t\t<div class="header-info"></div>\t\t<div class="txt-info"></div>\t\t<div class="players-in-ranking-info"></div>\t\t<div class="amount-players-got-outfit-info"></div>\t\t<div class="wrapper-outfit-info"></div> </div>  <div class="your-season-record"></div>  <div class="your-career-record"></div></div>');
        t.find(".season-winners-header").html(_t("last_season_winners", null, "matchmaking")),
        t.find(".season-reward-header").html(_t("rewards_of_season", null, "matchmaking")),
        t.find(".played-battle").html(_t("played-battle", null, "matchmaking") + "?/?"),
        t.find(".header-info").html(_t("season-header-info", null, "matchmaking")),
        t.find(".txt-info").html(_t("txt-info", null, "matchmaking")),
        t.find(".players-in-ranking-info").html(_t("players-in-ranking-info", null, "matchmaking") + "<span>" + a.players_cur + "/" + a.players_max + "</span>"),
        t.find(".amount-players-got-outfit-info").html(_t("amount-players-got-outfit-info", null, "matchmaking") + "<span>" + a.outfits_cur_count + "</span>"),
        t.find(".wrapper-outfit-info").append(ca(a.outfit_one)),
        t.find(".wrapper-outfit-info").append(ca(a.outfit_two)),
        t.find(".your-season-record").html(_t("your-season-record", null, "matchmaking") + ": " + a.rating_best_season + " PR"),
        t.find(".your-career-record").html(_t("your-career-record", null, "matchmaking") + ": " + a.rating_best_career + " PR"),
        W(),
        ua(),
        t.appendTo(f.body),
        ga(),
        $(".season-wnd").find(".item-wrapper").remove(),
        function(a) {
            for (var t in a.rewards) {
                for (var n = $("<div>").addClass("rage-wrapper"), i = $("<div>").html("#" + t).addClass("place place-" + t), e = 0; e < a.rewards[t].length; e++) {
                    var s = a.rewards[t][e]
                      , d = $("<div>").addClass("item-wrapper tpl-" + s[0]);
                    d.attr("data-amount", s[1]),
                    n.append(d)
                }
                n.prepend(i),
                $(".season-wnd").find(".reward-wrapper").append(n)
            }
            !function(a) {
                var t = $(".season-wnd");
                if (t.find("active").removeClass("active"),
                a <= 6)
                    return;
                t.find(".winners-background").addClass("active"),
                t.find(".winners-wrapper").addClass("active"),
                t.find(".season-winners-header").addClass("active"),
                t.find(".reward-wrapper").addClass("active")
            }(a.rewards.length)
        }(a),
        l ? l = !1 : g.tplsManager.removeCallback("r", la),
        g.tplsManager.fetch("r", la),
        g.matchmakingTutorial.setTutorialById(4)
    }
    function ca(a) {
        return $("<div>").addClass("season-outfit").css("background-image", "url(" + CFG.ppath + a + ")")
    }
    function pa() {
        W();
        var a = $("<div>").addClass("MM-button-bar").appendTo(f.body)
          , t = U("stat").appendTo(a)
          , i = U("fight").appendTo(a)
          , e = U("rank").appendTo(a)
          , s = $('<div class="completed-matches">\t\t<div class="MM-info-icon info-icon"></div>\t\t<div class="text"></div></div>')
          , d = $('<div class="warning-points">   <div class="text"></div>   <div class="MM-info-icon info-icon"></div></div>');
        s.attr("tip", _t("matches_point_desc")),
        d.attr("tip", _t("warning_point_desc")),
        d.appendTo(f.body),
        i.append(s);
        var l = $("<div>").addClass("my-checkbox").html(_t("dont_show", null, "matchmaking-tutorial"))
          , o = $("<div>").addClass("my-checkbox-wrapper").appendTo(f.body);
        if (o.append(l),
        o.click((function() {
            var a = $(this).find(".my-checkbox");
            a.toggleClass("active");
            var t = a.hasClass("active");
            margoStorage.set("MM_Tutorial/status", t)
        }
        )),
        t.click((function() {
            c = ".on-progress",
            D()
        }
        )),
        i.click(S),
        e.click((function() {
            c = ".on-global",
            L()
        }
        )),
        r) {
            var p = $(G(_t("take_reward", null, "matchmaking"))).addClass("take-reward");
            f.body.append(p),
            p.click((function() {
                ia()
            }
            ))
        }
        var u = 1 == n;
        if (i.toggleClass("MM-queue-button", u),
        i.toggleClass("MM-fight-button", !u),
        u) {
            var m = $("<div>").addClass("MM-dialog-average").appendTo(f.body);
            Y(),
            h.tipFunc = H,
            h.avgTimeFunc = function(a) {
                !function(a, t) {
                    var n = _(t)
                      , i = "~" + b(n.h, n.m, n.s, !0);
                    0 == t && (i = "-");
                    var e = _t("average_wait_time %val", {
                        "%val%": i
                    }, "matchmaking");
                    a.text(e)
                }(m, a)
            }
            ,
            null != h.avgTime && h.avgTimeFunc(h.avgTime),
            w()
        }
        if (_g("match&a=main"),
        g.matchmaking.isBlockedShowMatchmakingMenu())
            return V(),
            !1;
        $("#MM-window").absCenter(),
        g.matchmakingTutorial.initTutorialStateInMMWnd(),
        null == g.matchmaking.getOldSeasonData() && g.matchmakingTutorial.setTutorialById(0)
    }
    function ua() {
        var a = $(G("Profil"))
          , t = $(G(_t("yourstatistics", null, "matchmaking")))
          , n = $(G(_t("battlehistory", null, "matchmaking")))
          , i = $(G(_t("season", null, "matchmaking")));
        a.click((function() {
            c = ".on-progress",
            D()
        }
        )).addClass("on-progress MM-tab-button MM-tab-button-menu"),
        t.click((function() {
            c = ".on-statistics",
            Q()
        }
        )).addClass("on-statistics MM-tab-button MM-tab-button-menu"),
        n.click((function() {
            c = ".on-history",
            R()
        }
        )).addClass("on-history MM-tab-button MM-tab-button-menu"),
        i.click((function() {
            c = ".on-season",
            _g("match&a=season")
        }
        )).addClass("on-season MM-tab-button MM-tab-button-menu"),
        a.appendTo(f.body),
        t.appendTo(f.body),
        n.appendTo(f.body),
        i.appendTo(f.body),
        ma()
    }
    function ma() {
        c && (f.body.find(".MM-ranking-buttons").removeClass("active"),
        f.body.find(c).addClass("active"))
    }
    function va() {
        var a = $(G(_t("general", null, "matchmaking")))
          , t = $(G(_t("clan", null, "matchmaking")))
          , n = $(G(_t("friends", null, "matchmaking")));
        a.click((function() {
            c = ".on-global",
            L()
        }
        )).addClass("on-global MM-tab-button MM-tab-button-menu MM-ranking-buttons"),
        t.click((function() {
            if (!isset(hero.clan))
                return c = ".on-clan",
                W(),
                va(),
                $("<div>").html(_t("clan_not_exist")).addClass("info-text").appendTo(f.body),
                void ga();
            c = ".on-clan",
            O()
        }
        )).addClass("on-clan MM-tab-button MM-tab-button-menu MM-ranking-buttons"),
        n.click((function() {
            c = ".on-friends",
            P()
        }
        )).addClass("on-friends MM-tab-button MM-tab-button-menu MM-ranking-buttons"),
        a.appendTo(f.body),
        t.appendTo(f.body),
        n.appendTo(f.body),
        ma()
    }
    function fa() {
        var a = $("<div>").addClass("MM-info-icon-cont");
        return $("<div>").addClass("MM-info-icon").appendTo(a),
        a
    }
    function ga() {
        var a = G(_t("back", null, "matchmaking"));
        $(a).addClass("MM-back-button").click(pa).appendTo(f.body),
        $("#MM-window").absCenter()
    }
    function ha(a, t) {
        a.click((function() {
            Q(t)
        }
        ))
    }
    function Ma(a) {
        W();
        var t, n = function(a) {
            ua();
            var t = $("<table>").addClass("MM-table MM-table-statistics")
              , n = $("<span>").text(a)
              , i = $("<span>").text("M")
              , e = $("<span>").text(_t("pr %val", {
                "%val%": ""
            }, "matchmaking"))
              , s = $("<span>").text(_t("pw %val", {
                "%val%": ""
            }, "matchmaking"))
              , d = $("<span>").text(_t("wins_losse_draws", null, "matchmaking"))
              , l = E([n, i, e, s, d])
              , o = _t("ranking_place", null, "matchmaking");
            i.parent().attr("tip", o);
            var r = _t("pr_tip", null, "matchmaking");
            e.parent().attr("tip", r);
            var c = _t("pw_tip", null, "matchmaking");
            s.parent().attr("tip", c);
            var p = _t("wpr_tip", null, "matchmaking");
            return d.parent().attr("tip", p),
            fa().prependTo(i.parent()),
            fa().prependTo(e.parent()),
            fa().prependTo(s.parent()),
            fa().prependTo(d.parent()),
            $("<div>").addClass("MM-table-container").append(t).appendTo(f.body),
            l.addClass("MM-table-header"),
            l.appendTo(t),
            {
                table: t,
                dane: n,
                place: i,
                pr: e,
                pw: s,
                stat: d
            }
        }(_t("chardata", null, "matchmaking")), i = 0, e = 0, s = 0, d = 0, l = 0;
        for (var o in a) {
            var r, c = a[o].playerId, p = $("<div>").addClass("MM-statistics-dane-place"), u = $("<div>").addClass("MM-statistics-dane"), m = $("<span>").addClass("MM-statistics-value"), v = $("<span>").addClass("MM-statistics-value"), h = $("<span>").addClass("MM-statistics-value"), M = $("<div>").addClass("MM-statistics-icon"), _ = $("<span>").addClass("MM-statistics-value MM-statistics-nick"), b = $("<span>").addClass("MM-statistics-lvl");
            M.css("background-image", 'url("' + CFG.opath + a[o].icon + '")').appendTo(u),
            c == hero.id && (t = void 0,
            t = $("<div>").addClass("MM-active-icon-cont"),
            $("<div>").addClass("MM-active-icon").appendTo(t),
            t).appendTo(u),
            _.text(o).appendTo(u),
            b.text("[" + a[o].lvl + a[o].prof + "]").appendTo(u),
            p.text(a[o].ladder_pos),
            m.text(a[o].rating),
            v.text(a[o].wins_ratio + "%"),
            h.text(a[o].wins + "/" + a[o].losses + "/" + a[o].draws),
            0 != a[o].status && (e += a[o].wins_ratio,
            s += a[o].wins,
            d += a[o].losses,
            l += a[o].draws,
            i++);
            var k = _t("in_classification %val%", {
                "%val%": a[o].placement_cur + "/" + a[o].placement_max
            }, "matchmaking");
            0 != a[o].status ? r = E([u, p, m, v, h]) : (r = E([u, k])).children().last().attr("colspan", 4),
            r.addClass("MM-statistics-row"),
            ha(r, c),
            r.appendTo(n.table)
        }
        var w = 0 == i ? 0 : Math.round(e / i * 100) / 100;
        n.pw.append($("<div>").addClass("MM-statistics-value").text(w + "%")),
        n.stat.append($("<div>").addClass("MM-statistics-value").text(s + "/" + d + "/" + l)),
        $("<div>").addClass("MM-statistics-info").html(_t("statisticsinfo_tip", null, "matchmaking")).appendTo(f.body),
        ga(),
        g.matchmakingTutorial.setTutorialById(2)
    }
    function _a(a) {
        W();
        var t = function(a) {
            ua();
            var t = $("<table>").addClass("MM-table MM-table-statistics")
              , n = $("<span>").text(a)
              , i = $("<span>").text(_t("pr %val", {
                "%val%": ""
            }, "matchmaking"))
              , e = $("<span>").text(_t("pw %val", {
                "%val%": ""
            }, "matchmaking"))
              , s = $("<span>").text(_t("wins_losse_draws", null, "matchmaking"))
              , d = E([n, i, e, s])
              , l = _t("pr_tip", null, "matchmaking");
            i.parent().attr("tip", l);
            var o = _t("pw_tip", null, "matchmaking");
            e.parent().attr("tip", o);
            var r = _t("wpr_tip", null, "matchmaking");
            return s.parent().attr("tip", r),
            fa().prependTo(i.parent()),
            fa().prependTo(e.parent()),
            fa().prependTo(s.parent()),
            $("<div>").addClass("MM-table-container").append(t).appendTo(f.body),
            d.addClass("MM-table-header"),
            d.appendTo(t),
            {
                table: t,
                dane: n,
                pr: i,
                pw: e,
                stat: s
            }
        }(_t("classopponents", null, "matchmaking"));
        for (var n in t.table.addClass("MM-table-statistics-detailed"),
        t.pw.append($("<div>").addClass("MM-statistics-value").text(a.all.wins_ratio + "%")),
        t.stat.append($("<div>").addClass("MM-statistics-value").text(a.all.wins + "/" + a.all.losses + "/" + a.all.draws)),
        a)
            if ("all" != n) {
                var i = $("<span>").addClass("MM-statistics-value")
                  , e = $("<span>").addClass("MM-statistics-value")
                  , s = $("<span>").addClass("MM-statistics-value")
                  , d = $("<span>").addClass("MM-statistics-value");
                $("<div>").addClass("MM-statistics-icon"),
                $("<span>").addClass("MM-statistics-value"),
                $("<span>").addClass("MM-statistics-lvl");
                i.text(_t(y(n), null, "eq_prof")),
                e.text(mp(a[n].rating)),
                s.text(a[n].wins_ratio + "%"),
                d.text(a[n].wins + "/" + a[n].losses + "/" + a[n].draws),
                E([i, e, s, d]).appendTo(t.table)
            }
        var l = G(_t("back", null, "matchmaking"));
        $(l).addClass("MM-back-button").click((function() {
            Q()
        }
        )).appendTo(f.body),
        $("#MM-window").absCenter()
    }
    function ba(a) {
        W(),
        ua();
        var t = $("<table>").addClass("MM-table MM-table-history")
          , n = $("<span>").text(_t("result", null, "matchmaking"))
          , i = $("<span>").text(_t("prof-and-lvl", null, "matchmaking"))
          , e = $("<span>").text(_t("pr %val", {
            "%val%": ""
        }, "matchmaking"))
          , s = E([n, i, e, $("<span>").text(_t("fight-length", null, "matchmaking")), $("<span>").text(_t("time", null, "matchmaking")), $("<span>").text(_t("date", null, "matchmaking"))])
          , d = _t("pr_tip", null, "matchmaking");
        e.parent().attr("tip", d),
        fa().prependTo(e.parent());
        var l, o, r, c = null, p = 0, u = null;
        for (var m in s.addClass("MM-table-header"),
        s.appendTo(t),
        a.positions) {
            var v = a.positions[m]
              , h = $("<span>")
              , M = $("<span>")
              , _ = $("<span>")
              , b = $("<span>")
              , k = $("<span>")
              , w = (l = v.start_ts,
            o = void 0,
            r = void 0,
            o = new Date(1e3 * l),
            r = o.getFullYear(),
            _t("date %d %m %y", {
                "%d%": o.getDate(),
                "%m%": o.getMonth() + 1,
                "%y%": r
            }, "matchmaking"))
              , C = [h, M, _, b, k]
              , I = !1;
            if (w != c) {
                var F = $("<span>");
                F.text(w),
                c = w,
                C.push(F),
                p = 1,
                I = !0
            } else
                null != u && p > 0 && (p++,
                u.attr("rowspan", p));
            var B = x(v.result);
            h.text(_t(B, null, "matchmaking")),
            h.addClass("MM-hi-" + B);
            var q = _t("prof-lvl %prof %lvl", {
                "%prof%": _t(y(v.opponent_prof), null, "eq_prof"),
                "%lvl%": v.opponent_lvl
            }, "matchmaking");
            M.text(q),
            _.text(mp(v.rating_delta)),
            b.text(T(v.end_ts, v.start_ts)),
            k.text(ut_time_ns(v.start_ts));
            var S = E(C);
            I && (u = S.find("td").eq(5)),
            S.appendTo(t)
        }
        $("<div>").addClass("MM-table-container").append(t).appendTo(f.body),
        A("MM-history-page", a.cur_page, a.max_page, R),
        ga(),
        g.matchmakingTutorial.setTutorialById(3)
    }
    function ka(a, t, n, i) {
        var e = U("eq", "eq-" + a)
          , s = $("<div>").addClass("MM-eq-container");
        s.appendTo(e);
        var d = $("<div>").addClass("MM-um-set");
        d.appendTo(s);
        var l = t.skill_set;
        d.addClass("MM-um-set-" + l);
        for (var o = t.items, r = 0; r < 8; r++)
            I(o[r], r + 1, s);
        return e.click((function() {
            _g("match&a=battleset&ans=" + a)
        }
        )),
        e
    }
    function $a() {
        W(),
        j();
        var a = $("<div>").appendTo(f.body);
        a.addClass("MM-wating-container");
        var t = _t("waiting_msg", null, "matchmaking")
          , n = $("<div>").text(t).appendTo(a);
        n.addClass("MM-wating-txt"),
        function a() {
            n.animate({
                opacity: 1
            }, 400).delay(300).animate({
                opacity: .2
            }, 300, (function() {
                a()
            }
            ))
        }()
    }
    function wa(a) {
        W(),
        j();
        var t = a.selected_battle_set - 1
          , i = 1
          , e = [];
        for (var s in a.battle_sets) {
            var d = ka(i, a.battle_sets[s]);
            i++,
            e.push(d),
            f.body.append(d)
        }
        e[t].addClass("selected"),
        h.endTime = unix_time() + a.time_left,
        Y(),
        C();
        var l = $("<div>").addClass("MM-versus").appendTo(f.body)
          , o = $("<div>").addClass("MM-prepare-icon MM-prepare-icon-you");
        o.css("background-image", 'url("' + hero.icon + '")'),
        o.appendTo(l);
        var r = $("<div>").addClass("MM-prepare-info MM-prepare-info-you")
          , c = _t("prepare-info", {
            "%prof%": _t("you", null, "matchmaking"),
            "%lvl%": hero.lvl,
            "%pr%": a.rating
        }, "matchmaking");
        r.html(c),
        r.appendTo(l);
        var p = $("<div>").addClass("MM-prepare-icon MM-prepare-icon-opp");
        p.css("background-image", 'url("/obrazki/postacie/' + a.opponent_icon + '")'),
        p.appendTo(l);
        var u = $("<div>").addClass("MM-prepare-info MM-prepare-info-opp")
          , m = _t("prepare-info", {
            "%prof%": _t(y(a.opponent_prof), null, "eq_prof"),
            "%lvl%": a.opponent_lvl,
            "%pr%": a.opponent_rating
        }, "matchmaking");
        u.html(m),
        u.appendTo(l),
        $("<div>").addClass("MM-big-button-header MM-vs-header").appendTo(l);
        var v = $(G(_t("fight2", null, "matchmaking")));
        if (v.click(z).addClass("MM-go-fight-button"),
        v.appendTo(l),
        $("#MM-window").absCenter(),
        4 == n) {
            $("#MM-window").find(".MM-go-fight-button").addClass("disable"),
            $("#MM-window").find(".MM-eq-button").each((function() {
                $(this).hasClass("selected") ? $(this).addClass("chosen-tile") : $(this).addClass("disabled-tile")
            }
            ));
            var g = $("<div>").addClass("blink-wait-label");
            g.html(_t("wait-for-label", null, "matchmaking")),
            g.appendTo(f.body)
        }
    }
    function Ca(a) {
        var t, n = a.data, i = a.kind;
        if (W(),
        va(),
        "friends" == i && 0 == lengthObject(n.positions))
            return $("<div>").html(_t("friend_not_exist")).addClass("info-text").appendTo(f.body),
            void ga();
        var e = $("<table>").addClass("MM-table MM-table-ladder")
          , s = $("<span>").text(_t("lp", null, "matchmaking"))
          , d = $("<span>").text(_t("playernick", null, "matchmaking"))
          , l = $("<span>").text(_t("profandlevel", null, "matchmaking"))
          , o = $("<span>").text(_t("pr %val", {
            "%val%": ""
        }, "matchmaking"))
          , r = $("<span>").text(_t("pw %val", {
            "%val%": ""
        }, "matchmaking"))
          , c = $("<span>").text(_t("wins_losse_draws", null, "matchmaking"))
          , p = E([s, d, l, o, r, c])
          , u = _t("pr_tip", null, "matchmaking");
        o.parent().attr("tip", u);
        var m = _t("pw_tip", null, "matchmaking");
        r.parent().attr("tip", m);
        var v = _t("wpr_tip", null, "matchmaking");
        for (var h in c.parent().attr("tip", v),
        fa().prependTo(o.parent()),
        fa().prependTo(r.parent()),
        fa().prependTo(c.parent()),
        p.addClass("MM-table-header"),
        p.appendTo(e),
        n.positions) {
            a = n.positions[h];
            var M = $("<span>").text(h + ".")
              , _ = $("<div>").text(a.nick)
              , b = " " == a.prof ? "" : _t(y(a.prof), null, "eq_prof");
            a.nick == hero.nick && _.addClass("MM-your-nick"),
            _.attr("tip", a.nick);
            var k = _t("prof-lvl %prof %lvl", {
                "%prof%": b,
                "%lvl%": a.lvl
            }, "matchmaking")
              , w = E([M, _, $("<span>").text(k), $("<span>").text(a.rating), $("<span>").text(a.wins_ratio + "%"), $("<span>").text(a.wins + "/" + a.losses + "/" + a.draws)]);
            Ta(w, a.ikona),
            w.appendTo(e)
        }
        switch ($("<div>").addClass("MM-tab").appendTo(f.body),
        $("<div>").addClass("MM-table-container").append(e).appendTo(f.body),
        i) {
        case "global":
            t = L,
            g.matchmakingTutorial.setTutorialById(5);
            break;
        case "clan":
            t = O,
            g.matchmakingTutorial.setTutorialById(6);
            break;
        case "friends":
            t = P,
            g.matchmakingTutorial.setTutorialById(7)
        }
        A("MM-ranking-page", n.cur_page, n.max_page, t),
        ga()
    }
    function Ta(a, t) {
        var n = CFG.opath + t;
        a.addClass("MM-statistics-row");
        var i = '<div class="outfit-tip" style=background-image:url("' + n + '")></div>';
        a.addClass("hover-tr"),
        a.attr("tip", i)
    }
    return this.getOldSeasonData = function() {
        return v
    }
    ,
    getOutfitIndex = function(a) {
        switch (a) {
        case "woman":
            return 1;
        case "man":
            return 2
        }
    }
    ,
    this.changeState = function(a) {
        var t, e = !1;
        switch (n != a && (e = !0),
        n = a,
        e && (n > 1 && function() {
            "none" != $("#dlgwin").css("display") && (M.push($("#dlgwin")),
            $("#dlgwin").hide()),
            "none" != $("#config").css("display") && (M.push($("#config")),
            $("#config").hide());
            var a = $("#centerbox").children()
              , t = !1;
            a.each((function() {
                t && $(this).attr("id") && "none" != $(this).css("display") && "chat" != $(this).attr("id") && (M.push($(this)),
                $(this).hide()),
                "battle" == $(this).attr("id") && (t = !0)
            }
            ))
        }(),
        B(),
        F(),
        null != i && (clearInterval(i),
        i = null),
        h.onUpdate = null,
        $("#MM-in-queue-icon").remove()),
        a) {
        case 0:
            e && null != f.body && pa(),
            F(),
            function() {
                for (var a in M)
                    M[a].show();
                M = []
            }();
            break;
        case 1:
            e && (F(),
            t = $("<div>").attr("id", "MM-in-queue-icon"),
            h.onUpdate = function(a, n) {
                var i = _t("time_in_queue %val", {
                    "%val%": a
                }, "matchmaking");
                i += "<br>",
                i += _t("average_wait_time %val", {
                    "%val%": "<br>" + n
                }, "matchmaking"),
                t.attr("tip", i)
            }
            ,
            t.appendTo("#centerbox"),
            w(),
            h.avgTime = null,
            null != f.body && pa(),
            null == i && (i = setInterval(w, 1e3)));
            break;
        case 2:
            e && (V(),
            q(),
            null == i && (i = setInterval(C, 1e3)));
            break;
        case 3:
        case 4:
            e && (V(),
            null == i && (i = setInterval(C, 1e3)));
            break;
        case 5:
            e && V()
        }
    }
    ,
    this.changeSearch = function(a) {
        h.startTime = unix_time() - a.since,
        h.avgTime = a.avg_duration,
        null != h.avgTimeFunc && h.avgTimeFunc(h.avgTime),
        w()
    }
    ,
    this.onConfirmation = function(a) {
        h.endTime = unix_time() + a.time_left,
        C(),
        1 == a.accept && (B(),
        F(),
        $a())
    }
    ,
    this.onProgress = function(a) {
        g.init >= 5 ? na(a) : g.loadQueue.push({
            fun: na,
            data: a
        })
    }
    ,
    this.onMatchmakingSeasonPosition = function(a) {
        g.init >= 5 ? ia(a) : g.loadQueue.push({
            fun: ia,
            data: a
        })
    }
    ,
    this.onSeason = function(a) {
        g.init >= 5 ? ra(a) : g.loadQueue.push({
            fun: ra,
            data: a
        })
    }
    ,
    this.onPreparation = function(a) {
        g.init >= 5 ? wa(a) : g.loadQueue.push({
            fun: wa,
            data: a
        })
    }
    ,
    this.onStatistics = function(a) {
        g.init >= 5 ? Ma(a) : g.loadQueue.push({
            fun: wa,
            data: a
        })
    }
    ,
    this.onStatisticsDetailed = function(a) {
        g.init >= 5 ? _a(a) : g.loadQueue.push({
            fun: _a,
            data: a
        })
    }
    ,
    this.onMain = function(a) {
        var t, n;
        t = a.warnings_cur,
        n = a.warnings_max,
        $("#MM-window").find(".warning-points").find(".text").html(_t("warning_points") + ": " + t + "/" + n),
        function(a, t) {
            var n = a >= t ? t : a;
            $("#MM-window").find(".completed-matches").find(".text").html(n + "/" + t),
            $("#MM-window").find(".completed-matches").css("display", 0 == t ? "none" : "block")
        }(a.matches_cur, a.matches_min)
    }
    ,
    this.onHistory = function(a) {
        g.init >= 5 ? ba(a) : g.loadQueue.push({
            fun: ba,
            data: a
        })
    }
    ,
    this.onGeneralRanking = function(a, t) {
        g.init >= 5 ? Ca({
            data: a,
            kind: t
        }) : g.loadQueue.push({
            fun: Ca,
            data: {
                obj: a,
                kind: t
            }
        })
    }
    ,
    this.onClanRanking = function(a) {
        g.init >= 5 ? updateDialogClanRanking(a) : g.loadQueue.push({
            fun: updateDialogClanRanking,
            data: a
        })
    }
    ,
    this.onFriendsRanking = function(a) {
        g.init >= 5 ? updateDialogFriendsRanking(a) : g.loadQueue.push({
            fun: updateDialogFriendsRanking,
            data: a
        })
    }
    ,
    this.isBlockedShowMatchmakingMenu = function() {
        return 0 != g.trade.id
    }
    ,
    this.canToggleMatchmaking = function() {
        return !($("#MM-window").find(".MM-versus").length > 0 || $("#MM-window").find(".MM-wating-container").length > 0)
    }
    ,
    this.show = function() {
        this.canToggleMatchmaking() && (W(),
        pa())
    }
    ,
    this.toggleDetailsWnd = function() {
        var a = $("#match-details-wnd")
          , t = "block" == a.css("display");
        a.css("display", t ? "none" : "block")
    }
    ,
    this.getprogressBarTpl = function() {
        return J()
    }
    ,
    this
}
function BattleSets() {
    var a, t = this, n = [];
    function i(a) {
        var n = $("<div>");
        return n.addClass("MM-battleset-switch-button MM-battleset-switch-button-" + a),
        n.click((function() {
            t.change(a)
        }
        )),
        n
    }
    return this.change = function(a) {
        _g("moveitem&set=" + a, (function() {
            $("#skills").is(":visible") && g.skills.show()
        }
        ))
    }
    ,
    this.update = function(a) {
        for (var t in n)
            n[t].removeClass("MM-battleset-switch-button-selected");
        n[a - 1].addClass("MM-battleset-switch-button-selected")
    }
    ,
    (a = $("<div>").appendTo("#panel")).addClass("MM-battleset-switch"),
    n.push(i(1).appendTo(a)),
    n.push(i(2).appendTo(a)),
    n.push(i(3).appendTo(a)),
    this
}
function matchmakingSummary() {
    var t, a, i, s = this, e = !0;
    this.init = function() {
        this.initWindow(),
        this.initNextFightButton(),
        this.initCloseButton(),
        this.setShow(!1)
    }
    ,
    this.newBattleSummaryItem = function(t) {
        $("#matchmaking-summary").find(".progress-tpl-slot-id-" + t.id).each((function() {
            var a = t.$.clone();
            $(this).append(a),
            a.click((function() {
                !function(t, a, i) {
                    var s = [];
                    isset(function(t) {
                        for (var a = t.stat.split(";"), i = {}, s = 0; s < a.length; s++) {
                            var e = a[s].split("=");
                            i[e[0]] = isset(e[1]) ? e[1] : null
                        }
                        return i
                    }(t).canpreview) && function(t, a) {
                        var i = '_g("moveitem&st=2&tpl=' + t.id + '"); g.tplsManager.deleteMessItemsByLoc("p"); g.tplsManager.deleteMessItemsByLoc("s");';
                        a.push([_t("show", null, "item"), i, !0])
                    }(t, s);
                    a && function(t, a) {
                        var i = t.attr("reward_stage");
                        if (null == i)
                            return;
                        var s = t.attr("reward_idx")
                          , e = '_g("match&a=summary&reward_stage=' + i + "&reward_idx=" + s + '");';
                        a.push([_t("take_reward", null, "matchmaking"), e, !0])
                    }(a, s);
                    if (0 == s.length)
                        return;
                    showMenu({
                        target: i
                    }, s)
                }(t, $(this).parent(), $(this))
            }
            ))
        }
        ))
    }
    ,
    this.getMatchmakingSummaryHtml = function() {
        return $('<div id="matchmaking-summary">\t <div class="header-text"></div>\t <div class="summary-content">\t\t <div class="classification-match wood-bar">\t\t\t\t<div class="classification-match-val wood-bar-val"></div>\t\t </div>\t\t <div class="difficult-stars wood-bar">\t\t\t\t<div class="difficult-stars-val wood-bar-val">\t\t\t\t\t<div class="text" data-trans="#fight_dificult"></div>\t\t\t\t\t<div class="stars-wrapper"></div>\t\t\t\t</div>\t\t </div>\t\t <div id="result-panel">\t\t\t <div class="your-side">\t\t\t\t <div class="your-result"></div>\t\t\t\t <div class="your-name-and-level"></div>\t\t\t\t <div class="your-prof"></div>\t\t\t\t <div class="your-pr"></div>\t\t\t </div>\t\t\t <div class="middle-side">\t\t\t\t <div class="middle-wrapper">\t\t\t\t\t <div class="avatars-info-wrapper">\t\t\t\t\t\t <div class="your-outfit-wrapper">\t\t\t\t\t\t\t <div class="out-icon"></div>\t\t\t\t\t\t </div>\t\t\t\t\t\t <div class="vs-img-wrapper">\t\t\t\t\t\t\t <div class="vs-img"></div>\t\t\t\t\t\t </div>\t\t\t\t\t\t <div class="enemy-outfit-wrapper">\t\t\t\t\t\t\t <div class="out-icon"></div>\t\t\t\t\t\t </div>\t\t\t\t\t </div>\t\t\t\t </div>\t\t\t\t <div class="pr-change"></div>\t\t\t\t <div class="arrow"></div>\t\t\t </div>\t\t\t <div class="enemy-side">\t\t\t\t <div class="enemy-result"></div>\t\t\t\t <div class="enemy-name-and-level"></div>\t\t\t\t <div class="enemy-prof"></div>\t\t\t\t <div class="enemy-pr"></div>      </div>\t\t </div>\t\t <div class="progress-points wood-bar">\t\t\t\t<div class="progress-points-val wood-bar-val"></div>\t\t </div>    <div class="current-stage"></div>    <div class="price-info"></div>  </div>  <div class="bottom-panel-graphics">\t </div></div>')
    }
    ,
    this.initWindow = function() {
        (t = s.getMatchmakingSummaryHtml()).find(".header-text").html(_t("mass_summary", null, "auction")),
        $("body").append(t)
    }
    ,
    this.initCloseButton = function() {
        createMMButton(_t("close"), t.find(".bottom-panel-graphics"), (function() {
            s.setShow(!1)
        }
        ))
    }
    ,
    this.initNextFightButton = function() {
        createMMButton(_t("next_fight"), t.find(".bottom-panel-graphics"), (function() {
            s.setShow(!1),
            _g("fight&a=nextmatch")
        }
        ))
    }
    ,
    this.setShow = function(a) {
        t.css("display", a ? "block" : "none")
    }
    ,
    this.simulate = function() {
        this.updateSummary({
            big_reward_tpl: {
                cl: 15,
                icon: "sur/kam07.gif",
                loc: "t",
                name: "Eterium",
                pr: 1,
                st: 0,
                stat: "nodepo;capacity=100;soulbound;unique",
                tpl: 23944
            },
            daily_stage: {
                id: 0,
                points_cur: 8,
                points_max: 12,
                points_step: 4,
                rewards_last: 0,
                rewards_cur: 0,
                rewards_max: 3
            },
            small_reward_tpl: {
                cl: 16,
                icon: "zlo/skrzynia.gif",
                loc: "t",
                name: "Skrzynia z niespodziankï¿½",
                pr: 0,
                st: 0,
                stat: "lootbox2=1111;soulbound",
                tpl: 23806
            },
            opponent_icon: "/paid/bdm02.gif",
            opponent_lvl: 150,
            opponent_prof: "w",
            opponent_rating: 1295,
            points_gained: 2,
            rating: 1505,
            rating_delta: 5,
            result: 0,
            shop_id: 472
        })
    }
    ,
    this.updateSummary = function(t) {
        this.setShow(!0),
        this.createRewardItems(t);
        var a = {
            result: s.getResult(t.result),
            name: hero.nick,
            lvl: hero.lvl,
            prof: hero.prof,
            pr: t.rating,
            icon: hero.img
        }
          , i = {
            result: s.getResult(t.result, !0),
            name: s.tLang("opponent"),
            lvl: t.opponent_lvl,
            prof: t.opponent_prof,
            pr: t.opponent_rating,
            icon: t.opponent_icon
        };
        s.updateGreenHeader(a.result),
        s.updateOutfit("your", a),
        s.updateOutfit("enemy", i),
        s.updateStars(t.difficulty_rank),
        s.updateClassificationMatch(t.placement_cur, t.placement_max),
        s.setArrow(a.result),
        s.setChangePr(a.result, t.rating_delta),
        s.setProgressPoints(t.points_gained);
        var n = t.daily_stage;
        s.setMachmakingProgressStage(n.id, n.points_cur, n.points_max, n.rewards_max, n.rewards_cur, n.rewards_last),
        e ? e = !1 : g.tplsManager.removeCallback("d", s.newBattleSummaryItem),
        g.tplsManager.fetch("d", s.newBattleSummaryItem)
    }
    ,
    this.updateStars = function(a) {
        t.find(".difficult-stars-val").find(".text").html(_t("fight_dificult"));
        var i = t.find(".difficult-stars-val").find(".stars-wrapper");
        i.empty();
        for (var s = 1; s < 11; s += 2) {
            var e = $("<div>").addClass("star");
            s < a + 1 ? s == a && s % 2 && e.addClass("half-star") : e.addClass("empty-star"),
            i.append(e)
        }
    }
    ,
    this.updateClassificationMatch = function(a, i) {
        var s = t.find(".classification-match-val")
          , e = t.find(".difficult-stars");
        a >= i ? (s.css("display", "none"),
        e.css({
            "margin-top": "15px",
            "margin-bottom": "12px"
        })) : (s.css("display", "block"),
        e.css({
            "margin-top": "8px",
            "margin-bottom": "0px"
        })),
        t.find(".classification-match-val").html(_t("classification_match") + " " + a + "/" + i)
    }
    ,
    this.getResult = function(t, a) {
        var i;
        switch (t) {
        case 1:
            i = a ? "win" : "lose";
            break;
        case 0:
            i = a ? "lose" : "win";
            break;
        case 2:
            i = "draw"
        }
        return i
    }
    ,
    this.createBigRewardTpl = function(t) {
        isset(a) || (a = t)
    }
    ,
    this.createSmallRewardTpl = function(t) {
        isset(i) || (i = t)
    }
    ,
    this.createRewardItems = function(t) {
        s.createBigRewardTpl(t.big_reward_tpl),
        s.createSmallRewardTpl(t.small_reward_tpl)
    }
    ,
    this.getRomeVal = function(t) {
        switch (t) {
        case 0:
            return "I";
        case 1:
            return "II";
        case 2:
            return "III";
        case 3:
            return "IV";
        case 4:
            return "V";
        case 5:
            return "VI"
        }
    }
    ,
    this.setMachmakingProgressStage = function(a, i, e, n, r, d) {
        var l = g.matchmaking.getprogressBarTpl()
          , o = [!0];
        t.find(".current-stage").empty().append(l),
        s.setTokenAmounts();
        var c = 250 / n
          , p = i / e * 250
          , u = l.find(".items-wrapper");
        l.find(".background-bar").css("width", p),
        l.find(".stage").html(s.tLang("stage") + " " + s.getRomeVal(a)),
        l.find(".ratio").html(i + "/" + e);
        for (var m = 1; m < n + 1; m++) {
            var v = $("<div>").addClass("item-chest-slot")
              , f = m * c
              , h = $("<div>").addClass("item-chest-border");
            if (v.append(h),
            s.appendPriceItemToSlot(o, h, v, m, r, d, n, i, a),
            v.css("left", f),
            u.append(v),
            m != n) {
                var _ = $("<div>").addClass("measure");
                _.css("left", f),
                u.append(_)
            }
        }
    }
    ,
    this.appendPriceItemToSlot = function(t, s, e, n, r, d, l, o, c) {
        var p = ""
          , u = !1
          , m = !1
          , v = "unavailable-level"
          , f = i;
        d >= n && (p += "disabled",
        v = "disabled " + v,
        m = !0),
        0 == o && 0 == r && 0 == d && (p += "disabled",
        v = "disabled " + v,
        m = !0),
        !m && n <= r ? (p += " available-level",
        u = !0) : p += " unavailable-level",
        n == l && (p += "-last",
        v += "-last",
        f = a),
        0 == $("#matchmaking-summary").find(".first").length && u && !m && (p += " first",
        e.attr("reward_stage", c),
        e.attr("reward_idx", n - 1)),
        s.addClass(p),
        e.addClass(v),
        e.addClass("progress-tpl-slot-id-" + f)
    }
    ,
    this.setProgressPoints = function(a) {
        t.find(".progress-points-val").html(_t("got_points", {
            "%val%": a
        }, "matchmaking"))
    }
    ,
    this.setTokenAmounts = function() {
        var a = $("<span>").addClass("green").html(s.tLang("token_amount"))
          , i = $("<span>").html(6);
        t.find(".tokens-amount").empty(),
        t.find(".tokens-amount").append(a),
        t.find(".tokens-amount").append(i)
    }
    ,
    this.setChangePr = function(a, i) {
        t.find(".pr-change").html(i + " PR").removeClass("win lose").addClass(a)
    }
    ,
    this.setArrow = function(a) {
        t.find(".arrow").removeClass("win lose").addClass(a)
    }
    ,
    this.updateGreenHeader = function(a) {
        var i = "win" == a ? "battle_banner_win_header" : "battle_banner_lose_header";
        t.find(".edit-header-label").html(_t(i, null, "battle"))
    }
    ,
    this.updateOutfit = function(a, i) {
        var s = t.find("." + a + "-side")
          , e = CFG.opath + i.icon;
        s.find("." + a + "-result").html(_t(i.result + "_p", null, "matchmaking")).removeClass("win lose").addClass(i.result),
        s.find("." + a + "-name-and-level").html(i.name),
        s.find("." + a + "-prof").html(i.lvl + i.prof),
        s.find("." + a + "-pr").html(i.pr + " PR").removeClass("win lose").addClass(i.result),
        t.find("." + a + "-outfit-wrapper").find(".out-icon").css("background", "url(" + e + ")")
    }
    ,
    this.tLang = function(t) {
        return _t(t, null, "matchmaking")
    }
    ,
    this.init()
}
function dragonChests() {
    var t = this
      , s = [];
    this.counter = null,
    this.init = function() {
        this.initWnd(),
        this.initCloseBut()
    }
    ,
    this.ShowChestsPanel = function() {
        t.$.css("display", "block")
    }
    ,
    this.hideChestsPanel = function() {
        t.$.css("display", "none"),
        g.tplsManager.removeCallback("n", shopNewItem),
        g.tplsManager.deleteMessItemsByLoc("n"),
        g.shop = {
            id: 0
        }
    }
    ,
    this.initCloseBut = function() {
        t.$.find(".close-chests-window").click(t.hideChestsPanel)
    }
    ,
    this.initWnd = function() {
        this.$ = $("#chests-window")
    }
    ,
    this.createAllChests = function(e, i) {
        var n = this;
        for (var c in t.ShowChestsPanel(),
        t.$.find(".chests-choice-wrapper").empty(),
        t.counter = 0,
        e)
            "n" == e[c].loc && (s[e[c].id] = e[c]);
        i.map((function(t) {
            return n.addOne(t)
        }
        ))
    }
    ,
    this.addOne = function(e) {
        var i = s[e.tplId]
          , n = this.createHtmlChest()
          , c = t.getClass(i.name)
          , a = n.find(".btn-wrapper")
          , h = _t("buying_items", null, "shop")
          , o = e.price;
        n.find(".chest-img").addClass(c),
        n.find(".price-txt").html(e.price + " " + _t("sl")),
        n.find(".txt-html").html(_t("chest_" + t.counter)),
        n.find(".header-txt").html(i.name.toUpperCase()),
        this.$.find(".chests-choice-wrapper").append(n),
        createMMButton(h, a, (function() {
            t.chestClick(o, e.id)
        }
        )),
        createMMButton(_t("items_list"), a, (function() {
            _g("moveitem&st=2&tpl=" + i.id),
            g.tplsManager.deleteMessItemsByLoc("p"),
            g.tplsManager.deleteMessItemsByLoc("s")
        }
        )),
        t.counter++
    }
    ,
    this.getClass = function(t) {
        var s = new RegExp("czerwonego","gi")
          , e = new RegExp("czarnego","gi");
        return t.match(s) ? "red-dragon-chest-g" : t.match(e) ? "black-dragon-chest-g" : void 0
    }
    ,
    this.chestClick = function(t, s) {
        var e = _t("accept_dragon_chest", null, "shop")
          , i = _t("stamina_shop_cost") + " "
          , n = _t("sl");
        mAlert(e + "<div class='dragonbox_confirm'>" + i + t + n + "</div>", 2, [function() {
            _g("shop&buy=" + s + ",1&sell=")
        }
        , function() {}
        ])
    }
    ,
    this.createHtmlChest = function() {
        return $('<div class="promo-chest"><div class="header-txt"></div><div class="img-wrapper"><div class="chest-img"></div></div><div class="txt-wrapper"><div class="txt-html"></div></div><div class="btn-wrapper"></div><div class="price-txt"></div></div>')
    }
    ,
    this.init()
}
function prePremiumPanel() {
    var i = this;
    this.init = function() {
        this.initWindow(),
        this.initAllTiles(),
        this.initCloseBut()
    }
    ,
    this.initWindow = function() {
        this.$ = $("#pre-premium-panel")
    }
    ,
    this.initAllTiles = function() {
        var e = i.$.find(".tiles-wrapper");
        this.createOneTile(e, _t("stat-credits").toUpperCase(), "sl-cl", (function(e) {
            i.hidePrePremiumPanel(),
            slShopOpen()
        }
        )),
        this.createOneTile(e, _t("shop"), "shop-cl", (function(e) {
            i.hidePrePremiumPanel(),
            showPremiumPanel()
        }
        )),
        this.createOneTile(e, _t("dragon-chest"), "chest-cl", (function(e) {
            i.hidePrePremiumPanel(),
            _g("creditshop&npc=436")
        }
        )),
        this.createOneTile(e, _t("for-you"), "for-you-cl", (function(e) {
            i.hidePrePremiumPanel(),
            _g("creditshop&filters=1&npc=479&filterlvlunder=10&filterlvlabove=5")
        }
        ))
    }
    ,
    this.showPrePremiumPanel = function() {
        i.$.css("display", "block")
    }
    ,
    this.hidePrePremiumPanel = function() {
        i.$.css("display", "none")
    }
    ,
    this.initCloseBut = function() {
        i.$.find(".close-pre-premium").click(i.hidePrePremiumPanel)
    }
    ,
    this.createOneTile = function(e, t, n, l) {
        var r = i.getOneTileHtml();
        return r.find(".header-txt").html(t),
        r.find(".graph").addClass(n),
        r.click(l),
        e.append(r),
        r
    }
    ,
    this.getOneTileHtml = function() {
        return $('<div class="pre-premium-panel-tile"><div class="header-txt"></div><div class="graph"></div></div>')
    }
    ,
    this.init()
}
function LootPreview() {
    var t = this
      , e = this;
    this.wnd = {},
    this.content = [],
    this.reagents = [],
    this.recipePreview = !1,
    this.init = function() {
        this.initWindow(),
        this.initCloseBut()
    }
    ,
    this.initCloseBut = function() {
        e.wnd.$.find(".close-but").click(e.close)
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("p", e.newPreviewItem),
        g.tplsManager.fetch("s", e.newOpenItem)
    }
    ,
    this.newPreviewItem = function(t) {
        var i = e.getLootPreviewOneItem()
          , n = e.getType(t.id)
          , s = e.getAmount(t.id, n)
          , r = e.recipePreview ? ".".concat(n, "-list") : "";
        i.find(".item-wrapper").append(t.$),
        i.find(".name-wrapper").append(t.name),
        i.find(".amount-wrapper").append("x".concat(s)),
        e.wnd.$.find(".scroll-pane ".concat(r)).append(i),
        $(".scroll-wrapper", undefined).trigger("update")
    }
    ,
    this.getType = function(e) {
        return t.content.find((function(t) {
            return t.id === e
        }
        )) ? "content" : "reagents"
    }
    ,
    this.getAmount = function(e, i) {
        return t[i].find((function(t) {
            return t.id === e
        }
        )).amount
    }
    ,
    this.newOpenItem = function(t) {
        e.wnd.$.find(".item-container").append(t.$)
    }
    ,
    this.update = function(t) {
        var e = "";
        this.recipePreview = !!isset(t.reagents),
        this.content = t.content,
        this.wnd.$.find(".scroll-pane").empty(),
        this.wnd.$.find(".item-container").empty(),
        this.recipePreview ? (this.setRecipePreview(t),
        e = _t("desc", null, "recipe_preview"),
        this.wnd.$.addClass("recipe-preview")) : (e = "lootbox" === t.type ? _t("will_get") : _t("shuffle"),
        this.wnd.$.removeClass("recipe-preview")),
        this.wnd.$.find(".items-txt").html(e),
        this.initFetch()
    }
    ,
    this.setRecipePreview = function(i) {
        t.reagents = i.reagents;
        var n = e.getRecipePreviewContent();
        t.wnd.$.find(".scroll-pane").html(n),
        t.wnd.$.find(".content-txt").text(_t("result", null, "recipe_preview")),
        t.wnd.$.find(".reagents-txt").text(_t("reagents", null, "recipe_preview"))
    }
    ,
    this.initWindow = function() {
        this.wnd.$ = e.getLootPreviewHtml(),
        $("body").append(this.wnd.$),
        this.wnd.$.absCenter()
    }
    ,
    this.close = function() {
        g.tplsManager.removeCallback("p", e.newPreviewItem),
        g.tplsManager.deleteMessItemsByLoc("p"),
        g.tplsManager.removeCallback("s", e.newOpenItem),
        g.tplsManager.deleteMessItemsByLoc("s"),
        e.wnd.$.remove(),
        g.lootPreview = null
    }
    ,
    this.getLootPreviewHtml = function() {
        return $('<div id="loot-preview">\t\t<div class="close-but"></div>\t\t<div class="item-container"></div>\t\t<div class="items-txt"></div>\t\t<div class="scroll-wrapper">\t\t\t<div class="scroll-pane"></div>\t\t</div></div>')
    }
    ,
    this.getLootPreviewOneItem = function() {
        return $('<div class="loot-preview-one-item">\t\t<div class="item-wrapper"></div>\t\t<div class="name-wrapper"></div>       <div class="amount-wrapper"></div></div>')
    }
    ,
    this.getRecipePreviewContent = function() {
        return $('\n\t\t\t<div data-template="recipe-preview-content">\n\t\t\t\t<div class="content-txt"></div>\n\t\t\t\t<div class="content-list"></div>\n\t\t\t\t<div class="reagents-txt"></div>\n\t\t\t\t<div class="reagents-list"></div>\n\t\t\t</div>\n\t\t')
    }
}
function rewardsCalendar() {
    var t, a = this, e = null, n = null, d = null, i = null, r = !1;
    this.rewardDays = null,
    this.rewardItems = {},
    this.init = function() {
        this.initWindow(),
        this.setActualTs(),
        this.initHeaderDays(),
        this.initPrevNextMonth(),
        this.initFetch(),
        this.setPrevActualNextMonthAndYear()
    }
    ,
    this.setActualTs = function() {
        e = a.getTodayWithoutMinutes(getWorldTime()),
        n = e,
        n = a.getFirstDayOfMonthTs(n),
        d = getStartMonth(n),
        i = getStartYear(n)
    }
    ,
    this.initPrevNextMonth = function() {
        a.wnd.$.find(".prev-month, .click-prev").click((function() {
            var t = d - 1;
            t < 0 ? (i--,
            d = 11) : d = t,
            a.updateMonthAndDaysAfterChangeMonth()
        }
        )),
        a.wnd.$.find(".next-month, .click-next").click((function() {
            var t = d + 1;
            t > 11 ? (i++,
            d = 0) : d = t,
            a.updateMonthAndDaysAfterChangeMonth()
        }
        ))
    }
    ,
    this.updateMonthAndDaysAfterChangeMonth = function() {
        var t = new Date(i,d);
        n = t.getTime() / 1e3,
        a.setPrevActualNextMonthAndYear(),
        a.setOneMonthDays(),
        a.updateBackground()
    }
    ,
    this.initHeaderDays = function() {
        for (var t = a.wnd.$.find(".calendar-days-header"), e = 0; e < 7; e++) {
            var n = $("<div>").html(_t("days" + e)).addClass("day-header day-" + e);
            t.append(n)
        }
    }
    ,
    this.setPrevActualNextMonthAndYear = function() {
        var t = getStartMonth(n)
          , e = t - 1 < 0 ? 11 : t - 1
          , d = t + 1 > 11 ? 0 : t + 1;
        a.wnd.$.find(".prev-month").html(_t("month" + e)),
        a.wnd.$.find(".actual-month").html(_t("month" + t)),
        a.wnd.$.find(".next-month").html(_t("month" + d)),
        a.wnd.$.find(".calendar-year").html(getStartYear(n))
    }
    ,
    this.setOneMonthDays = function() {
        a.wnd.$.find(".calendar-days-content").empty(),
        r = !1;
        for (var t = a.getFirstDayOfMonthTs(n), e = getStartWeekDay(t), d = t; 1 != e; ) {
            d = a.getPreviousDayTs(d);
            var i = getStartDay(d)
              , s = a.checkIfThisDayEventExist(d);
            a.createDay(d, s, i, "not", !0),
            e = getStartWeekDay(d)
        }
        for (var o = t, c = t; getStartDay(c) <= getStartDay(o); ) {
            c = o,
            o = a.getNextDayTs(c);
            s = a.checkIfThisDayEventExist(c),
            i = getStartDay(c);
            a.createDay(c, s, i, "current")
        }
        for (; 1 != getStartWeekDay(o); ) {
            c = o,
            o = a.getNextDayTs(c);
            i = getStartDay(c),
            s = a.checkIfThisDayEventExist(c);
            a.createDay(c, s, i, "not")
        }
    }
    ,
    this.getTodayWithoutMinutes = function(t) {
        var a = getStartDay(t)
          , e = getStartMonth(t)
          , n = getStartYear(t);
        return new Date(n,e,a).getTime() / 1e3
    }
    ,
    this.getPreviousDayTs = function(t) {
        var a = t - 43200
          , e = getStartDay(a)
          , n = getStartMonth(a)
          , d = getStartYear(a);
        return new Date(d,n,e).getTime() / 1e3
    }
    ,
    this.getNextDayTs = function(t) {
        var a = t + 129600
          , e = getStartDay(a)
          , n = getStartMonth(a)
          , d = getStartYear(a);
        return new Date(d,n,e).getTime() / 1e3
    }
    ,
    this.getFirstDayOfMonthTs = function(t) {
        return new Date(getStartYear(t),getStartMonth(t)).getTime() / 1e3
    }
    ,
    this.createDay = function(t, n, d, i, s) {
        var o = $("<div>").addClass("day-wrapper")
          , c = $("<div>").addClass("day " + i)
          , h = $("<div>").html(d).addClass("day-nr");
        if (o.append(c),
        c.append(h),
        n) {
            r = !0;
            var l = $("<div>").html(parseBasicBB(n)).addClass("event-name");
            c.prepend(l);
            var u = a.getRewardDataByTs(t)
              , g = $("<div>").addClass("reward")
              , y = $("<div>").addClass("item-wrapper");
            if (g.append(y),
            c.append(g),
            isset(u)) {
                var v = u.tplId
                  , p = u.quantity;
                u.isOpened ? g.addClass("is-open") : (g.addClass("can-open"),
                y.addClass("lock"),
                g.on("click", (function() {
                    _g("rewards_calendar&action=open&day_no=" + (parseInt(a.getDayIndex(t)) + 1))
                }
                ))),
                v && (g.addClass("visible-item"),
                g.addClass("reward-tpl-" + v),
                g.attr("data-amount", p),
                a.addItem(v, g))
            }
        }
        if (t == e && c.addClass("today"),
        s ? a.wnd.$.find(".calendar-days-content").prepend(o) : a.wnd.$.find(".calendar-days-content").append(o),
        n) {
            l = o.find(".event-name");
            a.setTipWhenNameToLong(l, n)
        }
    }
    ,
    this.getRewardDataByTs = function(t) {
        var e = a.getDayIndex(t);
        return this.data.days[e]
    }
    ,
    this.getDayIndex = function(t) {
        return this.rewardDays[t]
    }
    ,
    this.initWindow = function() {
        t = a.getRewardsCalendarHtml(),
        this.wnd = {},
        this.wnd.$ = t;
        var e = $("#calendar-wrapper");
        e.append(this.wnd.$),
        this.wnd.$.find(".closebut").click((function() {
            a.close()
        }
        )),
        e.css("display", "block"),
        $("#new_event_calendar").removeClass("notif")
    }
    ,
    this.initScroll = function() {
        $(".scroll-wrapper", t).addScrollBar({
            track: !0
        })
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", t).trigger("update")
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("v", a.newRewardCalendarItem)
    }
    ,
    this.newRewardCalendarItem = function(t) {
        a.rewardItems[t.id] = t,
        a.addItem(t.id)
    }
    ,
    this.addItem = function(t, e) {
        var n = a.rewardItems[t];
        if (n) {
            var d = e || a.wnd.$.find(".reward-tpl-" + t);
            if (!(d.length < 1)) {
                var i = n.$.clone()
                  , r = d.attr("data-amount");
                g.tplsManager.changeItemAmount(n, i, r),
                i.attr("data-tip-type", n.$.data("tipType")),
                i.attr("data-item-type", n.$.data("itemType")),
                d.find(".item-wrapper").empty().append(i)
            }
        }
    }
    ,
    this.update = function(t) {
        this.updateData(t),
        this.updateDaysTs(),
        this.setOneMonthDays(),
        this.updateBackground()
    }
    ,
    this.updateBackground = function() {
        var t = r ? cdnUrl + "/obrazki/calendar" + a.data.background_img.substr(1) : "img/calendar-background.png?v=".concat(_CLIENTVER)
          , e = r ? cdnUrl + "/obrazki/calendar" + a.data.day_img.substr(1) : "img/calendar-windows-1.png?v=".concat(_CLIENTVER);
        a.wnd.$.find(".calendar-background").css("background-image", "url(" + t + ")"),
        a.wnd.$.find(".day:not(.today), .day:not(.today)>.event-name,.day:not(.today)>.reward.is-open,.day:not(.today)>.reward.can-open").css("background-image", "url(" + e + ")")
    }
    ,
    this.updateDaysTs = function() {
        this.rewardDays = {};
        for (var t = Object.keys(this.data.days).length, e = this.data.start_ts, n = 0; n < t; n++)
            this.rewardDays[e] = n,
            e = a.getNextDayTs(e)
    }
    ,
    this.checkIfThisDayEventExist = function(t) {
        return !!(a.data.start_ts <= t && t < a.data.end_ts && a.getRewardDataByTs(t)) && a.data.name
    }
    ,
    this.updateData = function(t) {
        this.data = {},
        this.data = t,
        this.data.start_ts = a.getTodayWithoutMinutes(this.data.start_ts)
    }
    ,
    this.getRewardsCalendarHtml = function() {
        return $('<div class="rewards-calendar"><div class="calendar-background"></div><div class="calendar-year"></div><div class="calendar-month-header"><div class="month-wrapper"><div class="prev-month month-item"></div><div class="click-prev month-item direction"><</div><div class="actual-month"></div><div class="click-next month-item direction">></div><div class="next-month month-item"></div></div></div><div class="calendar-days-header"></div><div class="calendar-days-content"></div><div class="closebut"></div></div>')
    }
    ,
    this.getData = function() {
        return {
            start_ts: a.getTodayWithoutMinutes(1536656299),
            end_ts: 1541116800,
            name_event: "advent",
            background_img: "advent-background.png",
            day_img: "advent-windows.png",
            max_closed: 1,
            extra_opening: {
                price: 13,
                max: 2,
                cur: 0
            },
            days: [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [1, 1]]
        }
    }
    ,
    this.close = function() {
        a.wnd.$.remove(),
        g.tplsManager.removeCallback("v", a.newRewardCalendarItem),
        g.tplsManager.deleteMessItemsByLoc("v"),
        delete a.wnd,
        g.rewardsCalendar = !1,
        delete a,
        $("#calendar-wrapper").css("display", "none")
    }
    ,
    this.setTipWhenNameToLong = function(t, a) {
        t[0].scrollWidth > t.innerWidth() ? t.attr("tip", parseBasicBB(a)) : t.removeAttr("tip")
    }
    ,
    this.init()
}
function chooseOutfit() {
    var t = this;
    this.itemId = null,
    this.ttl = null,
    this.active = null,
    this.$allOutfits = [];
    var i = {
        x: 3,
        y: 0
    }
      , n = !1
      , e = null
      , s = {}
      , o = {};
    this.init = function() {
        t.initWindow(),
        t.initAnimUpdate(),
        t.initButtons(),
        $(".choose-outfit-info").html(_t("choose-outfit-info"))
    }
    ,
    this.initButtons = function() {
        var i = drawSIButton(_t("accept", null, "trade")).addClass("black")
          , n = drawSIButton(_t("cancel"));
        t.wnd.$.find(".save-button").append(i),
        t.wnd.$.find(".cancel-button").append(n),
        i.bind("click", (function() {
            t.acceptAlert()
        }
        )),
        n.bind("click", (function() {
            t.close()
        }
        ))
    }
    ,
    this.acceptAlert = function() {
        var i = _t("one-choose");
        mAlert(i, 1, [function() {
            _g("moveitem&st=2&id=" + t.itemId + "&outfit_id=" + t.active, (function() {
                t.close()
            }
            ))
        }
        , function() {
            console.log("none")
        }
        ])
    }
    ,
    this.update = function(i) {
        for (var n in t.itemId = i.item_id,
        t.ttl = i.outfitsTTL,
        i.outfits)
            t.createOutfits(i.outfits[n], n)
    }
    ,
    this.initAnimUpdate = function() {
        e = setInterval((function() {
            t.updateFrames(),
            t.draw()
        }
        ), 200)
    }
    ,
    this.createOutfits = function(i, n) {
        var e = t.getTplChooseOutfitWrapper()
          , s = e.find(".outfit")
          , o = $("<span>").html(i.name)
          , a = $("<div>").addClass("gender gender-" + i.gender)
          , c = $("<div>");
        a.html({
            1: "&#9794;",
            2: "&#9792;"
        }[i.gender]),
        c.append(o),
        c.append(a),
        e.find(".outfit-name").html(c),
        e.append(s),
        t.setImage(s, i.img),
        t.wnd.$.find(".all-outfits").append(e),
        e.click((function() {
            t.wnd.$.find(".choose-outfit-wrapper").removeClass("active"),
            t.wnd.$.find(".save-button").find(".SI-button").removeClass("black"),
            e.addClass("active"),
            t.active = n
        }
        ))
    }
    ,
    this.setImage = function(i, n) {
        var e = new Image;
        e.src = CFG.opath + "/" + n,
        e.onload = function() {
            var n = e.width / 4
              , s = e.height / 4;
            i.css({
                background: "url(" + e.src + ") no-repeat",
                width: n,
                height: s
            }),
            t.setAnimFrames(n, s),
            t.$allOutfits.push(i)
        }
    }
    ,
    this.updateFrames = function() {
        i.x++,
        4 == i.x && (i.x = 0,
        n ? (n = !1,
        i.y++) : n = !0,
        4 == i.y && (i.y = 0))
    }
    ,
    this.draw = function() {
        for (var i = 0; i < t.$allOutfits.length; i++)
            t.setOutfitPosition(t.$allOutfits[i])
    }
    ,
    this.setOutfitPosition = function(t) {
        t.css("background-position", s[i.x] + "px " + o[i.y] + "px")
    }
    ,
    this.initWindow = function() {
        var i = t.getTplChooseOutfit();
        this.wnd = {},
        this.wnd.$ = i,
        $("#choose-outfit").append(this.wnd.$),
        $("#choose-outfit").css("display", "block"),
        this.wnd.$.find(".closebut").click(t.close)
    }
    ,
    this.setAnimFrames = function(t, i) {
        s = [0, -t, 2 * -t, 3 * -t],
        o = [0, -i, 2 * -i, 3 * -i]
    }
    ,
    this.close = function() {
        t.clearAnimInterval(),
        t.wnd.$.remove(),
        delete t.wnd,
        g.chooseOutfit = null
    }
    ,
    this.clearAnimInterval = function() {
        clearInterval(e)
    }
    ,
    this.getTplChooseOutfit = function() {
        return $('<div class="choose-outfit"> <div class="middle-graphics"></div> <div class="choose-outfit-info"></div> <div class="all-outfits"></div> <div class="buttons-wrapper">   <div class="save-button"></div>   <div class="cancel-button"></div> </div> <div class="closebut"></div></div>')
    }
    ,
    this.getTplChooseOutfitWrapper = function() {
        return $('<div class="choose-outfit-wrapper"> <div class="outfit-name"></div> <div class="outfit"></div></div>')
    }
}
function _slicedToArray(e, t) {
    return _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _unsupportedIterableToArray(e, t) || _nonIterableRest()
}
function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
}
function _unsupportedIterableToArray(e, t) {
    if (e) {
        if ("string" == typeof e)
            return _arrayLikeToArray(e, t);
        var i = Object.prototype.toString.call(e).slice(8, -1);
        return "Object" === i && e.constructor && (i = e.constructor.name),
        "Map" === i || "Set" === i ? Array.from(e) : "Arguments" === i || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i) ? _arrayLikeToArray(e, t) : void 0
    }
}
function _arrayLikeToArray(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var i = 0, n = new Array(t); i < t; i++)
        n[i] = e[i];
    return n
}
function _iterableToArrayLimit(e, t) {
    var i = null == e ? null : "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
    if (null != i) {
        var n, a, r = [], s = !0, l = !1;
        try {
            for (i = i.call(e); !(s = (n = i.next()).done) && (r.push(n.value),
            !t || r.length !== t); s = !0)
                ;
        } catch (e) {
            l = !0,
            a = e
        } finally {
            try {
                s || null == i.return || i.return()
            } finally {
                if (l)
                    throw a
            }
        }
        return r
    }
}
function _arrayWithHoles(e) {
    if (Array.isArray(e))
        return e
}
function barter() {
    var e, t = this;
    this.items = {},
    this.barterId = null,
    this.barterName = null,
    this.desireItemId = null,
    this.lastCreatedId = null,
    this.showAffectedOfferId = null,
    this.barterOffersData = null,
    this.barterOwnedData = null,
    this.barterAvailableData = null,
    this.barterUsagesData = null,
    this.availableOffersAmount = null,
    this.allParseOffers = null,
    this.allCategories = null,
    this.firstInitItems = !0,
    this.selectedItems = null,
    this.haveReagentsList = null,
    this.needReagentsList = null,
    this.init = function() {
        this.initWindow(),
        this.initLabels(),
        this.initFetch(),
        this.blockMove(),
        this.initSelect(),
        this.initSearch(),
        this.initStartLvl(),
        this.initStopLvl()
    }
    ,
    this.initStartLvl = function() {
        var e = this;
        this.wnd.$.find(".start-lvl").keyup((function() {
            e.startFilter()
        }
        ))
    }
    ,
    this.initStopLvl = function() {
        var e = this;
        this.wnd.$.find(".stop-lvl").keyup((function() {
            e.startFilter()
        }
        ))
    }
    ,
    this.initLabels = function() {
        t.wnd.$.find(".recipe-list-label").html(goldTxt("Lista wymian", !0)),
        t.wnd.$.find(".recipe-reagent-label").html(goldTxt("Reagenty", !0)),
        t.wnd.$.find(".recipe-lvl").html("Lvl")
    }
    ,
    this.updateTitle = function() {
        var e = goldTxt(t.barterName, !0);
        t.wnd.$.find(".recipe-title").html(e)
    }
    ,
    this.initWindow = function() {
        (e = t.getHtmlLeftGroupedListAndRightDescriptionWindow()).find(".item-changer-label").html(goldTxt("Barter")),
        t.wnd = {},
        t.wnd.$ = e,
        $("#barter-window").replaceWith(t.wnd.$),
        $("#barter-window").css("display", "block"),
        t.wnd.$.find(".close-but").click((function() {
            t.close()
        }
        ))
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("f", this.createBarterItem)
    }
    ,
    this.addToCategories = function(e, i) {
        var n = i.cl
          , a = i.id
          , r = i.name;
        t.items[a] = i,
        t.allCategories.hasOwnProperty(n) || (t.allCategories[n] = []),
        e.category = n,
        e.resultItemName = r,
        t.allCategories[n].push(e)
    }
    ,
    this.checkOneStatByItemStats = function(e, t) {
        return t.hasOwnProperty(e)
    }
    ,
    this.updateItem = function(e) {
        for (var i = e.id, n = 0; n < t.allParseOffers.length; n++)
            for (var a = t.allParseOffers[n], r = 0; r < a.recived.length; r++) {
                a.recived[r][0] == i && t.addToCategories(a, e)
            }
    }
    ,
    this.createBarterItem = function(e) {
        t.items[e.id] = e;
        var i = parseItemStat(e.stat);
        t.setItemType(e, i)
    }
    ,
    this.createAllCategoriesDisableAndEnable = function() {
        var e = {};
        for (var i in t.allCategories) {
            e[i] = {
                enable: [],
                disable: []
            };
            for (var n = t.allCategories[i], a = 0; a < n.length; a++) {
                var r = n[a];
                r.maxAmount ? e[i].enable.push(r) : e[i].disable.push(r)
            }
        }
        for (var s in e)
            e[s].disable.sort(t.compare),
            e[s].enable.sort(t.compare);
        return e
    }
    ,
    this.buildRecipeList = function() {
        var e = t.createAllCategoriesDisableAndEnable();
        t.cleanList(),
        t.drawAllRecipesOnList(e),
        t.countRecipesPerGroup()
    }
    ,
    this.drawAllRecipesOnList = function(e) {
        for (var i in e) {
            for (var n = e[i], a = 0; a < n.enable.length; a++) {
                var r = n.enable[a]
                  , s = t.createOneOfferOnList(r);
                t.createGroupElement(r, s)
            }
            for (var l = 0; l < n.disable.length; l++) {
                var o = n.disable[l]
                  , d = t.createOneOfferOnList(o);
                t.createGroupElement(o, d)
            }
        }
    }
    ,
    this.compare = function(e, t) {
        var i = e.resultItemName.toUpperCase()
          , n = t.resultItemName.toUpperCase()
          , a = 0;
        return i > n ? a = 1 : i < n && (a = -1),
        a
    }
    ,
    this.createOneOfferOnList = function(e) {
        var i = e.maxAmount
          , n = e.recived[0][0]
          , a = t.items[n]
          , r = t.getHtmlOneItemOnDivideList().addClass("crafting-recipe-in-list " + (i ? "enabled" : "disabled"))
          , s = i > 0 ? " (" + i + ")" : "";
        return r.addClass("offer-id-" + e.id),
        r.addClass("affectedId-id-" + e.affectedId),
        r.find(".name").html(e.resultItemName + s),
        t.createAttrToCraftingRecipe(r, a),
        t.recipeClick(r, e),
        r
    }
    ,
    this.createAttrToCraftingRecipe = function(e, t) {
        var i = "all"
          , n = "all"
          , a = ["unique", "heroic", "legendary"]
          , r = parseItemStat(t.stat);
        isset(r.lvl) && e.attr("lvl", r.lvl),
        isset(r.reqp) && (i = r.reqp);
        for (var s = 0; s < a.length; s++)
            t.itemTypeName === a[s] && (n = a[s]);
        e.attr("typeItem", n),
        e.attr("reqp", i)
    }
    ,
    this.recipeClick = function(e, t) {
        var i = this;
        e.click((function(e) {
            e.stopPropagation(),
            i.showAffectedOfferId = t.affectedId,
            i.createOffer(t)
        }
        ))
    }
    ,
    this.deleteOldViews = function() {}
    ,
    this.createOffer = function(e) {
        g.disableItemsManager.endSpecificItemKindDisable("barter");
        var i = t.getHtmlCraftingDescriptionHeader()
          , n = t.getCraftingDescriptionReagents()
          , a = t.getHtmlRecipeDescriptionButton()
          , r = $("<button>" + _t("use_it", null, "item") + "</button>")
          , s = e.recived[0][0]
          , l = e.recived[0][1]
          , o = t.items[s];
        t.desireItemId = s;
        var d = t.createViewItem(o)
          , c = i.find(".result-item");
        g.tplsManager.changeItemAmount(o, d, l),
        d.attr("data-tip-type", o.$.data("tipType")),
        d.attr("data-item-type", o.$.data("itemType")),
        d.data("item", o),
        c.append(d),
        t.rightClickItem(d, o, !1);
        var f = t.createLimitCell(e);
        f = "-" != f ? '<br><span class="limit-cell">' + _t("limit", null, "item_changer") + f + "</span>" : "";
        var u = o.itemType;
        i.find(".recipe-name").addClass(u).html(o.name + f),
        g.itemsMovedManager.removeItemsByTarget("barter-item-reagent");
        var m = t.sortReagents(e.required);
        t.createReagents(n, m),
        t.createCost(n, e),
        t.useRecipeBtn(r, e),
        a.find(".use-recipe-btn").append(r);
        var p = t.wnd.$;
        p.find(".choose-recipe").css("display", "block"),
        p.find(".recipe-header").html(i),
        p.find(".recipe-wrapper").empty(),
        p.find(".choose-recipe").find(".recipe-description-button").remove(),
        p.find(".recipe-wrapper").append(n),
        p.find(".recipe-wrapper").append(a),
        p.find(".right-column").find(".crafting-cost-panel").remove(),
        p.find(".bottom-row-panel").find(".do-recipe").find(".button").remove(),
        p.find(".bottom-row-panel").find(".do-recipe").append(r),
        t.markChooseOffer(),
        t.manageEnableClassOfButton()
    }
    ,
    this.sortReagents = function(e) {
        return e.sort((function(e, i) {
            var n = _slicedToArray(e, 1)[0]
              , a = _slicedToArray(i, 1)[0];
            return n = t.items[n],
            (a = t.items[a]).itemTypeSort - n.itemTypeSort || a.pr - n.pr || n.name.localeCompare(a.name)
        }
        ))
    }
    ,
    this.markChooseOffer = function() {
        var e = "mark-offer";
        t.wnd.$.find("." + e).removeClass(e),
        t.wnd.$.find(".affectedId-id-" + t.showAffectedOfferId).addClass(e)
    }
    ,
    this.setItemType = function(e, t) {
        var i = {
            heroic: "t-her",
            upgraded: "t-upgraded",
            elite: "t-uniupg",
            unique: "t-uniupg",
            legendary: "t-leg",
            artefact: "t-art",
            common: "t-norm"
        };
        for (var n in i)
            if (isset(t[n]) || "common" === n)
                return void (e.itemType = i[n])
    }
    ,
    this.rightClickItem = function(e, t, i) {
        e.bind("contextmenu", (function(e, n) {
            t.createOptionMenu(getE(e, n), !1, i)
        }
        ))
    }
    ,
    this.useRecipeBtn = function(e, t) {
        var i = this
          , n = _t("use_it", null, "item");
        e.find(".label").html(n),
        e.bind("click", (function() {
            i.askAlert(t)
        }
        ))
    }
    ,
    this.createLimitCell = function(e, i) {
        if (!e.limit)
            return "-";
        var n = t.findUsagesById(e.id)
          , a = n || 0
          , r = i ? "<br>" : " ";
        switch (e.limit.period) {
        case 0:
            return "-";
        case 1:
            return a + "/" + e.limit.max + r + _t("on_day");
        case 2:
            return a + "/" + e.limit.max + r + _t("on_week");
        case 3:
            return a + "/" + e.limit.max + r + _t("on_month")
        }
    }
    ,
    this.findUsagesById = function(e) {
        for (var i = 0; i < t.barterUsagesData.length; i++) {
            var n = t.barterUsagesData[i];
            if (n[0] == e)
                return n[1]
        }
        return null
    }
    ,
    this.getAmountAvailable = function(e, t) {
        for (var i = 0; i < this.barterAvailableData.length; i++) {
            var n = this.barterAvailableData[i];
            if (n.offerId == e) {
                if (!n.hasOwnProperty("tplId"))
                    return n.count;
                if (n.tplId == t)
                    return n.count
            }
        }
        return 0
    }
    ,
    this.askAlert = function(e) {
        var i = e.id
          , n = e.limit ? _t("limit", null, "item_changer") + "<b>" + t.createLimitCell(e) + "</b><br>" : ""
          , a = _t("accept_barter_offer") + "<br>" + n;
        mAlert(a, 1, [function() {
            var e = Object.keys(t.selectedItems).join();
            _g("barter&id=" + t.barterId + "&offerId=" + i + "&selectedItems=" + e + "&action=use&usesCount=1&available=0&desiredItem=" + t.desireItemId)
        }
        , function() {
            console.log("none")
        }
        ])
    }
    ,
    this.setCostInData = function(e, t) {
        t.m = "yesno4"
    }
    ,
    this.initSelect = function() {
        var e = {
            all: _t("prof_all", null, "eq_prof"),
            m: _t("prof_mag", null, "eq_prof"),
            w: _t("prof_warrior", null, "eq_prof"),
            p: _t("prof_paladyn", null, "eq_prof"),
            t: _t("prof_tracker", null, "eq_prof"),
            h: _t("prof_hunter", null, "eq_prof"),
            b: _t("prof_bladedancer", null, "eq_prof")
        }
          , i = t.wnd.$.find(".choose-prof");
        for (var n in e) {
            var a = $("<option>").attr("val", n).html(e[n]);
            i.append(a)
        }
        var r = {
            all: _t("type_all", null, "auction"),
            unique: _t("type_unique", null, "auction"),
            heroic: _t("type_heroic", null, "auction"),
            legendary: _t("type_legendary", null, "auction")
        }
          , s = t.wnd.$.find(".choose-item-type");
        for (var n in r)
            s.append($("<option>").attr("val", n).html(r[n]));
        i.change((function() {
            t.startFilter()
        }
        )),
        s.change((function() {
            t.startFilter()
        }
        )),
        t.wnd.$.find(".start-lvl").attr("placeholder", _t("start")),
        t.wnd.$.find(".stop-lvl").attr("placeholder", _t("stop"))
    }
    ,
    this.initSearch = function() {
        var e = t.wnd.$.find(".search")
          , i = t.wnd.$.find(".search-x");
        e.keyup((function() {
            t.startFilter()
        }
        )),
        e.attr("placeholder", _t("search")),
        i.bind("click", (function() {
            e.val("").blur().trigger("keyup")
        }
        ))
    }
    ,
    this.startFilter = function() {
        t.wnd.$.find(".one-item-on-divide-list").removeClass("hide"),
        t.searchKeyUp(),
        t.lvlKeyUp(),
        t.getValueFromProf(),
        t.getValueFromItemType(),
        t.countRecipesPerGroup()
    }
    ,
    this.searchKeyUp = function() {
        var e = t.wnd.$.find(".search").val()
          , i = t.wnd.$.find(".one-item-on-divide-list");
        "" == e || i.each((function() {
            $(this).find(".name").html().toLowerCase().search(e.toLowerCase()) > -1 ? $(this).removeClass("hide") : $(this).addClass("hide")
        }
        ))
    }
    ,
    this.lvlKeyUp = function() {
        var e = t.wnd.$.find(".start-lvl").val()
          , i = t.wnd.$.find(".stop-lvl").val()
          , n = t.wnd.$.find(".one-item-on-divide-list");
        "" == e && "" == i || ("" == e && (e = 0),
        "" == i && (i = 1e3),
        n.each((function() {
            if ("none" != $(this).css("display")) {
                var t = $(this).attr("lvl");
                t >= parseInt(e) && t <= parseInt(i) ? $(this).removeClass("hide") : $(this).addClass("hide")
            }
        }
        )))
    }
    ,
    this.getValueFromProf = function() {
        var e = t.wnd.$.find(".choose-prof option:selected").attr("val");
        "all" != e && t.wnd.$.find(".one-item-on-divide-list").each((function() {
            "none" != $(this).css("display") && ($(this).attr("reqp").indexOf(e) > -1 ? $(this).removeClass("hide") : $(this).addClass("hide"))
        }
        ))
    }
    ,
    this.getValueFromItemType = function() {
        var e = t.wnd.$.find(".choose-item-type option:selected").attr("val");
        "all" != e && t.wnd.$.find(".one-item-on-divide-list").each((function() {
            if ("none" != $(this).css("display")) {
                var t, i = $(this).attr("typeitem");
                switch (e) {
                case "unique":
                    t = "unique" == i || "heroic" == i || "legendary" == i;
                    break;
                case "heroic":
                    t = "heroic" == i || "legendary" == i;
                    break;
                case "legendary":
                    t = "legendary" == i
                }
                t ? $(this).removeClass("hide") : $(this).addClass("hide")
            }
        }
        ))
    }
    ,
    this.countRecipesPerGroup = function() {
        t.wnd.$.find(".divide-list-group").each((function(e, t) {
            var i = $(t).find(".group-list .one-item-on-divide-list:not(.hide)").length;
            $(t).find(".amount").html(i)
        }
        ))
    }
    ,
    this.createCost = function(e, i) {
        if (i.cost) {
            var n = t.getHtmlCostWrapper();
            switch (i.cost.currency) {
            case 1:
                var a = t.createCostReagent(_t("gold"), i.cost.value, hero.gold, "money-icon");
                e.append(a);
                break;
            case 2:
                a = t.createCostReagent(_t("stat-credits"), i.cost.value, hero.credits, "draconite-icon");
                e.append(a);
                break;
            case 3:
                var r = t.lookForOwnedById(i.cost.itemTpl);
                a = t.createCostReagent(!1, i.cost.value, r, !1, i.cost.itemTpl);
                e.append(a);
                break;
            case 4:
                a = t.createCostReagent(_t("stat-honor"), i.cost.value, hero.honor, "honor-icon");
                e.append(a);
                break;
            default:
                console.error("bad", i.cost.currency)
            }
            e.find(".crafting-cost-wrapper").append(n)
        } else
            e.find(".crafting-cost-wrapper").html("-")
    }
    ,
    this.setCostAvailableData = function(e) {
        var t = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1];
        e.attr("data-cost-available", t)
    }
    ,
    this.createViewItem = function(e) {
        return g.tplsManager.getClone(e.id, e.loc)
    }
    ,
    this.createReagents = function(e, i) {
        var n = []
          , a = [];
        t.clearSelectedItems(),
        t.clearHaveReagentsList(),
        t.clearNeedReagentsList();
        for (var r = 0; r < i.length; r++) {
            var s = i[r][0]
              , l = i[r][1]
              , o = t.items[s]
              , d = t.createViewItem(o)
              , c = t.getHtmlCraftingReagent()
              , f = c.find(".item-slot")
              , u = checkItemStat(o, "amount")
              , m = checkItemStat(o, "ammo")
              , p = 0
              , v = 0
              , h = o.itemType;
            d.addClass("pattern-item"),
            d.find("small").remove(),
            u && (l *= getAmountItem(o)),
            m && (l *= getAmmoItem(o)),
            t.setNeedReagentsList(s, l);
            var b = c.find(".have")
              , I = c.find(".need");
            t.setLabelWithRoundVal(b, v),
            t.setLabelWithRoundVal(I, l),
            c.find(".item-name").addClass(h).html(o.name),
            f.addClass("reagent-tpl-" + s),
            f.append(d),
            t.rightClickItem(d, o, !1);
            for (var w = !0; w; ) {
                var y = t.findOneReagent(s, a);
                if (w = !1,
                y) {
                    if (w = !0,
                    u && (p += getAmountItem(y)),
                    m && (p += getAmmoItem(y)),
                    u || m || p++,
                    v >= l)
                        continue;
                    u && (v += getAmountItem(y)),
                    m && (v += getAmmoItem(y)),
                    u || m || v++,
                    t.setBarterItem(y, f)
                }
            }
            n.push(o.id),
            t.setHaveReagentsList(s, v);
            var C = c.find(".owned-items");
            t.setLabelWithRoundVal(C, p, "Posiadane: "),
            e.find(".reagents-list").append(c)
        }
        g.disableItemsManager.startSpecificItemKindDisable("barter", n)
    }
    ,
    this.setLabelWithRoundVal = function(e, t, i) {
        t > 9995 ? e.tip(t) : e.tip("");
        var n = i || "";
        e.html(n + round(t, 4))
    }
    ,
    this.setHaveReagentsList = function(e, i) {
        t.haveReagentsList[e] = i
    }
    ,
    this.createCostReagent = function(e, i, n, a, r) {
        var s, l, o = t.getHtmlCraftingReagent(), d = o.find(".item-slot");
        if (o.addClass("currency-reagent"),
        a && (s = t.getHtmlCostItemComponent()).find(".icon").addClass(a),
        r) {
            var c = t.items[r];
            s = t.createViewItem(c),
            l = c.name,
            s.addClass("currency-item")
        }
        e && (l = e);
        var f = n > i ? i : n
          , u = o.find(".owned-items")
          , m = o.find(".have")
          , p = o.find(".need");
        return t.setLabelWithRoundVal(u, n, "Posiadane: "),
        t.setLabelWithRoundVal(m, f),
        t.setLabelWithRoundVal(p, i),
        o.find(".item-name").html(l),
        d.append(s),
        o
    }
    ,
    this.getItemSlot = function(e) {
        return t.wnd.$.find(".reagent-tpl-" + e)
    }
    ,
    this.setBarterItem = function(e, i) {
        var n = e.id
          , a = e.tpl
          , r = $("#item" + n).clone(!1)
          , s = checkItemStat(e, "amount")
          , l = checkItemStat(e, "ammo")
          , o = i;
        i || (i = t.getItemSlot(a));
        var d = i.closest(".reagent-wrapper");
        g.itemsMovedManager.addItem(e, "barter-item-reagent", (function() {
            t.removeItemFromSlot(e, i, d, r)
        }
        )),
        t.addToSelectedItems(n),
        i.append(r),
        r.css({
            left: 0,
            top: 0
        }),
        r.click((function() {
            t.removeItemFromSlot(e, i, d, r)
        }
        ));
        var c = t.getHaveReagentsList(a);
        s && (c += getAmountItem(e)),
        l && (c += getAmmoItem(e)),
        s || l || c++,
        t.setHaveReagentsList(a, c);
        var f = d.find(".have");
        t.setLabelWithRoundVal(f, c),
        o || t.manageEnableClassOfButton(),
        t.rightClickItem(r, e, {
            use: !0,
            move: !0,
            split: !0
        })
    }
    ,
    this.removeItemFromSlot = function(e, i, n, a) {
        var r = e.id
          , s = e.tpl;
        t.removeFromSelectedItems(r),
        g.itemsMovedManager.removeItem(r);
        var l = t.getHaveReagentsList(s)
          , o = checkItemStat(e, "amount")
          , d = checkItemStat(e, "ammo");
        o && (l -= getAmountItem(e)),
        d && (l -= getAmmoItem(e)),
        o || d || l--,
        t.setHaveReagentsList(s, l),
        a.remove();
        var c = n.find(".have");
        t.setLabelWithRoundVal(c, l),
        t.manageEnableClassOfButton()
    }
    ,
    this.clearHaveReagentsList = function() {
        t.haveReagentsList = {}
    }
    ,
    this.getHaveReagentsList = function(e) {
        return t.haveReagentsList.hasOwnProperty(e) ? t.haveReagentsList[e] : 0
    }
    ,
    this.setHaveReagentsList = function(e, i) {
        t.haveReagentsList[e] = i
    }
    ,
    this.clearNeedReagentsList = function() {
        t.needReagentsList = {}
    }
    ,
    this.getNeedReagentsList = function(e) {
        return t.needReagentsList.hasOwnProperty(e) ? t.needReagentsList[e] : 0
    }
    ,
    this.setNeedReagentsList = function(e, i) {
        t.needReagentsList[e] = i
    }
    ,
    this.checkCanUseOffer = function() {
        for (var e in t.needReagentsList) {
            var i = t.needReagentsList[e];
            if (t.haveReagentsList[e] < i)
                return !1
        }
        return !!t.getOfferAvailableByCost()
    }
    ,
    this.manageEnableClassOfButton = function() {
        var e = !!t.checkCanUseOffer()
          , i = t.wnd.$.find(".choose-recipe").find(".use-recipe-btn").find("button");
        i.removeAttr("disabled"),
        e || i.attr("disabled", "disabled")
    }
    ,
    this.clearSelectedItems = function() {
        t.selectedItems = {}
    }
    ,
    this.addToSelectedItems = function(e) {
        t.selectedItems[e] = !0
    }
    ,
    this.removeFromSelectedItems = function(e) {
        t.selectedItems.hasOwnProperty(e) && delete t.selectedItems[e]
    }
    ,
    this.fixItemsData = function(e, t) {
        var i = {}
          , n = {};
        for (var a in e)
            t.hasOwnProperty(a) ? (t[a].hasOwnProperty("del") || (i[a] = t[a]),
            n[a] = !0) : i[a] = e[a];
        for (var r in t)
            n.hasOwnProperty(r) || (i[r] = t[r]);
        return i
    }
    ,
    this.findOneReagent = function(e, i) {
        var n = getHItems()
          , a = ["upg", "soulbound", "lowreq", "opis2", "timelimit_upgs", "lvlupgs", "recovered"]
          , r = null
          , s = null
          , l = i || []
          , o = lookForInLoadQueue("newItem");
        for (var d in o && (n = t.fixItemsData(n, o)),
        n) {
            var c = n[d];
            c.hasOwnProperty("id") || (c.id = d);
            var f = c.id
              , u = parseItemStat(c.stat);
            if (!(c.st > 0) && (!l.includes(f) && !(c.tpl != e || checkItemStat(c, "expires") && checkItemExpires(c)))) {
                var m = t.getAmountOfConfuseStats(a, u);
                if (!m)
                    return l.push(f),
                    c;
                (null == s || s > m) && (s = m,
                r = c)
            }
        }
        return r ? (l.push(r.id),
        r) : null
    }
    ,
    this.getAmountOfConfuseStats = function(e, t) {
        for (var i = 0, n = 0; n < e.length; n++) {
            var a = e[n];
            t.hasOwnProperty(a) && i++
        }
        return i
    }
    ,
    this.lookForOwnedById = function(e) {
        for (var i = 0; i < t.barterOwnedData.length; i++) {
            if (e == t.barterOwnedData[i][0])
                return t.barterOwnedData[i][1]
        }
        return 0
    }
    ,
    this.createGroupElement = function(e, i) {
        var n, a = e.category, r = t.wnd.$.find(".group-" + a);
        r.length < 1 && (n = (r = t.getHtmlDivideListGroup()).find(".group-header"),
        r.addClass("group-".concat(a, " active")),
        r.find(".label").html(_t("au_cat" + a, null, "auction")),
        t.wnd.$.find(".recipe-list").append(r),
        n.click((function() {
            r.toggleClass("active")
        }
        ))),
        r.find(".group-list").append(i)
    }
    ,
    this.cleanList = function() {
        this.wnd.$.find(".recipe-list").empty()
    }
    ,
    this.update = function(e, i) {
        for (var n in t.barterId = e.id,
        t.barterName = e.name,
        t.barterOffersData = e.offers,
        t.barterOwnedData = e.owned,
        t.barterAvailableData = e.available,
        t.barterUsagesData = e.usages,
        t.allCategories = {},
        t.lastCreatedId = 0,
        t.updateTitle(),
        t.createOffers(),
        t.items) {
            var a = t.items[n];
            t.updateItem(a)
        }
        t.buildRecipeList(),
        null != t.showAffectedOfferId && t.showAgainClickOffer()
    }
    ,
    this.showAgainClickOffer = function() {
        for (var e = 0; e < t.allParseOffers.length; e++)
            if (t.showAffectedOfferId == t.allParseOffers[e].affectedId)
                return void t.createOffer(t.allParseOffers[e])
    }
    ,
    this.getOfferAvailableByCost = function() {
        for (var e = 0; e < t.allParseOffers.length; e++)
            if (t.showAffectedOfferId == t.allParseOffers[e].affectedId)
                return t.allParseOffers[e].maxAmount;
        return console.warn("not find"),
        0
    }
    ,
    this.checkShowAffectedOfferId = function() {
        return null != t.showAffectedOfferId
    }
    ,
    this.createOffers = function() {
        t.allParseOffers = [];
        for (var e = 0; e < t.barterOffersData.length; e++) {
            var i = t.barterOffersData[e];
            switch (i.mode) {
            case 1:
                t.prepareNormalOffer(i);
                break;
            case 2:
                t.prepareChooseOneRequiredFromBigRequiredListOffer(i);
                break;
            default:
                return console.error("bad offer mode:", i.mode)
            }
        }
    }
    ,
    this.prepareNormalOffer = function(e) {
        for (var i = e.recived, n = 0; n < i.length; n++) {
            var a = i[n]
              , r = t.getAmountAvailable(e.id)
              , s = {
                id: e.id,
                affectedId: t.lastCreatedId,
                mode: e.mode,
                required: e.required,
                recived: [a],
                maxAmount: r,
                category: null,
                resultItemName: null
            };
            t.lastCreatedId++,
            e.limit && (s.limit = e.limit),
            e.cost && (s.cost = e.cost),
            t.allParseOffers.push(s)
        }
    }
    ,
    this.prepareChooseOneRequiredFromBigRequiredListOffer = function(e) {
        for (var i = e.required, n = 0; n < i.length; n++) {
            var a = i[n]
              , r = a[0]
              , s = t.getAmountAvailable(e.id, r)
              , l = {
                id: e.id,
                affectedId: t.lastCreatedId,
                mode: e.mode,
                required: [a],
                recived: e.recived,
                category: null,
                maxAmount: s,
                resultItemName: null
            };
            t.lastCreatedId++,
            e.limit && (l.limit = e.limit),
            e.cost && (l.cost = e.cost),
            t.allParseOffers.push(l)
        }
    }
    ,
    this.blockMove = function() {
        g.lock.add("barter")
    }
    ,
    this.unblockMove = function() {
        g.lock.remove("barter")
    }
    ,
    this.close = function() {
        t.unblockMove(),
        t.wnd.$.empty(),
        $("#barter-window").css("display", "none"),
        g.tplsManager.removeCallback("f", t.createBarterItem),
        g.tplsManager.deleteMessItemsByLoc("f"),
        delete t.wnd,
        g.itemsMovedManager.removeItemsByTarget("barter-item-reagent"),
        g.disableItemsManager.endSpecificItemKindDisable("barter"),
        g.barter = !1
    }
    ,
    this.getHtmlOneItemOnDivideList = function() {
        return $('\n\t\t    <div class="one-item-on-divide-list">\n        <div class="name-wrapper">\n            <div class="name"></div>\n        </div>\n      </div>\n\t\t')
    }
    ,
    this.getHtmlLeftGroupedListAndRightDescriptionWindow = function() {
        return $('\n\t\t<div id="barter-window">\n\n\n\t\t\t\t<div class="recipe-title"></div>\n\t\t\t\t<div class="recipe-list-label"></div>\n\t\t\t\t<div class="recipe-reagent-label"></div>\n\t\t\t\t<div class="recipe-list-search">\n\t\t\t\t\t<input class="search" placeholder="Szukaj">\n\t\t\t\t\t<div class="recipe-lvl"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="recipe-header"></div>\n\t\t\t\t<div class="recipe-list"></div>\n\t\t\t\t<div class="choose-recipe">\n\t\t\t\t\t<div class="reagent-list-label"></div>\n\t\t\t\t\t<div class="recipe-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t\t<input class="start-lvl" val=""/>\n\t\t\t\t<input class="stop-lvl" val=""/>\n\t\t\t\t<select class="choose-item-type"></select>\n\t\t\t\t<select class="choose-prof"></select>\n\t\t\t\t<div class="close-but"></div>\n\t\t\t\t</div>\n\t\t')
    }
    ,
    this.getCraftingDescriptionReagents = function() {
        return $('\n\t\t\t<div class="recipe-description-reagents">\n\t\t\t\t<div class="reagents-list"></div>\n\t\t\t</div>\n\t\t')
    }
    ,
    this.getHtmlCraftingDescriptionHeader = function() {
        return $('\n\t\t\t<div class="recipe-description-header">\n\t\t\t\t<div class="item-name-wrapper">\n\t\t\t\t\t<div class="result-item item-slot"></div>\n\t\t\t\t\t<div class="recipe-name"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')
    }
    ,
    this.getHtmlCostWrapper = function() {
        return $('\n\t\t\t<div class="cost-wrapper"></div>\n\t\t')
    }
    ,
    this.getHtmlCostItem = function() {
        return $('\n\t\t    <div class="cost-item">\n        <div class="item-wrapper"></div>\n        <div class="require-state">\n            <div class="require-state-inner">\n                <span class="current-owned"></span><span class="seperator">/</span><span class="need-to-use"></span>\n            </div>\n        </div>\n      </div>\n\t\t')
    }
    ,
    this.getHtmlCraftingReagent = function() {
        return $('\n\t\t\t<div class="recipe-reagent">\n          <div class="reagent-wrapper">\n              <div class="item-reagent-wrapper">\n                  <div class="item-reagent item-slot"></div>\n              </div>\n              <div class="reagent-info">\n                  <div class="item-name"></div>\n                  <div class="amount-items">\n                      <span class="have"></span>/<span class="need"></span>\n                  </div>\n              </div>\n              <div class="owned-items"></div>\n          </div>\n      </div>\n\t\t')
    }
    ,
    this.getHtmlCostItemComponent = function() {
        return $('\n\t\t\t<div class="cost-icon-component">\n          <div class="cost-icon-wrapper">\n              <div class="text"></div>\n              <div class="cost"></div>\n              <div class="icon"></div>\n          </div>\n      </div>\n\t\t')
    }
    ,
    this.getHtmlDivideListGroup = function() {
        return $('\n\t\t<div class="divide-list-group">\n\t\t\t<div class="group-header">\n\t\t\t\t<div class="card-graphic"></div>\n\t\t\t\t<div class="label"></div>\n\t\t\t\t<div class="direction"></div>\n\t\t\t\t<div class="amount"></div>\n\t\t\t</div>\n\t\t\t<div class="group-list"></div>\n\t\t</div>\n\t\t')
    }
    ,
    this.getHtmlRecipeDescriptionButton = function() {
        return $('\n\t\t\t<div class="recipe-description-button">\n\t\t\t\t<div class="use-recipe-btn"></div>\n\t\t\t</div>\n\t\t')
    }
}
var _this = this
  , lastCl = null
  , superMarketEqItemCounter = 0;
function createOffers(e) {
    var s = this;
    e.map((function(e) {
        return s.createSingleOffer(e)
    }
    ))
}
function createSingleOffer(e) {
    var s = g.shop.tpls[e.tplId];
    s.offerId = e.id,
    s.quantity = e.quantity,
    s.pr = e.price,
    s.prc = g.shop.cur,
    s.$ = s.$.clone(),
    s.$.tip(itemTip(s)),
    g.shop.items[s.id] = s,
    isset(parseItemStat(s.stat).amount) && g.tplsManager.changeItemAmount(s, s.$, e.quantity),
    $("#shop_store").append(s.$);
    var t = !1
      , o = 479 == g.shop.id;
    o && (g.superMarketItems[s.id] = s,
    isSuperMarketEqItem(s) ? (null == lastCl && (lastCl = s.cl),
    lastCl != s.cl && (lastCl = s.cl,
    superMarketEqItemCounter = 8 * (Math.floor(superMarketEqItemCounter / 8) + 1))) : t = !0);
    var p = t ? "none" : "block"
      , i = o ? Math.floor(superMarketEqItemCounter / 8) : e.y
      , r = o ? superMarketEqItemCounter - 8 * i : e.x;
    s.$.css({
        display: p,
        left: 33 * r,
        top: 33 * i
    }).click((function() {
        shop_buy(this, s)
    }
    )),
    o && !t && superMarketEqItemCounter++
}
function shop_show(e, s) {
    if (0 !== g.shop.id && shop_close(!0),
    436 == e.id)
        return smoczeKuferki(e, s);
    $("#window-smoczeKuferki").remove(),
    tutorialStart(7);
    for (var t in 479 == e.id ? (callSuperMarket(),
    $("#for-you-plug").css("display", "block"),
    $("#for-you-txt").css("display", "block")) : ($("#for-you-plug").css("display", "none"),
    $("#for-you-txt").css("display", "none")),
    $("#for-you-plug-disabled").css("display", "none"),
    e)
        g.shop[t] = e[t];
    for (var t in g.shop.type = 1,
    s)
        if ("n" == s[t].loc && !(16 == s[t].cl && s[t].stat.search(/outfit/) >= 0 || 16 == s[t].cl && s[t].stat.search(/pet=/) >= 0)) {
            g.shop.type = 0;
            break
        }
    1 == g.shop.type ? $("#shop").addClass("outfit") : $("#shop").removeClass("outfit"),
    g.shop.tpls = {},
    g.shop.items = {},
    g.shop.b = [],
    g.shop.s = [],
    $("#gold_shop_banner").css("display", "none"),
    $("#sl_shop_banner").css("display", "none");
    var o = "";
    if ("ph" == g.shop.cur)
        o = _t("sell_for_ph") + "<br>";
    else if ("sl" == g.shop.cur)
        o = _t("sell_for_sl") + "<br>",
        $("#sl_shop_banner").css("display", "block");
    else if ("zl" == g.shop.cur)
        $("#gold_shop_banner").css("display", "block"),
        o = "<b>" + _t("sell_prices") + "</b>: ",
        g.shop.sellp < 150 ? o += _t("sell_price_cheap") : g.shop.sellp > 299 ? o += _t("sell_price_vExpensive") : g.shop.sellp > 199 ? o += _t("sell_price_expensive") : o += _t("sell_price_normal"),
        o += "<br><b>" + _t("rebuy_price") + "</b> " + g.shop.buyp + "%<br><b>" + _t("max_per_item") + "</b> " + g.shop.maxbuyp + "<br />";
    else {
        var p = g.shop.cur.split("|");
        o = '<div style="height:32px"><div style="float:left;padding-top:9px;"><b>' + _t("selling_for_info") + '</b></div><div style="margin:0px 5px;background-image:url(' + CFG.ipath + p[1] + ');height:32px;width:32px;float:left" /><div style="padding-top:9px;margin-left:40px;width:150px;">' + p[0] + '.</div></div><div class="clearfix"></div><br/>'
    }
    if (o += "<b>" + _t("shopper_buys") + "</b> ",
    "*" == g.shop.purchase)
        o += _t("buys_all");
    else if ("" == g.shop.purchase)
        o += _t("buys_nothing");
    else {
        var i = g.shop.purchase.split(",");
        for (var t in i)
            i[t] = eq.classes[parseInt(i[t])];
        o += i.join(", ")
    }
    $("#shop_desc").html(o),
    $("#shop").fadeIn("fast"),
    g.tplsManager.fetch("n", shopNewItem),
    g.lock.add("shop")
}
function check_shop() {
    return !("none" == $("#shop").css("display"))
}
function is_only_buy_shop() {
    return check_shop() && "" == get_shop_purchase()
}
function get_shop_purchase() {
    return g.shop.purchase
}
function shop_close(e) {
    $("#shop>DIV").not("#for-you-plug-disabled, #for-you-txt").empty(),
    $("#shop>SPAN").empty(),
    $("#shop_store").empty(),
    g.tplsManager.removeCallback("n", shopNewItem),
    g.tplsManager.deleteMessItemsByLoc("n"),
    g.lock.remove("shop"),
    clear_shop_preview(),
    e ? $("#shop").css("display", "none") : $("#shop").fadeOut("fast"),
    g.shop = {
        id: 0
    }
}
function shop_recover_items() {
    _g("recovery")
}
function shop_accept() {
    if (!$.isEmptyObject(g.shop.b) || !$.isEmptyObject(g.shop.s)) {
        switch (g.shop.cur) {
        case "ph":
            if (-g.shop.bill > hero.honor)
                return void mAlert(_t("shop_to_low_ph"));
            break;
        case "zl":
            if (-g.shop.bill > hero.gold)
                return void mAlert(_t("shop_to_low_gold"));
            break;
        case "sl":
            if (-g.shop.bill > hero.credits)
                return void mAlert(_t("shop_to_low_credits"));
            break;
        default:
            var e = 0
              , s = g.shop.cur.split("|");
            for (it in g.item) {
                var t = g.item[it];
                if ("g" == t.loc && t.name == s[0]) {
                    var o = /amount=([0-9]+)/.exec(t.stat);
                    null !== o && isset(o[1]) ? e += parseInt(o[1]) : e++
                }
            }
            if (-g.shop.bill > e)
                return void mAlert(_t("shop_to_low_items %type%", {
                    "%type%": s[0]
                }))
        }
        var p = []
          , i = g.shop.b.filter((function(e) {
            return e
        }
        ));
        for (var r in i)
            p[r] = i[r].offerId + "," + i[r].q;
        var l = [];
        for (var r in g.shop.s)
            l.push(g.shop.s[r]);
        _g("shop&buy=" + p.join(";") + "&sell=" + l.join(",")),
        g.shop.b = [],
        g.shop.s = [],
        clear_shop_preview(),
        479 == g.shop.id ? $("#shop>DIV").not("#shop_sell, #for-you-plug-disabled, #for-you-txt").empty() : $("#shop>DIV").empty()
    }
}
function shop_buy(e) {
    var s = $(e).attr("id").substr(4)
      , t = g.shop.items[s]
      , o = -1;
    for (var p in g.shop.b)
        g.shop.b[p].id == s && (g.shop.b[p].q++,
        o = p);
    if (o < 0) {
        for (var i = 0; i < (0 == g.shop.type ? 5 : 3); i++)
            if (!g.shop.b[i]) {
                o = i;
                break
            }
        if (-1 == o)
            return
    }
    if (g.shop.b[o] || (g.shop.b[o] = {
        id: s,
        q: 1,
        offerId: t.offerId
    }),
    1 == g.shop.type && (isset(g.shop.preview) || (g.shop.preview = []),
    !isset(g.shop.preview[o]))) {
        var r = parseItemStat(g.shop.items[s].stat)
          , l = null;
        if (isset(r.outfit) ? l = "outfit" : isset(r.pet) && (l = "pet"),
        null != l) {
            var a, n, h = new Image, c = 0, d = 58 * o - (o - 1);
            if ("pet" == l)
                g.shop.preview[o] = {
                    object: new PetStore({
                        stat: r.pet,
                        idx: o
                    }),
                    outfit: 0
                },
                $("#shop_sell .infobox").length || $("#shop_sell").append('<div class="infobox" style="color:gold;position:absolute;font-size:0.7em;top:83px">' + _t("mascot_preview_info") + "</div>");
            else {
                var u = r.outfit.split(",");
                h.src = CFG.opath + u[1],
                h.onload = function() {
                    var e = "pet" == l ? 32 : this.width / 4
                      , s = this.height / 4
                      , t = 48 < e ? 48 : e
                      , p = 75 < s ? 75 : s
                      , i = !0;
                    (48 < e || 75 < s) && (c = -1 * (e > t ? e / 2 - t / 2 : e),
                    i = !1),
                    n = 37.5 - p / 2 + 3,
                    a = 24 - t / 2 + d;
                    var r = $(document.createElement("div")).css({
                        width: t,
                        height: p,
                        position: "absolute",
                        overflow: "hidden",
                        background: "url(" + h.src + ") " + c + "px 0px",
                        top: n,
                        left: a
                    });
                    g.shop.preview[o] = {
                        object: r,
                        outfit: 0
                    },
                    i && (g.shop.preview[o].interval = setInterval((function() {
                        g.shop.preview[o].outfit = g.shop.preview[o].outfit + 1 & 15;
                        var e = (3 & g.shop.preview[o].outfit) * t
                          , s = g.shop.preview[o].outfit >> 2;
                        2 == s ? s = 3 : 3 == s && (s = 2),
                        s *= p,
                        g.shop.preview[o].object.css({
                            backgroundPosition: "-" + e + "px -" + s + "px"
                        })
                    }
                    ), 400)),
                    $("#shop_sell").append(g.shop.preview[o].object)
                }
            }
        }
    }
    if (isset(parseItemStat(t.stat).canpreview)) {
        var f = '_g("moveitem&st=2&tpl=' + s + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
        showMenu({
            target: e
        }, [[_t("show", null, "item"), f, !0]])
    }
    var _ = 0 == g.shop.type ? o : 2 * o;
    $("#shq" + _).html(g.shop.b[o].q);
    var m = t.$.clone().attr("idx", o).css({
        top: "",
        left: 33 * _,
        display: "block"
    }).click((function(e) {
        var t = $(this).attr("idx");
        g.shop.b[t].q > 1 ? (g.shop.b[t].q--,
        $("#shq" + (0 == g.shop.type ? t : 2 * t)).html(g.shop.b[t].q)) : ($("#shq" + (0 == g.shop.type ? t : 2 * t)).empty(),
        $("#shop_buy [idx=" + t + "]").remove(),
        1 == g.shop.type && isset(g.shop.preview[t]) && (clearInterval(g.shop.preview[t].interval),
        g.shop.preview[t].object.remove(),
        delete g.shop.preview[t]),
        delete g.shop.b[t],
        $("#item" + s).trigger("groupbuy_off")),
        Tip.hide(),
        shop_bcalc()
    }
    ));
    m.find("small, .itemHighlighter").remove(),
    $("#shop_buy").append(m),
    shop_bcalc()
}
function clear_shop_preview() {
    if (isset(g.shop.preview)) {
        for (var e in g.shop.preview)
            clearInterval(g.shop.preview[e].interval),
            g.shop.preview[e].object.remove();
        delete g.shop.preview
    }
}
function shop_bcalc() {
    var e = 0;
    for (var s in g.shop.b)
        e -= g.shop.items[g.shop.b[s].id].pr * g.shop.b[s].q;
    for (var s in g.shop.s)
        e += Math.min(g.shop.maxbuyp, Math.round(g.item[g.shop.s[s]].pr * g.shop.buyp * .01));
    switch (g.shop.cur) {
    case "zl":
        $("#shop_bilans").html((e > 0 ? "+" : "") + round(e, 3) + (-e > hero.gold ? " (!)" : ""));
        break;
    case "sl":
        $("#shop_bilans").html((e > 0 ? "+" : "") + round(e, 3) + (-e > hero.credits ? " (!)" : ""));
        break;
    case "ph":
        $("#shop_bilans").html((e > 0 ? "+" : "") + round(e, 3) + (-e > hero.honor ? " (!)" : ""));
        break;
    default:
        var t = 0
          , o = g.shop.cur.split("|");
        for (it in g.item) {
            var p = g.item[it];
            if ("g" == p.loc && p.name == o[0]) {
                var i = /amount=([0-9]+)/.exec(p.stat);
                null !== i && isset(i[1]) ? t += parseInt(i[1]) : t++
            }
        }
        $("#shop_bilans").html((e > 0 ? "+" : "") + round(e, 3) + (-e > t ? " (!)" : ""))
    }
    g.shop.bill = e
}
function shop_sell(e) {
    var s = function() {
        createItem(g.item[t]).attr("idx", o).css({
            left: o % 5 * 33,
            top: 33 * Math.floor(o / 5)
        }).append($(e).find("img").clone()).click((function(e) {
            var s = $(this).attr("idx");
            $("#shop_sell [idx=" + s + "]").remove(),
            delete g.shop.s[s],
            Tip.hide(),
            shop_bcalc()
        }
        )).appendTo("#shop_sell"),
        shop_bcalc()
    };
    if ("none" != $("#shop").css("display")) {
        var t = $(e).attr("id").substr(4)
          , o = -1
          , p = g.item[t].cl;
        if (17 != p && 19 != p && 25 != p && 26 != p && 27 != p)
            if ("" != g.shop.purchase) {
                if ("*" !== g.shop.purchase) {
                    var i = g.shop.purchase.split(",")
                      , r = !1;
                    for (var l in i)
                        i[l] == g.item[t].cl && (r = !0);
                    if (!r)
                        return void mAlert(_t("seller_wont_buy_this"))
                }
                for (var a in g.shop.s)
                    if (g.shop.s[a] == t)
                        return;
                for (a = 0; a < 20; a++)
                    if (!g.shop.s[a]) {
                        o = a,
                        g.shop.s[a] = t;
                        break
                    }
                -1 != o && (g.item[t].stat.search("quest=") >= 0 ? _g("shop&can_sell=" + t, (function(e) {
                    1 == e.can_sell && s()
                }
                )) : s())
            } else
                mAlert(_t("seller_wont_buy_anything"));
        else
            mAlert(_t("sell_cannot"))
    }
}
function slShopOpen() {
    if (isset(hero.guest)) {
        var e = _t("guest_cannot_buy_draconite");
        mAlert(e)
    } else {
        if ("pl" != _l())
            return window.open("https://margonem.com/draconite");
        var s;
        s = !isset(g.worldConfig.getWorldName()) || "dev" !== g.worldConfig.getWorldName() && "experimental" !== g.worldConfig.getWorldName() ? $('<div style="z-index:1000;position:absolute;width:787px;height:537px;" id="slshop"><div style="background:url(/img/belka-platnosci.png?v='.concat(_CLIENTVER, ');width:787px;height:31px;"></div><iframe style="width:787px;height:506px;" src="https://www.margonem.pl/profile/payments"></iframe><div class="closebut" rollover="22" id="sl_shop_close_button" onclick="slShopClose()"></div></div>')) : $('<div style="background:white;z-index:1000;position:absolute;width:787px;height:537px;" id="slshop">' + '<div style="background:url(/img/belka-platnosci.png?v='.concat(_CLIENTVER, ');width:787px;height:31px;"></div>') + '<iframe style="width:787px;height:506px;" src="https://www.margonem.pl/profile/payments"></iframe><div class="closebut" rollover="22" id="sl_shop_close_button" onclick="slShopClose()"></div></div>'),
        $("#centerbox").append(s)
    }
}
function slShopClose() {
    $("#slshop").remove()
}
function showStaminaShop() {
    g.lock.add("staminashop"),
    updateStaminaDescription(),
    $("#staminashop").absCenter().fadeIn()
}
function staminaShopOptionChoose(e, s) {
    var t = [_t("stamina_shop choosen_option", null, "default"), _t("stamina_shop_sure", null, "default"), "<div style='text-align:center'>", "</div>", "<br/><br/>", _t("stamina_buy_info_increase", null, "default"), _t("stamina_buy_info-decrease", null, "default")]
      , o = {
        "%state%": s ? _t("add") : _t("sub")
    }
      , p = {
        1: _t("for_today_desc", o, "static"),
        7: _t("for_week_desc", o, "static"),
        30: _t("for_30days_desc", o, "static")
    };
    mAlert(t[2] + t[0] + t[4] + p[e] + t[4] + (s ? t[5] : t[6]) + t[4] + t[1] + t[4] + t[3], 1, [function() {
        _g("creditshop&ttl_days=" + e + "&ttl_del=" + (s ? "0" : "1")),
        hideStaminaShop()
    }
    , function() {}
    ])
}
function updateStaminaDescription() {
    var e = hero.ttl_end
      , s = hero.ttl_del
      , t = $("#staminashop").find("#_t3new");
    if (!e || e && e < ts() / 1e3)
        t.css("display", "none");
    else {
        t.css("display", "block");
        var o = 0 == s ? _t("stamina_increase") : _t("stamina_decrease");
        t.html(o + " " + ut_fulltime(e))
    }
}
function hideStaminaShop() {
    return $("#staminashop").fadeOut(),
    g.lock.remove("staminashop"),
    !1
}
function buyStamina(e) {
    _g("creditshop&ttl=" + {
        1: 1,
        2: 7,
        8: 30
    }[e]),
    $(".staminaOption").removeClass("step2")
}
function showGoldShop(e) {
    e = e.split(";"),
    $("#goldShop .options").html();
    for (var s = 0; s < e.length; s++) {
        var t = e[s].split("=");
        $('<div class="goldBox box_' + s + '"><div class="bg" onclick="goldShopBuy(' + t[0] + ", " + t[1] + ')"><span class=sl>' + t[0] + _t("sl", null, "clan") + "</span><span class=gold>" + round(t[1], 3) + "</span></div></div>").appendTo("#goldShop .options")
    }
    $("#goldShop").show()
}
function hideGoldShop() {
    return $("#goldShop").hide().find(".options").html(""),
    !1
}
function goldShopBuy(e, s) {
    mAlert(_t("gold_buy_confirm %sl% %gold%", {
        "%sl%": e,
        "%gold%": s
    }), 2, [function() {
        _g("creditshop&credits_gold=" + e)
    }
    , null])
}
this.shopNewItem = function(e, s) {
    g.shop.tpls[e.id] = e,
    s && _this.createOffers(g.shop.items_offers)
}
;
var timeout = null
  , disableClass = "disabled"
  , $tradeAccept = $("#tradeaccept");
function tradeInit(e) {
    g.lock.add("trade"),
    g.trade = {
        id: e,
        items: 0,
        myitems: 0,
        myval: 0,
        val: 0,
        mygold: 0,
        gold: 0,
        accept: 0,
        myaccept: 0
    },
    $("#tradeaccept").css("backgroundPosition", "-69px -163px"),
    $("#tradeaccept2").css("backgroundPosition", "0 -163px"),
    $("#tr2_gold").html(""),
    $("#mytr_gold").val(""),
    $("#tr2_value").html("0"),
    $("#mytr_value").html("0"),
    $("#mytrader").css({
        backgroundImage: "url(" + hero.icon + ")",
        width: hero.fw,
        height: hero.fh,
        backgroundPosition: "0 -" + hero.fh + "px"
    }).attr("tip", hero.nick),
    isset(g.other[e]) ? tradeSetupOther(g.other[e]) : g.checklist["other" + e] = tradeSetupOther,
    $("#trade").fadeIn("fast")
}
function tradeUpdate(e) {
    for (var t in e)
        "init" != t && (g.trade[t] = e[t]);
    if (isset(e.acceptLockSeconds) && setTimer(e.acceptLockSeconds),
    isset(e.gold)) {
        var a = "";
        e.gold < 1e3 ? a = "#888" : e.gold < 1e6 && (a = "white"),
        $("#tr2_gold").html(round(e.gold, 3)).css("color", a)
    }
    if (isset(e.mygold)) {
        a = "";
        e.mygold < 1e3 ? a = "#888" : e.mygold < 1e6 && (a = "white"),
        $("#mytr_gold").val(round(e.mygold, 3)).css("color", a)
    }
    isset(e.myaccept) && $("#tradeaccept").css("backgroundPosition", e.myaccept ? "-207px -163px" : "-69px -163px"),
    isset(e.accept) && $("#tradeaccept2").css("backgroundPosition", e.accept ? "-276px -163px" : "0px -163px"),
    isset(e.close) && tradeClose()
}
var setTimer = function(e) {
    timeout && clearTimeout(timeout),
    checkBlockAccept() || ($tradeAccept.addClass(disableClass),
    $tradeAccept.tip(_t("change_money_or_items"))),
    timeout = setTimeout((function() {
        $tradeAccept.removeClass(disableClass),
        Tip.hide(),
        $tradeAccept.removeAttr("tip")
    }
    ), 1e3 * e)
}
  , checkBlockAccept = function() {
    return $tradeAccept.hasClass(disableClass)
};
function tradeSetupOther(e) {
    $("#trader2").css({
        backgroundImage: "url(" + g.opath + "postacie" + e.icon + ")",
        width: e.fw,
        height: e.fh,
        backgroundPosition: "0 -" + 2 * e.fh + "px"
    }).attr("tip", e.nick)
}
function trade_sell(e) {
    var t = $(e).attr("id").substr(4);
    "block" == $("#trade").css("display") && _g("trade&a=add&tid=" + t)
}
function trade_gold() {
    var e = parsePrice($("#mytr_gold").val());
    if (e > hero.gold) {
        mAlert(_t("gold_low", null, "trade"));
        e < 1e3 ? "#888" : e < 1e6 && "white",
        $("#mytr_gold").val(round(g.trade.mygold, 3))
    } else
        _g("trade&a=gold&val=" + e)
}
function tradeAccept() {
    if (!checkBlockAccept())
        if (g.trade.myaccept)
            _g("trade&a=noaccept");
        else {
            var e = ""
              , t = "";
            for (var a in g.item)
                "t" == g.item[a].loc && (g.item[a].own == hero.id ? t += "," + a : e += "," + a);
            _g("trade&a=accept&buy=" + g.trade.gold + e + "&sell=" + g.trade.mygold + t)
        }
}
function tradeClear(e) {
    var t = {};
    for (var a in g.item)
        "t" != g.item[a].loc && "s" != g.item[a].loc || ($("#item" + a).remove(),
        e && "s" != g.item[a].loc || g.item[a].own != hero.id ? delete g.item[a] : (g.item[a].loc = "g",
        g.item[a].returned = !0,
        t[a] = g.item[a],
        $("#item" + a).css({
            backgroundImage: "url(" + CFG.ipath + g.item[a].icon + ")"
        })));
    newItem(t)
}
function trade_start(e) {
    _g("trade&a=ask&id=" + e)
}
function tradeCancel() {
    _g("trade&a=cancel")
}
function tradeClose() {
    g.lock.remove("trade"),
    $("#trade").fadeOut("fast"),
    tradeClear(g.trade.myaccept && g.trade.accept),
    g.trade = {
        id: 0
    }
}
function _typeof(t) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t
    }
    : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    }
    ,
    _typeof(t)
}
function itemChanger() {
    var t, e = this, a = [], r = [], i = [], n = !0, s = null, l = null, c = {};
    this.wnd = null,
    this.init = function() {
        this.initWindow(),
        this.initFetch(),
        this.initTableHeader(),
        this.initSelect(),
        this.initStartLvl(),
        this.initStopLvl(),
        this.initCheckbox(),
        this.initClose(),
        this.wnd.$.find(".filter-label").html("Lvl:"),
        g.lock.add("itemChanger")
    }
    ,
    this.initClose = function() {
        this.wnd.$.find(".close-but").click((function() {
            e.close()
        }
        ))
    }
    ,
    this.initCheckbox = function() {
        var t = $("<div>").addClass("my-checkbox")
          , a = $("<div>").html(_t("available_barter")).addClass("label");
        t.append(a),
        e.wnd.$.find(".bottom-item-changer-panel").append(t),
        t.click((function() {
            $(this).toggleClass("active"),
            n = !$(this).hasClass("active"),
            _g("barter&id=" + s + "&action=show&available=" + (n ? 0 : 1))
        }
        ))
    }
    ,
    this.createRecords = function(t, e) {
        for (var a = $("<tr>"), r = 0; r < t.length; r++) {
            var i = $("<td>").html(t[r]);
            "object" == _typeof(e) ? i.addClass(e[r]) : i.addClass(e),
            a.append(i)
        }
        return a
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("f", e.createBarterItem)
    }
    ,
    this.initTableHeader = function() {
        e.wnd.$.find(".static-bar-table").append(e.createRecords([_t("cost_table"), _t("item", null, "recover"), _t("action", null, "recover")], ["barter-table-header cost-cell", "barter-table-header item-cell", "barter-table-header action"]))
    }
    ,
    this.initWindow = function() {
        (t = e.getTplItemChanger()).find(".item-changer-label").html(goldTxt("Barter")),
        this.wnd = {},
        this.wnd.$ = t,
        $("#item-changer").append(this.wnd.$),
        $("#item-changer").css("display", "block")
    }
    ,
    this.updateTitle = function(t) {
        e.wnd.$.find(".item-changer-label").html(goldTxt(t))
    }
    ,
    this.updateScroll = function() {
        $(".scroll-wrapper", e.wnd.$).trigger("update")
    }
    ,
    this.createBarterItem = function(t) {
        c[t.id] && delete c[t.id],
        c[t.id] = t
    }
    ,
    this.getNewItemType = function(t) {
        return t.hasOwnProperty("heroic") ? "h" : t.hasOwnProperty("unique") ? "u" : t.hasOwnProperty("legendary") ? "l" : "*"
    }
    ,
    this.createAttrToSort = function(t, a) {
        var r = g.tplsManager.parseTplStat(t.stat)
          , i = e.getNewItemType(r);
        isset(r.lvl) && e.lvlParse(r, a),
        isset(r.reqp) && e.profParse(r, a),
        i && e.itemTypeParse(t, a),
        t.cl && e.parseItemCl(t, a)
    }
    ,
    this.lvlParse = function(t, e) {
        var a = parseInt(t.lvl);
        e.attr("lvl") ? a > parseInt(e.attr("lvl")) && e.attr("lvl", a) : e.attr("lvl", a)
    }
    ,
    this.profParse = function(t, e) {
        var a = "all" == t.reqp ? ["*"] : t.reqp.split("");
        if (e.attr("reqp")) {
            var r = e.attr("reqp").split(",");
            if ("*" == r[0])
                return;
            if ("*" == a[0])
                return void e.attr("reqp", "*");
            for (var i = [], n = 0; n < a.length; n++)
                r.indexOf(a[n]) < 0 && i.push(a[n]);
            e.attr("reqp", r.concat(i).join())
        } else
            e.attr("reqp", a.join())
    }
    ,
    this.itemTypeParse = function(t, a) {
        var r = g.tplsManager.parseTplStat(t.stat)
          , i = [e.getNewItemType(r)];
        if (a.attr("itemType")) {
            var n = a.attr("itemType").split(",");
            if ("*" == n[0])
                return;
            if ("*" == i[0])
                return void a.attr("itemType", "*");
            for (var s = [], l = 0; l < i.length; l++)
                n.indexOf(i[l]) < 0 && s.push(i[l]);
            a.attr("itemType", n.concat(s).join())
        } else
            a.attr("itemType", i.join())
    }
    ,
    this.parseItemCl = function(t, e) {
        var a = [t.cl];
        if (e.attr("itemCl")) {
            for (var r = e.attr("itemCl").split(","), i = [], n = 0; n < a.length; n++)
                r.indexOf(a[n]) < 0 && i.push(a[n]);
            e.attr("itemCl", r.concat(i).join())
        } else
            e.attr("itemCl", a.join())
    }
    ,
    this.getItemType = function(t) {
        switch (t) {
        case "t-norm":
            return "*";
        case "t-her":
            return "h";
        case "t-leg":
            return "l";
        case "t-uniupg":
            return "u";
        default:
            console.warn("bug type item" + t)
        }
    }
    ,
    this.createOffer = function(t, a) {
        var r = t.id
          , i = $("<div>").addClass("action-wrapper")
          , n = $("<div>").addClass("cost-wrapper");
        n.append(e.createLimitCell(t)),
        i.append(e.createButtonAction(t)),
        i.append(n);
        for (var s = e.createRecords([e.createCost(t), e.createItemCell(t), i], ["cost-cell", "item-cell", "action"]).addClass("one-barter-offer barter-offer-" + r), l = 0; l < t.recived.length; l++) {
            var o = t.recived[l][0];
            e.createAttrToSort(c[o], s)
        }
        (a.append(s),
        e.getAvailable(r)) && ("false" !== s.find(".cost-wrapper").attr("data-cost-available") && e.wnd.$.find(".barter-offer-" + r).find(".action").find(".SI-button").removeClass("black"))
    }
    ,
    this.prepareArray = function(t, e) {
        for (var a = 0; a < e.length; a++)
            t.push(e[a])
    }
    ,
    this.setStateDoActionButtonFromTpl = function(t, a) {
        var r = e.wnd.$.find(".barter-offer-" + a).find(".action").find(".button");
        r.removeClass("disable"),
        this.getOwned(t) || r.addClass("disable")
    }
    ,
    this.update = function(t) {
        var n = e.wnd.$.find(".table-item-changer-content").empty();
        s = t.id,
        a = [],
        i = [],
        r = [],
        l = t.name,
        this.updateTitle(l),
        this.prepareArray(a, t.available),
        this.prepareArray(i, t.usages),
        this.prepareArray(r, t.owned);
        for (var c = 0; c < t.offers.length; c++) {
            var o = t.offers[c];
            e.createOffer(o, n)
        }
        e.resetFilter(),
        e.updateScroll()
    }
    ,
    this.createCost = function(t) {
        if (!t.cost)
            return "-";
        var a = e.getTplCostWrapper();
        switch (t.cost.currency) {
        case 1:
            var r = (i = t.cost.value < hero.gold) ? "green" : "red";
            this.setCostAvailableData(a, i),
            a.html(round(t.cost.value, 2)).addClass(r);
            break;
        case 2:
            r = (i = t.cost.value < hero.credits) ? "green" : "red";
            this.setCostAvailableData(a, i),
            a.html(t.cost.value + _t("sl", null, "clan")).addClass(r);
            break;
        case 3:
            e.createCostItem(t.cost.itemTpl, t.cost.value, a);
            break;
        case 4:
            var i;
            r = (i = t.cost.value < hero.honor) ? "green" : "red";
            this.setCostAvailableData(a, i),
            a.html(t.cost.value + "PH").addClass(r)
        }
        return a
    }
    ,
    this.setCostAvailableData = function(t, e) {
        e = void 0 === e || e,
        t.attr("data-cost-available", e)
    }
    ,
    this.createButtonAction = function(t) {
        var r = drawSIButton(_t("do_offer")).addClass("black");
        return null !== a && r.bind("click", (function() {
            e.askAlert(t)
        }
        )),
        r
    }
    ,
    this.setCostInData = function(t) {
        if (!t.cost)
            return "";
        switch (t.cost.currency) {
        case 1:
            return "<br>" + _t("all_cost") + '<span id="alert-cost-item-changer">' + t.cost.value + "</span>";
        case 2:
            return "<br>" + _t("all_cost") + '<span id="alert-cost-item-changer">' + t.cost.value + "</span><span>" + _t("sl") + "</span>";
        case 3:
            return "<br>" + _t("all_cost") + '<span id="alert-cost-item-changer">' + t.cost.value + "</span><span> " + c[t.cost.itemTpl].name + "</span>";
        case 4:
            return "<br>" + _t("all_cost") + '<span id="alert-cost-item-changer">' + t.cost.value + "</span><span>PH</span>";
        default:
            console.log("bug currency: " + t.cost.currency)
        }
    }
    ,
    this.createLimitCell = function(t, a) {
        if (!t.limit)
            return "-";
        var r = e.getUsages(t.id)
          , i = r || 0
          , n = a ? "<br>" : " ";
        switch (t.limit.period) {
        case 0:
            return "-";
        case 1:
            return i + "/" + t.limit.max + n + _t("on_day");
        case 2:
            return i + "/" + t.limit.max + n + _t("on_week");
        case 3:
            return i + "/" + t.limit.max + n + _t("on_month")
        }
    }
    ,
    this.createItemCell = function(t) {
        var a = e.getTplRequireAndReceiveItem();
        if (1 == t.mode)
            e.createRequire(t, a.find(".require-wrapper-align"));
        else {
            var r = a.find(".require-wrapper-align");
            e.createRequire(t, r, !1, !0)
        }
        return e.createRecive(t.recived, a.find(".recive-wrapper-align")),
        a
    }
    ,
    this.createRequire = function(t, a, r, i) {
        for (var n = t.required, s = 0; s < n.length; s++) {
            var l = e.getTplRequireItem();
            if (a.append(l),
            i)
                return l.addClass("choose-item can-choose-item"),
                l.find(".seperator").html("?"),
                void e.openItemChangerGroup(l, t);
            var c = n[s]
              , o = c[0]
              , d = c[1];
            e.fillRequireItem(l, o, d),
            e.addItemToRequire(l, o, d),
            r && g.itemChangerGroup.setItemInGroup(t, l, o, d)
        }
    }
    ,
    this.addItemToRequire = function(t, a, r) {
        var i = c[a].$.clone();
        i.attr("data-id", a),
        t.find(".item-wrapper").append(i),
        i.click((function(t) {
            var a = $(this)
              , r = a.attr("data-id");
            e.showMenuItem(t, r, a)
        }
        ))
    }
    ,
    this.fillRequireItem = function(t, a, r) {
        var i = e.getOwned(a)
          , n = i ? parseInt(i) : 0
          , s = parseInt(r) <= n ? "green" : "red";
        t.addClass("tpl-item-" + a),
        t.find(".require-state").removeClass("green red").addClass(s),
        t.find(".current-owned").html(n),
        t.find(".need-to-use").html(r)
    }
    ,
    this.openItemChangerGroup = function(t, e) {
        t.click((function(t) {
            t.stopPropagation(),
            g.itemChangerGroup && g.itemChangerGroup.close(),
            g.itemChangerGroup = new itemChangerGroup,
            g.itemChangerGroup.init(),
            g.itemChangerGroup.update(e)
        }
        ))
    }
    ,
    this.createRecive = function(t, a) {
        for (var r = 0; r < t.length; r++) {
            var i = t[r]
              , n = e.getTplReciveItem()
              , s = i[0]
              , l = i[1]
              , o = c[s]
              , d = o.$.clone();
            d.attr("data-id", s),
            n.addClass("tpl-item-" + s).find(".item-wrapper").append(d),
            a.append(n),
            g.tplsManager.changeItemAmount(o, d, l),
            d.click((function(t) {
                var a = $(this)
                  , r = a.attr("data-id");
                e.showMenuItem(t, r, a)
            }
            ))
        }
    }
    ,
    this.createCostItem = function(t, a, r) {
        var i = e.getTplCostItem()
          , n = e.getOwned(t)
          , s = n ? parseInt(n) : 0
          , l = parseInt(a) <= s
          , o = i.addClass("tpl-item-" + t).find(".item-wrapper");
        i.find(".require-state").removeClass("green red").addClass(l ? "green" : "red"),
        i.find(".current-owned").html(s),
        i.find(".need-to-use").html(a);
        var d = c[t].$.clone();
        d.attr("data-id", t),
        o.append(d),
        r.append(i),
        this.setCostAvailableData(r, l),
        d.click((function(t) {
            var a = $(this)
              , r = a.attr("data-id");
            e.showMenuItem(t, r, a)
        }
        ))
    }
    ,
    this.showMenuItem = function(t, e, a) {
        if (isset(parseItemStat(g.tplsManager.getItems().f[e].stat).canpreview)) {
            var r = '_g("moveitem&st=2&tpl=' + e + '"); g.tplsManager.deleteMessItemsByLoc("p");g.tplsManager.deleteMessItemsByLoc("s");';
            showMenu({
                target: a
            }, [[_t("show", null, "item"), r, !0]])
        }
    }
    ,
    this.newRecipeItem = function(t, e, a) {
        var r = new Item(a,e,"item");
        t.append(r.$),
        r.hasMenu && (r.$.css("cursor", "url(../img/gui/cursor/5.png), auto"),
        r.$.click((function(t) {
            r.createOptionMenu(t)
        }
        )))
    }
    ,
    this.initSelect = function() {
        var t = e.wnd.$
          , a = t.find(".choose-prof")
          , r = t.find(".choose-item-type")
          , i = t.find(".choose-cl")
          , n = {
            "*": _t("class", null, "eq_prof"),
            m: _t("prof_mage", null, "auction"),
            w: _t("prof_warrior", null, "auction"),
            p: _t("prof_paladin", null, "auction"),
            t: _t("prof_tracker", null, "auction"),
            h: _t("prof_hunter", null, "auction"),
            b: _t("prof_bdancer", null, "auction")
        };
        for (var s in n) {
            var l = $("<option>").attr("val", s).html(n[s]);
            a.append(l)
        }
        var c = {
            "*": _t("type_item_changer"),
            u: _t("type_unique", null, "auction"),
            h: _t("type_heroic", null, "auction"),
            l: _t("type_legendary", null, "auction")
        };
        for (var s in c) {
            l = $("<option>").attr("val", s).html(c[s]);
            r.append(l)
        }
        for (var o = ["cl_onehanded", "cl_twohanded", "cl_bastard", "cl_distance", "cl_helpers", "cl_wands", "cl_staffs", "cl_armor", "cl_helmets", "cl_boots", "cl_gloves", "cl_rings", "cl_neclaces", "cl_shield", "cl_neutral", "cl_usable", "cl_gold", "cl_keys", "cl_quests", "cl_renewable", "cl_arrows", "cl_talisman", "cl_books", "cl_bags", "cl_bless", "cl_improve"], d = {}, p = 0; p < o.length; p++)
            d[p + 1] = _t(o[p], null, "eq_cl");
        for (var s in i.append($("<option>").attr("val", "*").html(_t("type", null, "item_changer"))),
        d) {
            l = $("<option>").attr("val", s).html(d[s]);
            i.append(l)
        }
        a.change((function() {
            e.startFilter()
        }
        )),
        r.change((function() {
            e.startFilter()
        }
        )),
        i.change((function() {
            e.startFilter()
        }
        )),
        t.find(".start-lvl").attr("placeholder", _t("start")),
        t.find(".stop-lvl").attr("placeholder", _t("stop"))
    }
    ,
    this.initStartLvl = function() {
        this.wnd.$.find(".start-lvl").keyup((function() {
            e.startFilter()
        }
        ))
    }
    ,
    this.initStopLvl = function() {
        this.wnd.$.find(".stop-lvl").keyup((function() {
            e.startFilter()
        }
        ))
    }
    ,
    this.startFilter = function() {
        e.wnd.$.find(".one-barter-offer").css("display", "table-row"),
        e.lvlKeyUp(),
        e.getValueFromProf(),
        e.getValueFromItemType(),
        e.getValueFromCl(),
        e.updateScroll()
    }
    ,
    this.resetFilter = function() {
        this.wnd.$.find(".start-lvl").val(""),
        this.wnd.$.find(".stop-lvl").val(""),
        this.wnd.$.find(".menu").each((function() {
            var t = $(this).find("option:first").val();
            $(this).val(t)
        }
        ))
    }
    ,
    this.lvlKeyUp = function() {
        var t = this.wnd.$.find(".start-lvl").val()
          , a = this.wnd.$.find(".stop-lvl").val()
          , r = e.wnd.$.find(".one-barter-offer");
        "" == t && "" == a || ("" == t && (t = 0),
        "" == a && (a = 1e3),
        r.each((function() {
            if ("none" != $(this).css("display")) {
                var e = $(this).attr("lvl")
                  , r = e >= parseInt(t) && e <= parseInt(a) ? "table-row" : "none";
                $(this).css("display", r)
            }
        }
        )))
    }
    ,
    this.getValueFromProf = function() {
        var t = e.wnd.$.find(".choose-prof  option:selected").attr("val");
        "*" != t && e.wnd.$.find(".one-barter-offer").each((function() {
            if ("none" != $(this).css("display") && $(this).attr("reqp")) {
                var e = $(this).attr("reqp").split(",").indexOf(t) > -1 ? "table-row" : "none";
                $(this).css("display", e)
            }
        }
        ))
    }
    ,
    this.getValueFromCl = function() {
        var t = e.wnd.$.find(".choose-cl option:selected").attr("val");
        "*" != t && e.wnd.$.find(".one-barter-offer").each((function() {
            if ("none" != $(this).css("display") && $(this).attr("itemCl")) {
                var e = $(this).attr("itemCl").split(",").indexOf(t) > -1 ? "table-row" : "none";
                $(this).css("display", e)
            }
        }
        ))
    }
    ,
    this.getValueFromItemType = function() {
        var t = e.wnd.$.find(".choose-item-type  option:selected").attr("val");
        "a" != t && e.wnd.$.find(".one-barter-offer").each((function() {
            if ("none" != $(this).css("display")) {
                var a = $(this).attr("itemType");
                if (a) {
                    var r, i = a.split(",");
                    switch (t) {
                    case "u":
                        r = e.check(i, "u") || e.check(i, "h") || e.check(i, "l") ? "table-row" : "none";
                        break;
                    case "h":
                        r = e.check(i, "h") || e.check(i, "l") ? "table-row" : "none";
                        break;
                    case "l":
                        r = e.check(i, "l") ? "table-row" : "none"
                    }
                    $(this).css("display", r)
                }
            }
        }
        ))
    }
    ,
    this.check = function(t, e) {
        return t.indexOf(e) > -1
    }
    ,
    this.getAvailable = function(t) {
        for (var e = 0; e < a.length; e++) {
            var r = a[e];
            if (r[0] == t)
                return r[1]
        }
        return null
    }
    ,
    this.getOwned = function(t) {
        for (var e = 0; e < r.length; e++) {
            var a = r[e];
            if (a[0] == t)
                return a[1]
        }
        return null
    }
    ,
    this.getUsages = function(t) {
        for (var e = 0; e < i.length; e++) {
            var a = i[e];
            if (a[0] == t)
                return a[1]
        }
        return null
    }
    ,
    this.askAlert = function(t) {
        var a = t.id
          , r = e.getAvailable(a)
          , i = (t.limit ? _t("limit", null, "item_changer") + "<b>" + e.createLimitCell(t) + "</b><br>" : "") + _t("reagents", null, "item_changer") + "<b>" + r + " szt.</b>" + e.setCostInData(t);
        mAlert(i, 3, [function() {
            var t = $('#alert input[name="mAlertInput"]').val();
            _g("barter&id=" + s + "&offerId=" + a + "&action=use&usesCount=" + t + "&available=" + (n ? 0 : 1))
        }
        , function() {
            console.log("none")
        }
        ]),
        t.cost && $("#alert .a2").keyup((function() {
            var e = $('#alert input[name="mAlertInput"]').val();
            "" == e && (e = 0),
            $("#alert-cost-item-changer").html(parseInt(t.cost.value) * parseInt(e))
        }
        )),
        $('#alert input[name="mAlertInput"]').val(1),
        $('#alert input[name="mAlertInput"]')[0].setAttribute("type", "number")
    }
    ,
    this.close = function() {
        g.lock.remove("itemChanger"),
        $("#item-changer").css("display", "none"),
        e.wnd.$.remove(),
        g.tplsManager.removeCallback("f", e.createBarterItem),
        g.tplsManager.deleteMessItemsByLoc("f"),
        delete e.wnd,
        a = [],
        r = [],
        i = [],
        c = {},
        g.itemChanger = !1
    }
    ,
    this.getTplItemChanger = function() {
        return $('<div class="item-changer"><div class="header-wrapper"><div class="graphic"></div><div class="item-changer-label"></div></div><div class="filter-wrapper"><div class="filter-label"></div><input class="start-lvl default"/><input class="stop-lvl default"/><div class="choose-prof-wrapper"><select class="choose-prof menu"></select></div><div class="choose-item-type-wrapper"><select class="choose-item-type menu"></select></div><div class="choose-cl-wrapper"><select class="choose-cl menu"></select></div></div><table class="static-bar-table"></table><div class="scroll-wrapper classic-bar"><div class="scroll-pane"><div class="middle-graphics"></div><div class="paper-graphics"></div><table class="table-item-changer-content"></table></div></div><div class="bottom-item-changer-panel"><div class="bottom-panel-graphics"></div></div><div class="close-but"></div></div>')
    }
    ,
    this.getTplRequireAndReceiveItem = function() {
        return $('<div class="require-and-receive-item"><div class="require-wrapper"><div class="require-wrapper-align"></div></div><div class="arrow"></div><div class="recive-wrapper"><div class="recive-wrapper-align"></div></div></div>')
    }
    ,
    this.getTplRequireItem = function() {
        return $('<div class="require-item"><div class="item-wrapper"></div><div class="require-state"><span class="current-owned"></span>/<span class="need-to-use"></span></div></div>')
    }
    ,
    this.getTplCostWrapper = function() {
        return $('<div class="cost-wrapper"></div>')
    }
    ,
    this.getTplCostItem = function() {
        return $('<div class="cost-item"><div class="item-wrapper"></div><div class="require-state"><span class="current-owned"></span>/<span class="need-to-use"></span></div></div>')
    }
    ,
    this.getTplReciveItem = function() {
        return $('<div class="recive-item"><div class="item-wrapper"></div></div>')
    }
}
function itemChangerGroup() {
    var t, e = this;
    this.wnd = null,
    this.init = function() {
        this.initWindow(),
        this.wnd.$.find(".header-wrapper-text").html(_t("barter_group_header") + ":")
    }
    ,
    this.initBackgroundGrid = function() {
        for (var t = 0; t < 40; t++)
            e.wnd.$.find(".background-grid").append($("<div>").addClass("background-grid-element"))
    }
    ,
    this.initFetch = function() {
        g.tplsManager.fetch("f", e.createItemChangerGroupItem)
    }
    ,
    this.createItemChangerGroupItem = function(t) {
        e.wnd.$.find(".tpl-item-" + t.id).find(".item-wrapper").each((function() {
            var e = t.$.clone();
            if ($(this).html(e),
            $(this).parent().hasClass("recive-item")) {
                var i = $(this).attr("data-amount");
                g.tplsManager.changeItemAmount(t, e, i),
                e.attr("data-tip-type", t.$.data("tipType")),
                e.attr("data-item-type", t.$.data("itemType"))
            }
        }
        ))
    }
    ,
    this.initWindow = function() {
        (t = e.getItemChangerGroup()).find(".header-wrapper").html(goldTxt("Barter")),
        this.wnd = {
            $: t
        },
        $("#item-changer-group").append(this.wnd.$),
        t.find(".close-but").click(e.close)
    }
    ,
    this.update = function(t) {
        e.createGrid(t),
        e.initFetch()
    }
    ,
    this.setItemInGroup = function(t, i, r, n) {
        i.click((function() {
            r,
            t;
            var a = t.id
              , d = i.find(".item").clone()
              , o = g.itemChanger.wnd.$.find(".barter-offer-" + a).find(".choose-item");
            o.removeClass("can-choose-item"),
            g.itemChanger.fillRequireItem(o, r, n),
            g.itemChanger.setStateDoActionButtonFromTpl(r, a),
            o.find(".seperator").html("/"),
            o.find(".item-wrapper").html(d),
            o.attr("set-group-item", r),
            e.close()
        }
        ))
    }
    ,
    this.createGrid = function(t) {
        var i = e.wnd.$.find(".grid").empty();
        g.itemChanger.createRequire(t, i, !0)
    }
    ,
    this.close = function() {
        e.wnd.$.remove(),
        g.tplsManager.removeCallback("f", e.createItemChangerGroupItem),
        delete e.wnd,
        g.itemChangerGroup = !1
    }
    ,
    this.getItemChangerGroup = function() {
        return $('<div class="item-changer-group"><div class="close-but"></div><div class="header-wrapper"></div><div class="header-wrapper-text"></div><div class="background-grid"></div><div class="grid"></div></div>')
    }
}
function MinigameLoader() {
    this.game = null,
    this.v = null,
    this.data = null;
    var a = this;
    this.loadImages = function(t) {
        var s = 0;
        for (var e in t.list) {
            var i = new Image;
            i.src = "games/js/" + this.data.name + "/img/" + t.list[e],
            i.onload = function() {
                ++s == t.amount && a.start()
            }
        }
    }
    ,
    this.loadCss = function(a) {
        $("head").append('<link rel="stylesheet" type="text/css" href="games/js/' + this.data.name + "/" + a + "?ts=" + unix_time() + '" />')
    }
    ,
    this.initGame = function(a) {
        this.v = a,
        this.task({
            c: "init"
        })
    }
    ,
    this.loadScripts = function(t) {
        this.data = t,
        null == window["g_" + t.name] ? $.getScript("games/js/" + t.name + "/g_" + t.name + ".js?ts=" + unix_time(), (function() {
            a.game = new window["g_" + t.name](a),
            a.game.initData = t,
            isset(t.files) ? a.loadImages(t.files) : a.start(),
            isset(t.css) && a.loadCss(t.css)
        }
        )) : (a.game = new window["g_" + t.name](a),
        a.game.initData = t,
        a.start())
    }
    ,
    this.start = function() {
        $("#load_game").remove(),
        this.game.run()
    }
    ,
    this.task = function(t) {
        null != this.game && this.game.lock(),
        $.ajax({
            url: "".concat(g.worldConfig.getApiDomain(), "/minigames/").concat(g.worldConfig.getWorldName()),
            type: "post",
            xhrFields: {
                withCredentials: !0
            },
            crossDomain: !0,
            dataType: "json",
            data: {
                d: t,
                g: a.v
            },
            success: function(t) {
                null != a.game && a.game.unlock(),
                a.parseMessage(t)
            }
        })
    }
    ,
    this.parseMessage = function(a) {
        if (!a)
            return !1;
        switch (a.t) {
        case "init":
            this.loadScripts(a);
            break;
        case "nogame":
            null != this.game ? this.game.endGame() : _g("endgame");
        default:
            this.game.parseMessage(a)
        }
    }
}
